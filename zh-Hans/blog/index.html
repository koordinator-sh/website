<!doctype html>
<html lang="zh-Hans" dir="ltr" class="blog-wrapper blog-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Blog | Koordinator</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://koordinator.sh/zh-Hans/blog"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" property="og:title" content="Blog | Koordinator"><meta data-rh="true" name="description" content="Blog"><meta data-rh="true" property="og:description" content="Blog"><meta data-rh="true" name="docusaurus_tag" content="blog_posts_list"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_posts_list"><link data-rh="true" rel="icon" href="/zh-Hans/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://koordinator.sh/zh-Hans/blog"><link data-rh="true" rel="alternate" href="https://koordinator.sh/blog" hreflang="en"><link data-rh="true" rel="alternate" href="https://koordinator.sh/zh-Hans/blog" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://koordinator.sh/blog" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://FKASWWQYOP-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/zh-Hans/blog/rss.xml" title="Koordinator RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh-Hans/blog/atom.xml" title="Koordinator Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Koordinator" href="/zh-Hans/opensearch.xml"><link rel="stylesheet" href="/zh-Hans/assets/css/styles.d55f2266.css">
<link rel="preload" href="/zh-Hans/assets/js/runtime~main.004cc254.js" as="script">
<link rel="preload" href="/zh-Hans/assets/js/main.7c3c3fd8.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="è·³åˆ°ä¸»è¦å†…å®¹"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">è·³åˆ°ä¸»è¦å†…å®¹</a></div><div class="announcementBar_mb4j" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">â­ï¸ If you like Koordinator, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/koordinator-sh/koordinator">GitHub</a>! â­ï¸</div><button type="button" aria-label="å…³é—­" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="ä¸»å¯¼èˆª" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="åˆ‡æ¢å¯¼èˆªæ " aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh-Hans/"><div class="navbar__logo"><img src="/zh-Hans/img/logo.svg" alt="Koordinator" class="themedImage_ToTc themedImage--light_HNdA"><img src="/zh-Hans/img/logo.svg" alt="Koordinator" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Koordinator</b></a><a class="navbar__item navbar__link" href="/zh-Hans/docs">æ–‡æ¡£</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zh-Hans/blog">åšå®¢</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/zh-Hans/docs/">v1.7</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh-Hans/docs/next/">v1.8 ğŸš§</a></li><li><a class="dropdown__link" href="/zh-Hans/docs/">v1.7</a></li><li><a class="dropdown__link" href="/zh-Hans/docs/v1.6/">v1.6</a></li><li><a class="dropdown__link" href="/zh-Hans/docs/v1.5/">v1.5</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>ç®€ä½“ä¸­æ–‡</a><ul class="dropdown__menu"><li><a href="/blog" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/zh-Hans/blog" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-Hans">ç®€ä½“ä¸­æ–‡</a></li></ul></div><a href="https://github.com/koordinator-sh/koordinator" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="åˆ‡æ¢æµ…è‰²/æš—é»‘æ¨¡å¼ï¼ˆå½“å‰ä¸ºæµ…è‰²æ¨¡å¼ï¼‰" aria-label="åˆ‡æ¢æµ…è‰²/æš—é»‘æ¨¡å¼ï¼ˆå½“å‰ä¸ºæµ…è‰²æ¨¡å¼ï¼‰" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="æœç´¢"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">æœç´¢</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="æœ€è¿‘åšæ–‡å¯¼èˆª"><div class="sidebarItemTitle_pO2u margin-bottom--md">æ‰€æœ‰æ–‡ç« </div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-Hans/blog/release-v1.7.0">Koordinator v1.7: åŸºäºç½‘ç»œæ‹“æ‰‘æ„ŸçŸ¥è°ƒåº¦å’Œä½œä¸šçº§æŠ¢å èµ‹èƒ½å¤§è§„æ¨¡ AI è®­ç»ƒ</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-Hans/blog/release-v1.6.0">Koordinator v1.6: æ”¯æŒ AI/ML åœºæ™¯çš„å¼‚æ„èµ„æºè°ƒåº¦èƒ½åŠ›</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-Hans/blog/release-v1.5.0">Koordinator v1.5: æŒç»­ä¼˜åŒ–ï¼Œè¿›å…¥ CNCF Sandbox</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-Hans/blog/release-v1.4.0">Koordinator v1.4: æ›´å¤šçš„è®¡ç®—è´Ÿè½½ç±»å‹å’Œæ›´çµæ´»çš„èµ„æºç®¡ç†æœºåˆ¶</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-Hans/blog/release-v1.3.0">Koordinator v1.3: å¢å¼ºèµ„æºé¢„ç•™ï¼Œæ”¯æŒ NRIï¼Œæä¾›èŠ‚ç‚¹ç”»åƒçš„ Mid èµ„æºè¶…å–</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-Hans/blog/release-v1.2.0">Koordinator v1.2: æ”¯æŒèŠ‚ç‚¹èµ„æºé¢„ç•™ï¼Œå…¼å®¹ç¤¾åŒºé‡è°ƒåº¦ç­–ç•¥</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-Hans/blog/anolis-CPU-Co-location">é¾™èœ¥ plugsched ç¥å™¨åŠ©åŠ› Koordinator äº‘åŸç”Ÿå•æœºæ··éƒ¨â€”â€” å†…æ ¸ CPU QoS æ­ç§˜</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-Hans/blog/release-v1.1.0">Koordinator v1.1: è®©è°ƒåº¦æ„ŸçŸ¥è´Ÿè½½ä¸å¹²æ‰°æ£€æµ‹é‡‡é›†</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-Hans/blog/release-v1.0.0">Koordinator v1.0: æ­£å¼å‘å¸ƒ</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-Hans/blog/release-v0.7.0">Koordinator v0.7: ä¸ºä»»åŠ¡è°ƒåº¦é¢†åŸŸæ³¨å…¥æ–°æ´»åŠ›</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-Hans/blog/release-v0.6.0">Koordinator v0.6: Complete fine-grained CPU orchestration, Resource Reservation and Descheduling</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-Hans/blog/release-v0.5.0">Koordinator v0.5: Now With Node Resource Topology And More</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-Hans/blog/release-v0.4.0">What&#x27;s New in Koordinator v0.4.0?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-Hans/blog/release-v0.3.0">What&#x27;s New in Koordinator v0.3.0?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-Hans/blog/release-v0.2.0">Koordinator v0.2.0 - Enhanced node-side scheduling capabilities</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-Hans/blog/release-v0.1.0">Koordinator v0.1.0 - QoS based scheduling system</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/zh-Hans/blog/release-v1.7.0">Koordinator v1.7: åŸºäºç½‘ç»œæ‹“æ‰‘æ„ŸçŸ¥è°ƒåº¦å’Œä½œä¸šçº§æŠ¢å èµ‹èƒ½å¤§è§„æ¨¡ AI è®­ç»ƒ</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2025-10-26T00:00:00.000Z" itemprop="datePublished">2025å¹´10æœˆ26æ—¥</time> Â· <!-- -->17 åˆ†é’Ÿé˜…è¯»</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/ZiMengSheng" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/ZiMengSheng.png" alt="Jianyu Wang"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/ZiMengSheng" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Jianyu Wang</span></a></div><small class="avatar__subtitle" itemprop="description">Koordinator approver</small></div></div></div><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/saintube" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/saintube.png" alt="Rougang Han"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/saintube" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Rougang Han</span></a></div><small class="avatar__subtitle" itemprop="description">Koordinator approver</small></div></div></div><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/zqzten" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/zqzten.png" alt="Ziqiu Zhu"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/zqzten" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Ziqiu Zhu</span></a></div><small class="avatar__subtitle" itemprop="description">Koordinator approver</small></div></div></div><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/ZhuZhezz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/ZhuZhezz.png" alt="Zhe Zhu"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/ZhuZhezz" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Zhe Zhu</span></a></div><small class="avatar__subtitle" itemprop="description">Koordinator contributor</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="èƒŒæ™¯">èƒŒæ™¯<a href="#èƒŒæ™¯" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>éšç€äººå·¥æ™ºèƒ½æŠ€æœ¯çš„æŒç»­æ¼”è¿›ï¼ŒAI æ¨¡å‹è®­ç»ƒçš„è§„æ¨¡å’Œå¤æ‚åº¦å‘ˆæŒ‡æ•°çº§å¢é•¿ã€‚å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰å’Œåˆ†å¸ƒå¼ AI è®­ç»ƒåœºæ™¯å¯¹é›†ç¾¤èµ„æºè°ƒåº¦æå‡ºäº†å‰æ‰€æœªæœ‰çš„æŒ‘æˆ˜ã€‚é«˜æ•ˆçš„è·¨èŠ‚ç‚¹é€šä¿¡ã€æ™ºèƒ½çš„èµ„æºæŠ¢å ä»¥åŠç»Ÿä¸€çš„å¼‚æ„è®¾å¤‡ç®¡ç†æˆä¸ºç”Ÿäº§ç¯å¢ƒå¿…é¡»è§£å†³çš„å…³é”®é—®é¢˜ã€‚</p><p>è‡ª 2022 å¹´ 4 æœˆæ­£å¼å¼€æºä»¥æ¥ï¼ŒKoordinator å·²è¿­ä»£å‘å¸ƒäº† 15 ä¸ªå¤§ç‰ˆæœ¬ï¼ŒæŒç»­ä¸ºå·¥ä½œè´Ÿè½½ç¼–æ’ã€èµ„æºè°ƒåº¦ã€éš”ç¦»å’Œæ€§èƒ½ä¼˜åŒ–æä¾›å…¨é¢çš„è§£å†³æ–¹æ¡ˆã€‚Koordinator ç¤¾åŒºæ„Ÿè°¢æ¥è‡ªé˜¿é‡Œå·´å·´ã€èš‚èšç§‘æŠ€ã€Intelã€å°çº¢ä¹¦ã€å°ç±³ã€çˆ±å¥‡è‰ºã€360ã€æœ‰èµç­‰ä¼—å¤šä¼ä¸šçš„ä¼˜ç§€å·¥ç¨‹å¸ˆçš„è´¡çŒ®ï¼Œä»–ä»¬å¸¦æ¥äº†å®è´µçš„æƒ³æ³•ã€ä»£ç å’Œå®é™…åº”ç”¨åœºæ™¯ã€‚</p><p>ä»Šå¤©ï¼Œæˆ‘ä»¬å¾ˆé«˜å…´åœ°å®£å¸ƒ Koordinator v1.7.0 æ­£å¼å‘å¸ƒã€‚æœ¬ç‰ˆæœ¬é’ˆå¯¹å¤§è§„æ¨¡ AI è®­ç»ƒåœºæ™¯å¼•å…¥äº†çªç ´æ€§èƒ½åŠ›ï¼ŒåŒ…æ‹¬<strong>ç½‘ç»œæ‹“æ‰‘æ„ŸçŸ¥è°ƒåº¦</strong>å’Œ<strong>ä½œä¸šçº§æŠ¢å </strong>ã€‚æ­¤å¤–ï¼Œv1.7.0 é€šè¿‡æ”¯æŒ<strong>åä¸ºæ˜‡è…¾ NPU</strong> å’Œ<strong>å¯’æ­¦çºª MLU</strong> å¢å¼ºäº†å¼‚æ„è®¾å¤‡è°ƒåº¦èƒ½åŠ›ï¼Œæä¾›äº†ç«¯åˆ°ç«¯çš„è®¾å¤‡ç®¡ç†è§£å†³æ–¹æ¡ˆã€‚è¯¥ç‰ˆæœ¬è¿˜åŒ…å«äº†å…¨é¢çš„ <strong>API å‚è€ƒæ–‡æ¡£</strong>å’Œå®Œæ•´çš„<strong>å¼€å‘è€…æŒ‡å—</strong>ï¼Œä»¥æ”¹å–„å¼€å‘è€…ä½“éªŒã€‚</p><p>åœ¨ v1.7.0 ç‰ˆæœ¬ä¸­ï¼Œå…±æœ‰ 14 ä½æ–°å¼€å‘è€…ç§¯æå‚ä¸åˆ° Koordinator ç¤¾åŒºçš„å»ºè®¾ä¸­ï¼Œä»–ä»¬æ˜¯ @ditingdapengã€@Rouzipã€@ClanEverã€@zheng-weihaoã€@cntigersã€@LennonChinã€@ZhuZhezzã€@dabaoolineã€@bobsongplusã€@yccharlesã€@qingyuanzã€@yyrdlã€@hwenwur å’Œ @hkttty2009ã€‚ç”±è¡·æ„Ÿè°¢æ‰€æœ‰ç¤¾åŒºæˆå‘˜çš„ç§¯æå‚ä¸å’ŒæŒç»­æ”¯æŒï¼</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="æ ¸å¿ƒäº®ç‚¹åŠŸèƒ½">æ ¸å¿ƒäº®ç‚¹åŠŸèƒ½<a href="#æ ¸å¿ƒäº®ç‚¹åŠŸèƒ½" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-ç½‘ç»œæ‹“æ‰‘æ„ŸçŸ¥è°ƒåº¦åŠ é€Ÿåˆ†å¸ƒå¼-ai-è®­ç»ƒä¸­çš„é€šä¿¡">1. ç½‘ç»œæ‹“æ‰‘æ„ŸçŸ¥è°ƒåº¦ï¼šåŠ é€Ÿåˆ†å¸ƒå¼ AI è®­ç»ƒä¸­çš„é€šä¿¡<a href="#1-ç½‘ç»œæ‹“æ‰‘æ„ŸçŸ¥è°ƒåº¦åŠ é€Ÿåˆ†å¸ƒå¼-ai-è®­ç»ƒä¸­çš„é€šä¿¡" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>åœ¨å¤§è§„æ¨¡ AI è®­ç»ƒåœºæ™¯ä¸­ï¼Œç‰¹åˆ«æ˜¯å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰è®­ç»ƒï¼Œé«˜æ•ˆçš„è·¨èŠ‚ç‚¹é€šä¿¡å¯¹è®­ç»ƒæ€§èƒ½è‡³å…³é‡è¦ã€‚å¼ é‡å¹¶è¡Œï¼ˆTPï¼‰ã€æµæ°´çº¿å¹¶è¡Œï¼ˆPPï¼‰å’Œæ•°æ®å¹¶è¡Œï¼ˆDPï¼‰ç­‰æ¨¡å‹å¹¶è¡ŒæŠ€æœ¯éœ€è¦è·¨ GPU è¿›è¡Œé¢‘ç¹çš„é«˜å¸¦å®½æ•°æ®äº¤æ¢â€”â€”é€šå¸¸è·¨è¶Šå¤šä¸ªèŠ‚ç‚¹ã€‚åœ¨è¿™ç±»å·¥ä½œè´Ÿè½½ä¸‹ï¼Œç½‘ç»œæ‹“æ‰‘æˆä¸ºå…³é”®çš„æ€§èƒ½ç“¶é¢ˆï¼Œé€šä¿¡å»¶è¿Ÿå’Œå¸¦å®½å—ç‰©ç†ç½‘ç»œå±‚æ¬¡ç»“æ„ï¼ˆå¦‚ NVLinkã€blockã€spineï¼‰çš„ä¸¥é‡å½±å“ã€‚</p><p><img loading="lazy" alt="image" src="/zh-Hans/assets/images/networktopo-1-15ff3dfaa8b22320a1aa11d9ff39147c.png" width="2830" height="978" class="img_ev3q"></p><p>ä¸ºäº†ä¼˜åŒ–è®­ç»ƒæ•ˆç‡ï¼ŒKoordinator v1.7.0 æä¾›äº†<strong>ç½‘ç»œæ‹“æ‰‘æ„ŸçŸ¥è°ƒåº¦</strong>èƒ½åŠ›ï¼Œç¡®ä¿ï¼š</p><ul><li>å½“é›†ç¾¤èµ„æºå……è¶³æ—¶ï¼Œå…·æœ‰ç½‘ç»œæ‹“æ‰‘è¦æ±‚çš„ Pod å°†æ ¹æ®ç”¨æˆ·æŒ‡å®šçš„ç­–ç•¥è°ƒåº¦åˆ°æ€§èƒ½æ›´å¥½çš„æ‹“æ‰‘åŸŸï¼ˆå¦‚æ›´ä½å»¶è¿Ÿã€æ›´é«˜å¸¦å®½ï¼‰ã€‚</li><li>å½“é›†ç¾¤èµ„æºä¸è¶³æ—¶ï¼Œè°ƒåº¦å™¨å°†åŸºäºç½‘ç»œæ‹“æ‰‘çº¦æŸé€šè¿‡ä½œä¸šçº§æŠ¢å ä¸º GangGroup æŠ¢å èµ„æºï¼Œå¹¶åœ¨ <code>.status.nominatedNode</code> å­—æ®µä¸­è®°å½•èµ„æºæåä»¥ç¡®ä¿ä¸€è‡´çš„æ”¾ç½®ã€‚</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="é›†ç¾¤ç½‘ç»œæ‹“æ‰‘é…ç½®">é›†ç¾¤ç½‘ç»œæ‹“æ‰‘é…ç½®<a href="#é›†ç¾¤ç½‘ç»œæ‹“æ‰‘é…ç½®" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>ç®¡ç†å‘˜é¦–å…ˆä½¿ç”¨ NVIDIA çš„ <a href="https://github.com/NVIDIA/topograph/blob/v0.1.0/docs/engines/k8s.md" target="_blank" rel="noopener noreferrer">topograph</a> ç­‰å·¥å…·ä¸ºèŠ‚ç‚¹æ ‡è®°å…¶ç½‘ç»œæ‹“æ‰‘ä½ç½®ï¼š</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">network.topology.nvidia.com/block</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> b1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">network.topology.nvidia.com/spine</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> s1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç„¶åé€šè¿‡ <code>ClusterNetworkTopology</code> CR å®šä¹‰æ‹“æ‰‘å±‚æ¬¡ç»“æ„ï¼š</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> scheduling.koordinator.sh/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ClusterNetworkTopology</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">networkTopologySpec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">labelKey</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> network.topology.nvidia.com/spine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">topologyLayer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> SpineLayer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">labelKey</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> network.topology.nvidia.com/block</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">parentTopologyLayer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> SpineLayer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">topologyLayer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> BlockLayer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">parentTopologyLayer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> BlockLayer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">topologyLayer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NodeTopologyLayer</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="é…ç½®æ‹“æ‰‘æ„ŸçŸ¥çš„-gang-è°ƒåº¦">é…ç½®æ‹“æ‰‘æ„ŸçŸ¥çš„ Gang è°ƒåº¦<a href="#é…ç½®æ‹“æ‰‘æ„ŸçŸ¥çš„-gang-è°ƒåº¦" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>è¦åˆ©ç”¨ç½‘ç»œæ‹“æ‰‘æ„ŸçŸ¥èƒ½åŠ›ï¼Œåˆ›å»º <code>PodGroup</code> å¹¶ä½¿ç”¨æ‹“æ‰‘è¦æ±‚è¿›è¡Œæ³¨è§£ï¼š</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> scheduling.sigs.k8s.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PodGroup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> training</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">job</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">gang.scheduling.koordinator.sh/network-topology-spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        &quot;gatherStrategy&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          {</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            &quot;layer&quot;: &quot;BlockLayer&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            &quot;strategy&quot;: &quot;PreferGather&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">minMember</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">scheduleTimeoutSeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">300</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>è°ƒåº¦å±äºæ­¤ PodGroup çš„ Pod æ—¶ï¼Œè°ƒåº¦å™¨å°†å°è¯•å°†æ‰€æœ‰æˆå‘˜ Pod æ”¾ç½®åœ¨åŒä¸€ä¸ª <code>BlockLayer</code> æ‹“æ‰‘åŸŸå†…ï¼Œä»¥æœ€å°åŒ–èŠ‚ç‚¹é—´é€šä¿¡å»¶è¿Ÿã€‚</p><p>æ›´å¤šå…³äºç½‘ç»œæ‹“æ‰‘æ„ŸçŸ¥è°ƒåº¦çš„ä¿¡æ¯ï¼Œè¯·å‚è§<a href="https://koordinator.sh/docs/user-manuals/network-topology-aware-scheduling" target="_blank" rel="noopener noreferrer">ç½‘ç»œæ‹“æ‰‘æ„ŸçŸ¥è°ƒåº¦</a>ã€‚</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-ä½œä¸šçº§æŠ¢å ç¡®ä¿å…¨æœ‰æˆ–å…¨æ— çš„èµ„æºè·å–">2. ä½œä¸šçº§æŠ¢å ï¼šç¡®ä¿å…¨æœ‰æˆ–å…¨æ— çš„èµ„æºè·å–<a href="#2-ä½œä¸šçº§æŠ¢å ç¡®ä¿å…¨æœ‰æˆ–å…¨æ— çš„èµ„æºè·å–" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>åœ¨å¤§è§„æ¨¡é›†ç¾¤ç¯å¢ƒä¸­ï¼Œé«˜ä¼˜å…ˆçº§ä½œä¸šï¼ˆå¦‚å…³é”® AI è®­ç»ƒä»»åŠ¡ï¼‰åœ¨èµ„æºä¸è¶³æ—¶é€šå¸¸éœ€è¦ä»ä½ä¼˜å…ˆçº§å·¥ä½œè´Ÿè½½æŠ¢å èµ„æºã€‚ç„¶è€Œï¼ŒKubernetes ä¸­ä¼ ç»Ÿçš„<strong>Pod çº§æŠ¢å </strong>æ— æ³•ä¿è¯åˆ†å¸ƒå¼ä½œä¸šçš„æ‰€æœ‰æˆå‘˜ Pod ä¸€èµ·è·å–èµ„æºï¼Œå¯¼è‡´æ— æ•ˆæŠ¢å å’Œèµ„æºæµªè´¹ã€‚</p><p>ä¸ºè§£å†³è¿™ä¸€é—®é¢˜ï¼ŒKoordinator v1.7.0 æä¾›äº†<strong>ä½œä¸šçº§æŠ¢å </strong>ï¼Œç¡®ä¿ï¼š</p><ul><li>åœ¨ä½œä¸šï¼ˆGangGroupï¼‰çº§åˆ«è§¦å‘æŠ¢å ã€‚</li><li>åªæœ‰å½“æ‰€æœ‰æˆå‘˜ Pod åœ¨é©±é€åéƒ½èƒ½è¢«å…±åŒè°ƒåº¦æ—¶æ‰ä¼šå‘ç”ŸæŠ¢å ã€‚</li><li>é€šè¿‡ <code>nominatedNode</code> ä¸ºæ‰€æœ‰æˆå‘˜ä¿ç•™èµ„æºä»¥ä¿æŒè°ƒåº¦ä¸€è‡´æ€§ã€‚</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="æŠ¢å ç®—æ³•">æŠ¢å ç®—æ³•<a href="#æŠ¢å ç®—æ³•" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>ä½œä¸šçº§æŠ¢å å·¥ä½œæµç¨‹åŒ…æ‹¬ä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li><strong>æ— æ³•è°ƒåº¦çš„ Pod æ£€æµ‹</strong>ï¼šå½“ Pod æ— æ³•è°ƒåº¦æ—¶ï¼Œè¿›å…¥ PostFilter é˜¶æ®µã€‚</li><li><strong>ä½œä¸šè¯†åˆ«</strong>ï¼šè°ƒåº¦å™¨æ£€æŸ¥ Pod æ˜¯å¦å±äº PodGroup/GangGroup å¹¶è·å–æ‰€æœ‰æˆå‘˜ Podã€‚</li><li><strong>æŠ¢å èµ„æ ¼æ£€æŸ¥</strong>ï¼šéªŒè¯ <code>pods.spec.preemptionPolicy</code> â‰  Never å¹¶ç¡®ä¿å½“å‰æåèŠ‚ç‚¹ä¸Šä¸å­˜åœ¨æ­£åœ¨ç»ˆæ­¢çš„å—å®³è€…ã€‚</li><li><strong>å€™é€‰èŠ‚ç‚¹é€‰æ‹©</strong>ï¼šé€šè¿‡æ¨¡æ‹Ÿç§»é™¤æ½œåœ¨å—å®³è€…ï¼ˆä½ä¼˜å…ˆçº§ Podï¼‰æ¥æ‰¾åˆ°æŠ¢å å¯èƒ½æœ‰å¸®åŠ©çš„èŠ‚ç‚¹ã€‚</li><li><strong>ä½œä¸šæ„ŸçŸ¥æˆæœ¬æ¨¡å‹</strong>ï¼šåŸºäºä½œä¸šæ„ŸçŸ¥æˆæœ¬æ¨¡å‹é€‰æ‹©æœ€ä¼˜èŠ‚ç‚¹å’Œæœ€å°æˆæœ¬å—å®³è€…é›†ã€‚</li><li><strong>æ‰§è¡ŒæŠ¢å </strong>ï¼šåˆ é™¤å—å®³è€…å¹¶ä¸ºæ‰€æœ‰æˆå‘˜ Pod è®¾ç½® <code>status.nominatedNode</code>ã€‚</li></ol><h4 class="anchor anchorWithStickyNavbar_LWe7" id="ä½¿ç”¨ç¤ºä¾‹">ä½¿ç”¨ç¤ºä¾‹<a href="#ä½¿ç”¨ç¤ºä¾‹" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>ä¸ºæŠ¢å è€…å’Œå—å®³è€…å®šä¹‰ä¼˜å…ˆçº§ç±»ï¼š</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> scheduling.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PriorityClass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> high</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">priority</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">preemptionPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PreemptLowerPriority</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">description</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ç”¨äºå¯ä»¥æŠ¢å å…¶ä»–ä½œä¸šçš„å…³é”® AI è®­ç»ƒä»»åŠ¡ã€‚&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> scheduling.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PriorityClass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> low</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">priority</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">preemptionPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PreemptLowerPriority</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">description</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ç”¨äºå¯ä»¥è¢«æŠ¢å çš„éå…³é”®ä»»åŠ¡ã€‚&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>åˆ›å»ºé«˜ä¼˜å…ˆçº§ gang ä½œä¸šï¼š</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> scheduling.sigs.k8s.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PodGroup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> hp</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">training</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">job</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">minMember</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">scheduleTimeoutSeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">300</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> hp</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">worker</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">pod-group.scheduling.sigs.k8s.io</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> hp</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">training</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">job</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">schedulerName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> koord</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">scheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">priorityClassName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> high</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">priority</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">preemptionPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PreemptLowerPriority</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> worker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">limits</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 4Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 4Gi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å½“é«˜ä¼˜å…ˆçº§ä½œä¸šæ— æ³•è°ƒåº¦æ—¶ï¼Œè°ƒåº¦å™¨å°†è·¨å¤šä¸ªèŠ‚ç‚¹æŠ¢å ä½ä¼˜å…ˆçº§ Podï¼Œä¸ºä½œä¸šçš„æ‰€æœ‰æˆå‘˜ Pod è…¾å‡ºç©ºé—´ã€‚</p><p>æ›´å¤šå…³äºä½œä¸šçº§æŠ¢å çš„ä¿¡æ¯ï¼Œè¯·å‚è§<a href="https://koordinator.sh/zh-Hans/docs/user-manuals/job-level-preemption" target="_blank" rel="noopener noreferrer">ä½œä¸šçº§æŠ¢å </a>ã€‚</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-å¼‚æ„è®¾å¤‡è°ƒåº¦æ”¯æŒåä¸ºæ˜‡è…¾-npu-å’Œå¯’æ­¦çºª-mlu">3. å¼‚æ„è®¾å¤‡è°ƒåº¦ï¼šæ”¯æŒåä¸ºæ˜‡è…¾ NPU å’Œå¯’æ­¦çºª MLU<a href="#3-å¼‚æ„è®¾å¤‡è°ƒåº¦æ”¯æŒåä¸ºæ˜‡è…¾-npu-å’Œå¯’æ­¦çºª-mlu" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>åœ¨ v1.6 å¼ºå¤§çš„ GPU è°ƒåº¦åŸºç¡€ä¸Šï¼ŒKoordinator v1.7.0 å°†å¼‚æ„è®¾å¤‡è°ƒåº¦æ‰©å±•åˆ°æ”¯æŒ<strong>åä¸ºæ˜‡è…¾ NPU</strong> å’Œ<strong>å¯’æ­¦çºª MLU</strong>ï¼Œä¸ºå¤šå‚å•†æä¾›<a href="https://koordinator.sh/zh-Hans/docs/architecture/device/#%E8%AE%BE%E5%A4%87%E8%B0%83%E5%BA%A6%E6%9E%B6%E6%9E%84" target="_blank" rel="noopener noreferrer">ç»Ÿä¸€çš„è®¾å¤‡ç®¡ç†å’Œè°ƒåº¦èƒ½åŠ›</a>ã€‚</p><p><img loading="lazy" alt="Device Scheduling Architecture" src="/zh-Hans/assets/images/device-scheduling-architecture-f6dc2e74f676861e32a7224182d2fbfe.jpg" width="2753" height="1649" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="åä¸ºæ˜‡è…¾-npu-æ”¯æŒ">åä¸ºæ˜‡è…¾ NPU æ”¯æŒ<a href="#åä¸ºæ˜‡è…¾-npu-æ”¯æŒ" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>Koordinator v1.7.0 é€šè¿‡ <code>koord-device-daemon</code> å’Œ <code>koordlet</code> ç»„ä»¶æ”¯æŒæ˜‡è…¾è™šæ‹ŸåŒ–æ¨¡æ¿å’Œæ•´å¡ã€‚ä¸»è¦ç‰¹æ€§åŒ…æ‹¬ï¼š</p><ul><li><strong>è®¾å¤‡ä¸ŠæŠ¥</strong>ï¼šè‡ªåŠ¨æ£€æµ‹æ˜‡è…¾ NPU ä¿¡æ¯å¹¶ä¸ŠæŠ¥åˆ° Device CRã€‚</li><li><strong>åˆ†åŒºæ„ŸçŸ¥è°ƒåº¦</strong>ï¼šéµå®ˆ HCCS äº²å’Œæ€§çš„é¢„å®šä¹‰ GPU åˆ†åŒºè§„åˆ™ã€‚</li><li><strong>æ‹“æ‰‘è°ƒåº¦</strong>ï¼šåŸºäº PCIe å’Œ NUMA æ‹“æ‰‘åˆ†é… NPUã€‚</li></ul><p>æ˜‡è…¾ NPU çš„ Device CR ç¤ºä¾‹ï¼š</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> scheduling.koordinator.sh/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Device</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">node.koordinator.sh/gpu-model</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Ascend</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">910B3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">node.koordinator.sh/gpu-vendor</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> huawei</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">scheduling.koordinator.sh/gpu-partitions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        &quot;4&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          {</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            &quot;minors&quot;: [0,1,2,3],</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            &quot;gpuLinkType&quot;: &quot;HCCS&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            &quot;allocationScore&quot;: &quot;1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">devices</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">health</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> GPU</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">fd971b33</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">4891</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">fd2e</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ed42</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ce6adf324615</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">minor</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">huawei.com/npu-core</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;20&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">huawei.com/npu-cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;7&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">huawei.com/npu-dvpp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;100&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">koordinator.sh/gpu-memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 64Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">koordinator.sh/gpu-memory-ratio</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;100&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">topology</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">busID</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 0000</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">3b</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">00.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">nodeID</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">pcieID</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pci0000</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">3a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gpu</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="å¯’æ­¦çºª-mlu-æ”¯æŒ">å¯’æ­¦çºª MLU æ”¯æŒ<a href="#å¯’æ­¦çºª-mlu-æ”¯æŒ" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>Koordinator v1.7.0 åœ¨æ•´å¡å’Œè™šæ‹ŸåŒ–ï¼ˆdynamic-smluï¼‰æ¨¡å¼ä¸‹éƒ½æ”¯æŒå¯’æ­¦çºª MLU å¡ã€‚ä¸»è¦ç‰¹æ€§åŒ…æ‹¬ï¼š</p><ul><li><strong>è®¾å¤‡ä¸ŠæŠ¥</strong>ï¼šæ£€æµ‹å¹¶ä¸ŠæŠ¥å¯’æ­¦çºª MLU ä¿¡æ¯ã€‚</li><li><strong>è™šæ‹ŸåŒ–æ”¯æŒ</strong>ï¼šé€šè¿‡ dynamic-smlu æ¨¡å¼å¯ç”¨ GPU å…±äº«ã€‚</li><li><strong>ç»Ÿä¸€èµ„æºå‘½å</strong>ï¼šä½¿ç”¨ <code>koordinator.sh/gpu-*</code> èµ„æºè¿›è¡Œä¸€è‡´è°ƒåº¦ã€‚</li></ul><p>è¯·æ±‚å¯’æ­¦çºªè™šæ‹Ÿå¡çš„ Pod ç¤ºä¾‹ï¼š</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> test</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cambricon</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">partial</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">schedulerName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> koord</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">scheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> demo</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">sleep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">18.04</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">limits</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">koordinator.sh/gpu.shared</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">koordinator.sh/gpu-memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1Gi&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">koordinator.sh/gpu-core</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;10&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">cambricon.com/mlu.smlu.vcore</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;10&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">cambricon.com/mlu.smlu.vmemory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;4&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">koordinator.sh/gpu.shared</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">koordinator.sh/gpu-memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1Gi&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">koordinator.sh/gpu-core</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;10&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">cambricon.com/mlu.smlu.vcore</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;10&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">cambricon.com/mlu.smlu.vmemory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;4&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a href="https://koordinator.sh/zh-Hans/docs/user-manuals/device-scheduling-ascend-npu" target="_blank" rel="noopener noreferrer">è®¾å¤‡è°ƒåº¦ - æ˜‡è…¾ NPU</a> å’Œ<a href="https://koordinator.sh/zh-Hans/docs/user-manuals/device-scheduling-cambricon-mlu" target="_blank" rel="noopener noreferrer">è®¾å¤‡è°ƒåº¦ - å¯’æ­¦çºª MLU</a>ã€‚</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-å…¶ä»–å¢å¼ºå’Œæ”¹è¿›">4. å…¶ä»–å¢å¼ºå’Œæ”¹è¿›<a href="#4-å…¶ä»–å¢å¼ºå’Œæ”¹è¿›" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>Koordinator v1.7.0 è¿˜åŒ…å«ä»¥ä¸‹å…³é”®å¢å¼ºï¼š</p><ol><li><strong>GPU Share ä¸ HAMi å¢å¼º</strong>ï¼š <ul><li>å‡çº§åˆ° HAMi v2.6.0 å¹¶æ”¯æŒ NVIDIA 570 ä»¥ä¸Šé©±åŠ¨ã€‚</li><li>å¼•å…¥åŸºäº Helm çš„ <code>hami-daemon</code> chartï¼ˆç‰ˆæœ¬ 0.1.0ï¼‰å®‰è£…æ–¹å¼æ›¿ä»£æ‰‹åŠ¨ DaemonSet éƒ¨ç½²ï¼Œä¾¿äºç®¡ç†ã€‚</li><li>æ–°å¢ <strong>vGPUmonitor</strong> ç»„ä»¶æä¾›å…¨é¢çš„ GPU ç›‘æ§ï¼Œæ”¯æŒ Prometheus æŒ‡æ ‡åŒ…æ‹¬ <code>HostGPUMemoryUsage</code>ã€<code>HostCoreUtilization</code>ã€<code>vGPU_device_memory_usage_in_bytes</code>ã€<code>vGPU_device_memory_limit_in_bytes</code> ä»¥åŠå®¹å™¨çº§è®¾å¤‡æŒ‡æ ‡ã€‚</li></ul></li><li><strong>è´Ÿè½½æ„ŸçŸ¥è°ƒåº¦ä¼˜åŒ–</strong>ï¼š <ul><li>æ–°å¢ PreFilter æ‰©å±•ç‚¹é€šè¿‡ç¼“å­˜è®¡ç®—ç»“æœæ˜¾è‘—æå‡è°ƒåº¦æ€§èƒ½ã€‚</li><li>å¼•å…¥æ–°é…ç½®é€‰é¡¹åŒ…æ‹¬ <code>dominantResourceWeight</code> æ”¯æŒä¸»å¯¼èµ„æºå…¬å¹³æ€§ã€<code>prodUsageIncludeSys</code> ç”¨äºå…¨é¢çš„ Prod ä½¿ç”¨ç‡è®¡ç®—ã€<code>enableScheduleWhenNodeMetricsExpired</code> å¤„ç†è¿‡æœŸæŒ‡æ ‡ã€<code>estimatedSecondsAfterPodScheduled</code> å’Œ <code>estimatedSecondsAfterInitialized</code> å®ç°ç²¾ç¡®çš„èµ„æºä¼°ç®—æ—¶æœºã€<code>allowCustomizeEstimation</code> æ”¯æŒ Pod çº§ä¼°ç®—è‡ªå®šä¹‰ä»¥åŠ <code>supportedResources</code> æ‰©å±•èµ„æºç±»å‹æ”¯æŒã€‚</li></ul></li><li><strong>å¢å¼º ElasticQuota çš„ Quota Hook Plugin æ¡†æ¶</strong>ï¼š<ul><li>å…è®¸è‡ªå®šä¹‰é…é¢éªŒè¯å’Œæ‰§è¡Œé€»è¾‘</li><li>æ”¯æŒåœ¨ ReplaceQuotas å’Œ OnQuotaUpdate æ–¹æ³•ä¸­ä½¿ç”¨ hook æ’ä»¶</li><li>å¢å¼ºçš„ pod æ›´æ–° hookï¼Œæ— è®ºå·²ä½¿ç”¨èµ„æºæ˜¯å¦å‘ç”Ÿå˜åŒ–éƒ½ä¼šè¿è¡Œ</li></ul></li></ol><p>å®Œæ•´çš„å˜æ›´åˆ—è¡¨ï¼Œè¯·å‚è§ <a href="https://github.com/koordinator-sh/koordinator/releases/tag/v1.7.0" target="_blank" rel="noopener noreferrer">v1.7.0 Release</a>ã€‚</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-å…¨é¢çš„-api-å‚è€ƒå’Œå¼€å‘è€…æŒ‡å—">5. å…¨é¢çš„ API å‚è€ƒå’Œå¼€å‘è€…æŒ‡å—<a href="#5-å…¨é¢çš„-api-å‚è€ƒå’Œå¼€å‘è€…æŒ‡å—" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>ä¸ºäº†æ”¹å–„å¼€å‘è€…ä½“éªŒå¹¶ä¿ƒè¿›ç¤¾åŒºè´¡çŒ®ï¼ŒKoordinator v1.7.0 å¼•å…¥äº†å…¨é¢çš„ <strong>API å‚è€ƒæ–‡æ¡£</strong>å’Œå®Œæ•´çš„<strong>å¼€å‘è€…æŒ‡å—</strong>ã€‚</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="api-å‚è€ƒ">API å‚è€ƒ<a href="#api-å‚è€ƒ" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>æ–°çš„ API å‚è€ƒæä¾›äº†è¯¦ç»†æ–‡æ¡£ï¼š</p><ul><li><strong>è‡ªå®šä¹‰èµ„æºå®šä¹‰ (CRD)</strong>ï¼šæ‰€æœ‰ Koordinator CRD çš„å…¨é¢æ¶æ„å®šä¹‰ã€å­—æ®µæè¿°ã€éªŒè¯è§„åˆ™å’Œä½¿ç”¨æ¨¡å¼ï¼ŒåŒ…æ‹¬ Recommendationã€ClusterColocationProfileã€ElasticQuotaã€Reservationã€Deviceã€NodeMetric ç­‰ã€‚</li><li><strong>å®¢æˆ·ç«¯åº“</strong>ï¼šä½¿ç”¨ Goã€Python å’Œå…¶ä»–è¯­è¨€çš„ Koordinator å®¢æˆ·ç«¯åº“æŒ‡å—ã€‚</li><li><strong>æŒ‡æ ‡ç«¯ç‚¹</strong>ï¼šKoordinator ç»„ä»¶æš´éœ²çš„ Prometheus æŒ‡æ ‡çš„å®Œæ•´æ–‡æ¡£ã€‚</li><li><strong>Webhook ç«¯ç‚¹</strong>ï¼šç”¨äºæ‰©å±• Koordinator åŠŸèƒ½çš„ webhook ç«¯ç‚¹çš„è¯¦ç»†è§„èŒƒã€‚</li></ul><p>è‡ªå®šä¹‰èµ„æºå®šä¹‰æ–‡æ¡£ç¤ºä¾‹ï¼š</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> scheduling.koordinator.sh/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Device</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> worker01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">node.koordinator.sh/gpu-model</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NVIDIA</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">H20</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">node.koordinator.sh/gpu-vendor</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nvidia</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">devices</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">health</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> GPU</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">a43e0de9</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">28a0</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">1e87</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">32f8</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">f5c4994b3e69</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">minor</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">koordinator.sh/gpu-core</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;100&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">koordinator.sh/gpu-memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 97871Mi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">koordinator.sh/gpu-memory-ratio</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;100&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">topology</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">busID</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 0000</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">0e</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">00.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">nodeID</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">pcieID</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pci0000</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">0b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gpu</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="å¼€å‘è€…æŒ‡å—">å¼€å‘è€…æŒ‡å—<a href="#å¼€å‘è€…æŒ‡å—" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>å¼€å‘è€…æŒ‡å—ä¸ºè´¡çŒ®è€…æä¾›å…¨é¢èµ„æºï¼ŒåŒ…æ‹¬ï¼š</p><ul><li><strong>ç»„ä»¶æŒ‡å—</strong>ï¼šKoordinator ç»„ä»¶çš„æ¶æ„å’Œè®¾è®¡ã€‚</li><li><strong>æŒ‡æ ‡æ”¶é›†</strong>ï¼šå¦‚ä½•æ·»åŠ å’Œæš´éœ²æ–°æŒ‡æ ‡ã€‚</li><li><strong>å¯æ‰©å±•æ€§</strong>ï¼šæ‰©å±•ç‚¹å’Œæ’ä»¶å¼€å‘æ¨¡å¼ã€‚</li><li><strong>æ’ä»¶å¼€å‘</strong>ï¼šå¼€å‘è‡ªå®šä¹‰æ’ä»¶çš„åˆ†æ­¥æŒ‡å—ã€‚</li><li><strong>è‡ªå®šä¹‰è°ƒåº¦ç­–ç•¥</strong>ï¼šå¦‚ä½•å®ç°è‡ªå®šä¹‰è°ƒåº¦ç­–ç•¥ã€‚</li><li><strong>Webhook æ‰©å±•</strong>ï¼šå¼€å‘ç”¨äºéªŒè¯å’Œå˜æ›´çš„ webhook æ‰©å±•ã€‚</li><li><strong>è‡ªå®šä¹‰é‡è°ƒåº¦æ’ä»¶</strong>ï¼šæ„å»ºè‡ªå®šä¹‰é‡è°ƒåº¦æ’ä»¶ã€‚</li></ul><p>è¿™äº›èµ„æºæ˜¾è‘—é™ä½äº†æ–°è´¡çŒ®è€…çš„å‡†å…¥é—¨æ§›ï¼Œä½¿å¼€å‘è€…èƒ½å¤Ÿæ›´è½»æ¾åœ°æ‰©å±• Koordinator çš„èƒ½åŠ›ã€‚</p><p>æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ <a href="https://koordinator.sh/zh-Hans/docs/api-reference/custom-resource-definitions" target="_blank" rel="noopener noreferrer">API å‚è€ƒ</a>å’Œ<a href="https://koordinator.sh/zh-Hans/docs/developer-guide/component-guide" target="_blank" rel="noopener noreferrer">å¼€å‘è€…æŒ‡å—</a>ã€‚</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-æœ€ä½³å®è·µæ‰¹é‡æ··éƒ¨å¿«é€Ÿå…¥é—¨">5. æœ€ä½³å®è·µï¼šæ‰¹é‡æ··éƒ¨å¿«é€Ÿå…¥é—¨<a href="#5-æœ€ä½³å®è·µæ‰¹é‡æ··éƒ¨å¿«é€Ÿå…¥é—¨" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>ä¸ºäº†å¸®åŠ©ç”¨æˆ·å¿«é€Ÿä¸Šæ‰‹ Koordinator çš„æ··éƒ¨èƒ½åŠ›ï¼Œv1.7.0 å¼•å…¥äº†æ–°çš„æœ€ä½³å®è·µæŒ‡å—ï¼š<strong>æ‰¹é‡æ··éƒ¨å¿«é€Ÿå…¥é—¨</strong>ã€‚è¯¥æŒ‡å—æä¾›åˆ†æ­¥è¯´æ˜ï¼š</p><ul><li>åœ¨ Kubernetes é›†ç¾¤ä¸­éƒ¨ç½² Koordinatorã€‚</li><li>ä¸ºåœ¨çº¿å’Œæ‰¹é‡å·¥ä½œè´Ÿè½½é…ç½®æ··éƒ¨é…ç½®æ–‡ä»¶ã€‚</li><li>é€šè¿‡æ‰¹é‡èµ„æºè¶…å–è§‚å¯Ÿèµ„æºåˆ©ç”¨ç‡æ”¹è¿›ã€‚</li><li>ç›‘æ§å’Œæ•…éšœæ’é™¤æ··éƒ¨åœºæ™¯ã€‚</li></ul><p>è¯¥æŒ‡å—è¡¥å……äº†ç°æœ‰çš„ Spark ä½œä¸šæ··éƒ¨ã€Hadoop YARN æ··éƒ¨å’Œç»†ç²’åº¦ CPU ç¼–æ’ç­‰æœ€ä½³å®è·µï¼Œä¸ºç”Ÿäº§éƒ¨ç½²æä¾›å…¨é¢çš„èµ„æºåº“ã€‚</p><p>æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a href="https://koordinator.sh/zh-Hans/docs/best-practices/batch-colocation-quick-start" target="_blank" rel="noopener noreferrer">æ‰¹é‡æ··éƒ¨å¿«é€Ÿå…¥é—¨</a>ã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="è´¡çŒ®è€…">è´¡çŒ®è€…<a href="#è´¡çŒ®è€…" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>Koordinator æ˜¯ä¸€ä¸ªå¼€æºç¤¾åŒºã€‚åœ¨ v1.7.0 ä¸­ï¼Œæœ‰ 14 ä½æ–°å¼€å‘è€…ä¸º Koordinator ä¸»ä»“åº“åšå‡ºäº†è´¡çŒ®ï¼š</p><p>@ditingdapeng åœ¨ #2353 ä¸­é¦–æ¬¡è´¡çŒ®<br>
<!-- -->@Rouzip åœ¨ #2005 ä¸­é¦–æ¬¡è´¡çŒ®<br>
<!-- -->@ClanEver åœ¨ #2405 ä¸­é¦–æ¬¡è´¡çŒ®<br>
<!-- -->@zheng-weihao åœ¨ #2409 ä¸­é¦–æ¬¡è´¡çŒ®<br>
<!-- -->@cntigers åœ¨ #2434 ä¸­é¦–æ¬¡è´¡çŒ®<br>
<!-- -->@LennonChin åœ¨ #2449 ä¸­é¦–æ¬¡è´¡çŒ®<br>
<!-- -->@ZhuZhezz åœ¨ #2423 ä¸­é¦–æ¬¡è´¡çŒ®<br>
<!-- -->@dabaooline åœ¨ #2483 ä¸­é¦–æ¬¡è´¡çŒ®<br>
<!-- -->@bobsongplus åœ¨ #2524 ä¸­é¦–æ¬¡è´¡çŒ®<br>
<!-- -->@yccharles åœ¨ #2474 ä¸­é¦–æ¬¡è´¡çŒ®<br>
<!-- -->@qingyuanz åœ¨ #2584 ä¸­é¦–æ¬¡è´¡çŒ®<br>
<!-- -->@yyrdl åœ¨ #2597 ä¸­é¦–æ¬¡è´¡çŒ®<br>
<!-- -->@hwenwur åœ¨ #2621 ä¸­é¦–æ¬¡è´¡çŒ®<br>
<!-- -->@hkttty2009 åœ¨ #2641 ä¸­é¦–æ¬¡è´¡çŒ®</p><p>æ„Ÿè°¢é•¿æœŸä»¥æ¥æŒç»­åŠªåŠ›çš„è´¡çŒ®è€…å’Œæ–°åŠ å…¥çš„ç§¯æè´¡çŒ®è€…ã€‚æˆ‘ä»¬æ¬¢è¿æ›´å¤šè´¡çŒ®è€…åŠ å…¥ <a href="https://github.com/koordinator-sh/koordinator" target="_blank" rel="noopener noreferrer"><em>Koordinator ç¤¾åŒº</em></a>ã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="æœªæ¥è®¡åˆ’">æœªæ¥è®¡åˆ’<a href="#æœªæ¥è®¡åˆ’" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>åœ¨ä¸‹ä¸€ä¸ªç‰ˆæœ¬ä¸­ï¼ŒKoordinator è®¡åˆ’ä»¥ä¸‹å·¥ä½œï¼š</p><ul><li><strong>é˜Ÿåˆ—å’Œé…é¢ç®¡ç†</strong>ï¼šå°† Kube-Queue ä¸ Koordinator é›†æˆï¼Œæä¾›å…¨é¢çš„é˜Ÿåˆ—è°ƒåº¦æ”¯æŒ (<a href="https://github.com/koordinator-sh/koordinator/issues/2662" target="_blank" rel="noopener noreferrer">#2662</a>)</li><li><strong>é˜Ÿåˆ—å’Œé…é¢ç®¡ç†</strong>ï¼šåœ¨é…é¢æ’ä»¶ä¸­æ”¯æŒ PreEnqueue å’Œ QueueHint (<a href="https://github.com/koordinator-sh/koordinator/issues/2581" target="_blank" rel="noopener noreferrer">#2581</a>)</li><li><strong>é˜Ÿåˆ—å’Œé…é¢ç®¡ç†</strong>ï¼šé€šè¿‡ PDB æ„ŸçŸ¥å¢å¼ºé…é¢èµ„æºå›æ”¶ (<a href="https://github.com/koordinator-sh/koordinator/issues/2651" target="_blank" rel="noopener noreferrer">#2651</a>)</li><li><strong>ä»»åŠ¡è°ƒåº¦</strong>ï¼šä¸ä¸Šæ¸¸å¼€å‘è€…è®¨è®ºå¦‚ä½•æ”¯æŒååŒè°ƒåº¦ï¼Œå¹¶å¯»æ‰¾æ›´ä¼˜é›…çš„æ–¹å¼è§£å†³ä»¥ä¸‹é—®é¢˜<ul><li>è§£å†³ Gang Pod çš„ PreEnqueue æ‹¦æˆªé˜»æ­¢ Pod äº‹ä»¶ç”Ÿæˆç›´åˆ° Gang MinMember è¦æ±‚æ»¡è¶³çš„é—®é¢˜ (<a href="https://github.com/koordinator-sh/koordinator/issues/2480" target="_blank" rel="noopener noreferrer">#2480</a>)</li><li>è§£å†³ GatedMetric è´Ÿå€¼é—®é¢˜ (<a href="https://github.com/kubernetes/kubernetes/issues/133464" target="_blank" rel="noopener noreferrer">kubernetes#133464</a>)</li></ul></li><li><strong>å¼‚æ„è°ƒåº¦ç­–ç•¥</strong>ï¼šè€ƒè™‘åœ¨é‡è°ƒåº¦ä¸­è¿›è¡Œ GPU åˆ†é…ä»¥å®ç°é›†ç¾¤èµ„æºæ•´åˆ (<a href="https://github.com/koordinator-sh/koordinator/issues/2332" target="_blank" rel="noopener noreferrer">#2332</a>)</li><li><strong>å¼‚æ„èµ„æºè°ƒåº¦</strong>ï¼šå¼•å…¥åŠ¨æ€èµ„æºåˆ†é… (DRA) æ¡†æ¶æ”¯æŒ</li><li><strong>å¼‚æ„èµ„æºè°ƒåº¦</strong>ï¼šæ‰©å±•å¯¹æ›´å¤šç±»å‹å¼‚æ„èµ„æºçš„æ”¯æŒ</li><li><strong>åŸºç¡€è®¾æ–½å’Œå…¼å®¹æ€§</strong>ï¼šå‡çº§åˆ° Kubernetes 1.33</li><li><strong>å·¥å…·</strong>ï¼šåœ¨é¢„ç•™ä¸­æ”¯æŒé¢„åˆ†é… (<a href="https://github.com/koordinator-sh/koordinator/issues/2150" target="_blank" rel="noopener noreferrer">#2150</a>)</li><li><strong>å·¥å…·</strong>ï¼šä¸ºè°ƒåº¦é˜Ÿåˆ—ä¸­çš„ Pod å®ç°è°ƒåº¦å®¡è®¡ (<a href="https://github.com/koordinator-sh/koordinator/issues/2552" target="_blank" rel="noopener noreferrer">#2552</a>)</li><li><strong>å·¥å…·</strong>ï¼šæä¾› Pod è°ƒåº¦å®¡è®¡åˆ†æå·¥å…·</li></ul><p>æˆ‘ä»¬é¼“åŠ±ç”¨æˆ·åé¦ˆä½¿ç”¨ä½“éªŒï¼Œæ¬¢è¿æ›´å¤šå¼€å‘è€…å‚ä¸ Koordinator é¡¹ç›®ï¼Œå…±åŒæ¨åŠ¨å…¶å‘å±•ï¼</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="è‡´è°¢">è‡´è°¢<a href="#è‡´è°¢" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>è‡ªé¡¹ç›®å¼€æºä»¥æ¥ï¼ŒKoordinator å·²å‘å¸ƒè¶…è¿‡ 15 ä¸ªç‰ˆæœ¬ï¼Œæœ‰ 110 å¤šä½è´¡çŒ®è€…å‚ä¸å…¶ä¸­ã€‚ç¤¾åŒºæŒç»­æˆé•¿å’Œæ”¹è¿›ã€‚æˆ‘ä»¬æ„Ÿè°¢æ‰€æœ‰ç¤¾åŒºæˆå‘˜çš„ç§¯æå‚ä¸å’Œå®è´µåé¦ˆã€‚æˆ‘ä»¬ä¹Ÿè¦æ„Ÿè°¢ CNCF ç»„ç»‡å’Œç›¸å…³ç¤¾åŒºæˆå‘˜å¯¹é¡¹ç›®çš„æ”¯æŒã€‚</p><p>æ¬¢è¿æ›´å¤šå¼€å‘è€…å’Œç»ˆç«¯ç”¨æˆ·<a href="https://github.com/koordinator-sh/koordinator?tab=readme-ov-file#community" target="_blank" rel="noopener noreferrer"><strong>åŠ å…¥æˆ‘ä»¬</strong></a>!æ­£æ˜¯ä½ ä»¬çš„å‚ä¸å’Œåé¦ˆä½¿ Koordinator ä¸æ–­æ”¹è¿›ã€‚æ— è®ºä½ æ˜¯äº‘åŸç”Ÿç¤¾åŒºçš„åˆå­¦è€…è¿˜æ˜¯ä¸“å®¶ï¼Œæˆ‘ä»¬éƒ½æœŸå¾…å¬åˆ°ä½ çš„å£°éŸ³ï¼</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>æ ‡ç­¾ï¼š</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/zh-Hans/blog/tags/release">release</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/zh-Hans/blog/release-v1.6.0">Koordinator v1.6: æ”¯æŒ AI/ML åœºæ™¯çš„å¼‚æ„èµ„æºè°ƒåº¦èƒ½åŠ›</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2025-02-24T00:00:00.000Z" itemprop="datePublished">2025å¹´2æœˆ24æ—¥</time> Â· <!-- -->34 åˆ†é’Ÿé˜…è¯»</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/ZiMengSheng" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/ZiMengSheng.png" alt="Jianyu Wang"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/ZiMengSheng" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Jianyu Wang</span></a></div><small class="avatar__subtitle" itemprop="description">Koordinator approver</small></div></div></div><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/saintube" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/saintube.png" alt="Rougang Han"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/saintube" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Rougang Han</span></a></div><small class="avatar__subtitle" itemprop="description">Koordinator approver</small></div></div></div><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/songtao98" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/songtao98.png" alt="Tao Song"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/songtao98" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Tao Song</span></a></div><small class="avatar__subtitle" itemprop="description">Koordinator approver</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="èƒŒæ™¯">èƒŒæ™¯<a href="#èƒŒæ™¯" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>éšç€ DeepSeek ç­‰å¤§æ¨¡å‹çš„ç«çˆ†ï¼ŒAI å’Œé«˜æ€§èƒ½è®¡ç®—é¢†åŸŸå¯¹å¼‚æ„è®¾å¤‡èµ„æºè°ƒåº¦çš„éœ€æ±‚è¿…é€Ÿå¢é•¿ï¼Œæ— è®ºæ˜¯ GPUã€NPU è¿˜æ˜¯ RDMA ç­‰è®¾å¤‡ã€‚å¦‚ä½•é«˜æ•ˆç®¡ç†å’Œè°ƒåº¦è¿™äº›èµ„æºæˆä¸ºäº†è¡Œä¸šå…³æ³¨çš„æ ¸å¿ƒé—®é¢˜ã€‚åœ¨è¿™ä¸€èƒŒæ™¯ä¸‹ï¼ŒKoordinator ç§¯æå“åº”ç¤¾åŒºè¯‰æ±‚ï¼ŒæŒç»­æ·±è€•å¼‚æ„è®¾å¤‡è°ƒåº¦èƒ½åŠ›ï¼Œå¹¶åœ¨æœ€æ–°çš„ v1.6 ç‰ˆæœ¬ä¸­æ¨å‡ºäº†ä¸€ç³»åˆ—åˆ›æ–°åŠŸèƒ½ï¼Œå¸®åŠ©å®¢æˆ·è§£å†³å¼‚æ„èµ„æºè°ƒåº¦éš¾é¢˜ã€‚</p><p>åœ¨ v1.6 ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬å®Œå–„äº†è®¾å¤‡æ‹“æ‰‘è°ƒåº¦èƒ½åŠ›ï¼Œæ”¯æŒæ„ŸçŸ¥æ›´å¤šæœºå‹çš„ GPU æ‹“æ‰‘ç»“æ„ï¼Œæ˜¾è‘—åŠ é€Ÿ AI åº”ç”¨å†…çš„ GPU äº’è”æ€§èƒ½ã€‚ä¸å¼€æºé¡¹ç›® HAMi åˆä½œï¼Œæ¨å‡ºäº†ç«¯åˆ°ç«¯çš„ GPU &amp; RDMA è”åˆåˆ†é…èƒ½åŠ›ä»¥åŠ GPU å¼ºéš”ç¦»èƒ½åŠ›ï¼Œæœ‰æ•ˆæå‡äº†å…¸å‹ AI è®­ç»ƒä»»åŠ¡çš„è·¨æœºäº’è”æ•ˆç‡å’Œæ¨ç†ä»»åŠ¡çš„éƒ¨ç½²å¯†åº¦ï¼Œä»è€Œæ›´å¥½åœ°ä¿éšœåº”ç”¨æ€§èƒ½å¹¶æé«˜é›†ç¾¤èµ„æºåˆ©ç”¨ç‡ã€‚åŒæ—¶ï¼Œå¢å¼ºäº† Kubernetes ç¤¾åŒºçš„èµ„æºæ’ä»¶ï¼Œä½¿å…¶å¯ä»¥å¯¹ä¸åŒèµ„æºé…ç½®ä¸åŒçš„èŠ‚ç‚¹æ‰“åˆ†ç­–ç•¥ï¼Œè¯¥åŠŸèƒ½åœ¨ GPU ä»»åŠ¡å’Œ CPU ä»»åŠ¡æ··éƒ¨åœ¨ä¸€ä¸ªé›†ç¾¤ä¸­æ—¶èƒ½æœ‰æ•ˆé™ä½ GPU ç¢ç‰‡ç‡ã€‚</p><p>è‡ª 2022 å¹´ 4 æœˆæ­£å¼å¼€æºä»¥æ¥ï¼ŒKoordinator å·²è¿­ä»£å‘å¸ƒäº† 14 ä¸ªå¤§ç‰ˆæœ¬ï¼Œå¸å¼•äº†æ¥è‡ªé˜¿é‡Œå·´å·´ã€èš‚èšç§‘æŠ€ã€Intelã€å°çº¢ä¹¦ã€å°ç±³ã€çˆ±å¥‡è‰ºã€360ã€æœ‰èµç­‰ä¼—å¤šä¼ä¸šçš„ä¼˜ç§€å·¥ç¨‹å¸ˆå‚ä¸è´¡çŒ®ã€‚ä»–ä»¬å¸¦æ¥äº†ä¸°å¯Œçš„æƒ³æ³•ã€ä»£ç å’Œå®é™…åº”ç”¨åœºæ™¯ï¼Œæå¤§åœ°æ¨åŠ¨äº†é¡¹ç›®çš„å‘å±•ã€‚ç‰¹åˆ«å€¼å¾—ä¸€æçš„æ˜¯ï¼Œåœ¨ v1.6.0 ç‰ˆæœ¬ä¸­ï¼Œå…±æœ‰ 10 ä½æ–°åŠ å…¥çš„å¼€å‘è€…ç§¯æå‚ä¸åˆ° Koordinator ç¤¾åŒºçš„å»ºè®¾ä¸­ï¼Œä»–ä»¬æ˜¯ @LY-todayã€@AdrianMachaoã€@TaoYang526ã€@dongjiang1989ã€@chengjoeyã€@JBininã€@clay-wangzhiã€@ferris-cxã€@nce3xin å’Œ @lijunxin559ã€‚æ„Ÿè°¢ä»–ä»¬çš„è´¡çŒ®ï¼Œä¹Ÿæ„Ÿè°¢æ‰€æœ‰ç¤¾åŒºæˆå‘˜çš„æŒç»­æŠ•å…¥å’Œæ”¯æŒï¼</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="æ ¸å¿ƒäº®ç‚¹åŠŸèƒ½">æ ¸å¿ƒäº®ç‚¹åŠŸèƒ½<a href="#æ ¸å¿ƒäº®ç‚¹åŠŸèƒ½" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1gpu-æ‹“æ‰‘æ„ŸçŸ¥è°ƒåº¦åŠ é€Ÿ-ai-åº”ç”¨å†…çš„-gpu-äº’è”">1ã€GPU æ‹“æ‰‘æ„ŸçŸ¥è°ƒåº¦ï¼šåŠ é€Ÿ AI åº”ç”¨å†…çš„ GPU äº’è”<a href="#1gpu-æ‹“æ‰‘æ„ŸçŸ¥è°ƒåº¦åŠ é€Ÿ-ai-åº”ç”¨å†…çš„-gpu-äº’è”" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>éšç€æ·±åº¦å­¦ä¹ å’Œé«˜æ€§èƒ½è®¡ç®—ï¼ˆHPCï¼‰ç­‰é¢†åŸŸçš„å¿«é€Ÿå‘å±•ï¼ŒGPU æˆä¸ºè®¸å¤šè®¡ç®—å¯†é›†å‹å·¥ä½œè´Ÿè½½çš„æ ¸å¿ƒèµ„æºã€‚åœ¨ Kubernetes é›†ç¾¤ä¸­ï¼ŒGPU çš„é«˜æ•ˆåˆ©ç”¨å¯¹äºæå‡åº”ç”¨æ€§èƒ½è‡³å…³é‡è¦ã€‚ç„¶è€Œï¼ŒGPU èµ„æºçš„æ€§èƒ½è¡¨ç°å¹¶ä¸å‡è¡¡ï¼Œå—åˆ°ç¡¬ä»¶æ‹“æ‰‘ç»“æ„å’Œèµ„æºé…ç½®çš„å½±å“ã€‚ä¾‹å¦‚</p><ol><li>åœ¨å¤š NUMA èŠ‚ç‚¹çš„ç³»ç»Ÿä¸­ï¼ŒGPUã€CPU å’Œå†…å­˜ä¹‹é—´çš„ç‰©ç†è¿æ¥å¯èƒ½ä¼šå½±å“æ•°æ®ä¼ è¾“é€Ÿåº¦å’Œè®¡ç®—æ•ˆç‡ã€‚</li><li>å¯¹äº NVIDIA çš„ L20ã€L40S ç­‰å¡å‹ï¼ŒGPU ä¹‹é—´çš„é€šä¿¡æ•ˆç‡å–å†³äºå®ƒä»¬æ˜¯å¦å±äºåŒä¸€ä¸ª PCIE æˆ–è€…åŒä¸€ä¸ª NUMANodeã€‚</li><li>å¯¹äºåä¸ºçš„æ™Ÿè…¾ NPU ä»¥åŠè™šæ‹ŸåŒ–ç¯å¢ƒä¸­é‡‡ç”¨ SharedNVSwitch æ¨¡å¼çš„ NVIDIA Hç³»åˆ—æœºå™¨ï¼ŒGPU çš„åˆ†é…éœ€è¦éµå®ˆä¸€äº›é¢„å®šä¹‰çš„ Partition è§„åˆ™ã€‚</li></ol><p><img loading="lazy" alt="image" src="/zh-Hans/assets/images/device_topology-97ee3391d3ee1b4b235c279b501dfdc9.png" width="938" height="575" class="img_ev3q"></p><p>Koordinator é’ˆå¯¹ä¸Šè¿°è®¾å¤‡åœºæ™¯ï¼Œæä¾›äº†ä¸°å¯Œçš„è®¾å¤‡æ‹“æ‰‘è°ƒåº¦ API æ¥æ»¡è¶³ Pod å¯¹äº GPU æ‹“æ‰‘çš„è¯‰æ±‚ã€‚ä¸‹é¢æ˜¯è¿™äº› API çš„ä½¿ç”¨ä¸¾ä¾‹ï¼š</p><ol><li>GPUã€CPUã€å†…å­˜ç­‰åˆ†é…åœ¨åŒä¸€ä¸ª NUMA Node<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">scheduling.koordinator.sh/numa-topology-spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;{&quot;numaTopologyPolicy&quot;:&quot;Restricted&quot;, &quot;singleNUMANodeExclusive&quot;:&quot;Preferred&quot;}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">limits</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">koordinator.sh/gpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">64</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 500Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">koordinator.sh/gpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">64</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 500Gi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li>GPU åˆ†é…åœ¨åŒä¸€ä¸ª PCIE<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">scheduling.koordinator.sh/device-allocate-hint</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">&quot;gpu&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">&quot;requiredTopologyScope&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;PCIe&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">limits</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">koordinator.sh/gpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li>GPU åˆ†é…åœ¨åŒä¸€ä¸ª NUMA Node<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">scheduling.koordinator.sh/device-allocate-hint</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">&quot;gpu&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">&quot;requiredTopologyScope&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;NUMANode&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">limits</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">koordinator.sh/gpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">400</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li>GPU éœ€æŒ‰ç…§é¢„å®šä¹‰çš„ Partition åˆ†é…</li></ol><p>é€šå¸¸ï¼ŒGPU é¢„å®šä¹‰ Partition è§„åˆ™ç”±ç‰¹å®šçš„ GPU å‹å·æˆ–ç³»ç»Ÿé…ç½®å†³å®šï¼Œä¹Ÿå¯èƒ½å—åˆ°å…·ä½“èŠ‚ç‚¹ä¸Šçš„ GPU é…ç½®çš„å½±å“ã€‚è°ƒåº¦å™¨æ— æ³•æ´æ‚‰ç¡¬ä»¶å‹å·æˆ– GPU ç±»å‹çš„å…·ä½“ä¿¡æ¯ï¼›ç›¸åï¼Œå®ƒä¾é èŠ‚ç‚¹çº§åˆ«çš„ç»„ä»¶å°†è¿™äº›é¢„å®šä¹‰è§„åˆ™ä¸ŠæŠ¥ç»™è®¾å¤‡è‡ªå®šä¹‰èµ„æº (CR) æ¥çŸ¥æ™“ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> scheduling.koordinator.sh/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Device</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">scheduling.koordinator.sh/gpu-partitions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        &quot;1&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            &quot;NVLINK&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                  # Which GPUs are included</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                  &quot;minors&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                      0</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                  ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                  # GPU Interconnect Type</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                  &quot;gpuLinkType&quot;: &quot;NVLink&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                  # Here we take the bottleneck bandwidth between GPUs in the Ring algorithm. BusBandwidth can be referenced from https://github.com/NVIDIA/nccl-tests/blob/master/doc/PERFORMANCE.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                  &quot;ringBusBandwidth&quot;: 400Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                  # Indicate the overall allocation quality for the node after the partition has been assigned away.</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                  &quot;allocationScore&quot;: &quot;1&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                },</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        &quot;2&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        &quot;4&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        &quot;8&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // æŒ‡ç¤º Partition è§„åˆ™æ˜¯å¦å¿…é¡»éµå®ˆ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">node.koordinator.sh/gpu-partition-policy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Honor&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å½“åŒæ—¶æœ‰å¤šä¸ªå¯é€‰çš„ Partition æ–¹æ¡ˆæ—¶ï¼ŒKoordinator å…è®¸ç”¨æˆ·å†³å®šæ˜¯å¦æŒ‰ç…§æœ€ä¼˜ Partition åˆ†é…:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> hello</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">gpu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">scheduling.koordinator.sh/gpu-partition-spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        # BestEffort|Restricted</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        &quot;allocatePolicy&quot;: &quot;Restricted&quot;, </span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">limits</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">koordinator.sh/gpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å½“ç”¨æˆ·ä¸éœ€è¦æŒ‰ç…§æœ€ä¼˜ Partition åˆ†é…æ—¶ï¼Œè°ƒåº¦å™¨å°†ä¼šæŒ‰ç…§å°½å¯èƒ½ Binpack çš„æ–¹å¼åˆ†é…ã€‚
æƒ³è¦äº†è§£å…³äº GPU æ‹“æ‰‘æ„ŸçŸ¥è°ƒåº¦çš„æ›´å¤šç»†èŠ‚ï¼Œè¯·å‚è€ƒå¦‚ä¸‹è®¾è®¡æ–‡æ¡£ï¼š</p><ul><li><a href="https://github.com/koordinator-sh/koordinator/blob/main/docs/proposals/scheduling/20230415-numa-topology-scheduling.md" target="_blank" rel="noopener noreferrer">NUMA Topology Scheduling</a></li><li><a href="https://github.com/koordinator-sh/koordinator/blob/main/docs/proposals/scheduling/20230803-device-allocate-hint-apis.md" target="_blank" rel="noopener noreferrer">Device Allocate Hint API</a></li><li><a href="https://github.com/koordinator-sh/koordinator/blob/main/docs/proposals/scheduling/20241008-gpu-partition-api.md" target="_blank" rel="noopener noreferrer">GPU Partition APIs</a></li></ul><p>ç”±è¡·æ„Ÿè°¢ç¤¾åŒºå¼€å‘è€… @eahydra å¯¹è¯¥ç‰¹æ€§çš„è´¡çŒ®ï¼</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2ç«¯åˆ°ç«¯-gdr-æ”¯æŒæå‡è·¨æœºä»»åŠ¡çš„äº’è”æ€§èƒ½">2ã€ç«¯åˆ°ç«¯ GDR æ”¯æŒï¼šæå‡è·¨æœºä»»åŠ¡çš„äº’è”æ€§èƒ½<a href="#2ç«¯åˆ°ç«¯-gdr-æ”¯æŒæå‡è·¨æœºä»»åŠ¡çš„äº’è”æ€§èƒ½" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p><img loading="lazy" alt="image" src="/zh-Hans/assets/images/gdr-6856416194117f2b55c389428b8bf5fe.webp" width="1650" height="928" class="img_ev3q">
åœ¨ AI æ¨¡å‹è®­ç»ƒåœºæ™¯ä¸­ï¼ŒGPU ä¹‹é—´éœ€è¦è¿›è¡Œé¢‘ç¹çš„é›†åˆé€šä¿¡ï¼Œä»¥åŒæ­¥è®­ç»ƒè¿‡ç¨‹è¿­ä»£æ›´æ–°çš„æƒé‡ã€‚GDR å…¨ç§°å«åš GPUDirect RDMAï¼Œå…¶ç›®çš„æ˜¯è§£å†³å¤šæœº GPU è®¾å¤‡ä¹‹é—´äº¤æ¢æ•°æ®çš„æ•ˆç‡é—®é¢˜ã€‚é€šè¿‡ GDR æŠ€æœ¯å¤šæœºä¹‹é—´ GPU äº¤æ¢æ•°æ®å¯ä»¥ä¸ç»è¿‡ CPU å’Œå†…å­˜ï¼Œå¤§å¹…èŠ‚çœ CPU/Memory å¼€é”€åŒæ—¶é™ä½å»¶æ—¶ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç›®æ ‡ï¼ŒKoordinator v1.6.0 ç‰ˆæœ¬ä¸­è®¾è®¡å®ç°äº† GPU/RDMA è®¾å¤‡è”åˆè°ƒåº¦ç‰¹æ€§ï¼Œæ•´ä½“æ¶æ„å¦‚ä¸‹ï¼š</p><p><img loading="lazy" alt="image" src="/zh-Hans/assets/images/gpu-rdma-joint-allocation-cf89f80793e0755b8761bee882121ddb.jpg" width="3348" height="1671" class="img_ev3q"></p><ol><li>Koordlet æ£€æµ‹èŠ‚ç‚¹ä¸Šçš„ GPU å’Œ RDMA è®¾å¤‡ï¼Œå¹¶å°†ç›¸å…³ä¿¡æ¯ä¸ŠæŠ¥ç»™ Device CRã€‚</li><li>Koord-Manager ä»è®¾å¤‡ CR åŒæ­¥èµ„æºåˆ° node.status.allocatableã€‚</li><li>Koord-Scheduler æ ¹æ®è®¾å¤‡æ‹“æ‰‘ä¸º Pod åˆ†é… GPU å’Œ RDMAï¼Œå¹¶å°†åˆ†é…ç»“æœæ³¨è§£åˆ° Pods ä¸Šã€‚</li><li>Multus-CNI è®¿é—® Koordlet PodResources Proxy ä»¥è·å–åˆ†é…ç»™ Pods çš„ RDMA è®¾å¤‡ï¼Œå¹¶å°†ç›¸åº”çš„ NIC é™„åŠ åˆ° Pods çš„ç½‘ç»œå‘½åç©ºé—´ä¸­ã€‚</li><li>Koordlet æä¾› NRI æ’ä»¶ï¼Œå°†è®¾å¤‡æŒ‚è½½åˆ°å®¹å™¨ä¸­ã€‚</li></ol><p>ç”±äºæ¶‰åŠåˆ°ä¼—å¤šç»„ä»¶å’Œå¤æ‚çš„ç¯å¢ƒï¼ŒKoordinator v1.6.0 æä¾›äº†<a href="https://koordinator.sh/docs/next/best-practices/gpu-and-rdma-joint-allocation/" target="_blank" rel="noopener noreferrer">æœ€ä½³å®è·µ</a>æ¥å±•ç¤ºå¦‚ä½•ä¸€æ­¥æ­¥éƒ¨ç½² Koordinatorã€Multus-CNI å’Œ SRIOV-CNIã€‚åœ¨éƒ¨ç½²å¥½ç›¸å…³ç»„ä»¶ä¹‹åï¼Œç”¨æˆ·å¯ä»¥ç®€å•é‡‡ç”¨å¦‚ä¸‹çš„ Pod åè®®æ¥è¯·æ±‚è°ƒåº¦å™¨ä¸ºå®ƒç”³è¯·çš„ GPU å’Œ RDMA è¿›è¡Œè”åˆåˆ†é…ï¼š</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pod</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">vf01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubeflow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">scheduling.koordinator.sh/device-joint-allocate</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">&quot;deviceTypes&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;gpu&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;rdma&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">scheduling.koordinator.sh/device-allocate-hint</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token key atrule" style="color:#00a4db">&quot;rdma&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token key atrule" style="color:#00a4db">&quot;vfSelector&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> //apply VF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">schedulerName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> koord</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">scheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> container</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">vf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">koordinator.sh/gpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">koordinator.sh/rdma</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">limits</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">koordinator.sh/gpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">koordinator.sh/rdma</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æƒ³è¦æ›´è¿›ä¸€æ­¥åœ°é‡‡ç”¨ Koordinator ç«¯åˆ°ç«¯åœ°æµ‹è¯• GDR ä»»åŠ¡ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒ<a href="https://koordinator.sh/docs/next/best-practices/gpu-and-rdma-joint-allocation/" target="_blank" rel="noopener noreferrer">æœ€ä½³å®è·µ</a>ä¸­çš„æ ·ä¾‹ä¸€æ­¥æ­¥è¿›è¡Œï¼Œåœ¨æ­¤ä¹Ÿç”±è¡·æ„Ÿè°¢ç¤¾åŒºå¼€å‘è€… @ferris-cx å¯¹è¯¥ç‰¹æ€§çš„è´¡çŒ®ï¼</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3gpu-å…±äº«å¼ºéš”ç¦»æé«˜-ai-æ¨ç†ä»»åŠ¡çš„èµ„æºåˆ©ç”¨ç‡">3ã€GPU å…±äº«å¼ºéš”ç¦»ï¼šæé«˜ AI æ¨ç†ä»»åŠ¡çš„èµ„æºåˆ©ç”¨ç‡<a href="#3gpu-å…±äº«å¼ºéš”ç¦»æé«˜-ai-æ¨ç†ä»»åŠ¡çš„èµ„æºåˆ©ç”¨ç‡" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>åœ¨ AI åº”ç”¨ä¸­ï¼ŒGPU æ˜¯å¤§æ¨¡å‹è®­ç»ƒå’Œæ¨ç†ä¸å¯æˆ–ç¼ºçš„æ ¸å¿ƒè®¾å¤‡ï¼Œèƒ½å¤Ÿä¸ºè®¡ç®—å¯†é›†å‹ä»»åŠ¡æä¾›å¼ºå¤§çš„ç®—åŠ›æ”¯æŒã€‚ç„¶è€Œï¼Œè¿™ç§å¼ºå¤§çš„ç®—åŠ›å¾€å¾€ä¼´éšç€é«˜æ˜‚çš„æˆæœ¬ã€‚åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°è¿™æ ·çš„æƒ…å†µï¼šä¸€äº›å°æ¨¡å‹æˆ–è½»é‡çº§æ¨ç†ä»»åŠ¡ä»…éœ€å ç”¨ GPU çš„ä¸€å°éƒ¨åˆ†èµ„æºï¼ˆä¾‹å¦‚ 20% çš„ç®—åŠ›æˆ– GPU å†…å­˜ï¼‰ï¼Œä½†ä¸ºäº†è¿è¡Œè¿™äº›ä»»åŠ¡ï¼Œå´ä¸å¾—ä¸ç‹¬å ä¸€å¼ é«˜æ€§èƒ½ GPU å¡ã€‚è¿™ç§èµ„æºä½¿ç”¨æ–¹å¼ä¸ä»…æµªè´¹äº†å®è´µçš„ GPU ç®—åŠ›ï¼Œè¿˜æ˜¾è‘—å¢åŠ äº†ä¼ä¸šçš„æˆæœ¬ã€‚</p><p>è¿™ç§æƒ…å†µåœ¨ä»¥ä¸‹åœºæ™¯ä¸­å°¤ä¸ºå¸¸è§ï¼š</p><ol><li><strong>åœ¨çº¿æ¨ç†æœåŠ¡</strong>ï¼šè®¸å¤šåœ¨çº¿æ¨ç†ä»»åŠ¡çš„è®¡ç®—éœ€æ±‚è¾ƒä½ï¼Œä½†å¯¹å»¶è¿Ÿè¦æ±‚è¾ƒé«˜ï¼Œé€šå¸¸éœ€è¦éƒ¨ç½²åœ¨é«˜æ€§èƒ½ GPU ä¸Šä»¥æ»¡è¶³å®æ—¶æ€§éœ€æ±‚ã€‚</li><li><strong>å¼€å‘ä¸æµ‹è¯•ç¯å¢ƒ</strong>ï¼šå¼€å‘è€…åœ¨è°ƒè¯•æ¨¡å‹æ—¶ï¼Œå¾€å¾€åªéœ€ä½¿ç”¨å°‘é‡ GPU èµ„æºï¼Œä½†ä¼ ç»Ÿè°ƒåº¦æ–¹å¼ä¼šå¯¼è‡´èµ„æºåˆ©ç”¨ç‡ä½ä¸‹ã€‚</li><li><strong>å¤šç§Ÿæˆ·å…±äº«é›†ç¾¤</strong>ï¼šåœ¨å¤šç”¨æˆ·æˆ–å¤šå›¢é˜Ÿå…±äº«çš„ GPU é›†ç¾¤ä¸­ï¼Œæ¯ä¸ªä»»åŠ¡ç‹¬å  GPU ä¼šå¯¼è‡´èµ„æºåˆ†é…ä¸å‡ï¼Œéš¾ä»¥å……åˆ†åˆ©ç”¨ç¡¬ä»¶èƒ½åŠ›ã€‚</li></ol><p>ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼ŒKoordinator ç»“åˆ HAMi ä¸ºç”¨æˆ·æä¾›äº† GPU å…±äº«éš”ç¦»çš„èƒ½åŠ›ï¼Œå…è®¸å¤šä¸ª Pod å…±äº«åŒä¸€å¼  GPU å¡ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä¸ä»…å¯ä»¥æ˜¾è‘—æé«˜ GPU çš„èµ„æºåˆ©ç”¨ç‡ï¼Œè¿˜èƒ½é™ä½ä¼ä¸šæˆæœ¬ï¼ŒåŒæ—¶æ»¡è¶³ä¸åŒä»»åŠ¡å¯¹èµ„æºçš„çµæ´»éœ€æ±‚ã€‚ä¾‹å¦‚ï¼Œåœ¨ Koordinator çš„ GPU å…±äº«æ¨¡å¼ä¸‹ï¼Œç”¨æˆ·å¯ä»¥ç²¾ç¡®åˆ†é… GPU æ ¸å¿ƒæ•°æˆ–æ˜¾å­˜æ¯”ä¾‹ï¼Œç¡®ä¿æ¯ä¸ªä»»åŠ¡éƒ½èƒ½è·å¾—æ‰€éœ€çš„èµ„æºï¼ŒåŒæ—¶é¿å…ç›¸äº’å¹²æ‰°ã€‚</p><p><img loading="lazy" alt="image" src="/zh-Hans/assets/images/gpushare_gpubinpack-0ae1662ad8128f6092b49131859dda4b.webp" width="1650" height="663" class="img_ev3q"></p><p>HAMi æ˜¯ CNCF Sandbox é¡¹ç›®ï¼Œæ—¨åœ¨ä¸º Kubernetes æä¾›ä¸€ä¸ªè®¾å¤‡ç®¡ç†ä¸­é—´ä»¶ã€‚HAMi-Core æ˜¯å®ƒçš„æ ¸å¿ƒæ¨¡å—ï¼Œé€šè¿‡åŠ«æŒ CUDA-Runtimeï¼ˆlibcudart.soï¼‰å’Œ CUDA-Driverï¼ˆlibcuda.soï¼‰ä¹‹é—´çš„ API è°ƒç”¨æä¾› GPU å…±äº«éš”ç¦»èƒ½åŠ›ã€‚åœ¨ v1.6.0 ç‰ˆæœ¬ä¸­ï¼ŒKoordinator åˆ©ç”¨ HAMi-Core çš„ GPU éš”ç¦»åŠŸèƒ½ï¼Œæä¾›ç«¯åˆ°ç«¯çš„ GPU å…±äº«è§£å†³æ–¹æ¡ˆã€‚</p><p>å¤§å®¶å¯ä»¥é€šè¿‡ä¸‹é¢çš„ YAML æ–‡ä»¶éƒ¨ç½² DaemonSet ç›´æ¥åœ¨å¯¹åº”èŠ‚ç‚¹ä¸Šå®‰è£… HAMi-coreã€‚</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> DaemonSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> hami</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">core</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">distribute</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">koord-app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> hami</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">core</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">distribute</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">koord-app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> hami</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">core</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">distribute</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">affinity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">nodeAffinity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">requiredDuringSchedulingIgnoredDuringExecution</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">nodeSelectorTerms</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">matchExpressions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">operator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> In</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">values</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;gpu&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          cp -f /k8s-vgpu/lib/nvidia/libvgpu.so /usl/local/vgpu &amp;&amp; sleep 3600000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> docker.m.daocloud.io/projecthami/hami</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">v2.4.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">imagePullPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Always</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">limits</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 200m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 256Mi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /usl/local/vgpu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> vgpu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">hook</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /tmp/vgpulock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> vgpu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">lock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">tolerations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">operator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Exists</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">hostPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /usl/local/vgpu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> DirectoryOrCreate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> vgpu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">hook</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># https://github.com/Project-HAMi/HAMi/issues/696</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">hostPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /tmp/vgpulock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> DirectoryOrCreate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> vgpu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">lock</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Koordinator è°ƒåº¦å™¨çš„ GPU Binpack èƒ½åŠ›æ˜¯é»˜è®¤å¼€å¯çŠ¶æ€ï¼Œåœ¨å®‰è£…å¥½ Koordinator å’Œ HAMi-Core ä¹‹åï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼ç”³è¯· GPU å…±äº«å¡å¹¶å¯ç”¨ HAMi-Core éš”ç¦»ã€‚</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pod</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">koordinator.sh/gpu-isolation-provider</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> hami</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">core</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">schedulerName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> koord</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">scheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> sleep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 365d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> busybox</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">imagePullPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> IfNotPresent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> curlimage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">limits</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 40m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 40Mi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">koordinator.sh/gpu-shared</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">koordinator.sh/gpu-core</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">koordinator.sh/gpu-memory-ratio</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 40m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 40Mi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">koordinator.sh/gpu-shared</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">koordinator.sh/gpu-core</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">koordinator.sh/gpu-memory-ratio</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">terminationMessagePath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /dev/termination</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">terminationMessagePolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> File</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">restartPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Always</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å…³äºåœ¨ Koordinator å¯ç”¨ HAMi GPU å…±äº«éš”ç¦»èƒ½åŠ›çš„ä½¿ç”¨æŒ‡å¯¼ï¼Œè¯·å‚è€ƒï¼š</p><ul><li><a href="https://koordinator.sh/docs/next/user-manuals/device-scheduling-gpu-share-with-hami/" target="_blank" rel="noopener noreferrer">Device Scheduling - GPU Share With HAMi</a></li></ul><p>ç”±è¡·æ„Ÿè°¢ HAMi ç¤¾åŒºåŒå­¦ @wawa0210 å¯¹è¯¥ç‰¹æ€§çš„æ”¯æŒï¼</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4å·®å¼‚åŒ–-gpu-è°ƒåº¦ç­–ç•¥æœ‰æ•ˆé™ä½-gpu-ç¢ç‰‡ç‡">4ã€å·®å¼‚åŒ– GPU è°ƒåº¦ç­–ç•¥ï¼šæœ‰æ•ˆé™ä½ GPU ç¢ç‰‡ç‡<a href="#4å·®å¼‚åŒ–-gpu-è°ƒåº¦ç­–ç•¥æœ‰æ•ˆé™ä½-gpu-ç¢ç‰‡ç‡" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>åœ¨ç°ä»£ Kubernetes é›†ç¾¤ä¸­ï¼Œå¤šç§ç±»å‹èµ„æºï¼ˆå¦‚ CPUã€å†…å­˜ã€GPU ç­‰ï¼‰é€šå¸¸åœ¨ä¸€ä¸ªç»Ÿä¸€çš„å¹³å°ä¸Šè¿›è¡Œç®¡ç†ã€‚ç„¶è€Œï¼Œä¸åŒç±»å‹èµ„æºçš„ä½¿ç”¨æ¨¡å¼å’Œéœ€æ±‚å¾€å¾€å­˜åœ¨æ˜¾è‘—å·®å¼‚ï¼Œè¿™å¯¼è‡´äº†å¯¹èµ„æºå †å ï¼ˆPackingï¼‰å’Œæ‰“æ•£ï¼ˆSpreadingï¼‰çš„ä¸åŒç­–ç•¥éœ€æ±‚ã€‚ä¾‹å¦‚ï¼š</p><ul><li><strong>GPU èµ„æº</strong>ï¼šåœ¨ AI æ¨¡å‹è®­ç»ƒæˆ–æ¨ç†ä»»åŠ¡ä¸­ï¼Œä¸ºäº†æœ€å¤§åŒ– GPU çš„åˆ©ç”¨ç‡å¹¶å‡å°‘ç¢ç‰‡åŒ–ï¼Œç”¨æˆ·é€šå¸¸å¸Œæœ›å°† GPU ä»»åŠ¡ä¼˜å…ˆè°ƒåº¦åˆ°å·²ç»åˆ†é…äº† GPU çš„èŠ‚ç‚¹ä¸Šï¼ˆå³â€œå †å â€ç­–ç•¥ï¼‰ã€‚è¿™ç§ç­–ç•¥å¯ä»¥é¿å…å›  GPU åˆ†å¸ƒè¿‡äºåˆ†æ•£è€Œå¯¼è‡´èµ„æºæµªè´¹ã€‚</li><li><strong>CPU å’Œå†…å­˜èµ„æº</strong>ï¼šç›¸æ¯”ä¹‹ä¸‹ï¼ŒCPU å’Œå†…å­˜èµ„æºçš„éœ€æ±‚æ›´å¤šæ ·åŒ–ã€‚å¯¹äºä¸€äº›åœ¨çº¿æœåŠ¡æˆ–æ‰¹å¤„ç†ä»»åŠ¡ï¼Œç”¨æˆ·æ›´å€¾å‘äºå°†ä»»åŠ¡åˆ†æ•£åˆ°å¤šä¸ªèŠ‚ç‚¹ä¸Šï¼ˆå³â€œæ‰“æ•£â€ç­–ç•¥ï¼‰ï¼Œä»¥é¿å…å•ä¸ªèŠ‚ç‚¹ä¸Šçš„èµ„æºçƒ­ç‚¹é—®é¢˜ï¼Œä»è€Œæé«˜æ•´ä½“é›†ç¾¤çš„ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚</li></ul><p>æ­¤å¤–ï¼Œåœ¨æ··åˆå·¥ä½œè´Ÿè½½åœºæ™¯ä¸­ï¼Œä¸åŒä»»åŠ¡å¯¹èµ„æºçš„éœ€æ±‚ä¹Ÿä¼šç›¸äº’å½±å“ã€‚ä¾‹å¦‚ï¼š</p><ul><li>åœ¨ä¸€ä¸ªåŒæ—¶è¿è¡Œ GPU è®­ç»ƒä»»åŠ¡å’Œæ™®é€š CPU å¯†é›†å‹ä»»åŠ¡çš„é›†ç¾¤ä¸­ï¼Œå¦‚æœ CPU å¯†é›†å‹ä»»åŠ¡è¢«è°ƒåº¦åˆ° GPU èŠ‚ç‚¹ä¸Šå¹¶æ¶ˆè€—äº†å¤§é‡ CPU å’Œå†…å­˜èµ„æºï¼Œå¯èƒ½ä¼šå¯¼è‡´åç»­çš„ GPU ä»»åŠ¡å› é CPU èµ„æºä¸è¶³è€Œæ— æ³•å¯åŠ¨ï¼Œæœ€ç»ˆå¤„äº Pending çŠ¶æ€ã€‚</li><li>åœ¨å¤šç§Ÿæˆ·ç¯å¢ƒä¸­ï¼ŒæŸäº›ç”¨æˆ·å¯èƒ½åªç”³è¯· CPU å’Œå†…å­˜èµ„æºï¼Œè€Œå¦ä¸€äº›ç”¨æˆ·åˆ™éœ€è¦ GPU èµ„æºã€‚å¦‚æœè°ƒåº¦å™¨ä¸èƒ½åŒºåˆ†è¿™äº›éœ€æ±‚ï¼Œå¯èƒ½ä¼šå¯¼è‡´èµ„æºäº‰ç”¨å’Œä¸å…¬å¹³çš„èµ„æºåˆ†é…ã€‚</li></ul><p><img loading="lazy" alt="image" src="/zh-Hans/assets/images/gpubinpack-9c1da8580381eb1df412a2560ae7c833.webp" width="1650" height="793" class="img_ev3q"></p><p>Kubernetes åŸç”Ÿçš„ NodeResourcesFit æ’ä»¶ç›®å‰å¯¹ä¸åŒèµ„æºåªæ”¯æŒé…ç½®åŒæ ·çš„æ‰“åˆ†ç­–ç•¥ï¼Œä¸¾ä¾‹å¦‚ä¸‹ï¼š</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubescheduler.config.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> KubeSchedulerConfiguration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">profiles</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">pluginConfig</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NodeResourcesFit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">args</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubescheduler.config.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NodeResourcesFitArgs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">scoringStrategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> LeastAllocated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cpu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">weight</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> memory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">weight</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nvidia.com/gpu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">weight</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ä½†åœ¨ç”Ÿäº§å®è·µä¸­ï¼Œæœ‰äº›åœºæ™¯å¹¶ä¸é€‚ç”¨è¿™ç§è®¾è®¡ã€‚ä¾‹å¦‚ï¼šåœ¨ AI åœºæ™¯ä¸­ï¼Œç”³è¯· GPU çš„ä¸šåŠ¡å¸Œæœ›ä¼˜å…ˆå ç”¨æ•´ä¸ª GPU æœºå™¨ï¼Œé˜²æ­¢ GPU ç¢ç‰‡åŒ–ï¼›ç”³è¯· CPU&amp;MEM çš„ä¸šåŠ¡å¸Œæœ›ä¼˜å…ˆ Spreadï¼Œä»¥é™ä½ CPU çƒ­ç‚¹ã€‚Koordinator åœ¨ v1.6.0 ç‰ˆæœ¬ä¸­å¼•å…¥äº† NodeResourceFitPlus æ’ä»¶ä»¥æ”¯æŒä¸ºä¸åŒèµ„æºé…ç½®å·®å¼‚åŒ–çš„æ‰“åˆ†ç­–ç•¥ï¼Œç”¨æˆ·åœ¨å®‰è£… Koordinator è°ƒåº¦å™¨æ—¶å¯é…ç½®å¦‚ä¸‹ï¼š</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubescheduler.config.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> KubeSchedulerConfiguration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">profiles</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">pluginConfig</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">args</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubescheduler.config.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NodeResourcesFitPlusArgs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">nvidia.com/gpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> MostAllocated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">weight</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> LeastAllocated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">weight</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> LeastAllocated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">weight</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NodeResourcesFitPlus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">plugins</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">score</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NodeResourcesFitPlus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">weight</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">schedulerName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> koord</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">scheduler</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å¦å¤–ï¼Œç”³è¯· CPU&amp;MEM çš„ä¸šåŠ¡ä¼šå¸Œæœ›ä¼˜å…ˆåˆ†æ•£åˆ°é GPU æœºå™¨ï¼Œé˜²æ­¢ GPU æœºå™¨ä¸Š CPU&amp;MEM æ¶ˆè€—è¿‡å¤§ï¼Œå¯¼è‡´çœŸæ­£çš„ç”³è¯· GPU ä»»åŠ¡å› é GPU èµ„æºä¸è¶³è€Œå¤„äº Pending çŠ¶æ€ã€‚Koordinator åœ¨ v1.6.0 å½“ä¸­å¼•å…¥äº† ScarceResourceAvoidance æ’ä»¶ä»¥æ”¯æŒè¯¥éœ€æ±‚ï¼Œç”¨æˆ·å¯é…ç½®è°ƒåº¦å™¨å¦‚ä¸‹ï¼Œè¡¨ç¤º nvidia.com/gpu æ˜¯ç¨€ç¼ºèµ„æºï¼Œå½“ Pod æ²¡æœ‰ç”³è¯·è¯¥ç¨€ç¼ºèµ„æºæ—¶å°½é‡é¿å…è°ƒåº¦åˆ°ä¸Šé¢ã€‚</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubescheduler.config.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> KubeSchedulerConfiguration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">profiles</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">pluginConfig</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">args</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubescheduler.config.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ScarceResourceAvoidanceArgs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> nvidia.com/gpu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ScarceResourceAvoidance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">plugins</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">score</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NodeResourcesFitPlus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">weight</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ScarceResourceAvoidance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">weight</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">disabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;*&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">schedulerName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> koord</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">scheduler</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å…³äº GPU èµ„æºå·®å¼‚åŒ–è°ƒåº¦ç­–ç•¥çš„è¯¦ç»†è®¾è®¡å’Œä½¿ç”¨æŒ‡å¯¼ï¼Œè¯·å‚è€ƒï¼š</p><ul><li><a href="https://koordinator.sh/docs/next/designs/node-resource-fit-plus-scoring/" target="_blank" rel="noopener noreferrer">è®¾è®¡æ–‡æ¡£</a></li><li><a href="http://koordinator.sh/docs/next/user-manuals/node-resource-fit-plus-scoring" target="_blank" rel="noopener noreferrer">ç”¨æˆ·æ‰‹å†Œ</a></li></ul><p>ç”±è¡·æ„Ÿè°¢ç¤¾åŒºå¼€å‘è€… @LY-today å¯¹è¯¥ç‰¹æ€§çš„è´¡çŒ®ã€‚</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="5ç²¾ç»†åŒ–èµ„æºé¢„ç•™æ»¡è¶³-ai-ä»»åŠ¡çš„é«˜æ•ˆè¿è¡Œéœ€æ±‚">5ã€ç²¾ç»†åŒ–èµ„æºé¢„ç•™ï¼šæ»¡è¶³ AI ä»»åŠ¡çš„é«˜æ•ˆè¿è¡Œéœ€æ±‚<a href="#5ç²¾ç»†åŒ–èµ„æºé¢„ç•™æ»¡è¶³-ai-ä»»åŠ¡çš„é«˜æ•ˆè¿è¡Œéœ€æ±‚" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>å¼‚æ„èµ„æºçš„é«˜æ•ˆåˆ©ç”¨å¾€å¾€ä¾èµ–äºä¸å…¶ç´§å¯†è€¦åˆçš„ CPU å’Œ NUMA èµ„æºçš„ç²¾ç¡®å¯¹é½ã€‚ä¾‹å¦‚ï¼š</p><ul><li><strong>GPU åŠ é€Ÿä»»åŠ¡</strong>ï¼šåœ¨å¤š NUMA èŠ‚ç‚¹çš„æœåŠ¡å™¨ä¸­ï¼Œå¦‚æœ GPU ä¸ CPU æˆ–å†…å­˜ä¹‹é—´çš„ç‰©ç†è¿æ¥è·¨è¶Šäº† NUMA è¾¹ç•Œï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¼ è¾“å»¶è¿Ÿå¢åŠ ï¼Œä»è€Œæ˜¾è‘—é™ä½ä»»åŠ¡æ€§èƒ½ã€‚å› æ­¤ï¼Œè¿™ç±»ä»»åŠ¡é€šå¸¸è¦æ±‚ GPUã€CPU å’Œå†…å­˜åˆ†é…åœ¨åŒä¸€ NUMA èŠ‚ç‚¹ä¸Šã€‚</li><li><strong>AI æ¨ç†æœåŠ¡</strong>ï¼šåœ¨çº¿æ¨ç†ä»»åŠ¡å¯¹å»¶è¿Ÿéå¸¸æ•æ„Ÿï¼Œéœ€è¦ç¡®ä¿ GPU å’Œ CPU çš„èµ„æºåˆ†é…å°½å¯èƒ½é è¿‘ï¼Œä»¥å‡å°‘è·¨ NUMA èŠ‚ç‚¹çš„é€šä¿¡å¼€é”€ã€‚</li><li><strong>ç§‘å­¦è®¡ç®—ä»»åŠ¡</strong>ï¼šä¸€äº›é«˜æ€§èƒ½è®¡ç®—ä»»åŠ¡ï¼ˆå¦‚åˆ†å­åŠ¨åŠ›å­¦æ¨¡æ‹Ÿæˆ–å¤©æ°”é¢„æµ‹ï¼‰éœ€è¦é«˜å¸¦å®½ã€ä½å»¶è¿Ÿçš„å†…å­˜è®¿é—®ï¼Œå› æ­¤å¿…é¡»ä¸¥æ ¼å¯¹é½ CPU æ ¸å¿ƒå’Œæœ¬åœ°å†…å­˜ã€‚</li></ul><p>è¿™äº›éœ€æ±‚ä¸ä»…é€‚ç”¨äºä»»åŠ¡è°ƒåº¦ï¼Œä¹Ÿå»¶ä¼¸åˆ°äº†èµ„æºé¢„ç•™åœºæ™¯ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œèµ„æºé¢„ç•™æ˜¯ä¸€ç§é‡è¦çš„æœºåˆ¶ï¼Œç”¨äºä¸ºå…³é”®ä»»åŠ¡æå‰é”å®šèµ„æºï¼Œç¡®ä¿å…¶åœ¨æœªæ¥çš„æŸä¸ªæ—¶é—´ç‚¹èƒ½å¤Ÿé¡ºåˆ©è¿è¡Œã€‚ç„¶è€Œï¼Œåœ¨å¼‚æ„èµ„æºåœºæ™¯ä¸‹ï¼Œç®€å•çš„èµ„æºé¢„ç•™æœºåˆ¶å¾€å¾€æ— æ³•æ»¡è¶³ç²¾ç»†åŒ–çš„èµ„æºç¼–æ’éœ€æ±‚ã€‚ä¾‹å¦‚ï¼š</p><ul><li>æŸäº›ä»»åŠ¡å¯èƒ½éœ€è¦é¢„ç•™ç‰¹å®š NUMA èŠ‚ç‚¹ä¸Šçš„ CPU å’Œ GPU èµ„æºï¼Œä»¥ä¿è¯ä»»åŠ¡å¯åŠ¨åèƒ½å¤Ÿè·å¾—æœ€ä½³æ€§èƒ½ã€‚</li><li>åœ¨å¤šç§Ÿæˆ·é›†ç¾¤ä¸­ï¼Œä¸åŒç”¨æˆ·å¯èƒ½éœ€è¦é¢„ç•™ä¸åŒç±»å‹çš„èµ„æºç»„åˆï¼ˆå¦‚ GPU + CPU + å†…å­˜ï¼‰ï¼Œå¹¶ä¸”å¸Œæœ›è¿™äº›èµ„æºèƒ½å¤Ÿä¸¥æ ¼å¯¹é½ã€‚</li><li>å½“é¢„ç•™èµ„æºæœªè¢«å®Œå…¨ä½¿ç”¨æ—¶ï¼Œå¦‚ä½•çµæ´»åœ°å°†å‰©ä½™èµ„æºåˆ†é…ç»™å…¶ä»–ä»»åŠ¡ï¼ŒåŒæ—¶é¿å…å½±å“é¢„ç•™ä»»åŠ¡çš„èµ„æºä¿éšœï¼Œä¹Ÿæ˜¯ä¸€ä¸ªé‡è¦æŒ‘æˆ˜ã€‚</li></ul><p>ä¸ºäº†åº”å¯¹è¿™äº›å¤æ‚çš„åœºæ™¯ï¼ŒKoordinator åœ¨ v1.6 ç‰ˆæœ¬ä¸­å¯¹èµ„æºé¢„ç•™åŠŸèƒ½è¿›è¡Œäº†å…¨é¢å¢å¼ºï¼Œæä¾›äº†æ›´ç²¾ç»†åŒ–å’Œçµæ´»çš„èµ„æºç¼–æ’èƒ½åŠ›ã€‚å…·ä½“åŒ…æ‹¬ä»¥ä¸‹æ”¹è¿›ï¼š</p><ol><li>æ”¯æŒç²¾ç»†åŒ– CPUã€GPU èµ„æºçš„é¢„ç•™å’ŒæŠ¢å ã€‚</li><li>æ”¯æŒ Pod å¯¹é¢„ç•™èµ„æºé‡çš„ç²¾ç¡®åŒ¹é…ã€‚</li><li>èµ„æºé¢„ç•™äº²å’Œæ€§æ”¯æŒæŒ‡å®šé¢„ç•™åç§°å’Œæ±¡ç‚¹å®¹å¿å±æ€§ã€‚</li><li>èµ„æºé¢„ç•™æ”¯æŒ Pods æ•°é™åˆ¶ã€‚</li><li>æ”¯æŒèµ„æºé¢„ç•™æŠ¢å ä½ä¼˜å…ˆçº§ Podã€‚</li></ol><p>æ’ä»¶æ‰©å±•æ¥å£å˜åŠ¨ï¼š</p><ol><li>é¢„ç•™èµ„æºæ ¡éªŒæ¥å£ ReservationFilterPlugin ä» PreScore é˜¶æ®µå‰ç½®åˆ° Filter é˜¶æ®µä»¥ç¡®ä¿è¿‡æ»¤ç»“æœæ›´å‡†ç¡®ã€‚</li><li>é¢„ç•™èµ„æºè´¦æœ¬å½’è¿˜æ¥å£ ReservationRestorePlugin åºŸå¼ƒäº†ä¸éœ€è¦çš„æ–¹æ³•ä»¥æå‡è°ƒåº¦æ•ˆç‡ã€‚</li></ol><p>ä»¥ä¸‹æ˜¯æ–°åŠŸèƒ½çš„ä½¿ç”¨ç¤ºä¾‹ï¼š</p><ol><li>é¢„ç•™èµ„æºé‡ç²¾ç¡®åŒ¹é…ï¼ˆExact-Match Reservationï¼‰
æŒ‡å®š Pod ç²¾ç¡®åŒ¹é…é¢„ç•™èµ„æºé‡ï¼Œå¯ä»¥ç”¨äºç¼©å°ä¸€ç»„ Pod å’Œä¸€ç»„é¢„ç•™èµ„æºçš„åŒ¹é…å…³ç³»ï¼Œè®©é¢„ç•™èµ„æºçš„åˆ†é…æ›´å¯æ§ã€‚</li></ol><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># æŒ‡å®šPodç²¾ç¡®åŒ¹é…é¢„ç•™çš„èµ„æºç±»åˆ«ï¼ŒPodåªèƒ½åŒ¹é…åœ¨è¿™äº›èµ„æºç±»åˆ«ä¸‹é¢„ç•™èµ„æºé‡å’ŒPodè§„æ ¼å®Œå…¨ç›¸ç­‰çš„Reservationå¯¹è±¡ï¼›æ¯”å¦‚æŒ‡å®š&quot;cpu&quot;,&quot;memory&quot;,&quot;nvidia.com/gpu&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">scheduling.koordinator.sh/exact-match-reservation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;{&quot;resourceNames&quot;:{&quot;cpu&quot;,&quot;memory&quot;,&quot;nvidia.com/gpu&quot;}}&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>å¿½ç•¥èµ„æºé¢„ç•™ï¼ˆreservation-ignoredï¼‰
æŒ‡å®š Pod å¿½ç•¥èµ„æºé¢„ç•™ï¼Œå¯ä»¥è®© Pod å¡«å……å·²é¢„ç•™ä½†æœªåˆ†é…çš„èŠ‚ç‚¹ç©ºé—²èµ„æºï¼Œé…åˆæŠ¢å ä½¿ç”¨å¯ä»¥æ›´å‡å°‘èµ„æºç¢ç‰‡ã€‚</li></ol><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># æŒ‡å®šPodçš„è°ƒåº¦å¯ä»¥å¿½ç•¥æ‰èµ„æºé¢„ç•™</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">scheduling.koordinator.sh/reservation-ignored</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;true&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>æŒ‡å®šèµ„æºé¢„ç•™åç§°çš„äº²å’Œæ€§ï¼ˆReservationAffinityï¼‰</li></ol><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># æŒ‡å®šPodåŒ¹é…çš„èµ„æºé¢„ç•™åç§°</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">scheduling.koordinator.sh/reservation-affinity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;{&quot;name&quot;:&quot;test-reservation&quot;}&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="4"><li>æŒ‡å®šèµ„æºé¢„ç•™çš„æ±¡ç‚¹å’Œå®¹å¿</li></ol><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> scheduling.koordinator.sh/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Reservation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> test</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">reservation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># æŒ‡å®šReservationçš„Taintsï¼Œå…¶é¢„ç•™èµ„æºåªèƒ½åˆ†é…ç»™å®¹å¿è¯¥æ±¡ç‚¹çš„Pod</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">taints</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">effect</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NoSchedule</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> test</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">taint</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> test</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">taint</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># æŒ‡å®šPodå¯¹èµ„æºé¢„ç•™çš„æ±¡ç‚¹å®¹å¿</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">scheduling.koordinator.sh/reservation-affinity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;{&quot;tolerations&quot;:[{&quot;key&quot;:&quot;test-taint-key&quot;,&quot;operator&quot;:&quot;Equal&quot;,&quot;value&quot;:&quot;test-taint-value&quot;,&quot;effect&quot;:&quot;NoSchedule&quot;}]}&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="5"><li>å¼€å¯ reservation æŠ¢å </li></ol><blockquote><p>æ³¨ï¼šå½“å‰ä¸æ”¯æŒé«˜ä¼˜ Pod æŠ¢å ä½ä¼˜ Reservation çš„ç”¨æ³•ã€‚</p></blockquote><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubescheduler.config.k8s.io/v1beta3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> KubeSchedulerConfiguration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">profiles</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">pluginConfigs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Reservation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">args</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubescheduler.config.k8s.io/v1beta3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ReservationArgs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">enablePreemption</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">plugins</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">postFilter</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># è°ƒåº¦å™¨é…ç½®ä¸­ï¼Œå…³é—­DefaultPreemptionæ’ä»¶çš„æŠ¢å ï¼Œå¼€å¯Reservationæ’ä»¶çš„æŠ¢å </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">disabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> DefaultPreemption</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Reservation</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç”±è¡·æ„Ÿè°¢ç¤¾åŒºå¼€å‘è€… @saintube å¯¹è¯¥ç‰¹æ€§çš„è´¡çŒ®ï¼</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="6æ··éƒ¨mid-tier-æ”¯æŒç©ºé—²èµ„æºå†åˆ†é…å¢å¼º-pod-çº§åˆ«-qos-é…ç½®">6ã€æ··éƒ¨ï¼šMid tier æ”¯æŒç©ºé—²èµ„æºå†åˆ†é…ï¼Œå¢å¼º Pod çº§åˆ« QoS é…ç½®<a href="#6æ··éƒ¨mid-tier-æ”¯æŒç©ºé—²èµ„æºå†åˆ†é…å¢å¼º-pod-çº§åˆ«-qos-é…ç½®" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>åœ¨ç°ä»£æ•°æ®ä¸­å¿ƒä¸­ï¼Œæ··éƒ¨æŠ€æœ¯å·²ç»æˆä¸ºæå‡èµ„æºåˆ©ç”¨ç‡çš„é‡è¦æ‰‹æ®µã€‚é€šè¿‡å°†å»¶è¿Ÿæ•æ„Ÿå‹ä»»åŠ¡ï¼ˆå¦‚åœ¨çº¿æœåŠ¡ï¼‰ä¸èµ„æºå¯†é›†å‹ä»»åŠ¡ï¼ˆå¦‚ç¦»çº¿æ‰¹å¤„ç†ï¼‰æ··åˆéƒ¨ç½²åœ¨åŒä¸€é›†ç¾¤ä¸­ï¼Œä¼ä¸šå¯ä»¥æ˜¾è‘—é™ä½ç¡¬ä»¶æˆæœ¬å¹¶æé«˜èµ„æºä½¿ç”¨æ•ˆç‡ã€‚ç„¶è€Œï¼Œéšç€æ··éƒ¨é›†ç¾¤èµ„æºæ°´ä½çš„ä¸æ–­æé«˜ï¼Œå¦‚ä½•ç¡®ä¿ä¸åŒç±»å‹ä»»åŠ¡ä¹‹é—´çš„èµ„æºéš”ç¦»æˆä¸ºå…³é”®æŒ‘æˆ˜ã€‚</p><p>åœ¨æ··éƒ¨åœºæ™¯ä¸­ï¼Œèµ„æºéš”ç¦»èƒ½åŠ›çš„æ ¸å¿ƒç›®æ ‡æ˜¯ï¼š</p><ul><li><strong>ä¿éšœé«˜ä¼˜å…ˆçº§ä»»åŠ¡çš„æ€§èƒ½</strong>ï¼šä¾‹å¦‚ï¼Œåœ¨çº¿æœåŠ¡éœ€è¦ç¨³å®šçš„ CPUã€å†…å­˜å’Œ I/O èµ„æºï¼Œä»¥æ»¡è¶³ä½å»¶è¿Ÿè¦æ±‚ã€‚</li><li><strong>å……åˆ†åˆ©ç”¨ç©ºé—²èµ„æº</strong>ï¼šç¦»çº¿ä»»åŠ¡åº”å°½å¯èƒ½åˆ©ç”¨é«˜ä¼˜å…ˆçº§ä»»åŠ¡æœªä½¿ç”¨çš„èµ„æºï¼Œä½†ä¸èƒ½å¯¹é«˜ä¼˜å…ˆçº§ä»»åŠ¡é€ æˆå¹²æ‰°ã€‚</li><li><strong>åŠ¨æ€è°ƒæ•´èµ„æºåˆ†é…</strong>ï¼šæ ¹æ®èŠ‚ç‚¹è´Ÿè½½çš„å˜åŒ–å®æ—¶è°ƒæ•´èµ„æºåˆ†é…ç­–ç•¥ï¼Œé¿å…èµ„æºäº‰æŠ¢æˆ–æµªè´¹ã€‚</li></ul><p>ä¸ºäº†å®ç°è¿™äº›ç›®æ ‡ï¼ŒKoordinator æŒç»­æ„å»ºå’Œå®Œå–„èµ„æºéš”ç¦»èƒ½åŠ›ã€‚åœ¨ v1.6 ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦å›´ç»•èµ„æºè¶…å–å’Œæ··éƒ¨ QoS å±•å¼€äº†ä¸€ç³»åˆ—åŠŸèƒ½ä¼˜åŒ–å’Œé—®é¢˜ä¿®å¤ï¼Œå…·ä½“åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š</p><ol><li>Mid èµ„æºè¶…å–å’ŒèŠ‚ç‚¹ç”»åƒç‰¹æ€§ä¼˜åŒ–è®¡ç®—é€»è¾‘ï¼Œæ”¯æŒè¶…å–èŠ‚ç‚¹æœªåˆ†é…èµ„æºï¼Œé¿å…å¯¹èŠ‚ç‚¹èµ„æºè¿›è¡ŒäºŒæ¬¡è¶…å–ã€‚</li><li>è´Ÿè½½æ„ŸçŸ¥è°ƒåº¦ä¼˜åŒ–æŒ‡æ ‡é™çº§é€»è¾‘ã€‚</li><li>CPU QoSã€Resctrl QoS æ”¯æŒ pod ç»´åº¦é…ç½®ã€‚</li><li>å¸¦å¤–è´Ÿè½½ç®¡ç†è¡¥å…… prometheus metricsï¼Œä»¥å¢å¼ºå¯è§‚æµ‹æ€§ã€‚</li><li>Blkio QoSã€èµ„æºæ”¾å¤§ç­‰ç‰¹æ€§çš„ bugfixesã€‚</li></ol><p>Mid èµ„æºè¶…å–ä» Koordinator v1.3 ç‰ˆæœ¬å¼€å§‹å¼•å…¥ï¼Œæä¾›åŸºäº<a href="https://koordinator.sh/docs/designs/node-prediction/" target="_blank" rel="noopener noreferrer">èŠ‚ç‚¹ç”»åƒ</a>çš„åŠ¨æ€èµ„æºè¶…å–èƒ½åŠ›ã€‚ä½†æ˜¯ï¼Œä¸ºäº†ç¡®ä¿è¶…å–èµ„æºçš„ç¨³å®šæ€§ï¼ŒMid èµ„æºå®Œå…¨ä»èŠ‚ç‚¹ä¸Šå·²åˆ†é…çš„ Prod pods ä¸­è·å–ï¼Œæ„å‘³ç€ç©ºèŠ‚ç‚¹ä¸€å¼€å§‹æ˜¯æ²¡æœ‰ Mid èµ„æºçš„ï¼Œè¿™ç»™ä¸€äº›å·¥ä½œè´Ÿè½½ä½¿ç”¨ Mid èµ„æºå¸¦æ¥äº†è¯¸å¤šä¸ä¾¿ï¼ŒKoordinator ç¤¾åŒºä¹Ÿæ”¶åˆ°äº†ä¸€äº›ä¼ä¸šç”¨æˆ·çš„åé¦ˆå’Œè´¡çŒ®ã€‚
<img loading="lazy" alt="Resource Model" src="/zh-Hans/assets/images/resource-model-0f6ca53f0a140a2be9705e75758caf22.png" width="1058" height="353" class="img_ev3q">
åœ¨ v1.6 ç‰ˆæœ¬ä¸­ï¼ŒKoordinator æ›´æ–°äº†è¶…å–è®¡ç®—å…¬å¼ï¼Œå¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">MidAllocatable := min(ProdReclaimable, NodeAllocatable * thresholdRatio) + ProdUnallocated * unallocatedRatio</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ProdReclaimable := min(max(0, ProdAllocated - ProdPeak * (1 + safeMargin)), NodeUnused)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>è®¡ç®—é€»è¾‘æœ‰ä¸¤ç‚¹å˜åŒ–ï¼š</p><ol><li>æ”¯æŒæŒ‰é™æ€æ¯”ä¾‹å¯¹æœªåˆ†é…èµ„æºè¿›è¡Œè¶…å–ï¼Œä»¥æ”¹å–„å†·å¯åŠ¨é—®é¢˜ã€‚</li><li>ä¸å…è®¸è¶…å–å®é™…å·²ä½¿ç”¨çš„èŠ‚ç‚¹èµ„æºï¼Œé¿å…å› äºŒæ¬¡è¶…å–åœºæ™¯å¯¼è‡´é¢„ä¼°å€¼è¿‡å¤§ï¼›ä¾‹å¦‚ï¼Œä¸€äº›ç”¨æˆ·ä½¿ç”¨äº† Koordinator çš„èŠ‚ç‚¹èµ„æºæ”¾å¤§èƒ½åŠ›ä»¥è°ƒåº¦æ›´å¤š Prod podsï¼Œä½¿å¾—èŠ‚ç‚¹ä¸Š ProdAllocated &gt; NodeAllocatableï¼Œå¯¼è‡´ MidAllocatable çš„é¢„ä¼°å€¼å·²ç»åç¦»çœŸå®çš„èŠ‚ç‚¹è´Ÿè½½ã€‚</li></ol><p>æ­¤å¤–ï¼Œåœ¨æ··éƒ¨ QoS æ–¹é¢ï¼ŒKoordinator v1.6 å¢å¼ºäº† Pod ç²’åº¦çš„ QoS ç­–ç•¥é…ç½®èƒ½åŠ›ï¼Œé€‚ç”¨äºä¾‹å¦‚æ··éƒ¨èŠ‚ç‚¹ä¸ŠåŠ é»‘å¹²æ‰° Pod ä»¥åŠç°åº¦è°ƒæ•´æ··éƒ¨ QoS çš„ä½¿ç”¨åœºæ™¯ï¼š</p><ol><li>Resctrl ç‰¹æ€§ï¼Œæ”¯æŒ Pod ç»´åº¦çš„ LLC å’Œå†…å­˜å¸¦å®½éš”ç¦»èƒ½åŠ›</li><li>CPU QoS ç‰¹æ€§ï¼Œæ”¯æŒ Pod ç»´åº¦çš„ CPU QoS é…ç½®</li></ol><p>Resctrl ç‰¹æ€§å¯é€šè¿‡ä»¥ä¸‹æ–¹å¼åœ¨ Pod ç»´åº¦å¯ç”¨ï¼š</p><ol><li>åœ¨ Koordlet ä¸­ feature-gate ä¸­å¯ç”¨ Resctrl ç‰¹æ€§ã€‚</li><li>é€šè¿‡ Pod Annotation åè®®node.koordinator.sh/resctrlï¼Œé…ç½® LLC åŠå†…å­˜å¸¦å®½ï¼ˆMBï¼‰é™åˆ¶ç­–ç•¥ã€‚ä¾‹å¦‚ï¼Œ</li></ol><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">node.koordinator.sh/resctrl</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;{&quot;llc&quot;: {&quot;schemata&quot;: {&quot;range&quot;: [0, 30]}}, &quot;mb&quot;: {&quot;schemata&quot;: {&quot;percent&quot;: 20}}}&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Pod ç»´åº¦çš„ CPU QoS é…ç½®åˆ™å¯é€šè¿‡ä»¥ä¸‹æ–¹å¼å¯ç”¨ï¼š</p><ol><li>å¯ç”¨ CPU QoSï¼Œè¯·å‚ç…§ï¼š<a href="https://koordinator.sh/docs/user-manuals/cpu-qos/" target="_blank" rel="noopener noreferrer">https://koordinator.sh/docs/user-manuals/cpu-qos/</a></li><li>é€šè¿‡ Pod Annotation åè®®koordinator.sh/cpuQOSï¼Œé…ç½® Pod çš„ CPU QoS ç­–ç•¥ã€‚ä¾‹å¦‚ï¼Œ</li></ol><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">koordinator.sh/cpuQOS</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;{&quot;groupIdentity&quot;: 1}&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç”±è¡·æ„Ÿè°¢ @kangclzjcã€@j4ckstrawã€@lijunxin559ã€@tan90githubã€@yangfeiyu20102011 ç­‰ç¤¾åŒºå¼€å‘è€…åœ¨æ··éƒ¨ç›¸å…³ç‰¹æ€§ä¸Šçš„è´¡çŒ®ï¼</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="7è°ƒåº¦é‡è°ƒåº¦æŒç»­æå‡çš„è¿è¡Œæ•ˆç‡">7ã€è°ƒåº¦ã€é‡è°ƒåº¦ï¼šæŒç»­æå‡çš„è¿è¡Œæ•ˆç‡<a href="#7è°ƒåº¦é‡è°ƒåº¦æŒç»­æå‡çš„è¿è¡Œæ•ˆç‡" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>åœ¨äº‘åŸç”ŸæŠ€æœ¯æŒç»­å‘å±•çš„ä»Šå¤©ï¼Œè¶Šæ¥è¶Šå¤šçš„ä¼ä¸šå°†æ ¸å¿ƒä¸šåŠ¡è¿ç§»åˆ° Kubernetes å¹³å°ï¼Œé›†ç¾¤è§„æ¨¡å’Œä»»åŠ¡æ•°é‡å‘ˆç°çˆ†å‘å¼å¢é•¿ã€‚è¿™ç§è¶‹åŠ¿å¸¦æ¥äº†æ˜¾è‘—çš„æŠ€æœ¯æŒ‘æˆ˜ï¼Œå°¤å…¶æ˜¯åœ¨è°ƒåº¦æ€§èƒ½å’Œé‡è°ƒåº¦ç­–ç•¥æ–¹é¢ï¼š</p><ul><li><strong>è°ƒåº¦æ€§èƒ½éœ€æ±‚</strong>ï¼šéšç€é›†ç¾¤è§„æ¨¡çš„æ‰©å¤§ï¼Œè°ƒåº¦å™¨éœ€è¦å¤„ç†çš„ä»»åŠ¡æ•°é‡æ€¥å‰§å¢åŠ ï¼Œè¿™å¯¹è°ƒåº¦å™¨çš„æ€§èƒ½å’Œæ‰©å±•æ€§æå‡ºäº†æ›´é«˜è¦æ±‚ã€‚ä¾‹å¦‚ï¼Œåœ¨å¤§è§„æ¨¡é›†ç¾¤ä¸­ï¼Œå¦‚ä½•å¿«é€Ÿå®Œæˆ Pod çš„è°ƒåº¦å†³ç­–ã€é™ä½è°ƒåº¦å»¶è¿Ÿæˆä¸ºå…³é”®é—®é¢˜ã€‚</li><li><strong>é‡è°ƒåº¦ç­–ç•¥éœ€æ±‚</strong>ï¼šåœ¨å¤šç§Ÿæˆ·ç¯å¢ƒä¸‹ï¼Œèµ„æºç«äº‰åŠ å‰§ï¼Œé¢‘ç¹çš„é‡è°ƒåº¦å¯èƒ½å¯¼è‡´å·¥ä½œè´Ÿè½½åœ¨ä¸åŒèŠ‚ç‚¹ä¹‹é—´åå¤è¿ç§»ï¼Œè¿›è€Œå¢åŠ ç³»ç»Ÿè´Ÿæ‹…å¹¶å½±å“é›†ç¾¤ç¨³å®šæ€§ã€‚æ­¤å¤–ï¼Œå¦‚ä½•åœ¨ä¿éšœç”Ÿäº§ä»»åŠ¡ç¨³å®šè¿è¡Œçš„åŒæ—¶ï¼Œåˆç†åˆ†é…èµ„æºä»¥é¿å…çƒ­ç‚¹é—®é¢˜ï¼Œä¹Ÿæˆä¸ºé‡è°ƒåº¦ç­–ç•¥è®¾è®¡çš„é‡è¦è€ƒé‡ã€‚</li></ul><p>ä¸ºäº†åº”å¯¹è¿™äº›æŒ‘æˆ˜ï¼ŒKoordinator åœ¨ v1.6.0 ç‰ˆæœ¬ä¸­å¯¹è°ƒåº¦å™¨å’Œé‡è°ƒåº¦å™¨è¿›è¡Œäº†å…¨é¢ä¼˜åŒ–ï¼Œæ—¨åœ¨æå‡è°ƒåº¦æ€§èƒ½ã€å¢å¼ºé‡è°ƒåº¦ç­–ç•¥çš„ç¨³å®šæ€§å’Œåˆç†æ€§ã€‚ä»¥ä¸‹æ˜¯æˆ‘ä»¬åœ¨å½“å‰ç‰ˆæœ¬ä¸­é’ˆå¯¹è°ƒåº¦å™¨æ€§èƒ½çš„ä¼˜åŒ–ï¼š</p><ol><li>å°† PodGroup çš„ MinMember æ£€æŸ¥æå‰åˆ° PreEnqueueï¼Œå‡å°‘ä¸å¿…è¦çš„è°ƒåº¦å‘¨æœŸã€‚</li><li>å°† Reservation çš„èµ„æºå½’è¿˜å»¶è¿Ÿåˆ° AfterPreFilter é˜¶æ®µï¼Œåªåœ¨ PreFilterResult å…è®¸çš„èŠ‚ç‚¹ä¸Šåšèµ„æºå½’è¿˜ï¼Œé™ä½ç®—æ³•å¤æ‚åº¦ã€‚</li><li>ä¼˜åŒ– NodeNUMAResourceã€DeviceShareã€Reservation ç­‰æ’ä»¶çš„ CycleState åˆ†å¸ƒï¼Œé™ä½å†…å­˜å¼€é”€ã€‚</li><li>ä¸º Koordinator é¢å¤–å¢åŠ çš„æ‰©å±•ç‚¹å¦‚ BeforePreFilterã€AfterPreFilter æ–°å¢å»¶è¿ŸæŒ‡æ ‡ã€‚</li></ol><p>éšç€é›†ç¾¤è§„æ¨¡çš„ä¸æ–­æ‰©å¤§ï¼Œé‡è°ƒåº¦è¿‡ç¨‹çš„ç¨³å®šæ€§å’Œåˆç†æ€§æˆä¸ºæ ¸å¿ƒå…³æ³¨ç‚¹ã€‚é¢‘ç¹çš„é©±é€å¯èƒ½å¯¼è‡´å·¥ä½œè´Ÿè½½åœ¨èŠ‚ç‚¹é—´åå¤è¿ç§»ï¼Œå¢åŠ ç³»ç»Ÿè´Ÿæ‹…å¹¶å¼•å‘ç¨³å®šæ€§é£é™©ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬åœ¨ v1.6.0 ç‰ˆæœ¬ä¸­å¯¹é‡è°ƒåº¦å™¨è¿›è¡Œäº†å¤šé¡¹ä¼˜åŒ–ï¼š</p><ol><li>LowNodeLoad æ’ä»¶ä¼˜åŒ–ï¼š<ol><li>LowNodeLoad æ’ä»¶ç°åœ¨æ”¯æŒé…ç½® ProdHighThresholds å’Œ ProdLowThresholdsï¼Œç»“åˆ Koordinator ä¼˜å…ˆçº§ï¼ˆPriorityï¼‰å¯¹å·¥ä½œè´Ÿè½½çš„èµ„æºåˆ©ç”¨ç‡è¿›è¡Œå·®å¼‚åŒ–ç®¡ç†ï¼Œèƒ½å¤Ÿå‡å°‘ç”Ÿäº§åº”ç”¨å¼•èµ·çš„çƒ­ç‚¹é—®é¢˜ï¼Œä»è€Œå®ç°æ›´ç»†ç²’åº¦çš„è´Ÿè½½å‡è¡¡ï¼›</li><li>ä¼˜åŒ–äº†å¯¹å¾…é©±é€ Pod çš„æ’åºé€»è¾‘ï¼Œé€šè¿‡åˆ†æ®µå‡½æ•°æ‰“åˆ†ç®—æ³•é€‰å‡ºæœ€é€‚åˆé©±é€çš„ Podï¼Œç¡®ä¿åˆç†çš„èµ„æºåˆ†é…ï¼Œé¿å…å› é©±é€èµ„æºåˆ©ç”¨ç‡æœ€å¤§çš„Podè€Œé€ æˆçš„ç¨³å®šæ€§é—®é¢˜ï¼›</li><li>ä¼˜åŒ–äº† Pod é©±é€å‰çš„æ£€æŸ¥é€»è¾‘ï¼ŒLowNodeLoad åœ¨é©±é€ Pod å‰é€ä¸€æ£€æŸ¥ç›®æ ‡èŠ‚ç‚¹æ˜¯å¦ä¼šå› é‡è°ƒåº¦æˆä¸ºæ–°çš„çƒ­ç‚¹èŠ‚ç‚¹ï¼Œè¿™ä¸€ä¼˜åŒ–æœ‰æ•ˆé¿å…äº†åå¤é‡è°ƒåº¦çš„å‘ç”Ÿã€‚</li></ol></li><li>é©±é€æ§åˆ¶å™¨ MigrationController å¢å¼ºï¼š<ol><li>MigrationController å…·æœ‰ ObjectLimiter çš„èƒ½åŠ›ï¼Œèƒ½å¤Ÿæ§åˆ¶æŸæ®µæ—¶é—´å†…å·¥ä½œè´Ÿè½½çš„é©±é€é¢‘ç‡ã€‚ç°åœ¨æ”¯æŒé…ç½® namespace çº§åˆ«çš„é©±é€é™æµï¼Œå¯¹ namespace ä¸‹çš„é©±é€è¿›è¡Œæ›´åŠ ç²¾ç»†åŒ–çš„æ§åˆ¶ï¼›åŒæ—¶å°†ObjectLimiterä»Arbitrator è¿ç§»åˆ° MigrationController å†…éƒ¨ï¼Œä¿®å¤äº†åœ¨å¹¶å‘åœºæ™¯ä¸‹å¯èƒ½å‡ºç°çš„é™æµå¤±æ•ˆé—®é¢˜ï¼›</li><li>æ–°å¢ EvictAllBarePods é…ç½®é¡¹ï¼Œå…è®¸ç”¨æˆ·å¼€å¯é©±é€æ²¡æœ‰ OwnerRef çš„ Podï¼Œä»è€Œæé«˜äº†é‡è°ƒåº¦çš„çµæ´»æ€§ï¼›</li><li>æ–°å¢ MaxMigratingGlobally é…ç½®é¡¹ï¼ŒMigrationController å¯ä»¥å•ç‹¬æ§åˆ¶Podçš„æœ€å¤§é©±é€æ•°é‡ï¼Œä»è€Œé™ä½äº†ç¨³å®šæ€§é£é™©ï¼›</li><li>ä¼˜åŒ–äº† GetMaxUnavailable æ–¹æ³•çš„è®¡ç®—é€»è¾‘ï¼Œå½“è®¡ç®—å·¥ä½œè´Ÿè½½çš„æœ€å¤§ä¸å¯ç”¨å‰¯æœ¬æ•°å‘ä¸‹å–æ•´ä¸º 0 æ—¶ï¼Œé»˜è®¤å°†å…¶è°ƒæ•´ä¸º 1ï¼Œé¿å…å¯¼è‡´ç”¨æˆ·å¯¹å‰¯æœ¬ä¸å¯ç”¨æ•°çš„æ§åˆ¶å¤±å»é¢„æœŸçš„å‡†ç¡®æ€§å’Œä¸€è‡´æ€§ã€‚</li></ol></li><li>æ–°å¢é‡è°ƒåº¦å…¨å±€é…ç½®å‚æ•° MaxNoOfPodsToEvictTotalï¼Œå¯ä»¥ç¡®ä¿é‡è°ƒåº¦å™¨å…¨å±€çš„ Pod æœ€å¤§é©±é€æ•°é‡ï¼Œå‡å°‘å¯¹é›†ç¾¤çš„è´Ÿæ‹…å¹¶æå‡ç¨³å®šæ€§ï¼›</li></ol><p>ç”±è¡·æ„Ÿè°¢ç¤¾åŒºå¼€å‘è€… @AdrianMachaoã€@songtao98ã€@LY-todayã€@zwForrestã€@JBininã€@googs1025ã€@bogo-y åœ¨è°ƒåº¦é‡è°ƒåº¦ä¼˜åŒ–ä¸Šçš„è´¡çŒ®ï¼</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="æœªæ¥è®¡åˆ’">æœªæ¥è®¡åˆ’<a href="#æœªæ¥è®¡åˆ’" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>Koordinator ç¤¾åŒºå°†ç»§ç»­ä¸“æ³¨äºåŠ å¼º GPU èµ„æºç®¡ç†å’Œè°ƒåº¦åŠŸèƒ½ï¼Œæä¾›é‡è°ƒåº¦æ’ä»¶è¿›ä¸€æ­¥è§£å†³èµ„æºåˆ†é…ä¸å‡è¡¡å¯¼è‡´çš„ GPU ç¢ç‰‡é—®é¢˜ï¼Œå¹¶è®¡åˆ’åœ¨ä¸‹ä¸€ä¸ªç‰ˆæœ¬ä¸­å¼•å…¥æ›´å¤šæ–°çš„åŠŸèƒ½å’Œç‰¹æ€§ï¼Œä»¥æ”¯æŒæ›´å¤æ‚çš„å·¥ä½œè´Ÿè½½åœºæ™¯ï¼›åŒæ—¶ï¼Œåœ¨èµ„æºé¢„ç•™å’Œæ··éƒ¨æ–¹é¢ï¼Œæˆ‘ä»¬å°†è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œä»¥æ”¯æŒæ›´ç»†ç²’åº¦çš„åœºæ™¯ã€‚</p><p>ç›®å‰ç¤¾åŒºå·²ç»åœ¨è§„åˆ’çš„ Proposal å¦‚ä¸‹ï¼š</p><ul><li><a href="https://github.com/koordinator-sh/koordinator/issues/2335" target="_blank" rel="noopener noreferrer">ç²¾ç»†åŒ–è®¾å¤‡è°ƒåº¦æ”¯æŒæ™Ÿè…¾ NPU</a></li><li><a href="https://github.com/koordinator-sh/koordinator/issues/2332" target="_blank" rel="noopener noreferrer">æä¾›é‡è°ƒåº¦æ’ä»¶è§£å†³èµ„æºä¸å‡è¡¡é—®é¢˜</a></li><li><a href="https://github.com/koordinator-sh/koordinator/issues/2150" target="_blank" rel="noopener noreferrer">Reservation æ”¯æŒç»‘å®šå·²åˆ†é… Pod</a></li></ul><p>ç€é‡è§£å†³çš„ä½¿ç”¨é—®é¢˜å¦‚ä¸‹ï¼š</p><ul><li><a href="https://github.com/koordinator-sh/koordinator/issues/2334" target="_blank" rel="noopener noreferrer">NRI æ’ä»¶å†²çª</a></li></ul><p>é•¿æœŸè§„åˆ’çš„ Proposal å¦‚ä¸‹ï¼š</p><ul><li><a href="https://github.com/koordinator-sh/koordinator/issues/2181" target="_blank" rel="noopener noreferrer">æä¾›ä¸€ä¸ªç«¯åˆ°ç«¯å¯æ¼”è¿›çš„è®¾å¤‡ç®¡ç†æ–¹æ¡ˆ</a></li></ul><p>æˆ‘ä»¬é¼“åŠ±ç”¨æˆ·åé¦ˆä½¿ç”¨ä½“éªŒï¼Œå¹¶æ¬¢è¿æ›´å¤šå¼€å‘è€…å‚ä¸ Koordinator é¡¹ç›®ï¼Œå…±åŒæ¨åŠ¨å…¶å‘å±•ï¼</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>æ ‡ç­¾ï¼š</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/zh-Hans/blog/tags/release">release</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/zh-Hans/blog/release-v1.5.0">Koordinator v1.5: æŒç»­ä¼˜åŒ–ï¼Œè¿›å…¥ CNCF Sandbox</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2024-06-18T00:00:00.000Z" itemprop="datePublished">2024å¹´6æœˆ18æ—¥</time> Â· <!-- -->18 åˆ†é’Ÿé˜…è¯»</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/saintube" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/saintube.png" alt="Rougang Han"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/saintube" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Rougang Han</span></a></div><small class="avatar__subtitle" itemprop="description">Koordinator approver</small></div></div></div><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/ZiMengSheng" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/ZiMengSheng.png" alt="Jianyu Wang"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/ZiMengSheng" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Jianyu Wang</span></a></div><small class="avatar__subtitle" itemprop="description">Koordinator approver</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="èƒŒæ™¯">èƒŒæ™¯<a href="#èƒŒæ™¯" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p><a href="https://koordinator.sh/" target="_blank" rel="noopener noreferrer">Koordinator</a> æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼ŒåŸºäºé˜¿é‡Œå·´å·´åœ¨å®¹å™¨è°ƒåº¦é¢†åŸŸçš„å¤šå¹´ç»éªŒç§¯ç´¯è€Œç”Ÿï¼Œè‡ªå‘å¸ƒä»¥æ¥ç»å†äº†ä¸ªç‰ˆæœ¬çš„è¿­ä»£ï¼ŒæŒç»­ä¸æ–­åœ°ä¸º Kubernetes ç”Ÿæ€ç³»ç»Ÿå¸¦æ¥åˆ›æ–°å’Œå¢å¼ºã€‚æ—¨åœ¨æä¾›æ··éƒ¨å·¥ä½œè´Ÿè½½ç¼–æ’ã€æ··éƒ¨èµ„æºè°ƒåº¦ã€æ··éƒ¨èµ„æºéš”ç¦»å’Œæ··éƒ¨æ€§èƒ½è°ƒä¼˜çš„ç»¼åˆè§£å†³æ–¹æ¡ˆï¼Œå¸®åŠ©ç”¨æˆ·ä¼˜åŒ–å®¹å™¨æ€§èƒ½ï¼Œå¹¶æå‡é›†ç¾¤èµ„æºä½¿ç”¨æ•ˆç‡ï¼Œç®¡ç†å’Œä¼˜åŒ–å»¶è¿Ÿæ•æ„Ÿå‹å·¥ä½œè´Ÿè½½å’Œæ‰¹å¤„ç†ä½œä¸šçš„è¿è¡Œæ•ˆç‡å’Œå¯é æ€§ã€‚</p><p>åœ¨æ­¤ï¼Œæˆ‘ä»¬å‘å¤§å®¶å®£å¸ƒ Koordinator v1.5.0 ç‰ˆæœ¬çš„å‘å¸ƒï¼Œè¿™æ˜¯è‡ª2022å¹´4æœˆæ­£å¼å¼€æºä»¥æ¥ï¼ŒKoordinator è¿­ä»£å‘å¸ƒçš„ç¬¬13ä¸ªå¤§ç‰ˆæœ¬ã€‚åœ¨2å¹´å¤šçš„æ—¶é—´é‡Œï¼ŒKoordinator å¾ˆè£å¹¸å¸å¼•äº†åŒ…æ‹¬é˜¿é‡Œå·´å·´ã€èš‚èšç§‘æŠ€ã€Intelã€å°çº¢ä¹¦ã€å°ç±³ã€çˆ±å¥‡è‰ºã€360ã€æœ‰èµç­‰ä¼—å¤šä¼ä¸šçš„ä¼˜ç§€å·¥ç¨‹å¸ˆå‚ä¸ï¼Œè´¡çŒ®äº†ä¼—å¤šçš„æƒ³æ³•ã€ä»£ç å’Œåœºæ™¯ã€‚
åœ¨ v1.5.0 ç‰ˆæœ¬ä¸­ï¼ŒKoordinator å¸¦æ¥äº†ä¼—å¤šçš„åŠŸèƒ½ä¼˜åŒ–ï¼Œæ–°å¢äº† Pod çº§åˆ« NUMA å¯¹é½ç­–ç•¥ã€ç½‘ç»œ QoSã€Core Scheduling ç­‰åŠŸèƒ½æ”¯æŒã€‚</p><p>æ­¤å¤–ï¼ŒKoordinator é¡¹ç›®è¿‘æœŸé€šè¿‡äº† CNCF TOC æŠ•ç¥¨ï¼Œé¡ºåˆ©è¢« CNCF åŸºé‡‘ä¼šæ¥å—ä¸º Sandbox é¡¹ç›®ï¼ŒCNCF å…¨ç§° Cloud Native Computing Foundationï¼ˆäº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼šï¼‰ï¼Œæ—¨åœ¨ä¸ºäº‘åŸç”Ÿè½¯ä»¶æ„å»ºå¯æŒç»­å‘å±•çš„ç”Ÿæ€ç³»ç»Ÿï¼ŒæœåŠ¡äºå‚å•†ä¸­ç«‹çš„å¿«é€Ÿå¢é•¿çš„å¼€æºé¡¹ç›®ï¼Œå¦‚ Kubernetesã€Prometheus ç­‰ã€‚</p><blockquote><p><img loading="lazy" alt="koordinator-aboard-cncf-sandbox-img" src="/zh-Hans/assets/images/koordinator-aboard-cncf-sandbox-20aa4d22ea2730f897dfe0c9c7286dae.jpg" width="1848" height="492" class="img_ev3q">
æŠ•ç¥¨åœ°å€ï¼š<a href="https://github.com/cncf/sandbox/issues/51" target="_blank" rel="noopener noreferrer">https://github.com/cncf/sandbox/issues/51</a></p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ç‰ˆæœ¬åŠŸèƒ½ç‰¹æ€§è§£è¯»">ç‰ˆæœ¬åŠŸèƒ½ç‰¹æ€§è§£è¯»<a href="#ç‰ˆæœ¬åŠŸèƒ½ç‰¹æ€§è§£è¯»" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="podçº§åˆ«numaå¯¹é½ç­–ç•¥">Podçº§åˆ«NUMAå¯¹é½ç­–ç•¥<a href="#podçº§åˆ«numaå¯¹é½ç­–ç•¥" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>åœ¨è¿‡å»çš„ v1.4.0 ç‰ˆæœ¬ä¸­ï¼ŒKoordinator æ”¯æŒäº†ç”¨æˆ·åœ¨èŠ‚ç‚¹ä¸ŠåŠ æ ‡ç­¾ä¸ºä¸åŒèŠ‚ç‚¹é…ç½®ä¸åŒçš„ NUMA å¯¹é½ç­–ç•¥ã€‚ç„¶è€Œè¿™æ„å‘³ç€ç”¨æˆ·éœ€è¦æå‰å°†é›†ç¾¤ä¸­çš„èŠ‚ç‚¹æ‹†åˆ†ä¸ºä¸åŒ NUMA å¯¹é½ç­–ç•¥çš„èŠ‚ç‚¹æ± ï¼Œå¼•å…¥äº†é¢å¤–ç®¡ç†èŠ‚ç‚¹çš„è´Ÿæ‹…ã€‚
Koordinator åœ¨ v1.5.0 ä¸­å¼•å…¥äº† Pod çº§åˆ«çš„ NUMA å¯¹é½ç­–ç•¥æ¥è§£å†³è¯¥é—®é¢˜ã€‚ä¸¾ä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥ä¸º <code>pod-1</code> è®¾ç½® <code>SingleNUMANode</code>ï¼š</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pod</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">scheduling.koordinator.sh/numa-topology-spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">&quot;numaTopologyPolicy&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SingleNUMANode&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> container</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">limits</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å¼•å…¥ Pod çº§åˆ«çš„ NUMA ç­–ç•¥åï¼Œå¿…ç„¶ä¼šå‡ºç°ä¸åŒ NUMA ç­–ç•¥çš„èŠ‚ç‚¹éƒ¨ç½²åœ¨åŒä¸€ä¸ª NUMA Node çš„æƒ…å†µã€‚
ä¸¾ä¾‹ï¼Œ<code>node-1</code> æœ‰ä¸¤ä¸ª NUMA Nodeï¼Œ<code>pod-1</code> é‡‡ç”¨ <code>SingleNUMANode</code> ç­–ç•¥ä½¿ç”¨äº† <code>numa-0</code>ï¼Œ<code>pod-2</code> é‡‡ç”¨ <code>Restricted</code> ç­–ç•¥ä½¿ç”¨äº† <code>numa-0</code> å’Œ <code>numa-1</code>ã€‚
ç”±äº Pod è®¾ç½® Limit åªèƒ½é™åˆ¶ Pod åœ¨æ•´æœºç»´åº¦æœ€å¤šèƒ½ä½¿ç”¨å¤šå°‘èµ„æºï¼Œæ— æ³•é™åˆ¶åœ¨æŸä¸ª NUMA èŠ‚ç‚¹ä¸‹æœ€å¤šèƒ½ä½¿ç”¨å¤šå°‘ NUMA èµ„æºï¼Œæ‰€ä»¥ <code>pod-2</code> åœ¨ <code>numa-0</code> ä½¿ç”¨çš„èµ„æºå¯èƒ½è¶…è¿‡è°ƒåº¦å™¨åˆ†é…ç»™å®ƒçš„èµ„æºé‡ã€‚è¿™æ—¶å€™ <code>pod-2</code> å’Œ <code>pod-1</code> åœ¨ <code>numa-0</code> ä¸Šå­˜åœ¨èµ„æºç«äº‰ã€‚
ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼ŒKoordinator æ”¯æŒç”¨æˆ·ä¸º <code>SingleNUMANode</code> çš„ Pod é…ç½®ç‹¬å ç­–ç•¥ã€‚ä¸¾ä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥é…ç½® Pod ä¸º <code>SingleNUMANode</code> ä¸”ä¸ä¸è·¨ NUMA å…±å­˜åœ¨ä¸€ä¸ªæœºå™¨ä¸Šï¼š</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pod</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">scheduling.koordinator.sh/numa-topology-spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">&quot;numaTopologyPolicy&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SingleNUMANode&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">&quot;singleNUMANodeExclusive&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Required&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Required or Preferred</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> container</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">limits</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å¦å¤–ï¼ŒPod çº§åˆ«çš„ NUMA ç­–ç•¥çš„å¼•å…¥å¹¶ä¸æ„å‘³ç€åºŸå¼ƒ Node çº§åˆ«çš„ NUMA ç­–ç•¥ï¼Œè€Œæ˜¯ç›¸äº’å…¼å®¹çš„ã€‚
å› æ­¤ï¼Œå¦‚æœ Pod å’ŒèŠ‚ç‚¹ä¸Šçš„ç­–ç•¥ä¸åŒï¼ŒPod å°†ä¸ä¼šè¢«è°ƒåº¦åˆ°è¯¥èŠ‚ç‚¹ä¸Šï¼›å¦‚æœèŠ‚ç‚¹ä¸Šçš„ç­–ç•¥ä¸º <code>&quot;&quot;</code>, åˆ™è¡¨ç¤ºè¯¥èŠ‚ç‚¹èƒ½å¤Ÿæ”¾ç½®ä»»ä½• Podï¼›å¦‚æœ Pod ä¸Šçš„ç­–ç•¥ä¸º <code>&quot;&quot;</code>ï¼Œåˆ™è¡¨ç¤º Pod å¯ä»¥è°ƒåº¦åˆ°ä»»ä½•èŠ‚ç‚¹ä¸Šã€‚</p><table><thead><tr><th></th><th>SingleNUMANode node</th><th>Restricted node</th><th>BestEffort node</th></tr></thead><tbody><tr><td>SingleNUMANode pod</td><td>[âœ“]</td><td>[x]</td><td>[x]</td></tr><tr><td>Restricted pod</td><td>[x]</td><td>[âœ“]</td><td>[x]</td></tr><tr><td>BestEffort pod</td><td>[x]</td><td>[x]</td><td>[âœ“]</td></tr><tr><td>&quot;&quot;</td><td>[âœ“]</td><td>[âœ“]</td><td>[âœ“]</td></tr></tbody></table><p>å…³äº Pod çº§åˆ« NUMA å¯¹é½ç­–ç•¥çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·è§ <a href="https://github.com/koordinator-sh/koordinator/blob/main/docs/proposals/scheduling/20240131-pod-level-numa-policy.md" target="_blank" rel="noopener noreferrer">Proposal: Pod-level NUMA Policy</a>ã€‚</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="terwayç½‘ç»œqos">Terwayç½‘ç»œQoS<a href="#terwayç½‘ç»œqos" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>åœ¨ v1.5.0 ç‰ˆæœ¬ä¸­ï¼ŒKoordinator è”åŠ¨ Terway ç¤¾åŒºæä¾›äº†ç½‘ç»œ QoS èƒ½åŠ›ã€‚
<a href="https://github.com/AliyunContainerService/terway-qos" target="_blank" rel="noopener noreferrer">Terway QoS</a> çš„è¯ç”Ÿæ˜¯ä¸ºäº†è§£å†³æ··éƒ¨åœºæ™¯ä¸‹çš„ç½‘ç»œå¸¦å®½äº‰æŠ¢é—®é¢˜ï¼Œå®ƒæ”¯æŒæŒ‰å•ä¸ª Pod æˆ– QoS ç±»å‹è¿›è¡Œå¸¦å®½é™åˆ¶ï¼Œä¸å…¶ä»–æ–¹æ¡ˆç›¸æ¯”å…·å¤‡ä»¥ä¸‹ä¼˜åŠ¿ï¼š</p><ol><li>æ”¯æŒæŒ‰ä¸šåŠ¡ç±»å‹é™åˆ¶å¸¦å®½ï¼Œé€‚ç”¨äºå¤šç§ä¸šåŠ¡æ··éƒ¨çš„åœºæ™¯ã€‚</li><li>æ”¯æŒåŠ¨æ€è°ƒæ•´ Pod å¸¦å®½é™åˆ¶ã€‚</li><li>æä¾›æ•´æœºå¸¦å®½é™åˆ¶ï¼Œæ”¯æŒå¤šç½‘å¡ï¼Œæ”¯æŒå®¹å™¨ç½‘ç»œå’Œ HostNetwork Pod çš„å¸¦å®½é™åˆ¶ã€‚</li></ol><p>Terway QoS åŒ…æ‹¬3ç§ç½‘ç»œå¸¦å®½çš„ä¼˜å…ˆçº§ï¼Œå¯¹åº”çš„ Koordinator é»˜è®¤ QoS æ˜ å°„å¦‚ä¸‹ï¼š</p><table><thead><tr><th align="center">Koordinator QoS</th><th align="center">Kubernetes QoS</th><th align="center">Terway Net QoS</th></tr></thead><tbody><tr><td align="center">SYSTEM</td><td align="center">--</td><td align="center">L0</td></tr><tr><td align="center">LSE</td><td align="center">Guaranteed</td><td align="center">L1</td></tr><tr><td align="center">LSR</td><td align="center">Guaranteed</td><td align="center">L1</td></tr><tr><td align="center">LS</td><td align="center">Guaranteed/Burstable</td><td align="center">L1</td></tr><tr><td align="center">BE</td><td align="center">BestEffort</td><td align="center">L2</td></tr></tbody></table><p>åœ¨æ··éƒ¨åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨çº¿ä¸šåŠ¡å…·æœ‰æœ€å¤§çš„å¸¦å®½ä¿éšœï¼Œä»¥é¿å…äº‰æŠ¢ï¼›åœ¨ç©ºé—²æ—¶ï¼Œç¦»çº¿ä¸šåŠ¡ä¹Ÿå¯ä»¥å……åˆ†åˆ©ç”¨æ‰€æœ‰å¸¦å®½èµ„æºã€‚</p><p>å› æ­¤ï¼Œç”¨æˆ·å¯ä»¥ä¸ºä¸šåŠ¡æµé‡å®šä¹‰ä¸º3ä¸ªä¼˜å…ˆçº§ï¼Œä»é«˜åˆ°ä½ä¾æ¬¡ä¸ºï¼šL0ã€L1ã€L2ã€‚æˆ‘ä»¬å®šä¹‰äº‰ç”¨åœºæ™¯ä¸ºï¼šå½“ L0+L1+L2 çš„æ€»æµé‡è¶…è¿‡æ•´æœºå¸¦å®½æ—¶ã€‚
L0 çš„æœ€å¤§å¸¦å®½æ ¹æ® L1 å’Œ L2 çš„å®æ—¶æµé‡åŠ¨æ€è°ƒæ•´ã€‚å®ƒå¯ä»¥é«˜è‡³æ•´æœºå¸¦å®½ï¼Œä½è‡³â€œæ•´æœºå¸¦å®½ - L1 æœ€å°å¸¦å®½ - L2 æœ€å°å¸¦å®½â€ã€‚åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼ŒL1 å’Œ L2 çš„å¸¦å®½éƒ½ä¸ä¼šè¶…è¿‡å„è‡ªçš„ä¸Šé™ã€‚åœ¨äº‰ç”¨åœºæ™¯ä¸­ï¼ŒL1 å’Œ L2 çš„å¸¦å®½ä¸ä¼šä½äºå„è‡ªçš„ä¸‹é™ã€‚åœ¨äº‰ç”¨åœºæ™¯ä¸­ï¼Œå¸¦å®½å°†æŒ‰ L2ã€L1 å’Œ L0 çš„é¡ºåºè¿›è¡Œé™åˆ¶ã€‚ç”±äº Terway QoS åªæœ‰ä¸‰ä¸ªä¼˜å…ˆçº§ï¼Œå› æ­¤åªèƒ½è®¾ç½® LS å’Œ BE çš„å…¨æœºå¸¦å®½é™åˆ¶ï¼Œå…¶ä½™L0éƒ¨åˆ†æ ¹æ®æ•´æœºçš„å¸¦å®½ä¸Šé™è®¡ç®—ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªé…ç½®ç¤ºä¾‹ï¼š</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># unit: bps</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">resource-qos-config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    &quot;clusterStrategy&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      &quot;policies&quot;: {&quot;netQOSPolicy&quot;:&quot;terway-qos&quot;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      &quot;lsClass&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        &quot;networkQOS&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          &quot;enable&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          &quot;ingressRequest&quot;: &quot;50M&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          &quot;ingressLimit&quot;: &quot;100M&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          &quot;egressRequest&quot;: &quot;50M&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          &quot;egressLimit&quot;: &quot;100M&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      &quot;beClass&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        &quot;networkQOS&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          &quot;enable&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          &quot;ingressRequest&quot;: &quot;10M&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          &quot;ingressLimit&quot;: &quot;200M&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          &quot;egressRequest&quot;: &quot;10M&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          &quot;egressLimit&quot;: &quot;200M&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">  }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">system-config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&quot;clusterStrategy&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">&quot;totalNetworkBandwidth&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;600M&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ­¤å¤–ï¼Œç½‘ç»œ QoS èƒ½åŠ›ä¹Ÿæ”¯æŒ Pod ç»´åº¦çš„å¸¦å®½é™åˆ¶ï¼Œé‡‡ç”¨ä»¥ä¸‹ annotations åè®®ï¼š</p><table><thead><tr><th>Key</th><th>Value</th></tr></thead><tbody><tr><td>koordinator.sh/networkQOS</td><td>&#x27;{&quot;IngressLimit&quot;: &quot;10M&quot;, &quot;EgressLimit&quot;: &quot;20M&quot;}&#x27;</td></tr></tbody></table><p>å…³äºç½‘ç»œ QoS èƒ½åŠ›çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·è§ <a href="/zh-Hans/docs/user-manuals/network-qos-with-terwayqos">Network Bandwidth Limitation Using Terway QoS</a> å’Œ <a href="https://github.com/AliyunContainerService/terway" target="_blank" rel="noopener noreferrer">Terway</a> ç¤¾åŒºã€‚</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="core-scheduling">Core Scheduling<a href="#core-scheduling" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>åœ¨ v1.5.0 ç‰ˆæœ¬ä¸­ï¼ŒKoordinator æä¾›äº†å®¹å™¨ç»´åº¦çš„ Core Scheduling èƒ½åŠ›ï¼Œç”¨äºå¤šç§Ÿæˆ·åœºæ™¯ä¸‹é™ä½ä¾§ä¿¡é“ï¼ˆSide Channel Attackï¼‰æ”»å‡»é£é™©ï¼Œä¹Ÿå¯ä»¥ä½œä¸º CPU QoS èƒ½åŠ›å¢å¼ºæ··éƒ¨éš”ç¦»ã€‚</p><p><a href="https://docs.kernel.org/admin-guide/hw-vuln/core-scheduling.html" target="_blank" rel="noopener noreferrer">Linux Core Scheduling</a> æ”¯æŒåœ¨ç”¨æˆ·æ€å®šä¹‰å¯ä»¥å…±äº«ç‰©ç†æ ¸çš„ä»»åŠ¡åˆ†ç»„ã€‚å±äºåŒä¸€åˆ†ç»„çš„ä»»åŠ¡å°†èµ‹äºˆç›¸åŒçš„ cookie ä½œä¸ºæ ‡è¯†ï¼ŒåŒä¸€ç‰©ç†æ ¸ï¼ˆSMT ç»´åº¦ï¼‰åœ¨åŒä¸€æ—¶åˆ»åªä¼šè¿è¡Œä¸€ç§ cookie çš„ä»»åŠ¡ã€‚é€šè¿‡å°†è¿™ç§æœºåˆ¶åº”ç”¨åˆ°å®‰å…¨æ–¹é¢æˆ–æ€§èƒ½æ–¹é¢ï¼Œæˆ‘ä»¬å¯ä»¥åšåˆ°ä»¥ä¸‹äº‹æƒ…ï¼š</p><ol><li>å¯¹ä¸åŒç§Ÿæˆ·çš„ä»»åŠ¡è¿›è¡Œç‰©ç†æ ¸ç»´åº¦çš„éš”ç¦»ã€‚</li><li>é¿å…ç¦»çº¿ä»»åŠ¡äº‰æŠ¢åœ¨çº¿æœåŠ¡çš„ç‰©ç†èµ„æºã€‚</li></ol><p>Koordinator ä½¿èƒ½å†…æ ¸çš„ Core Scheduling æœºåˆ¶ï¼Œå®ç°å®¹å™¨ç»´åº¦çš„åˆ†ç»„éš”ç¦»ç­–ç•¥ï¼Œæœ€ç»ˆå½¢æˆäº†ä»¥ä¸‹ä¸¤ç§èƒ½åŠ›ï¼š</p><ol><li>Pod è¿è¡Œæ—¶ç‰©ç†æ ¸éš”ç¦»ï¼šå¯¹ Pods è¿›è¡Œåˆ†ç»„ï¼Œä¸åŒåˆ†ç»„çš„ Pods ä¸èƒ½åŒæ—¶å…±äº«ç‰©ç†æ ¸ï¼Œä¿éšœå¤šç§Ÿæˆ·éš”ç¦»ã€‚</li><li>ä¸‹ä¸€ä»£ CPU QoS ç­–ç•¥ï¼šä½œä¸º Group Identity æœºåˆ¶ä»¥å¤–ï¼Œå…¼é¡¾å®‰å…¨çš„ CPU QoS èƒ½åŠ›ã€‚</li></ol><h4 class="anchor anchorWithStickyNavbar_LWe7" id="podè¿è¡Œæ—¶ç‰©ç†æ ¸éš”ç¦»">Podè¿è¡Œæ—¶ç‰©ç†æ ¸éš”ç¦»<a href="#podè¿è¡Œæ—¶ç‰©ç†æ ¸éš”ç¦»" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>Koordinator æä¾› Pod Label åè®®ï¼Œæ ‡è¯† Pod çš„ Core Scheduling åˆ†ç»„ã€‚</p><table><thead><tr><th>Key</th><th>Value</th></tr></thead><tbody><tr><td>koordinator.sh/coreSchedulingGroup</td><td>&quot;xxx-group&quot;</td></tr></tbody></table><p>ä¸åŒåˆ†ç»„çš„ Pods è¿è¡Œæ—¶åœ¨ç‰©ç†æ ¸å±‚é¢äº’æ–¥ï¼Œå¯ä»¥è§„é¿äº†ä¸€äº›ç‰©ç†æ ¸ã€L1 cacheã€L2 cache ç»´åº¦çš„ä¾§ä¿¡é“æ”»å‡»ï¼Œé€‚ç”¨äºå¤šç§Ÿæˆ·åœºæ™¯ã€‚</p><p><img loading="lazy" alt="container-core-scheduling-img" src="/zh-Hans/assets/images/container-core-scheduling-8058c0b2c1e3cb1630406d4eddeae658.svg" width="771" height="501" class="img_ev3q"></p><p>åŒºåˆ«äºç»‘æ ¸è°ƒåº¦ï¼ŒPod è¿è¡Œçš„ç‰©ç†æ ¸èŒƒå›´å¹¶ä¸å›ºå®šï¼ŒåŒä¸€ç‰©ç†æ ¸åœ¨ä¸åŒæ—¶åˆ»å¯èƒ½è¿è¡Œç€ä¸åŒåˆ†ç»„çš„ Podsï¼Œç‰©ç†æ ¸èµ„æºå¯ä»¥è¢«åˆ†æ—¶å¤ç”¨ã€‚</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="ä¸‹ä¸€ä»£cpu-qosç­–ç•¥">ä¸‹ä¸€ä»£CPU QoSç­–ç•¥<a href="#ä¸‹ä¸€ä»£cpu-qosç­–ç•¥" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>Koordinator åŸºäº <a href="https://openanolis.cn/anolisos" target="_blank" rel="noopener noreferrer">Anolis OS</a> å†…æ ¸æä¾›çš„ Core Scheduling å’Œ CGroup Idle æœºåˆ¶ï¼Œæ„å»ºäº†æ–°çš„ CPU QoS ç­–ç•¥ã€‚</p><ul><li>BE å®¹å™¨å¯ç”¨ CGroup Idle ç‰¹æ€§ï¼Œæœ€å°åŒ–è°ƒåº¦æƒé‡å’Œä¼˜å…ˆçº§ã€‚</li><li>LSR/LS å®¹å™¨å¯ç”¨ Core Scheduling ç‰¹æ€§ï¼Œæ”¯æŒé©±é€ç‰©ç†æ ¸ä¸ŠåŒåˆ†ç»„çš„ BE ä»»åŠ¡ã€‚</li></ul><p>ç”¨æˆ·å¯ä»¥é€šè¿‡åœ¨ slo-controller-config ä¸­æŒ‡å®š <code>cpuPolicy=&quot;coreSched&quot;</code> æ¥å¯ç”¨è¯¥ç­–ç•¥ã€‚</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Example of the slo-controller-config ConfigMap.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ConfigMap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> slo</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">controller</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> koordinator</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">resource-qos-config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      &quot;clusterStrategy&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        &quot;policies&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          &quot;cpuPolicy&quot;: &quot;coreSched&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        &quot;lsClass&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          &quot;cpuQOS&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            &quot;enable&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            &quot;coreExpeller&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            &quot;schedIdle&quot;: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        &quot;beClass&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          &quot;cpuQOS&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            &quot;enable&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            &quot;coreExpeller&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            &quot;schedIdle&quot;: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å…³äº Core Scheduling èƒ½åŠ›çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·è§ <a href="/zh-Hans/docs/user-manuals/cpu-qos">CPU QoS</a>ã€‚</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="å…¶ä»–åŠŸèƒ½">å…¶ä»–åŠŸèƒ½<a href="#å…¶ä»–åŠŸèƒ½" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>é™¤äº†ä¸Šè¿°æ–°åŠŸèƒ½ç‰¹æ€§ä»¥å¤–ï¼ŒKoordinator v1.5.0 ç‰ˆæœ¬è¿˜åŒ…å«äº†ä»¥ä¸‹ä¸€ç³»åˆ—çš„åŠŸèƒ½å¢å¼ºå’Œç¨³å®šæ€§ä¼˜åŒ–ï¼š</p><ol><li>åŠŸèƒ½å¢å¼ºï¼šReservation Restricted æ¨¡å¼ä¸‹æ”¯æŒé€šè¿‡ Annotation æ§åˆ¶å“ªäº›èµ„æºä¸¥æ ¼éµå¾ª Restricted è¯­ä¹‰ï¼›å°† NUMA å¯¹é½ç­–ç•¥ Restricted çš„è¯­ä¹‰è·Ÿä¸Šæ¸¸å¯¹é½ï¼›Coscheduling å®ç°å®Œå…¨å…¬å¹³çš„è°ƒåº¦é˜Ÿåˆ—æ’é˜Ÿè§„åˆ™ï¼Œç¡®ä¿åŒä¸€ä¸ª GangGroup çš„ Pod ä¸€èµ·å‡ºé˜Ÿï¼Œä¸åŒ Gang ä»¥åŠè£¸ Pod ä¹‹é—´æŒ‰ç…§ä¸Šæ¬¡è°ƒåº¦æ—¶é—´æ’é˜Ÿï¼›NRI æ¨¡å¼æ”¯æŒé‡è¿æœºåˆ¶ï¼›koordlet ä¼˜åŒ–ç›‘æ§æŒ‡æ ‡åˆ†ç±»ï¼Œå¢åŠ æ€§èƒ½æŒ‡æ ‡ï¼›BlkioReconcile é…ç½®èƒ½åŠ›å¢å¼ºã€‚</li><li>BugFixesï¼šä¿®å¤ koordlet CPU å‹åˆ¶åŠŸèƒ½çš„å†…å­˜æ³„éœ²é—®é¢˜ï¼›ä¿®å¤ runtimeproxy çš„ panic é—®é¢˜ï¼›ä¿®æ­£ CPICollectorã€BECPUEvictã€CPUBurst æ¨¡å—è®¡ç®—é€»è¾‘ã€‚</li><li>ç¯å¢ƒé€‚é…ï¼šæ‰€æœ‰ç»„ä»¶å‡çº§åˆ° K8S 1.28ï¼›koordlet æ”¯æŒé CUDA é•œåƒçš„éƒ¨ç½²ï¼›koordlet é€‚é… kubelet 1.28 é…ç½®ï¼Œä¼˜åŒ– cpu manager å…¼å®¹é€»è¾‘ï¼›é€‚é… cri-o è¿è¡Œæ—¶ã€‚</li><li>é‡æ„ä¼˜åŒ–ï¼škoordlet ä¼˜åŒ– Resctrl æ›´æ–°é€»è¾‘ï¼›ä¼˜åŒ–å•æœºé©±é€æ¥å£é€»è¾‘ï¼›ä¼˜åŒ–èŠ‚ç‚¹ GPU èµ„æºå’Œå¡å‹å·åŒæ­¥é€»è¾‘ï¼›ä¼˜åŒ– Batch è´¦æœ¬è®¡ç®—é€»è¾‘ã€‚</li><li>CI/CDï¼šä¿®å¤å¤šä¸ª flaky testsã€‚</li></ol><p>é€šè¿‡ <a href="https://github.com/koordinator-sh/koordinator/releases/tag/v1.5.0" target="_blank" rel="noopener noreferrer">v1.5.0 Release</a> é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°æ›´å¤šåŒ…å«åœ¨ v1.5.0 ç‰ˆæœ¬çš„æ–°å¢åŠŸèƒ½ã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="æ¬¢è¿ç¤¾åŒºæ–°æˆå‘˜">æ¬¢è¿ç¤¾åŒºæ–°æˆå‘˜<a href="#æ¬¢è¿ç¤¾åŒºæ–°æˆå‘˜" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>Koordinator æ˜¯ä¸€ä¸ªå¼€æ”¾çš„ç¤¾åŒºï¼Œåœ¨ v1.5.0 ç‰ˆæœ¬ä¸­ï¼Œå…±æœ‰ 10 ä½æ–°çš„å¼€å‘è€…å‚ä¸åˆ°äº† Koordinator çš„å»ºè®¾ï¼Œä»–ä»¬æ˜¯ @georgexiangã€@googs1025ã€@l1b0kã€@ls-2018ã€@PeterChgã€@sjtuflã€@testwillã€@yangfeiyu20102011ã€@zhifanggaoã€@zwForrestã€‚</p><p>Koordinator ç¤¾åŒºç›®å‰æœ‰è®¸å¤šæ¥è‡ªä¸åŒè¡Œä¸šçš„ä¼ä¸šçº§è´¡çŒ®è€…ï¼Œå…¶ä¸­ä¸å°‘åŒå­¦æˆä¸ºäº†é¡¹ç›®çš„ Maintainer å’Œ Memberï¼Œè¿‘æœŸæ–°åŠ å…¥çš„ Maintainer æˆå‘˜æœ‰ @songzh215ã€@j4ckstrawã€@lucmingã€@kangclzjcã€‚
åœ¨æ­¤æ„Ÿè°¢å„ä½æ–°åŒå­¦çš„ç§¯æå‚ä¸å’Œè€åŒå­¦çš„æŒç»­æŠ•å…¥ï¼Œä¹Ÿæ¬¢è¿æ›´å¤šä¼˜ç§€çš„åŒå­¦å‚ä¸åˆ° <a href="https://github.com/koordinator-sh/koordinator" target="_blank" rel="noopener noreferrer">Koordinator</a> ç¤¾åŒºï½</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="æœªæ¥è®¡åˆ’">æœªæ¥è®¡åˆ’<a href="#æœªæ¥è®¡åˆ’" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>åœ¨æ¥ä¸‹æ¥çš„ç‰ˆæœ¬ä¸­ï¼ŒKoordinator ç›®å‰è§„åˆ’äº†ä»¥ä¸‹å·¥ä½œï¼š</p><ul><li>è°ƒåº¦æ€§èƒ½ä¼˜åŒ–ï¼šè°ƒåº¦æ€§èƒ½æ˜¯è°ƒåº¦å™¨èƒ½å¦åº”å¯¹å¤§è§„æ¨¡é›†ç¾¤çš„å…³é”®æŒ‡æ ‡ã€‚æ¥ä¸‹æ¥çš„ç‰ˆæœ¬ä¸­ï¼ŒKoordinator å°†ç»™å‡ºåŸºæœ¬çš„å‹æµ‹ç¯å¢ƒæ­å»ºæ‰‹å†Œä»¥åŠå¸¸è§å‹æµ‹åœºæ™¯ï¼Œå¹¶ç€æ‰‹æå‡ Koord-Scheduler çš„è°ƒåº¦æ€§èƒ½ã€‚</li><li>è®¾å¤‡è”åˆåˆ†é…ã€‚åœ¨ AI å¤§æ¨¡å‹åˆ†å¸ƒå¼è®­ç»ƒåœºæ™¯ä¸­ï¼Œä¸åŒæœºå™¨ GPU ä¹‹é—´é€šå¸¸éœ€è¦é€šè¿‡é«˜æ€§èƒ½ç½‘å¡ç›¸äº’é€šä¿¡ï¼Œä¸” GPU å’Œé«˜æ€§èƒ½ç½‘å¡å°±è¿‘åˆ†é…çš„æ—¶å€™æ€§èƒ½æ›´å¥½ã€‚Koordinator æ­£åœ¨æ¨è¿›æ”¯æŒå¤šç§å¼‚æ„èµ„æºçš„è”åˆåˆ†é…ï¼Œç›®å‰å·²ç»åœ¨åè®®ä¸Šå’Œè°ƒåº¦å™¨åˆ†é…é€»è¾‘ä¸Šæ”¯æŒè”åˆåˆ†é…ï¼›å•æœºä¾§å…³äºç½‘å¡èµ„æºçš„ä¸ŠæŠ¥é€»è¾‘æ­£åœ¨æ¢ç´¢ä¸­ã€‚</li><li>Job ç²’åº¦çš„æŠ¢å å®ç°ï¼šåœ¨å¤§è§„æ¨¡å…±äº«é›†ç¾¤ä¸­ï¼Œæœ‰äº›é…é¢å¯èƒ½éå¸¸ç¹å¿™ï¼Œæœ‰äº›é…é¢å¯èƒ½å¤„äºç©ºé—²çŠ¶æ€ã€‚åœ¨ ElasticQuota æ’ä»¶ä¸­ï¼Œæˆ‘ä»¬å·²ç»æ”¯æŒä»ç©ºé—²çš„ ElasticQuota å€Ÿç”¨èµ„æºã€‚ä½†æ˜¯ï¼Œå½“è¢«å€Ÿç”¨çš„ ElasticQuota å…³è”çš„ Pod éœ€è¦å–å›èµ„æºæ—¶ï¼Œå¹¶æ²¡æœ‰è€ƒè™‘åˆ° Job ç²’åº¦ã€‚å¯¹äºå±äºåŒä¸€ä¸ª Job çš„ Podï¼Œæˆ‘ä»¬éœ€è¦ä»¥ Job ç²’åº¦è¿›è¡ŒæŠ¢å ï¼Œä»¥ç¡®ä¿è·å¾—è¶³å¤Ÿçš„èµ„æºæ¥æ»¡è¶³ Job çš„éœ€æ±‚ï¼Œæé«˜èµ„æºäº¤ä»˜æ•ˆç‡ã€‚ä¹‹å‰ç¤¾åŒºå·²ç»é€šè¿‡äº† <a href="https://github.com/koordinator-sh/koordinator/blob/main/docs/proposals/scheduling/20240115-support-job-level-preemption.md" target="_blank" rel="noopener noreferrer">Proposal</a>ï¼Œæ¥ä¸‹æ¥ Koordinator å°†æ¨è¿›è¯¥ææ¡ˆçš„å®ç°ã€‚</li><li>è´Ÿè½½æ„ŸçŸ¥è°ƒåº¦é’ˆå¯¹ inflight pods çš„ä¼˜åŒ–ï¼šè´Ÿè½½æ„ŸçŸ¥è°ƒåº¦å½“å‰åŸºäºèŠ‚ç‚¹çœŸå®åˆ©ç”¨ç‡è¿›è¡Œå¤šä¸ªç»´åº¦çš„è°ƒåº¦è¿‡æ»¤å’Œæ‰“åˆ†ï¼Œå¯ä»¥ç”¨äºä¼˜åŒ–èŠ‚ç‚¹åˆ©ç”¨ç‡çš„åˆ†å¸ƒï¼Œé™ä½ Pod è°ƒåº¦åˆ°é«˜è´Ÿè½½èŠ‚ç‚¹çš„é£é™©ï¼›ä¸è¿‡ï¼Œç”±äºèŠ‚ç‚¹åˆ©ç”¨ç‡è§†å›¾å­˜åœ¨åŒæ­¥å»¶è¿Ÿï¼Œå„ä¸ªé˜¶æ®µçš„ inflight pods å¯èƒ½å½±å“åˆ©ç”¨ç‡ä¿¡æ¯çš„å‡†ç¡®æ€§ï¼Œæ¥ä¸‹æ¥ï¼Œè´Ÿè½½æ„ŸçŸ¥è°ƒåº¦å°†å®Œå–„è¿™éƒ¨åˆ†ä¼˜åŒ–ï¼Œæ›´å……åˆ†åœ°è§„é¿è°ƒåº¦åˆ°è¿‡è½½èŠ‚ç‚¹ï¼Œä¼˜åŒ–èŠ‚ç‚¹é—´çš„è´Ÿè½½å‡è¡¡åº¦ã€‚</li><li>ç»†ç²’åº¦çš„æœ«çº§ç¼“å­˜åŠå†…å­˜å¸¦å®½éš”ç¦»ç­–ç•¥ï¼šå®¹å™¨é—´äº‰æŠ¢å…±äº«çš„æœ«çº§ç¼“å­˜å’Œå†…å­˜å¸¦å®½èµ„æºï¼Œå¯èƒ½å¯¼è‡´åº”ç”¨è®¿å­˜æ€§èƒ½çš„æŠ–åŠ¨ï¼›å½“å‰ Koordinator æä¾›äº† ResctrlQoS èƒ½åŠ›ï¼Œåœ¨æ»¡è¶³éš”ç¦»åˆ†ç»„çš„æ•°é‡é™åˆ¶çš„å‰æä¸‹ï¼Œç”¨æ¥å¯¹ QoS ç»´åº¦éš”ç¦»æœ«çº§ç¼“å­˜å’Œå†…å­˜å¸¦å®½èµ„æºï¼Œé™ä½ç¦»çº¿è´Ÿè½½å¯¹åœ¨çº¿åº”ç”¨çš„å¹²æ‰°ã€‚ä¸‹ä¸€æ­¥ï¼ŒKoordinator å°†åŸºäº v1.3 ç‰ˆæœ¬æ”¯æŒçš„ <a href="https://github.com/koordinator-sh/koordinator/blob/main/docs/proposals/20230608-nri-mode-resource-management.md" target="_blank" rel="noopener noreferrer">NRI (Node Resource Interface) æ¡†æ¶</a>ï¼Œå¢å¼ºæœ«çº§ç¼“å­˜åŠå†…å­˜å¸¦å®½çš„éš”ç¦»ç­–ç•¥ï¼Œæä¾› Pod ç»´åº¦çš„éš”ç¦»èƒ½åŠ›ï¼Œå¢å¼ºåŠŸèƒ½çš„çµæ´»æ€§å’Œæ—¶æ•ˆæ€§ã€‚</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="è‡´è°¢">è‡´è°¢<a href="#è‡´è°¢" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>è‡ªå¼€æºä»¥æ¥ï¼ŒKoordinator å·²ç»å…±è®¡å‘å¸ƒäº†19ä¸ªå°ç‰ˆæœ¬ï¼Œå¸å¼•äº†80å¤šåè´¡çŒ®è€…çš„å‚ä¸ï¼Œç¤¾åŒºçš„ä¸æ–­å‘å±•å£®å¤§ï¼Œç¦»ä¸å¼€å¹¿å¤§å·¥ç¨‹å¸ˆçš„ç§¯æå‚ä¸ï¼Œåœ¨æ­¤çœŸè¯šæ„Ÿè°¢å„ä½ç¤¾åŒºåŒå­¦ä»¬çš„è´¡çŒ®å’ŒæŒç»­æŠ•å…¥ã€‚åŒæ—¶ï¼Œä¹Ÿç‰¹åˆ«æ„Ÿè°¢ CNCF ç¤¾åŒºåŒä»å¯¹é¡¹ç›®å‘å±•çš„æä¾›çš„å¤§åŠ›æ”¯æŒã€‚</p><p>æ¬¢è¿æ›´å¤šå¼€å‘è€…å’Œç”¨æˆ·å‚ä¸ Koordinator ç¤¾åŒºå»ºè®¾ï¼Œæ˜¯æ‚¨ä»¬çš„ç§¯æå‚ä¸å’Œå®è´µæ„è§è®© Koordinator ä¸æ–­è¿›æ­¥ã€‚æˆ‘ä»¬æœŸå¾…æ‚¨ç»§ç»­æä¾›åé¦ˆï¼Œå¹¶æ¬¢è¿æ–°çš„è´¡çŒ®è€…<a href="https://github.com/koordinator-sh/koordinator?tab=readme-ov-file#community" target="_blank" rel="noopener noreferrer">åŠ å…¥æˆ‘ä»¬</a>ã€‚
æ— è®ºæ‚¨åœ¨äº‘åŸç”Ÿé¢†åŸŸæ˜¯åˆå­¦ä¹ç»ƒè¿˜æ˜¯é©¾è½»å°±ç†Ÿï¼Œæˆ‘ä»¬éƒ½éå¸¸æœŸå¾…å¬åˆ°æ‚¨çš„å£°éŸ³ï¼</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>æ ‡ç­¾ï¼š</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/zh-Hans/blog/tags/release">release</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/zh-Hans/blog/release-v1.4.0">Koordinator v1.4: æ›´å¤šçš„è®¡ç®—è´Ÿè½½ç±»å‹å’Œæ›´çµæ´»çš„èµ„æºç®¡ç†æœºåˆ¶</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2024-01-15T00:00:00.000Z" itemprop="datePublished">2024å¹´1æœˆ15æ—¥</time> Â· <!-- -->28 åˆ†é’Ÿé˜…è¯»</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/ZiMengSheng" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/ZiMengSheng.png" alt="Jianyu Wang"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/ZiMengSheng" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Jianyu Wang</span></a></div><small class="avatar__subtitle" itemprop="description">Koordinator approver</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="èƒŒæ™¯">èƒŒæ™¯<a href="#èƒŒæ™¯" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>Koordinator ä½œä¸ºä¸€ä¸ªç§¯æå‘å±•çš„å¼€æºé¡¹ç›®ï¼Œè‡ª 2022 å¹´ 4 æœˆå‘å¸ƒ v0.1.0 ç‰ˆæœ¬ä»¥æ¥ï¼Œç»å†äº†å¤šæ¬¡è¿­ä»£ï¼ŒæŒç»­ä¸º Kubernetes ç”Ÿæ€ç³»ç»Ÿå¸¦æ¥åˆ›æ–°å’Œå¢å¼ºã€‚é¡¹ç›®çš„æ ¸å¿ƒæ˜¯æä¾›æ··éƒ¨å·¥ä½œè´Ÿè½½ç¼–æ’ã€æ··éƒ¨èµ„æºè°ƒåº¦ã€æ··éƒ¨èµ„æºéš”ç¦»å’Œæ··éƒ¨æ€§èƒ½è°ƒä¼˜çš„ç»¼åˆè§£å†³æ–¹æ¡ˆï¼Œå¸®åŠ©ç”¨æˆ·ä¼˜åŒ–å®¹å™¨æ€§èƒ½ï¼Œå¹¶æå‡é›†ç¾¤èµ„æºä½¿ç”¨æ•ˆç‡ã€‚</p><p>åœ¨è¿‡å»çš„ç‰ˆæœ¬è¿­ä»£ä¸­ï¼ŒKoordinator ç¤¾åŒºä¸æ–­å£®å¤§ï¼Œå·²ç»å¾—åˆ°äº†åŒ…æ‹¬é˜¿é‡Œå·´å·´ã€èš‚èšç§‘æŠ€ã€Intelã€å°ç±³ã€å°çº¢ä¹¦ã€çˆ±å¥‡è‰ºã€360ã€æœ‰èµã€è¶£ç©ã€ç¾äºšæŸç§‘ã€PITS ç­‰çŸ¥åä¼ä¸šå·¥ç¨‹å¸ˆçš„ç§¯æå‚ä¸å’Œè´¡çŒ®ã€‚æ¯ä¸€ä¸ªç‰ˆæœ¬éƒ½æ˜¯åœ¨ç¤¾åŒºå…±åŒåŠªåŠ›ä¸‹æ¨è¿›çš„ï¼Œåæ˜ äº†é¡¹ç›®åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­è§£å†³é—®é¢˜çš„èƒ½åŠ›ã€‚</p><p>ä»Šå¤©æˆ‘ä»¬å¾ˆé«˜å…´çš„å‘å¤§å®¶å®£å¸ƒï¼ŒKoordinator v1.4.0 ç‰ˆæœ¬æ­£å¼å‘å¸ƒã€‚åœ¨æœ¬æ¬¡å‘å¸ƒä¸­ï¼ŒKoordinator å¼•å…¥äº† Kubernetes ä¸ YARN è´Ÿè½½æ··éƒ¨ã€NUMA æ‹“æ‰‘å¯¹é½ç­–ç•¥ã€CPU å½’ä¸€åŒ–å’Œå†·å†…å­˜ä¸ŠæŠ¥ç­‰æ–°ç‰¹æ€§ï¼ŒåŒæ—¶é‡ç‚¹å¢å¼ºäº†å¼¹æ€§é…é¢ç®¡ç†ã€å®¿ä¸»æœºéå®¹å™¨åŒ–åº”ç”¨çš„ QoS ç®¡ç†ã€é‡è°ƒåº¦é˜²æŠ¤ç­–ç•¥ç­‰é¢†åŸŸçš„åŠŸèƒ½ã€‚è¿™äº›æ–°å¢å’Œæ”¹è¿›ç‚¹æ—¨åœ¨æ›´å¥½åœ°æ”¯æŒä¼ä¸šçº§ Kubernetes é›†ç¾¤ç¯å¢ƒï¼Œç‰¹åˆ«æ˜¯å¯¹äºå¤æ‚å’Œå¤šæ ·åŒ–çš„åº”ç”¨åœºæ™¯ã€‚</p><p>v1.4.0  ç‰ˆæœ¬çš„å‘å¸ƒï¼Œå°†ä¸ºç”¨æˆ·å¸¦æ¥æ›´å¤šçš„è®¡ç®—è´Ÿè½½ç±»å‹æ”¯æŒå’Œæ›´çµæ´»çš„èµ„æºç®¡ç†æœºåˆ¶ï¼Œæˆ‘ä»¬æœŸå¾…è¿™äº›æ”¹è¿›èƒ½å¤Ÿå¸®åŠ©ç”¨æˆ·åº”å¯¹æ›´å¤šä¼ä¸šèµ„æºç®¡ç†æŒ‘æˆ˜ã€‚åœ¨ v1.4.0 ç‰ˆæœ¬ä¸­ï¼Œå…±æœ‰ 11 ä½æ–°åŠ å…¥çš„å¼€å‘è€…å‚ä¸åˆ°äº† Koordinator ç¤¾åŒºçš„å»ºè®¾ï¼Œä»–ä»¬æ˜¯ @shaloulcyï¼Œ@baowj-678ï¼Œ@zqztenï¼Œ@tan90githubï¼Œ@pheianoxï¼Œ@zxh326ï¼Œ@qinfustuï¼Œ@ikaven1024ï¼Œ@peiqiaoWangï¼Œ@bogo-yï¼Œ@xujihui1985ï¼Œæ„Ÿè°¢æœŸé—´å„ä½ç¤¾åŒºåŒå­¦çš„ç§¯æå‚ä¸å’Œè´¡çŒ®ï¼Œä¹Ÿæ„Ÿè°¢æ‰€æœ‰åŒå­¦åœ¨ç¤¾åŒºçš„æŒç»­æŠ•å…¥ã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ç‰ˆæœ¬åŠŸèƒ½ç‰¹æ€§è§£è¯»">ç‰ˆæœ¬åŠŸèƒ½ç‰¹æ€§è§£è¯»<a href="#ç‰ˆæœ¬åŠŸèƒ½ç‰¹æ€§è§£è¯»" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-æ”¯æŒ-k8s-ä¸-yarn-æ··éƒ¨">1. æ”¯æŒ K8s ä¸ YARN æ··éƒ¨<a href="#1-æ”¯æŒ-k8s-ä¸-yarn-æ··éƒ¨" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>Koordinator å·²ç»æ”¯æŒäº† K8s ç”Ÿæ€å†…çš„åœ¨ç¦»çº¿æ··éƒ¨ï¼Œç„¶è€Œåœ¨ K8s ç”Ÿæ€å¤–ï¼Œä»æœ‰ç›¸å½“æ•°é‡çš„å¤§æ•°æ®ä»»åŠ¡è¿è¡Œåœ¨ä¼ ç»Ÿçš„ Hadoop YARN ä¹‹ä¸Šã€‚YARN ä½œä¸ºå‘å±•å¤šå¹´çš„å¤§æ•°æ®ç”Ÿæ€ä¸‹çš„èµ„æºç®¡ç†ç³»ç»Ÿï¼Œæ‰¿è½½äº†åŒ…æ‹¬ MapReduceã€Sparkã€Flink ä»¥åŠ Presto ç­‰åœ¨å†…çš„å¤šç§è®¡ç®—å¼•æ“ã€‚</p><p>Koordinator ç¤¾åŒºä¼šåŒæ¥è‡ªé˜¿é‡Œäº‘ã€å°çº¢ä¹¦ã€èš‚èšé‡‘æœçš„å¼€å‘è€…ä»¬å…±åŒå¯åŠ¨äº† Hadoop YARN ä¸ K8s æ··éƒ¨é¡¹ç›® Koordinator YARN Copilotï¼Œæ”¯æŒå°† Hadoop NodeManager è¿è¡Œåœ¨ kubernetes é›†ç¾¤ä¸­ï¼Œå……åˆ†å‘æŒ¥ä¸åŒç±»å‹è´Ÿè½½é”™å³°å¤ç”¨çš„æŠ€æœ¯ä»·å€¼ã€‚Koordinator YARN Copilot å…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li>é¢å‘å¼€æºç”Ÿæ€ï¼šåŸºäº Hadoop YARN å¼€æºç‰ˆæœ¬ï¼Œä¸æ¶‰åŠå¯¹ YARN çš„ä¾µå…¥å¼æ”¹é€ ï¼›</li><li>ç»Ÿä¸€èµ„æºä¼˜å…ˆçº§å’Œ QoS ç­–ç•¥ï¼šYARN NM ä½¿ç”¨ Koordinator çš„ Batch ä¼˜å…ˆçº§èµ„æºï¼Œéµå¾ª Koordinator QoS ç®¡ç†ç­–ç•¥ï¼›</li><li>èŠ‚ç‚¹çº§åˆ«çš„èµ„æºå…±äº«ï¼šKoordinator æä¾›çš„æ··éƒ¨èµ„æºï¼Œæ—¢å¯è¢« K8s Pod ä½¿ç”¨ï¼Œä¹Ÿå¯è¢« YARN taskä½¿ç”¨ï¼Œä¸åŒç±»å‹çš„ç¦»çº¿åº”ç”¨å¯è¿è¡Œåœ¨åŒä¸€èŠ‚ç‚¹ã€‚</li></ul><p><img loading="lazy" alt="img" src="/zh-Hans/assets/images/hadoop-k8s-a092bf3c9bc72245fec2b31b173a8792.svg" width="396" height="451" class="img_ev3q"></p><p>å…³äº Koordinator YARN Copilot çš„è¯¦ç»†è®¾è®¡ï¼Œä»¥åŠåœ¨å°çº¢ä¹¦ç”Ÿäº§ç¯å¢ƒçš„ä½¿ç”¨æƒ…å†µï¼Œè¯·å‚è€ƒ<a href="https://mp.weixin.qq.com/s/N0QEJYyOhoDZoVQ6hGhnmg" target="_blank" rel="noopener noreferrer">å¾€æœŸæ–‡ç« </a>ä»¥åŠ<a href="https://koordinator.sh/zh-Hans/docs/next/designs/koordinator-yarn" target="_blank" rel="noopener noreferrer">ç¤¾åŒºå®˜æ–¹æ–‡æ¡£</a>ã€‚</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-å¼•å…¥-numa-æ‹“æ‰‘å¯¹é½ç­–ç•¥">2. å¼•å…¥ NUMA æ‹“æ‰‘å¯¹é½ç­–ç•¥<a href="#2-å¼•å…¥-numa-æ‹“æ‰‘å¯¹é½ç­–ç•¥" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>è¿è¡Œåœ¨ Kubernetes é›†ç¾¤ä¸­çš„å·¥ä½œè´Ÿè½½æ—¥ç›Šå¤šæ ·åŒ–ã€‚å°¤å…¶æ˜¯åœ¨æœºå™¨å­¦ä¹ ç­‰é¢†åŸŸï¼Œå¯¹äºé«˜æ€§èƒ½è®¡ç®—èµ„æºçš„éœ€æ±‚æŒç»­ä¸Šå‡ã€‚åœ¨è¿™äº›é¢†åŸŸä¸­ï¼Œä¸ä»…éœ€è¦å¤§é‡ CPU èµ„æºï¼Œè¿˜ç»å¸¸éœ€è¦ GPU å’Œ RDMA ç­‰å…¶ä»–é«˜é€Ÿè®¡ç®—èµ„æºé…åˆä½¿ç”¨ï¼›å¹¶ä¸”ï¼Œä¸ºäº†è·å¾—æœ€ä½³çš„æ€§èƒ½ï¼Œè¿™äº›èµ„æºå¾€å¾€éœ€è¦åœ¨åŒä¸€ä¸ª NUMA èŠ‚ç‚¹ï¼Œç”šè‡³åŒä¸€ä¸ª PCIE ä¸­ã€‚</p><p>Kubernetes çš„ Kubelet æä¾›äº† Topology Manager æ¥ç®¡ç†èµ„æºåˆ†é…çš„ NUMA æ‹“æ‰‘ï¼Œè¯•å›¾åœ¨ Kubelet çš„ Admission é˜¶æ®µä»èŠ‚ç‚¹å±‚é¢å¯¹é½å¤šç§èµ„æºçš„æ‹“æ‰‘ã€‚ç„¶è€Œï¼ŒèŠ‚ç‚¹ç»„ä»¶æ²¡æœ‰è°ƒåº¦å™¨çš„å…¨å±€è§†è§’ä»¥åŠä¸º Pod é€‰æ‹©èŠ‚ç‚¹çš„æ—¶æœºï¼Œå¯èƒ½å¯¼è‡´ Pod è¢«è°ƒåº¦åˆ°æ— æ³•æ»¡è¶³æ‹“æ‰‘å¯¹é½ç­–ç•¥çš„èŠ‚ç‚¹ä¸Šï¼Œä»è€Œå¯¼è‡´ Pod ç”±äº <code>Topology Affinity</code>é”™è¯¯æ— æ³•å¯åŠ¨ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼ŒKoordinator å°† NUMA æ‹“æ‰‘é€‰æ‹©å’Œå¯¹é½çš„æ—¶æœºæ”¾åœ¨ä¸­å¿ƒè°ƒåº¦å™¨ä¸­ï¼Œä»é›†ç¾¤çº§åˆ«ä¼˜åŒ–èµ„æºä¹‹é—´çš„ NUMA æ‹“æ‰‘ã€‚åœ¨æœ¬æ¬¡å‘å¸ƒçš„ç‰ˆæœ¬ä¸­ï¼ŒKoordinator å°† CPU èµ„æºï¼ˆåŒ…å« Batch èµ„æºï¼‰çš„ NUMA æ„ŸçŸ¥è°ƒåº¦å’Œ GPU è®¾å¤‡çš„ NUMA æ„ŸçŸ¥è°ƒåº¦ä½œä¸º alpha åŠŸèƒ½æ”¯æŒï¼Œæ•´å¥— NUMA æ„ŸçŸ¥è°ƒåº¦å¿«é€Ÿæ¼”è¿›ä¸­ã€‚</p><p>koordinator æ”¯æŒç”¨æˆ·é€šè¿‡èŠ‚ç‚¹çš„ Label é…ç½®èŠ‚ç‚¹ä¸Šå¤šç§èµ„æºçš„ NUMA æ‹“æ‰‘å¯¹é½ç­–ç•¥ï¼Œå¯é…ç½®ç­–ç•¥å¦‚ä¸‹ï¼š</p><ul><li><code>None</code> æ˜¯é»˜è®¤ç­–ç•¥ï¼Œä¸æ‰§è¡Œä»»ä½•æ‹“æ‰‘å¯¹é½ã€‚</li><li><code>BestEffort</code> è¡¨ç¤ºèŠ‚ç‚¹ä¸ä¸¥æ ¼æŒ‰ç…§ NUMA æ‹“æ‰‘å¯¹é½æ¥åˆ†é…èµ„æºã€‚åªè¦èŠ‚ç‚¹çš„å‰©ä½™æ€»é‡æ»¡è¶³ Pods çš„éœ€æ±‚ï¼Œè°ƒåº¦å™¨æ€»æ˜¯å¯ä»¥å°†è¿™æ ·çš„èŠ‚ç‚¹åˆ†é…ç»™ Podsã€‚ </li><li><code>Restricted</code> è¡¨ç¤ºèŠ‚ç‚¹ä¸¥æ ¼æŒ‰ç…§ NUMA æ‹“æ‰‘å¯¹é½æ¥åˆ†é…èµ„æºï¼Œå³è°ƒåº¦å™¨åœ¨åˆ†é…å¤šä¸ªèµ„æºæ—¶å¿…é¡»åªé€‰æ‹©ç›¸åŒçš„ä¸€ä¸ªæˆ–å¤šä¸ª NUMA èŠ‚ç‚¹ï¼Œå¦åˆ™ä¸åº”ä½¿ç”¨è¯¥èŠ‚ç‚¹ï¼›å¯ä»¥ä½¿ç”¨å¤šä¸ª NUMA èŠ‚ç‚¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªPodè¯·æ±‚ 33Cï¼Œå¹¶ä¸”æ¯ä¸ª NUMA èŠ‚ç‚¹æœ‰ 32Cï¼Œé‚£ä¹ˆå®ƒå¯ä»¥è¢«åˆ†é…ä½¿ç”¨ä¸¤ä¸ª NUMA èŠ‚ç‚¹ã€‚å¦‚æœè¿™ä¸ªPodè¿˜éœ€è¦è¯·æ±‚ GPU/RDMAï¼Œé‚£ä¹ˆå®ƒéœ€è¦ä½äºä¸ CPU ç›¸åŒçš„ NUMA èŠ‚ç‚¹ä¸Šã€‚</li><li><code>SingleNUMANode</code> ä¸ <code>Restricted</code> ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ä¸¥æ ¼æŒ‰ç…§ NUMA æ‹“æ‰‘å¯¹é½ï¼Œä½†ä¸ <code>Restricted</code> ä¸åŒçš„æ˜¯ï¼Œ<code>Restricted</code> å…è®¸ä½¿ç”¨å¤šä¸ªNUMAèŠ‚ç‚¹ï¼Œè€Œ <code>SingleNUMANode</code> åªå…è®¸ä½¿ç”¨ä¸€ä¸ªNUMA èŠ‚ç‚¹ã€‚</li></ul><p>ä¸¾ä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥ä¸º <code>node-0</code>è®¾ç½®ç­–ç•¥ <code>SingleNUMANode</code>ï¼š</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">node.koordinator.sh/numa-topology-policy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SingleNUMANode&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œç”¨æˆ·å¯èƒ½å·²ç»å¼€å¯äº† Kubelet çš„æ‹“æ‰‘å¯¹é½ç­–ç•¥ï¼Œè¿™ä¸ªç­–ç•¥ä¼šç”± koordlet æ›´æ–°åˆ° <code>NodeResourceTopology</code>CRD å¯¹è±¡ä¸­çš„ <code>TopologyPolicies</code>å­—æ®µã€‚å½“ Kubelet çš„ç­–ç•¥å’Œç”¨æˆ·åœ¨ Node ä¸Šè®¾ç½®çš„ç­–ç•¥ç›¸å†²çªæ—¶ï¼Œä»¥ Kubelet ç­–ç•¥ä¸ºå‡†ã€‚Koordinator è°ƒåº¦å™¨åŸºæœ¬é‡‡ç”¨ä¸ Kubelet Topology Manager ç›¸åŒçš„ NUMA å¯¹é½ç­–ç•¥è¯­ä¹‰ï¼ŒKubelet ç­–ç•¥ <code>SingleNUMANodePodLevel </code>å’Œ<code>SingleNUMANodeContainerLevel</code>è¢«æ˜ å°„ä¸º <code>SingleNUMANode</code>ã€‚</p><p>åœ¨ä¸ºèŠ‚ç‚¹é…ç½®å¥½ NUMA å¯¹é½ç­–ç•¥çš„å‰æä¸‹ï¼Œè°ƒåº¦å™¨å¯ä»¥ä¸ºæ¯ä¸ª Pod é€‰å‡ºè®¸å¤šä¸ªç¬¦åˆæ¡ä»¶çš„ NUMA Node åˆ†é…ç»“æœã€‚Koordinator å½“å‰æ”¯æŒ NodeNUMAResource æ’ä»¶é…ç½® CPU å’Œå†…å­˜èµ„æºçš„ NUMA Node åˆ†é…ç»“æœæ‰“åˆ†ç­–ç•¥ï¼ŒåŒ…æ‹¬ <code>LeastAllocated</code>å’Œ <code>MostAllocated</code>, é»˜è®¤ä¸º <code>LeastAllocated</code> ç­–ç•¥ï¼Œèµ„æºæ”¯æŒé…ç½®æƒé‡ã€‚è°ƒåº¦å™¨æœ€ç»ˆå°†é€‰æ‹©å¾—åˆ†æœ€é«˜çš„ NUMA Node åˆ†é…ç»“æœã€‚å¦‚ä¸‹ä¾‹ï¼Œæˆ‘ä»¬é…ç½® NUMA Node åˆ†é…ç»“æœæ‰“åˆ†ç­–ç•¥ä¸º <code>MostAllocated</code>ï¼š</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubescheduler.config.k8s.io/v1beta2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> KubeSchedulerConfiguration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">profiles</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">pluginConfig</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NodeNUMAResource</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">args</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubescheduler.config.k8s.io/v1beta2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NodeNUMAResourceArgs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">scoringStrategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Here configure Node level scoring strategy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> MostAllocated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cpu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">weight</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> memory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">weight</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;kubernetes.io/batch-cpu&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">weight</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;kubernetes.io/batch-memory&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">weight</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">numaScoringStrategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Here configure NUMA-Node level scoring strategy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> MostAllocated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cpu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">weight</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> memory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">weight</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;kubernetes.io/batch-cpu&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">weight</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;kubernetes.io/batch-memory&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">weight</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-elasticquota-å†è¿›åŒ–">3. ElasticQuota å†è¿›åŒ–<a href="#3-elasticquota-å†è¿›åŒ–" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>ä¸ºäº†å……åˆ†åœ°åˆ©ç”¨é›†ç¾¤èµ„æºã€é™ä½ç®¡æ§ç³»ç»Ÿæˆæœ¬ï¼Œç”¨æˆ·å¸¸å¸¸å°†å¤šä¸ªç§Ÿæˆ·çš„è´Ÿè½½éƒ¨ç½²åœ¨ä¸€ä¸ªé›†ç¾¤ä¸­ã€‚åœ¨é›†ç¾¤èµ„æºæœ‰é™çš„æƒ…å†µä¸‹ï¼Œä¸åŒç§Ÿæˆ·ä¹‹é—´å¿…ç„¶ä¼šå‘ç”Ÿèµ„æºäº‰æŠ¢ã€‚æœ‰çš„ç§Ÿæˆ·çš„è´Ÿè½½å¯èƒ½ä¸€ç›´è¢«æ»¡è¶³ï¼Œè€Œæœ‰çš„ç§Ÿæˆ·çš„è´Ÿè½½ä¸€ç›´æ— æ³•å¾—åˆ°æ‰§è¡Œã€‚è¿™å°±äº§ç”Ÿå¯¹å…¬å¹³æ€§çš„è¯‰æ±‚ã€‚é…é¢æœºåˆ¶æ˜¯éå¸¸è‡ªç„¶åœ°ä¿éšœç§Ÿæˆ·é—´å…¬å¹³æ€§çš„æ–¹å¼ï¼Œç»™æ¯ä¸ªç§Ÿæˆ·ä¸€ä¸ªé…é¢ï¼Œç§Ÿæˆ·å¯ä»¥ä½¿ç”¨é…é¢å†…çš„èµ„æºï¼Œè¶…è¿‡é…é¢çš„ä»»åŠ¡å°†ä¸è¢«è°ƒåº¦å’Œæ‰§è¡Œã€‚ç„¶è€Œï¼Œç®€å•çš„é…é¢ç®¡ç†æ— æ³•æ»¡è¶³ç§Ÿæˆ·å¯¹äº‘çš„å¼¹æ€§æœŸå¾…ã€‚ç”¨æˆ·å¸Œæœ›é™¤äº†é…é¢ä¹‹å†…çš„èµ„æºè¯·æ±‚å¯ä»¥è¢«æ»¡è¶³å¤–ï¼Œé…é¢ä¹‹å¤–çš„èµ„æºè¯·æ±‚ä¹Ÿå¯ä»¥æŒ‰éœ€åœ°è¢«æ»¡è¶³ã€‚</p><p>åœ¨ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼ŒKoordinator å¤ç”¨äº†ä¸Šæ¸¸ ElasticQuota çš„åè®®ï¼Œå…è®¸ç§Ÿæˆ·è®¾ç½® Min è¡¨è¾¾å…¶ä¸€å®šè¦æ»¡è¶³çš„èµ„æºè¯‰æ±‚ï¼Œå…è®¸è®¾ç½® Max é™åˆ¶å…¶æœ€å¤§å¯ä»¥ä½¿ç”¨çš„èµ„æºå’Œè¡¨è¾¾åœ¨é›†ç¾¤èµ„æºä¸è¶³çš„æƒ…å†µä¸‹å¯¹é›†ç¾¤å‰©ä½™èµ„æºçš„ä½¿ç”¨æƒé‡ã€‚å¦å¤–ï¼Œkoordinator è§‚å¯Ÿåˆ°ï¼Œä¸€äº›ç§Ÿæˆ·å¯èƒ½é€šè¿‡ Min ç”³è¯·äº†é…é¢ï¼Œä½†æ˜¯å®é™…çš„ä»»åŠ¡ç”³è¯·å¯èƒ½å¹¶æ²¡æœ‰å……åˆ†åˆ©ç”¨è¯¥é…é¢ã€‚ç”±æ­¤ï¼Œä¸ºäº†æ›´è¿‘ä¸€æ­¥åœ°æé«˜èµ„æºåˆ©ç”¨ç‡ï¼ŒKoordinator å…è®¸ç§Ÿæˆ·é—´å€Ÿç”¨/å½’è¿˜èµ„æºã€‚</p><p>é™¤äº†æä¾›å¼¹æ€§çš„é…é¢æœºåˆ¶æ»¡è¶³ç§Ÿæˆ·æŒ‰éœ€è¯‰æ±‚å¤–ï¼ŒKoordinator åœ¨ ElasticQuota ä¸Šå¢åŠ æ³¨è§£å°†å…¶ç»„ç»‡æˆæ ‘çš„ç»“æ„ï¼Œæ–¹ä¾¿ç”¨æˆ·è¡¨è¾¾æ ‘å½¢çš„ç»„ç»‡æ¶æ„ã€‚</p><p><img loading="lazy" alt="img" src="/zh-Hans/assets/images/quotatree1-b68ec769c15547410ee4e5bd6eec1b27.jpg" width="1216" height="792" class="img_ev3q"></p><p>ä¸Šå›¾æ˜¯ä½¿ç”¨äº† Koordinator å¼¹æ€§é…é¢çš„é›†ç¾¤ä¸­å¸¸è§çš„ Quota ç»“æ„æ ‘ã€‚Root Quota æ˜¯è¿æ¥é…é¢ä¸é›†ç¾¤ä¸­å®é™…èµ„æºä¹‹é—´çš„æ¡¥æ¢ã€‚åœ¨ä¹‹å‰çš„è®¾è®¡ä¸­ï¼ŒRoot Quota åªåœ¨è°ƒåº¦å™¨é€»è¾‘ä¸­å­˜åœ¨ï¼Œåœ¨æœ¬æ¬¡å‘å¸ƒä¸­ï¼Œæˆ‘ä»¬å°† Root Quota ä¹Ÿé€šè¿‡ CRD çš„å½¢å¼æš´éœ²ç»™ç”¨æˆ·ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ koordinator-root-quota è¿™ä¸ª ElasticQuota CRD æŸ¥çœ‹ Root Quota ä¿¡æ¯ã€‚</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="31-å¼•å…¥-multi-quotatree">3.1 å¼•å…¥ Multi QuotaTree<a href="#31-å¼•å…¥-multi-quotatree" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>å¤§å‹é›†ç¾¤ä¸­çš„èŠ‚ç‚¹çš„å½¢æ€æ˜¯å¤šæ ·çš„ï¼Œä¾‹å¦‚äº‘å‚å•†æä¾›çš„ ECS VM ä¼šæœ‰ä¸åŒçš„æ¶æ„ï¼Œå¸¸è§çš„æ˜¯ amd64 å’Œ arm64ï¼Œç›¸åŒæ¶æ„åˆä¼šæœ‰ä¸åŒç§ç±»çš„æœºå‹ï¼Œè€Œä¸”ä¸€èˆ¬ä¼šæŠŠèŠ‚ç‚¹æŒ‰å¯ç”¨åŒºåˆ’åˆ†ã€‚ä¸åŒç±»å‹çš„èŠ‚ç‚¹æ”¾åˆ°åŒä¸€ä¸ª Quota Tree ä¸­ç®¡ç†æ—¶ï¼Œå…¶ç‰¹æœ‰çš„å±æ€§å°†ä¸¢å¤±ï¼Œå½“ç”¨æˆ·å¸Œæœ›ç²¾ç»†åŒ–ç®¡ç†æœºå™¨çš„ç‰¹æœ‰å±æ€§æ—¶ï¼Œå½“å‰çš„ ElasticQuota æ˜¾å¾—ä¸å¤Ÿç²¾ç¡®ã€‚ä¸ºäº†æ»¡è¶³ç”¨æˆ·çµæ´»çš„èµ„æºç®¡ç†æˆ–èµ„æºéš”ç¦»è¯‰æ±‚ï¼ŒKoordinator æ”¯æŒç”¨æˆ·å°†é›†ç¾¤ä¸­çš„èµ„æºåˆ’åˆ†ä¸ºå¤šä»½ï¼Œæ¯ä¸€ä»½ç”±ä¸€ä¸ª Quota Tree æ¥ç®¡ç†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img loading="lazy" alt="img" src="/zh-Hans/assets/images/multiquotatree-9680fdd40b65082d7f63092f830c8995.png" width="1502" height="634" class="img_ev3q"></p><p>åŒæ—¶ï¼Œä¸ºäº†å¸®åŠ©ç”¨æˆ·ç®€åŒ–ç®¡ç†å¤æ‚æ€§ï¼ŒKoordinator åœ¨ v1.4.0 ä¸­ å¼•å…¥äº† ElasticQuotaProfile æœºåˆ¶ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ nodeSelector å¿«é€Ÿçš„å°†èŠ‚ç‚¹å…³è”åˆ°ä¸åŒçš„ QuotaTree ä¸­ï¼Œå¦‚ä¸‹å®ä¾‹æ‰€ç¤ºï¼š</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> quota.koordinator.sh/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ElasticQuotaProfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">kubernetes.io/arch</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> amd64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> amd64</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kube</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">nodeSelector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">kubernetes.io/arch</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> amd64 // æŒ‘é€‰ amd64 èŠ‚ç‚¹</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">quotaName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> amd64</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">quota   // åŒ¹é…çš„ root quota åç§°</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> quota.koordinator.sh/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ElasticQuotaProfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">kubernetes.io/arch</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> arm64   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> arm64</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kube</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">nodeSelector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">kubernetes.io/arch</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> arm64  // æŒ‘é€‰ arm64 èŠ‚ç‚¹</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">quotaName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> arm64</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">quota    // åŒ¹é…çš„ root quota åç§°</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å…³è”å¥½ QuotaTree ä¹‹åï¼Œç”¨æˆ·åœ¨æ¯ä¸€ä¸ª  QuotaTree ä¸­ä¸ä¹‹å‰çš„ ElasticQuota ç”¨æ³•ä¸€è‡´ã€‚å½“ç”¨æˆ·æäº¤ Pod åˆ°å¯¹åº”çš„ Quota æ—¶ï¼Œå½“å‰ä»ç„¶éœ€è¦ç”¨æˆ·å®Œæˆ Pod NodeAffinity çš„ç®¡ç†ï¼Œä»¥ç¡®ä¿ Pod è¿è¡Œåœ¨æ­£ç¡®çš„èŠ‚ç‚¹ä¸Šã€‚æœªæ¥ï¼Œæˆ‘ä»¬ä¼šå¢åŠ ä¸€ä¸ªç‰¹æ€§å¸®åŠ©ç”¨æˆ·è‡ªåŠ¨ç®¡ç† Quota åˆ° Node çš„æ˜ å°„å…³ç³»ã€‚</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="32-æ”¯æŒ-non-preemptible">3.2 æ”¯æŒ non-preemptible<a href="#32-æ”¯æŒ-non-preemptible" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>Koordinator ElasticQuota æ”¯æŒæŠŠ ElasticQuota ä¸­ Min æœªä½¿ç”¨çš„éƒ¨åˆ†å…±äº«ç»™å…¶ä»– ElasticQuota ä½¿ç”¨ä»è€Œæé«˜èµ„æºåˆ©ç”¨æ•ˆç‡ï¼Œä½†å½“èµ„æºç´§å¼ æ—¶ï¼Œä¼šé€šè¿‡æŠ¢å æœºåˆ¶æŠŠå€Ÿç”¨é…é¢çš„ Pod æŠ¢å é©±é€èµ°æ‹¿å›èµ„æºã€‚</p><p>åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæœ‰ä¸€äº›åœ¨çº¿æœåŠ¡å¦‚æœä»å…¶ä»– ElasticQuota ä¸­å€Ÿç”¨äº†è¿™éƒ¨åˆ†é¢åº¦ï¼Œåç»­åˆå‘ç”Ÿäº†æŠ¢å ï¼Œæ˜¯å¯èƒ½å½±å“æœåŠ¡è´¨é‡çš„ã€‚è¿™ç±»å·¥ä½œè´Ÿè½½å®è´¨ä¸Šæ˜¯ä¸èƒ½è¢«æŠ¢å çš„ã€‚</p><p>ä¸ºäº†å®ç°è¿™ä¸ªæœºåˆ¶ï¼ŒKoordinator v1.4.0 å¼•å…¥äº†æ–°çš„ APIï¼Œç”¨æˆ·åªéœ€è¦åœ¨ Pod ä¸Šå£°æ˜ <code>quota.scheduling.koordinator.sh/preemptible: false </code>è¡¨ç¤ºè¿™ä¸ª Pod ä¸å¯ä»¥è¢«æŠ¢å ã€‚</p><p>è°ƒåº¦å™¨è°ƒåº¦æ—¶å‘ç° Pod å£°æ˜äº†ä¸å¯æŠ¢å ï¼Œé‚£ä¹ˆæ­¤ç±» Pod çš„å¯ç”¨é…é¢çš„ä¸Šé™ä¸èƒ½è¶…è¿‡ minï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯ç”¨è¯¥èƒ½åŠ›æ—¶ï¼Œä¸€ä¸ª ElasticQuota çš„ min éœ€è¦è®¾ç½®çš„åˆç†ï¼Œå¹¶ä¸”é›†ç¾¤å†…æœ‰ç›¸åº”çš„èµ„æºä¿éšœã€‚</p><p>è¿™ä¸ªç‰¹æ€§ä¸ä¼šç ´ååŸæœ‰çš„è¡Œä¸ºã€‚</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pod</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">quota.scheduling.koordinator.sh/name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;quota-example&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">quota.scheduling.koordinator.sh/preemptible</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="33-å…¶å®ƒæ”¹è¿›">3.3 å…¶å®ƒæ”¹è¿›<a href="#33-å…¶å®ƒæ”¹è¿›" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><ol><li>Koordinator Scheduler è¿‡å»æ”¯æŒè·¨ Namespace ä½¿ç”¨åŒä¸€ä¸ª ElasticQuota å¯¹è±¡ï¼Œä½†æœ‰ä¸€äº›åœºæ™¯ä¸‹ï¼Œå¸Œæœ›åªè¢«ä¸€ä¸ªæˆ–è€…å¤šä¸ªæœ‰é™çš„ Namespace å¯ä»¥å…±äº«åŒä¸€ä¸ªå¯¹è±¡ï¼Œä¸ºäº†æ”¯æŒè¿™ä¸ªåœºæ™¯ï¼Œç”¨æˆ·å¯ä»¥åœ¨ ElasticQuota ä¸Šå¢åŠ  annotation <code>quota.scheduling.koordinator.sh/namespaces</code>ï¼Œå¯¹åº”çš„å€¼ä¸ºä¸€ä¸ª JSON å­—ç¬¦ä¸²æ•°ç»„ã€‚</li><li>æ€§èƒ½ä¼˜åŒ–ï¼šè¿‡å»çš„å®ç°ä¸­ï¼Œå½“ ElasticQuota å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒElasticQuota æ’ä»¶ä¼šé‡å»ºæ•´æ£µ Quota æ ‘ï¼Œåœ¨  v1.4.0 ç‰ˆæœ¬ä¸­åšäº†ä¼˜åŒ–ã€‚</li><li>æ”¯æŒå¿½ç•¥ Overheadï¼šå½“ Pod ä½¿ç”¨ä¸€äº›å®‰å…¨å®¹å™¨æ—¶ï¼Œä¸€èˆ¬æ˜¯åœ¨ Pod ä¸­å£°æ˜ Overhead è¡¨ç¤ºå®‰å…¨å®¹å™¨è‡ªèº«çš„èµ„æºå¼€é”€ï¼Œä½†è¿™éƒ¨åˆ†èµ„æºæˆæœ¬æœ€ç»ˆæ˜¯å¦å½’äºç»ˆç«¯ç”¨æˆ·æ‰¿æ‹…å–å†³äºèµ„æºå”®å–ç­–ç•¥ã€‚å½“æœŸæœ›ä¸ç”¨ç”¨æˆ·æ‰¿æ‹…è¿™éƒ¨åˆ†æˆæœ¬æ—¶ï¼Œé‚£ä¹ˆå°±è¦æ±‚ ElaticQuota å¿½ç•¥ overheadã€‚åœ¨ v1.4.0 ç‰ˆæœ¬ä¸­ï¼Œå¯ä»¥å¼€å¯ featureGate <code>ElasticQuotaIgnorePodOverhead</code> å¯ç”¨è¯¥åŠŸèƒ½ã€‚</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-cpu-å½’ä¸€åŒ–">4. CPU å½’ä¸€åŒ–<a href="#4-cpu-å½’ä¸€åŒ–" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>éšç€ Kubernetes é›†ç¾¤ä¸­èŠ‚ç‚¹ç¡¬ä»¶çš„å¤šæ ·åŒ–ï¼Œä¸åŒæ¶æ„å’Œä»£æ•°çš„ CPU ä¹‹é—´æ€§èƒ½å·®å¼‚æ˜¾è‘—ã€‚å› æ­¤ï¼Œå³ä½¿ Pod çš„ CPU è¯·æ±‚ç›¸åŒï¼Œå®é™…è·å¾—çš„è®¡ç®—èƒ½åŠ›ä¹Ÿå¯èƒ½å¤§ä¸ç›¸åŒï¼Œè¿™å¯èƒ½å¯¼è‡´èµ„æºæµªè´¹æˆ–åº”ç”¨æ€§èƒ½ä¸‹é™ã€‚CPU å½’ä¸€åŒ–çš„ç›®æ ‡æ˜¯é€šè¿‡æ ‡å‡†åŒ–èŠ‚ç‚¹ä¸Šå¯åˆ†é… CPU çš„æ€§èƒ½ï¼Œæ¥ä¿è¯æ¯ä¸ª CPU å•å…ƒåœ¨ Kubernetes ä¸­æä¾›çš„è®¡ç®—èƒ½åŠ›åœ¨å¼‚æ„èŠ‚ç‚¹é—´ä¿æŒä¸€è‡´ã€‚</p><p>ä¸ºäº†è§£å†³è¯¥é—®é¢˜ï¼ŒKoordinator åœ¨ v1.4.0 ç‰ˆæœ¬ä¸­å®ç°äº†ä¸€å¥—æ”¯æŒ CPU å½’ä¸€åŒ–æœºåˆ¶ï¼Œæ ¹æ®èŠ‚ç‚¹çš„èµ„æºæ”¾å¤§ç­–ç•¥ï¼Œè°ƒæ•´èŠ‚ç‚¹ä¸Šå¯åˆ†é…çš„ CPU èµ„æºæ•°é‡ï¼Œä½¿å¾—é›†ç¾¤ä¸­æ¯ä¸ªå¯åˆ†é…çš„ CPU é€šè¿‡ç¼©æ”¾å®ç°ç®—åŠ›çš„åŸºæœ¬ä¸€è‡´ã€‚æ•´ä½“çš„æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img loading="lazy" alt="img" src="/zh-Hans/assets/images/cpu-normalization-42902e00c064a6a32c368a92720dca8e.svg" width="917" height="481" class="img_ev3q"></p><p>CPU å½’ä¸€åŒ–åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼š</p><ol><li>CPU æ€§èƒ½è¯„ä¼°ï¼Œè®¡ç®—ä¸åŒ CPU çš„æ€§èƒ½åŸºå‡†ï¼Œå¯ä»¥å‚è€ƒå·¥ä¸šçº§æ€§èƒ½è¯„æµ‹æ ‡å‡† <a href="https://www.spec.org/cpu2017/" target="_blank" rel="noopener noreferrer">SPEC CPU</a>ï¼Œè¿™éƒ¨åˆ† Koordinator é¡¹ç›®æœªæä¾›ï¼›</li><li>é…ç½® CPU å½’ä¸€åŒ–ç³»æ•°åˆ° Koordinatorï¼Œè°ƒåº¦ç³»ç»ŸåŸºäºå½’ä¸€åŒ–ç³»æ•°æ¥è°ƒåº¦èµ„æºï¼Œè¿™éƒ¨åˆ† Koordinator æä¾›ï¼›</li></ol><p>å°† CPU å½’ä¸€åŒ–æ¯”ä¾‹ä¿¡æ¯é…ç½®åˆ° koord-manager çš„ slo-controller-config ä¸­ï¼Œé…ç½®ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ConfigMap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> slo</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">controller</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> koordinator</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">cpu-normalization-config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      &quot;enable&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      &quot;ratioModel&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">         &quot;Intel(R) Xeon(R) Platinum 8269CY CPU @ 2.50GHz&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">           &quot;baseRatio&quot;: 1.29,</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">           &quot;hyperThreadEnabledRatio&quot;: 0.82,</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">           &quot;turboEnabledRatio&quot;: 1.52,</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">           &quot;hyperThreadTurboEnabledRatio&quot;: 1.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">         },</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">         &quot;Intel Xeon Platinum 8369B CPU @ 2.90GHz&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">           &quot;baseRatio&quot;: 1.69,</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">           &quot;hyperThreadEnabledRatio&quot;: 1.06,</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">           &quot;turboEnabledRatio&quot;: 1.91,</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">           &quot;hyperThreadTurboEnabledRatio&quot;: 1.20</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">         }</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å¯¹äºé…ç½®äº† CPU å½’ä¸€åŒ–çš„èŠ‚ç‚¹ï¼ŒKoordinator é€šè¿‡ Webhook æ‹¦æˆª Kubelet å¯¹ Node.Status.Allocatable çš„æ›´æ–°ä»¥å®ç° CPU èµ„æºçš„ç¼©æ”¾ï¼Œæœ€ç»ˆåœ¨èŠ‚ç‚¹ä¸Šå‘ˆç°å‡ºå½’ä¸€åçš„ CPU èµ„æºå¯åˆ†é…é‡ã€‚</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-æ”¹è¿›çš„é‡è°ƒåº¦é˜²æŠ¤ç­–ç•¥">5. æ”¹è¿›çš„é‡è°ƒåº¦é˜²æŠ¤ç­–ç•¥<a href="#5-æ”¹è¿›çš„é‡è°ƒåº¦é˜²æŠ¤ç­–ç•¥" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>Pod è¿ç§»æ˜¯ä¸€ä¸ªå¤æ‚çš„è¿‡ç¨‹ï¼Œæ¶‰åŠå®¡è®¡ã€èµ„æºåˆ†é…ã€åº”ç”¨å¯åŠ¨ç­‰æ­¥éª¤ï¼Œå¹¶ä¸”ä¸åº”ç”¨å‡çº§ã€æ‰©å±•åœºæ™¯ä»¥åŠé›†ç¾¤ç®¡ç†å‘˜çš„èµ„æºæ“ä½œå’Œç»´æŠ¤æ“ä½œæ··åˆåœ¨ä¸€èµ·ã€‚å› æ­¤ï¼Œå¦‚æœåŒæ—¶æœ‰å¤§é‡ Pods æ­£åœ¨è¿›è¡Œè¿ç§»ï¼Œå¯èƒ½ä¼šå¯¹ç³»ç»Ÿçš„ç¨³å®šæ€§äº§ç”Ÿå½±å“ã€‚æ­¤å¤–ï¼Œå¦‚æœåŒä¸€å·¥ä½œè´Ÿè½½çš„è®¸å¤šPodsåŒæ—¶è¢«è¿ç§»ï¼Œä¹Ÿä¼šå½±å“åº”ç”¨çš„ç¨³å®šæ€§ã€‚æ­¤å¤–ï¼Œå¦‚æœåŒæ—¶è¿ç§»å¤šä¸ªä½œä¸šä¸­çš„ Podsï¼Œå¯èƒ½ä¼šé€ æˆæƒŠç¾¤æ•ˆåº”ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¸Œæœ›é¡ºåºå¤„ç†æ¯ä¸ªä½œä¸šä¸­çš„ Podsã€‚</p><p>Koordinator åœ¨ä¹‹å‰æä¾›çš„ PodMigrationJob åŠŸèƒ½ä¸­å·²ç»æä¾›äº†ä¸€äº›é˜²æŠ¤ç­–ç•¥æ¥è§£å†³ä¸Šè¿°é—®é¢˜ã€‚åœ¨ v1.4.0 ç‰ˆæœ¬ä¸­ï¼ŒKoordinator å°†ä¹‹å‰çš„é˜²æŠ¤ç­–ç•¥å¢å¼ºä¸ºä»²è£æœºåˆ¶ã€‚å½“æœ‰å¤§é‡çš„ PodMigrationJob å¯ä»¥è¢«æ‰§è¡Œæ—¶ï¼Œç”±ä»²è£å™¨é€šè¿‡æ’åºå’Œç­›é€‰ï¼Œæ¥å†³å®šå“ªäº› PodMigrationJob å¯ä»¥å¾—åˆ°æ‰§è¡Œã€‚</p><p>æ’åºè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li>æ ¹æ®è¿ç§»å¼€å§‹æ—¶é—´ä¸å½“å‰æ—¶é—´çš„é—´éš”è¿›è¡Œæ’åºï¼Œé—´éš”è¶Šå°ï¼Œæ’åè¶Šé«˜ã€‚</li><li>æ ¹æ® PodMigrationJob çš„ Pod ä¼˜å…ˆçº§è¿›è¡Œæ’åºï¼Œä¼˜å…ˆçº§è¶Šä½ï¼Œæ’åè¶Šé«˜ã€‚</li><li>æŒ‰ç…§å·¥ä½œè´Ÿè½½åˆ†æ•£ Jobsï¼Œä½¿å¾—åŒä¸€ä½œä¸šä¸­çš„ PodMigrationJobs é è¿‘ã€‚</li><li>å¦‚æœä½œä¸šä¸­å·²æœ‰ Pods æ­£åœ¨è¿ç§»ï¼Œåˆ™è¯¥ PodMigrationJob çš„æ’åæ›´é«˜ã€‚</li></ul><p>ç­›é€‰è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li>æ ¹æ®å·¥ä½œè´Ÿè½½ã€èŠ‚ç‚¹ã€å‘½åç©ºé—´ç­‰å¯¹ PodMigrationJob è¿›è¡Œåˆ†ç»„å’Œç­›é€‰ã€‚</li><li>æ£€æŸ¥æ¯ä¸ªå·¥ä½œè´Ÿè½½ä¸­æ­£åœ¨è¿è¡ŒçŠ¶æ€çš„ PodMigrationJob æ•°é‡ï¼Œè¾¾åˆ°ä¸€å®šé˜ˆå€¼çš„å°†è¢«æ’é™¤ã€‚</li><li>æ£€æŸ¥æ¯ä¸ªå·¥ä½œè´Ÿè½½ä¸­ä¸å¯ç”¨å‰¯æœ¬çš„æ•°é‡æ˜¯å¦è¶…å‡ºäº†æœ€å¤§ä¸å¯ç”¨å‰¯æœ¬æ•°ï¼Œè¶…å‡ºçš„å°†è¢«æ’é™¤ã€‚</li><li>æ£€æŸ¥ç›®æ ‡ Pod æ‰€åœ¨èŠ‚ç‚¹ä¸Šæ­£åœ¨è¿ç§»çš„ Pod æ•°é‡æ˜¯å¦è¶…è¿‡å•ä¸ªèŠ‚ç‚¹çš„æœ€å¤§è¿ç§»é‡ï¼Œè¶…å‡ºçš„å°†è¢«æ’é™¤ã€‚</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-å†·å†…å­˜ä¸ŠæŠ¥">6. å†·å†…å­˜ä¸ŠæŠ¥<a href="#6-å†·å†…å­˜ä¸ŠæŠ¥" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>ä¸ºæå‡ç³»ç»Ÿæ€§èƒ½ï¼Œå†…æ ¸ä¸€èˆ¬å°½å¯èƒ½ä¸è®©åº”ç”¨ç¨‹åºè¯·æ±‚çš„é¡µé¢ç¼“å­˜ç©ºé—²ï¼Œè€Œæ˜¯å°½å¯èƒ½å°†å…¶åˆ†é…ç»™åº”ç”¨ç¨‹åºã€‚è™½ç„¶å†…æ ¸åˆ†é…äº†è¿™äº›å†…å­˜ï¼Œä½†æ˜¯åº”ç”¨å¯èƒ½ä¸å†è®¿é—®ï¼Œè¿™äº›å†…å­˜è¢«ç§°ä¸ºå†·å†…å­˜ã€‚</p><p>Koordinator åœ¨ 1.4 ç‰ˆæœ¬ä¸­å¼•å…¥å†·å†…å­˜ä¸ŠæŠ¥åŠŸèƒ½ï¼Œä¸»è¦ä¸ºæœªæ¥å†·å†…å­˜å›æ”¶åŠŸèƒ½æ‰“ä¸‹åŸºç¡€ã€‚å†·å†…å­˜å›æ”¶ä¸»è¦ç”¨äºåº”å¯¹ä¸¤ä¸ªåœºæ™¯ï¼š</p><ol><li>å¯¹äºæ ‡å‡†çš„ Kubernetes é›†ç¾¤ï¼Œå½“èŠ‚ç‚¹å†…å­˜æ°´ä½è¿‡é«˜æ—¶ï¼Œçªå‘çš„å†…å­˜è¯·æ±‚å®¹å™¨å¯¼è‡´ç³»ç»Ÿç›´æ¥å†…å­˜å›æ”¶ï¼Œæ“ä½œç³»ç»Ÿçš„ç›´æ¥å†…å­˜å›æ”¶è§¦å‘æ—¶ä¼šå½±å“å·²ç»è¿è¡Œå®¹å™¨çš„æ€§èƒ½ï¼Œå¦‚æœå›æ”¶ä¸åŠæ—¶æç«¯åœºæ™¯å¯èƒ½è§¦å‘æ•´æœº oomã€‚ä¿æŒèŠ‚ç‚¹å†…å­˜èµ„æºçš„ç›¸å¯¹ç©ºé—²ï¼Œå¯¹æå‡è¿è¡Œæ—¶ç¨³å®šæ€§è‡³å…³é‡è¦</li><li>åœ¨æ··éƒ¨åœºæ™¯ä¸­ï¼Œé«˜ä¼˜å…ˆçº§åº”ç”¨ç¨‹åºè¯·æ±‚ä½†æœªä½¿ç”¨çš„èµ„æºå¯ä»¥è¢«ä½ä¼˜å…ˆçº§åº”ç”¨ç¨‹åºå›æ”¶åˆ©ç”¨ã€‚å¯¹å†…å­˜è€Œè¨€ï¼Œæ“ä½œç³»ç»Ÿæœªå›æ”¶çš„å†…å­˜ï¼Œæ˜¯ä¸èƒ½è¢« Koordinator è°ƒåº¦ç³»ç»Ÿçœ‹åˆ°çš„ã€‚ä¸ºäº†æé«˜æ··éƒ¨èµ„æºæ•ˆç‡ï¼Œå›æ”¶å®¹å™¨æœªä½¿ç”¨çš„å†…å­˜é¡µé¢å¯ä»¥æé«˜æ•´æœºçš„èµ„æºåˆ©ç”¨æ•ˆç‡</li></ol><p>Koordlet åœ¨ Collector Plugins ä¸­æ·»åŠ äº†ä¸€ä¸ªå†·é¡µé¢å›æ”¶å™¨ï¼Œç”¨äºè¯»å–ç”± kidledï¼ˆAnolis å†…æ ¸ï¼‰ã€kstaledï¼ˆGoogleï¼‰æˆ– DAMONï¼ˆAmazonï¼‰å¯¼å‡ºçš„ cgroup æ–‡ä»¶ memory.idle_statã€‚è¯¥æ–‡ä»¶åŒ…å«é¡µé¢ç¼“å­˜ä¸­çš„å†·é¡µé¢ä¿¡æ¯ï¼Œå¹¶å­˜åœ¨äº memory çš„æ¯ä¸ªå±‚æ¬¡ç»“æ„ä¸­ã€‚ç›®å‰ koordlet å·²ç»å¯¹æ¥äº† kidled å†·é¡µé¢æ”¶é›†å™¨å¹¶æä¾›äº†å…¶ä»–å†·é¡µé¢æ”¶é›†å™¨æ¥å£ã€‚</p><p>åœ¨æ”¶é›†å†·é¡µé¢ä¿¡æ¯åï¼Œå†·é¡µé¢å›æ”¶å™¨å°†æŠŠæ”¶é›†åˆ°çš„æŒ‡æ ‡ï¼ˆä¾‹å¦‚èŠ‚ç‚¹ã€Pod å’Œå®¹å™¨çš„çƒ­é¡µé¢ä½¿ç”¨é‡å’Œå†·é¡µé¢å¤§å°ï¼‰å­˜åˆ° metriccache ä¸­ï¼Œæœ€åè¯¥æ•°æ®ä¼šè¢«ä¸ŠæŠ¥åˆ° NodeMetric CRD ä¸­ã€‚</p><p>ç”¨æˆ·å¯ä»¥é€šè¿‡ NodeMetric å¯ç”¨å†·å†…å­˜å›æ”¶å’Œé…ç½®å†·å†…å­˜æ”¶é›†ç­–ç•¥ï¼Œå½“å‰æä¾›äº† usageWithHotPageCacheã€usageWithoutPageCache å’Œ usageWithPageCache ä¸‰ç§ç­–ç•¥ï¼Œæ›´å¤šçš„ç»†èŠ‚è¯¦è§ç¤¾åŒº<a href="https://github.com/koordinator-sh/koordinator/blob/main/docs/proposals/koordlet/20230728-support-cold-memory-compute.md" target="_blank" rel="noopener noreferrer">è®¾è®¡æ–‡æ¡£</a>ã€‚</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="7-éå®¹å™¨åŒ–åº”ç”¨çš„-qos-ç®¡ç†">7. éå®¹å™¨åŒ–åº”ç”¨çš„ QoS ç®¡ç†<a href="#7-éå®¹å™¨åŒ–åº”ç”¨çš„-qos-ç®¡ç†" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>åœ¨ä¼ä¸šå®¹å™¨åŒ–è¿‡ç¨‹ä¸­ï¼Œé™¤äº†å·²ç»è¿è¡Œåœ¨ K8s ä¸Šçš„åº”ç”¨ï¼Œå¯èƒ½è¿˜ä¼šå­˜åœ¨ä¸€äº›éå®¹å™¨åŒ–çš„åº”ç”¨è¿è¡Œåœ¨ä¸»æœºä¸Šã€‚ä¸ºäº†æ›´å¥½å…¼å®¹ä¼ä¸šåœ¨å®¹å™¨åŒ–è¿‡ç¨‹è¿™ä¸€è¿‡æ¸¡æ€ï¼ŒKoordinator å¼€å‘äº†èŠ‚ç‚¹èµ„æºé¢„ç•™æœºåˆ¶ï¼Œå¯ä»¥æœªå°šæœªå®¹å™¨åŒ–çš„åº”ç”¨é¢„ç•™èµ„æºå¹¶èµ‹äºˆç‰¹å®šçš„ QoS ç‰¹æ€§ã€‚ä¸ Kubelet æä¾›çš„èµ„æºé¢„ç•™é…ç½®ä¸åŒï¼ŒKoordinator ä¸»è¦ç›®æ ‡æ˜¯è§£å†³è¿™äº›éå®¹å™¨åŒ–åº”ç”¨ä¸å®¹å™¨åŒ–åº”ç”¨è¿è¡Œæ—¶çš„ QoS é—®é¢˜ï¼Œæ•´ä½“çš„æ–¹æ¡ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img loading="lazy" alt="img" src="/zh-Hans/assets/images/host-application-101f6caa7664a1a2cc38c6d8cf01a6a1.svg" width="406" height="241" class="img_ev3q"></p><p>ç›®å‰ï¼Œåº”ç”¨ç¨‹åºéœ€è¦æŒ‰ç…§è§„èŒƒå°†è¿›ç¨‹å¯åŠ¨åˆ°å¯¹åº”çš„ cgroup ä¸­ï¼ŒKoordinator æœªå®ç°è‡ªåŠ¨çš„ cgroup æ¬è¿å·¥å…·ã€‚é’ˆå¯¹å®¿ä¸»æœºéå®¹å™¨åŒ–åº”ç”¨ï¼Œæ”¯æŒ QoS å¦‚ä¸‹ï¼š</p><ul><li><p>LS (Latency Sensitive)</p></li><li><ul><li>CPU QoS(Group Identity)ï¼šåº”ç”¨æŒ‰ç…§è§„èŒƒå°†è¿›ç¨‹è¿è¡Œåœ¨ cgroup çš„ cpu å­ç³»ç»Ÿä¸­ï¼Œkoordlet æ ¹æ® CPU QoS çš„é…ç½® resource-qos-config ä¸ºå…¶è®¾ç½® Group Identity å‚æ•°ï¼›</li><li>CPUSet Allocationï¼šåº”ç”¨æŒ‰ç…§è§„èŒƒå°†è¿›ç¨‹è¿è¡Œåœ¨ cgroup çš„ cpu å­ç³»ç»Ÿä¸­ï¼Œkoordlet å°†ä¸ºå…¶è®¾ç½® cpu share pool ä¸­çš„æ‰€æœ‰ CPU æ ¸å¿ƒã€‚</li></ul></li><li><p>BE (Best-effort)</p></li><li><ul><li>CPU QoS(Group Identity)ï¼šåº”ç”¨æŒ‰ç…§è§„èŒƒå°†è¿›ç¨‹è¿è¡Œåœ¨ cgroup çš„ cpu å­ç³»ç»Ÿä¸­ï¼Œkoordlet æ ¹æ® CPU QoS çš„é…ç½®ä¸ºå…¶è®¾ç½® Group Identity å‚æ•°ã€‚</li></ul></li></ul><p>å…³äºå®¿ä¸»æœºåº”ç”¨ QoS ç®¡ç†çš„è¯¦ç»†è®¾è®¡ï¼Œå¯ä»¥å‚è€ƒ<a href="https://koordinator.sh/zh-Hans/docs/next/user-manuals/host-application-qos" target="_blank" rel="noopener noreferrer">ç¤¾åŒºæ–‡æ¡£</a>ï¼Œåç»­æˆ‘ä»¬å°†é™†ç»­å¢åŠ å…¶ä»–QoSç­–ç•¥å¯¹å®¿ä¸»æœºåº”ç”¨çš„æ”¯æŒã€‚</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="8-å…¶å®ƒç‰¹æ€§">8. å…¶å®ƒç‰¹æ€§<a href="#8-å…¶å®ƒç‰¹æ€§" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>é™¤äº†ä¸Šè¿°æ–°ç‰¹æ€§å’ŒåŠŸèƒ½å¢å¼ºå¤–ï¼ŒKoordinator åœ¨ v1.4.0 ç‰ˆæœ¬è¿˜åšäº†ä¸€äº›å¦‚ä¸‹çš„ bugfix å’Œä¼˜åŒ–ï¼š</p><ol><li>RequiredCPUBindPolicyï¼šç²¾ç»†åŒ– CPU ç¼–æ’æ”¯æŒ Required çš„ CPU ç»‘å®šç­–ç•¥é…ç½®ï¼Œè¡¨ç¤ºä¸¥æ ¼æŒ‰ç…§æŒ‡å®šçš„ CPU ç»‘å®šç­–ç•¥åˆ†é… CPUï¼Œå¦åˆ™è°ƒåº¦å¤±è´¥ã€‚</li><li>CICDï¼šKoordinator ç¤¾åŒºåœ¨ v1.4.0 æä¾›äº†ä¸€å¥— e2e æµ‹è¯•çš„ Pipelineï¼›æä¾›äº† ARM64 é•œåƒã€‚</li><li>Batch èµ„æºè®¡ç®—ç­–ç•¥ä¼˜åŒ–ï¼šæ”¯æŒäº† maxUsageRequest çš„è®¡ç®—ç­–ç•¥ï¼Œç”¨äºæ›´ä¿å®ˆåœ°è¶…å–é«˜ä¼˜èµ„æºï¼›ä¼˜åŒ–äº†èŠ‚ç‚¹ä¸ŠçŸ­æ—¶é—´å¤§é‡ Pod å¯åœæ—¶ï¼ŒBatch allocatable è¢«ä½ä¼°çš„é—®é¢˜ï¼›å®Œå–„äº†å¯¹ hostApplicationã€thirdparty allocatableã€dangling pod used ç­‰ç‰¹æ®Šæƒ…å†µçš„è€ƒè™‘ã€‚</li><li>å…¶å®ƒï¼šåˆ©ç”¨ libpfm4&amp;perf group ä¼˜åŒ– CPI é‡‡é›†ã€SystemResourceCollector æ”¯æŒè‡ªå®šä¹‰çš„è¿‡æœŸæ—¶é—´é…ç½®ã€BE Pod æ”¯æŒæ ¹æ® evictByAllocatable  ç­–ç•¥è®¡ç®—CPU æ»¡è¶³åº¦ã€Koordlet CPUSetAllocator ä¿®å¤äº†å¯¹äº LS å’Œ None Qos çš„ Pod çš„è¿‡æ»¤é€»è¾‘ã€RDT èµ„æºæ§åˆ¶æ”¯æŒè·å¾— sandbox å®¹å™¨çš„ task IDs ç­‰</li></ol><p>é€šè¿‡ <a href="https://github.com/koordinator-sh/koordinator/releases/tag/v1.4.0" target="_blank" rel="noopener noreferrer">v1.4.0 Release</a> é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°æ›´å¤šåŒ…å«åœ¨ v1.4.0 ç‰ˆæœ¬çš„æ–°å¢åŠŸèƒ½ã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="æœªæ¥è®¡åˆ’">æœªæ¥è®¡åˆ’<a href="#æœªæ¥è®¡åˆ’" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>åœ¨æ¥ä¸‹æ¥çš„ç‰ˆæœ¬ä¸­ï¼ŒKoordinator ç›®å‰è§„åˆ’äº†ä»¥ä¸‹åŠŸèƒ½ï¼š</p><ul><li>Core Schedulingã€‚åœ¨è¿è¡Œæ—¶ä¾§ï¼ŒKoordinator å¼€å§‹æ¢ç´¢ä¸‹ä¸€ä»£ CPU QoS èƒ½åŠ›ï¼Œé€šè¿‡åˆ©ç”¨ Linux Core Scheduling ç­‰å†…æ ¸æœºåˆ¶ï¼Œå¢å¼ºçš„ç‰©ç†æ ¸ç»´åº¦çš„èµ„æºéš”ç¦»ï¼Œé™ä½æ··éƒ¨çš„å®‰å…¨æ€§é£é™©ï¼Œç›¸å…³å·¥ä½œè¯¦è§ <a href="https://github.com/koordinator-sh/koordinator/issues/1728" target="_blank" rel="noopener noreferrer">Issue #1728</a>ã€‚</li><li>è®¾å¤‡è”åˆåˆ†é…ã€‚åœ¨ AI å¤§æ¨¡å‹åˆ†å¸ƒå¼è®­ç»ƒåœºæ™¯ä¸­ï¼Œä¸åŒæœºå™¨ GPU ä¹‹é—´é€šå¸¸éœ€è¦é€šè¿‡é«˜æ€§èƒ½ç½‘å¡ç›¸äº’é€šä¿¡ï¼Œä¸” GPU å’Œé«˜æ€§èƒ½ç½‘å¡å°±è¿‘åˆ†é…çš„æ—¶å€™æ€§èƒ½æ›´å¥½ã€‚Koordinator æ­£åœ¨æ¨è¿›æ”¯æŒå¤šç§å¼‚æ„èµ„æºçš„è”åˆåˆ†é…ï¼Œç›®å‰å·²ç»åœ¨åè®®ä¸Šå’Œè°ƒåº¦å™¨åˆ†é…é€»è¾‘ä¸Šæ”¯æŒè”åˆåˆ†é…ï¼›å•æœºä¾§å…³äºç½‘å¡èµ„æºçš„ä¸ŠæŠ¥é€»è¾‘æ­£åœ¨æ¢ç´¢ä¸­ã€‚</li></ul><p>æ›´å¤šä¿¡æ¯ï¼Œæ•¬è¯·å…³æ³¨ <a href="https://github.com/koordinator-sh/koordinator/milestone/14" target="_blank" rel="noopener noreferrer">Milestone v1.5.0</a>ã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ç»“è¯­">ç»“è¯­<a href="#ç»“è¯­" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>æœ€åï¼Œæˆ‘ä»¬ååˆ†æ„Ÿè°¢ Koordinator ç¤¾åŒºçš„æ‰€æœ‰è´¡çŒ®è€…å’Œç”¨æˆ·ï¼Œæ˜¯æ‚¨ä»¬çš„ç§¯æå‚ä¸å’Œå®è´µæ„è§è®© Koordinator ä¸æ–­è¿›æ­¥ã€‚æˆ‘ä»¬æœŸå¾…æ‚¨ç»§ç»­æä¾›åé¦ˆï¼Œå¹¶æ¬¢è¿æ–°çš„è´¡çŒ®è€…åŠ å…¥æˆ‘ä»¬çš„è¡Œåˆ—ã€‚</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>æ ‡ç­¾ï¼š</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/zh-Hans/blog/tags/release">release</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/zh-Hans/blog/release-v1.3.0">Koordinator v1.3: å¢å¼ºèµ„æºé¢„ç•™ï¼Œæ”¯æŒ NRIï¼Œæä¾›èŠ‚ç‚¹ç”»åƒçš„ Mid èµ„æºè¶…å–</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-08-16T00:00:00.000Z" itemprop="datePublished">2023å¹´8æœˆ16æ—¥</time> Â· <!-- -->12 åˆ†é’Ÿé˜…è¯»</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/saintube" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/saintube.png" alt="Rougang Han"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/saintube" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Rougang Han</span></a></div><small class="avatar__subtitle" itemprop="description">Koordinator approver</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="èƒŒæ™¯">èƒŒæ™¯<a href="#èƒŒæ™¯" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>Koordinator æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œæ—¨åœ¨åŸºäºé˜¿é‡Œå·´å·´åœ¨å®¹å™¨è°ƒåº¦é¢†åŸŸçš„å¤šå¹´ç»éªŒï¼Œæä¾›ä¸€ä¸ªå®Œæ•´çš„æ··éƒ¨è§£å†³æ–¹æ¡ˆï¼ŒåŒ…å«æ··éƒ¨å·¥ä½œè´Ÿè½½ç¼–æ’ã€èµ„æºè°ƒåº¦ã€èµ„æºéš”ç¦»åŠæ€§èƒ½è°ƒä¼˜ç­‰å¤šæ–¹é¢èƒ½åŠ›ï¼Œæ¥å¸®åŠ©ç”¨æˆ·ä¼˜åŒ–å®¹å™¨æ€§èƒ½ï¼Œå……åˆ†å‘æ˜ç©ºé—²ç‰©ç†èµ„æºï¼Œæå‡èµ„æºæ•ˆç‡ï¼Œå¢å¼ºå»¶è¿Ÿæ•æ„Ÿå‹å·¥ä½œè´Ÿè½½å’Œæ‰¹å¤„ç†ä½œä¸šçš„è¿è¡Œæ•ˆç‡å’Œå¯é æ€§ã€‚</p><p>åœ¨æ­¤ï¼Œæˆ‘ä»¬å¾ˆé«˜å…´åœ°å‘å„ä½å®£å¸ƒ Koordinator v1.3.0 ç‰ˆæœ¬çš„å‘å¸ƒã€‚è‡ª 2022 å¹´ 4 æœˆå‘å¸ƒ v0.1.0 ç‰ˆæœ¬ä»¥æ¥ï¼ŒKoordinator è¿„ä»Šè¿­ä»£å‘å¸ƒäº†å…± 11 ä¸ªç‰ˆæœ¬ï¼Œå¸å¼•äº†äº†åŒ…æ‹¬é˜¿é‡Œå·´å·´ã€Intelã€å°ç±³ã€å°çº¢ä¹¦ã€çˆ±å¥‡è‰ºã€360ã€æœ‰èµç­‰ä¼ä¸šåœ¨å†…çš„å¤§é‡ä¼˜ç§€å·¥ç¨‹å¸ˆå‚ä¸è´¡çŒ®ã€‚åœ¨ v1.3.0 ç‰ˆæœ¬ä¸­ï¼ŒKoordinator å¸¦æ¥äº† NRI (Node Resource Interface) æ”¯æŒã€Mid èµ„æºè¶…å–ç­‰æ–°ç‰¹æ€§ï¼Œå¹¶åœ¨èµ„æºé¢„ç•™ã€è´Ÿè½½æ„ŸçŸ¥è°ƒåº¦ã€DeviceShare è°ƒåº¦ã€è´Ÿè½½æ„ŸçŸ¥é‡è°ƒåº¦ã€è°ƒåº¦å™¨æ¡†æ¶ã€å•æœºæŒ‡æ ‡é‡‡é›†å’Œèµ„æºè¶…å–æ¡†æ¶ç­‰ç‰¹æ€§ä¸Šè¿›è¡Œäº†ç¨³å®šæ€§ä¿®å¤ã€æ€§èƒ½ä¼˜åŒ–ä¸åŠŸèƒ½å¢å¼ºã€‚</p><p>åœ¨ v1.3.0 ç‰ˆæœ¬ä¸­ï¼Œå…±æœ‰ 12 ä½æ–°åŠ å…¥çš„å¼€å‘è€…å‚ä¸åˆ°äº† Koordinator ç¤¾åŒºçš„å»ºè®¾ï¼Œä»–ä»¬æ˜¯ @bowen-intelï¼Œ@BUPT-wxqï¼Œ@Gala-Rï¼Œ@haoyannï¼Œ@kangclzjcï¼Œ@Solomonwisdomï¼Œ@stulzqï¼Œ@TheBeatles1994ï¼Œ@Tiana2018ï¼Œ@VinceCuiï¼Œ@wenchezhaoï¼Œ@zhouzijiangï¼Œæ„Ÿè°¢æœŸé—´å„ä½ç¤¾åŒºåŒå­¦çš„ç§¯æå‚ä¸å’Œè´¡çŒ®ï¼Œä¹Ÿæ„Ÿè°¢æ‰€æœ‰åŒå­¦åœ¨ç¤¾åŒºçš„æŒç»­æŠ•å…¥ã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ç‰ˆæœ¬åŠŸèƒ½ç‰¹æ€§è§£è¯»">ç‰ˆæœ¬åŠŸèƒ½ç‰¹æ€§è§£è¯»<a href="#ç‰ˆæœ¬åŠŸèƒ½ç‰¹æ€§è§£è¯»" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="èµ„æºé¢„ç•™å¢å¼º">èµ„æºé¢„ç•™å¢å¼º<a href="#èµ„æºé¢„ç•™å¢å¼º" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>èµ„æºé¢„ç•™ï¼ˆReservationï¼‰èƒ½åŠ›è‡ª v0.5.0 ç‰ˆæœ¬æå‡ºåï¼Œç»å†äº†ä¸€å¹´çš„æ‰“ç£¨å’Œè¿­ä»£ï¼Œåœ¨ v1.3.0 ç‰ˆæœ¬ä¸­é’ˆå¯¹æŠ¢å ã€è®¾å¤‡é¢„ç•™ã€Coscheduling ç­‰åœºæ™¯å¢å¼ºäº†é¢„ç•™æœºåˆ¶ï¼Œæ–°å¢ allocatePolicy å­—æ®µç”¨äºå®šä¹‰ä¸åŒçš„é¢„ç•™èµ„æºåˆ†é…ç­–ç•¥ã€‚æœ€æ–°çš„èµ„æºé¢„ç•™ API å¦‚ä¸‹ï¼š</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> scheduling.koordinator.sh/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Reservation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> reservation</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># templateå­—æ®µå¡«å†™reservationå¯¹è±¡çš„èµ„æºéœ€æ±‚å’Œaffinityä¿¡æ¯ï¼Œå°±åƒè°ƒåº¦podä¸€æ ·.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">args</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;-c&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> stress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> polinux/stress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">imagePullPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Always</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> stress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 500m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 1Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">nodeAffinity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">requiredDuringSchedulingIgnoredDuringExecution</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token key atrule" style="color:#00a4db">nodeSelectorTerms</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">matchExpressions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> topology.kubernetes.io/zone</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   </span><span class="token key atrule" style="color:#00a4db">operator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> In</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   </span><span class="token key atrule" style="color:#00a4db">values</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> cn</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">hangzhou</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">i</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">schedulerName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> koord</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">scheduler </span><span class="token comment" style="color:#999988;font-style:italic"># æŒ‡å®škoord-scheduleræ¥è´Ÿè´£reservationå¯¹è±¡çš„è°ƒåº¦.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># æŒ‡å®šå¯åˆ†é…é¢„ç•™èµ„æºçš„owners.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">owners</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">labelSelector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> app</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ttl</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 1h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># æŒ‡å®šé¢„ç•™èµ„æºæ˜¯å¦ä»…æ”¯æŒä¸€æ¬¡æ€§çš„åˆ†é….</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">allocateOnce</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># æŒ‡å®šé¢„ç•™èµ„æºçš„åˆ†é…ç­–ç•¥,å½“å‰æ”¯æŒä»¥ä¸‹ç­–ç•¥:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># - Default: ç¼ºçœé…ç½®ï¼Œä¸é™åˆ¶å¯¹é¢„ç•™èµ„æºçš„åˆ†é…ï¼Œpodä¼˜å…ˆåˆ†é…è‡ªèŠ‚ç‚¹ä¸Šçš„é¢„ç•™èµ„æºï¼›å¦‚æœé¢„ç•™èµ„æºä¸è¶³ï¼Œåˆ™ç»§ç»­åˆ†é…èŠ‚ç‚¹ç©ºé—²èµ„æºã€‚</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># - Aligned: podä¼˜å…ˆåˆ†é…è‡ªèŠ‚ç‚¹ä¸Šçš„é¢„ç•™èµ„æºï¼›å¦‚æœé¢„ç•™èµ„æºä¸è¶³ï¼Œåˆ™ç»§ç»­åˆ†é…èŠ‚ç‚¹ç©ºé—²èµ„æºï¼Œä½†è¦æ±‚è¿™éƒ¨åˆ†èµ„æºæ»¡è¶³Podéœ€æ±‚ã€‚è¯¥ç­–ç•¥å¯ç”¨äºè§„é¿podåŒæ—¶åˆ†é…å¤šä¸ªreservationçš„èµ„æºã€‚</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># - Restricted: å¯¹äºé¢„ç•™èµ„æºåŒ…å«çš„å„ä¸ªèµ„æºç»´åº¦ï¼Œpodå¿…é¡»åˆ†é…è‡ªé¢„ç•™èµ„æºï¼›å…¶ä½™èµ„æºç»´åº¦å¯ä»¥åˆ†é…èŠ‚ç‚¹ç©ºé—²èµ„æºã€‚åŒ…å«äº†Alignedç­–ç•¥çš„è¯­ä¹‰ã€‚</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># åŒä¸€èŠ‚ç‚¹å°šä¸æ”¯æŒDefaultç­–ç•¥å’ŒAlignedç­–ç•¥æˆ–Restrictedç­–ç•¥å…±å­˜ã€‚</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">allocatePolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Aligned&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># æ§åˆ¶é¢„ç•™èµ„æºæ˜¯å¦å¯ä»¥ä½¿ç”¨</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">unschedulable</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ­¤å¤–ï¼Œèµ„æºé¢„ç•™åœ¨ v1.3.0 ä¸­è¿˜åŒ…å«äº†å¦‚ä¸‹å…¼å®¹æ€§å’Œæ€§èƒ½ä¼˜åŒ–ï¼š</p><ol><li>å¢å¼º Reservation çš„æŠ¢å ï¼Œå…è®¸ Reservation å†…çš„ Pod é—´æŠ¢å ï¼Œæ‹’ç» Reservation å¤–çš„ Pod æŠ¢å  Reservation å†…çš„ Podã€‚</li><li>å¢å¼ºè®¾å¤‡é¢„ç•™åœºæ™¯ï¼Œå¦‚æœèŠ‚ç‚¹ä¸Šè®¾å¤‡èµ„æºè¢«éƒ¨åˆ†é¢„ç•™å¹¶è¢« pod ä½¿ç”¨ï¼Œæ”¯æŒå‰©ä½™èµ„æºçš„åˆ†é…ã€‚</li><li>æ”¯æŒ Reservation ä½¿ç”¨ Coschedulingã€‚</li><li>æ–°å¢ Reservation Affinityåè®®ï¼Œå…è®¸ç”¨æˆ·ä¸€å®šä»Reservationå†…åˆ†é…èµ„æºã€‚</li><li>ä¼˜åŒ– Reservation å…¼å®¹æ€§ï¼Œä¿®å¤å›  Reservation å¯¼è‡´åŸç”Ÿæ‰“åˆ†æ’ä»¶å¤±æ•ˆçš„é—®é¢˜ã€‚ </li><li>ä¼˜åŒ–å› å¼•å…¥ Reservation å¯¼è‡´çš„è°ƒåº¦æ€§èƒ½å›å½’é—®é¢˜ã€‚</li><li>ä¿®å¤ Reservation é¢„ç•™ç«¯å£è¯¯åˆ é™¤çš„é—®é¢˜ã€‚</li></ol><p>å…³äºèµ„æºé¢„ç•™çš„è®¾è®¡ï¼Œè¯¦è§<a href="/zh-Hans/docs/designs/resource-reservation">Designs - Resource Reservation</a>ã€‚</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="å…¶ä»–è°ƒåº¦å¢å¼º">å…¶ä»–è°ƒåº¦å¢å¼º<a href="#å…¶ä»–è°ƒåº¦å¢å¼º" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>åœ¨ v1.3.0 ä¸­ï¼Œkoordinator åœ¨è°ƒåº¦å’Œé‡è°ƒåº¦æ–¹é¢è¿˜åŒ…å«å¦‚ä¸‹å¢å¼ºï¼š</p><ol><li><p>DeviceShare è°ƒåº¦</p><ul><li>æ›´æ”¹ GPU èµ„æºä½¿ç”¨æ–¹å¼ï¼Œä½¿ç”¨ GPU Share API æ—¶ï¼Œå¿…é¡»å£°æ˜<code>koordinator.sh/gpu-memory</code>æˆ–<code>koordinator.sh/gpu-memory-ratio</code>ï¼Œå…è®¸ä¸å£°æ˜<code>koordinator.sh/gpu-core</code>ã€‚</li><li>æ”¯æŒæ‰“åˆ†ï¼Œå¯ç”¨äºå®ç° GPU Share åœºæ™¯å’Œæ•´å¡åˆ†é…åœºæ™¯çš„ bin-packing æˆ– spreadï¼Œå¹¶æ”¯æŒå¡ç²’åº¦ binpacking æˆ– spreadã€‚</li><li>ä¿®å¤ç”¨æˆ·è¯¯åˆ é™¤ Device CRD å¯¼è‡´è°ƒåº¦å™¨å†…éƒ¨çŠ¶æ€å¼‚å¸¸é‡å¤åˆ†é…è®¾å¤‡çš„é—®é¢˜ã€‚</li></ul></li><li><p>è´Ÿè½½æ„ŸçŸ¥è°ƒåº¦ï¼šä¿®å¤å¯¹ä»…å¡«å†™ Request çš„ Pod çš„è°ƒåº¦é€»è¾‘ã€‚</p></li><li><p>è°ƒåº¦å™¨æ¡†æ¶ï¼šä¼˜åŒ– PreBind é˜¶æ®µçš„ Patch æ“ä½œï¼Œå°†å¤šä¸ªæ’ä»¶çš„ Patch æ“ä½œåˆå¹¶ä¸ºä¸€æ¬¡æäº¤ï¼Œæå‡æ“ä½œæ•ˆç‡ï¼Œé™ä½ APIServer å‹åŠ›ã€‚</p></li><li><p>é‡è°ƒåº¦</p><ul><li>LowNodeLoad æ”¯æŒæŒ‰èŠ‚ç‚¹æ± è®¾ç½®ä¸åŒçš„è´Ÿè½½æ°´ä½å’Œå‚æ•°ç­‰ã€‚è‡ªåŠ¨å…¼å®¹åŸæœ‰é…ç½®ã€‚</li><li>è·³è¿‡ schedulerName ä¸æ˜¯ koord-scheduler çš„Podï¼Œæ”¯æŒé…ç½®ä¸åŒçš„ schedulerNameã€‚</li></ul></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="nri-èµ„æºç®¡ç†æ¨¡å¼">NRI èµ„æºç®¡ç†æ¨¡å¼<a href="#nri-èµ„æºç®¡ç†æ¨¡å¼" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>Koordinator çš„ runtime hooks æ”¯æŒä¸¤ç§æ¨¡å¼ï¼Œstandalone å’Œ CRI proxyï¼Œç„¶è€Œè¿™ä¸¤ç§æ¨¡å¼å„è‡ªæœ‰ç€ä¸€äº›é™åˆ¶ã€‚å½“å‰ï¼Œå°½ç®¡åœ¨ standalone æ¨¡å¼åšäº†å¾ˆå¤šä¼˜åŒ–ï¼Œä½†å½“æƒ³è·å¾—æ›´åŠ åŠæ—¶çš„ Pod æˆ–å®¹å™¨çš„äº‹ä»¶æˆ–è€…ç¯å¢ƒå˜é‡çš„æ³¨å…¥æ—¶è¿˜æ˜¯éœ€è¦ä¾èµ– proxy æ¨¡å¼ã€‚ç„¶è€Œï¼Œ proxy æ¨¡å¼è¦æ±‚å•ç‹¬éƒ¨ç½² koord-runtime-proxy ç»„ä»¶æ¥ä»£ç† CRI (Container Runtime Interface) è¯·æ±‚, åŒæ—¶éœ€è¦æ›´æ”¹ Kubelet çš„å¯åŠ¨å‚æ•°å¹¶é‡å¯ Kubeletã€‚</p><p>NRIï¼ˆNode Resource Interfaceï¼‰ï¼Œå³èŠ‚ç‚¹èµ„æºæ¥å£ï¼Œæ˜¯ CRI å…¼å®¹çš„å®¹å™¨è¿è¡Œæ—¶æ’ä»¶æ‰©å±•çš„é€šç”¨æ¡†æ¶ï¼Œç‹¬ç«‹äºå…·ä½“çš„å®¹å™¨è¿è¡Œæ—¶ï¼ˆe.g. containerd, cri-oï¼‰, æä¾›ä¸åŒç”Ÿå‘½å‘¨æœŸäº‹ä»¶çš„æ¥å£ï¼Œå…è®¸ç”¨æˆ·åœ¨ä¸ä¿®æ”¹å®¹å™¨è¿è¡Œæ—¶æºä»£ç çš„æƒ…å†µä¸‹æ·»åŠ è‡ªå®šä¹‰é€»è¾‘ã€‚ç‰¹åˆ«çš„æ˜¯ï¼Œ2.0 ç‰ˆæœ¬ NRI åªéœ€è¦è¿è¡Œä¸€ä¸ªæ’ä»¶å®ä¾‹ç”¨äºå¤„ç†æ‰€æœ‰ NRI äº‹ä»¶å’Œè¯·æ±‚ï¼Œå®¹å™¨è¿è¡Œæ—¶é€šè¿‡ Unix-Domain Socket ä¸æ’ä»¶é€šä¿¡ï¼Œä½¿ç”¨åŸºäº Protobuf çš„åè®®æ•°æ®ï¼Œå’Œ 1.0 ç‰ˆæœ¬ NRI ç›¸æ¯”æ‹¥æœ‰æ›´é«˜çš„æ€§èƒ½ï¼Œèƒ½å¤Ÿå®ç°æœ‰çŠ¶æ€çš„ NRI æ’ä»¶ã€‚</p><p>é€šè¿‡ NRI çš„å¼•å…¥ï¼Œæ—¢èƒ½åŠæ—¶çš„è®¢é˜… Pod æˆ–è€…å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼Œåˆé¿å…äº†å¯¹ Kubelet çš„ä¾µå…¥ä¿®æ”¹ã€‚åœ¨ Koordinator v1.3.0 ä¸­ï¼Œæˆ‘ä»¬å¼•å…¥ NRI è¿™ç§ç¤¾åŒºæ¨èçš„æ–¹å¼æ¥ç®¡ç† runtime hooks æ¥è§£å†³ä¹‹å‰ç‰ˆæœ¬é‡åˆ°çš„é—®é¢˜ï¼Œå¤§å¤§æå‡äº† Koordinator éƒ¨ç½²çš„çµæ´»æ€§å’Œå¤„ç†çš„æ—¶æ•ˆæ€§ï¼Œæä¾›äº†ä¸€ç§ä¼˜é›…çš„äº‘åŸç”Ÿç³»ç»Ÿçš„èµ„æºç®¡ç†æ ‡å‡†åŒ–æ¨¡å¼ã€‚</p><p><img loading="lazy" alt="nri" src="/zh-Hans/assets/images/nri-proposal-472f1a1bde8c4bce268e6fce9c94b8b0.png" width="825" height="628" class="img_ev3q"></p><blockquote><p>æ³¨ï¼šNRI æ¨¡å¼ä¸æ”¯æŒ docker çš„å®¹å™¨è¿è¡Œæ—¶ï¼Œä½¿ç”¨ docker çš„ç”¨æˆ·è¯·ç»§ç»­ä½¿ç”¨ standalone æ¨¡å¼æˆ– proxy æ¨¡å¼ã€‚</p></blockquote><p>å…³äº Koordinator å¯ç”¨ NRI çš„éƒ¨ç½²æ–¹å¼ï¼Œè¯·è§<a href="/zh-Hans/docs/installation#enable-nri-mode-resource-management">Installation - Enable NRI Mode Resource Management</a>ã€‚</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="èŠ‚ç‚¹ç”»åƒå’Œ-mid-èµ„æºè¶…å–">èŠ‚ç‚¹ç”»åƒå’Œ Mid èµ„æºè¶…å–<a href="#èŠ‚ç‚¹ç”»åƒå’Œ-mid-èµ„æºè¶…å–" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>Koordinator ä¸­å°†èŠ‚ç‚¹èµ„æºåˆ†ä¸º4ç§èµ„æºä¼˜å…ˆçº§æ¨¡å‹ Prodã€Midã€Batch å’Œ Freeï¼Œä½ä¼˜å…ˆçº§èµ„æºå¯ä»¥å¤ç”¨é«˜ä¼˜å…ˆçº§å·²åˆ†é…ä½†æœªä½¿ç”¨çš„ç‰©ç†èµ„æºï¼Œä»¥æå‡ç‰©ç†èµ„æºåˆ©ç”¨ç‡ï¼›åŒæ—¶ï¼Œèµ„æºä¼˜å…ˆçº§è¶Šé«˜ï¼Œæä¾›çš„èµ„æºä¹Ÿè¶Šç¨³å®šï¼Œä¾‹å¦‚ Batch èµ„æºé‡‡ç”¨é«˜ä¼˜å…ˆçº§èµ„æºçŸ­æœŸï¼ˆshort-termï¼‰å·²åˆ†é…ä½†æœªä½¿ç”¨çš„è¶…å–èµ„æºï¼Œè€Œ Mid èµ„æºé‡‡ç”¨é«˜ä¼˜å…ˆçº§èµ„æºé•¿å‘¨æœŸï¼ˆlong-termï¼‰å·²åˆ†é…ä½†æœªä½¿ç”¨çš„è¶…å–èµ„æºã€‚ä¸åŒèµ„æºä¼˜å…ˆçº§æ¨¡å‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img loading="lazy" alt="resource-priority-model" src="/zh-Hans/assets/images/resource-model-0f6ca53f0a140a2be9705e75758caf22.png" width="1058" height="353" class="img_ev3q"></p><p>Koordinator v1.3.0 æ–°å¢äº†èŠ‚ç‚¹ç”»åƒèƒ½åŠ›ï¼ŒåŸºäº Prod çš„å†å²èµ„æºç”¨é‡è¿›è¡Œå³°å€¼é¢„æµ‹ï¼Œä»¥æ”¯æŒ Mid-tier çš„èµ„æºè¶…å–è°ƒåº¦ã€‚Mid èµ„æºçš„è¶…å–è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">MidAllocatable := min(ProdReclaimable, NodeAllocatable * thresholdRatio)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ProdReclaimable := max(0, ProdAllocated - ProdPeak * (1 + safeMargin))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><code>ProdPeak</code>ï¼šé€šè¿‡èŠ‚ç‚¹ç”»åƒï¼Œé¢„ä¼°çš„èŠ‚ç‚¹ä¸Šå·²è°ƒåº¦ Prod Pod åœ¨ä¸­é•¿å‘¨æœŸå†…ï¼ˆe.g. 12hï¼‰çš„ç”¨é‡å³°å€¼ã€‚</li><li><code>ProdReclaimable</code>ï¼šåŸºäºèŠ‚ç‚¹ç”»åƒç»“æœï¼Œé¢„ä¼°åœ¨ä¸­é•¿å‘¨æœŸå†…å¯å¤ç”¨çš„ Prod èµ„æºã€‚</li><li><code>MidAllocatable</code>ï¼šèŠ‚ç‚¹ä¸Šå¯åˆ†é…çš„ Mid èµ„æºã€‚</li></ul><p>æ­¤å¤–ï¼ŒMid èµ„æºçš„å•æœºéš”ç¦»ä¿éšœå°†åœ¨ä¸‹ä¸ªç‰ˆæœ¬å¾—åˆ°å®Œå–„ï¼Œç›¸å…³åŠ¨æ€æ•¬è¯·å…³æ³¨<a href="https://github.com/koordinator-sh/koordinator/issues/1442" target="_blank" rel="noopener noreferrer">Issue #1442</a>ã€‚
åœ¨ v1.3.0 ç‰ˆæœ¬ä¸­ï¼Œç”¨æˆ·å¯ä»¥æŸ¥çœ‹å’Œæäº¤ Mid-tier çš„è¶…å–èµ„æºï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä»¥ä¸‹ Prometheus metrics æ¥è§‚æµ‹èŠ‚ç‚¹ç”»åƒçš„è¶‹åŠ¿å˜åŒ–ã€‚</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># æŸ¥çœ‹èŠ‚ç‚¹çš„CPUèµ„æºç”»åƒï¼ŒreclaimableæŒ‡æ ‡è¡¨ç¤ºé¢„æµ‹çš„å¯å›æ”¶èµ„æºé‡ï¼Œpredictorå¯¹åº”ä¸åŒçš„é¢„æµ‹æ¨¡å‹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">koordlet_node_predicted_resource_reclaimable</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">node</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;test-node&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">predictor</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;minPredictor&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">resource</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;cpu&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">unit</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;core&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># æŸ¥çœ‹èŠ‚ç‚¹çš„å†…å­˜èµ„æºç”»åƒï¼ŒreclaimableæŒ‡æ ‡è¡¨ç¤ºé¢„æµ‹çš„å¯å›æ”¶èµ„æºé‡ï¼Œpredictorå¯¹åº”ä¸åŒçš„é¢„æµ‹æ¨¡å‹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">koordlet_node_predicted_resource_reclaimable</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">node</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;test-node&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">predictor</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;minPredictor&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">resource</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;memory&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">unit</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;byte&quot;</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get </span><span class="token function" style="color:#d73a49">node</span><span class="token plain"> test-node -o yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: test-node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">status:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  allocatable:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cpu: </span><span class="token string" style="color:#e3116c">&#x27;32&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    memory: 129636240Ki</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pods: </span><span class="token string" style="color:#e3116c">&#x27;110&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kubernetes.io/mid-cpu: </span><span class="token string" style="color:#e3116c">&#x27;16000&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># allocatable cpu milli-cores for Mid-tier pods</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kubernetes.io/mid-memory: 64818120Ki </span><span class="token comment" style="color:#999988;font-style:italic"># allocatable memory bytes for Mid-tier pods</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  capacity:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cpu: </span><span class="token string" style="color:#e3116c">&#x27;32&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    memory: 129636240Ki</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pods: </span><span class="token string" style="color:#e3116c">&#x27;110&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kubernetes.io/mid-cpu: </span><span class="token string" style="color:#e3116c">&#x27;16000&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kubernetes.io/mid-memory: 64818120Ki</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å…³äº Koordinator èŠ‚ç‚¹ç”»åƒçš„è®¾è®¡ï¼Œè¯¦è§<a href="/zh-Hans/docs/designs/node-prediction">Design - Node Prediction</a>ã€‚</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="å…¶ä»–åŠŸèƒ½">å…¶ä»–åŠŸèƒ½<a href="#å…¶ä»–åŠŸèƒ½" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>é€šè¿‡ <a href="https://github.com/koordinator-sh/koordinator/releases/tag/v1.3.0" target="_blank" rel="noopener noreferrer">v1.3.0 Release</a> é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°æ›´å¤šåŒ…å«åœ¨ v1.3.0 ç‰ˆæœ¬çš„æ–°å¢åŠŸèƒ½ã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="æœªæ¥è®¡åˆ’">æœªæ¥è®¡åˆ’<a href="#æœªæ¥è®¡åˆ’" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>åœ¨æ¥ä¸‹æ¥çš„ç‰ˆæœ¬ä¸­ï¼ŒKoordinator ç›®å‰è§„åˆ’äº†ä»¥ä¸‹åŠŸèƒ½ï¼š</p><ul><li>ç¡¬ä»¶æ‹“æ‰‘æ„ŸçŸ¥è°ƒåº¦ï¼Œç»¼åˆè€ƒè™‘èŠ‚ç‚¹ CPUã€å†…å­˜ã€GPU ç­‰å¤šä¸ªèµ„æºç»´åº¦çš„æ‹“æ‰‘å…³ç³»ï¼Œåœ¨é›†ç¾¤èŒƒå›´å†…è¿›è¡Œè°ƒåº¦ä¼˜åŒ–ã€‚</li><li>æä¾›èŠ‚ç‚¹å¯åˆ†é…èµ„æºçš„æ”¾å¤§æœºåˆ¶ã€‚</li><li>NRI èµ„æºç®¡ç†æ¨¡å¼çš„å®Œå–„å’Œå¢å¼ºã€‚</li></ul><p>æ›´å¤šä¿¡æ¯ï¼Œæ•¬è¯·å…³æ³¨ <a href="https://github.com/koordinator-sh/koordinator/milestone/12" target="_blank" rel="noopener noreferrer">Milestone v1.4.0</a>ã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ç»“è¯­">ç»“è¯­<a href="#ç»“è¯­" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>æœ€åï¼ŒKoordinator æ˜¯ä¸€ä¸ªå¼€æ”¾çš„ç¤¾åŒºï¼Œæ¬¢è¿å¹¿å¤§äº‘åŸç”Ÿçˆ±å¥½è€…ä»¬éšæ—¶é€šè¿‡å„ç§æ–¹å¼å‚ä¸å…±å»ºï¼Œæ— è®ºæ‚¨åœ¨äº‘åŸç”Ÿé¢†åŸŸæ˜¯åˆå­¦ä¹åˆ°è¿˜æ˜¯é©¾è½»å°±ç†Ÿï¼Œæˆ‘ä»¬éƒ½éå¸¸æœŸå¾…å¬åˆ°æ‚¨çš„å£°éŸ³ï¼</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>æ ‡ç­¾ï¼š</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/zh-Hans/blog/tags/release">release</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/zh-Hans/blog/release-v1.2.0">Koordinator v1.2: æ”¯æŒèŠ‚ç‚¹èµ„æºé¢„ç•™ï¼Œå…¼å®¹ç¤¾åŒºé‡è°ƒåº¦ç­–ç•¥</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-04-07T00:00:00.000Z" itemprop="datePublished">2023å¹´4æœˆ7æ—¥</time> Â· <!-- -->13 åˆ†é’Ÿé˜…è¯»</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/zwzhang0107" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/zwzhang0107.png" alt="Zuowei Zhang"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/zwzhang0107" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Zuowei Zhang</span></a></div><small class="avatar__subtitle" itemprop="description">Koordinator maintainer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="èƒŒæ™¯">èƒŒæ™¯<a href="#èƒŒæ™¯" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>Koordinator æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼ŒåŸºäºé˜¿é‡Œå·´å·´åœ¨å®¹å™¨è°ƒåº¦é¢†åŸŸå¤šå¹´ç´¯ç§¯çš„ç»éªŒå­µåŒ–è¯ç”Ÿï¼Œå¯ä»¥æå‡å®¹å™¨æ€§èƒ½ï¼Œé™ä½é›†ç¾¤èµ„æºæˆæœ¬ã€‚é€šè¿‡æ··éƒ¨ã€èµ„æºç”»åƒã€è°ƒåº¦ä¼˜åŒ–ç­‰æŠ€æœ¯èƒ½åŠ›ï¼Œ
èƒ½å¤Ÿæé«˜å»¶è¿Ÿæ•æ„Ÿçš„å·¥ä½œè´Ÿè½½å’Œæ‰¹å¤„ç†ä½œä¸šçš„è¿è¡Œæ•ˆç‡å’Œå¯é æ€§ï¼Œä¼˜åŒ–é›†ç¾¤èµ„æºä½¿ç”¨æ•ˆç‡ã€‚</p><p>ä» 2022 å¹´ 4 æœˆå‘å¸ƒä»¥æ¥ï¼ŒKoordinator è¿„ä»Šä¸€å…±è¿­ä»£å‘å¸ƒäº† 10 ä¸ªç‰ˆæœ¬ï¼Œå¸å¼•äº†äº†åŒ…æ‹¬é˜¿é‡Œå·´å·´ã€å°ç±³ã€å°çº¢ä¹¦ã€çˆ±å¥‡è‰ºã€360ã€æœ‰èµ ç­‰åœ¨å†…çš„å¤§é‡ä¼˜ç§€å·¥ç¨‹å¸ˆå‚ä¸è´¡çŒ®ã€‚
éšç€2023å¹´æ˜¥å¤©çš„æ¥ä¸´ï¼ŒKoordinatorä¹Ÿè¿æ¥äº†å®ƒçš„ä¸€å‘¨å¹´è¯è¾°ï¼Œåœ¨æ­¤æˆ‘ä»¬å¾ˆé«˜å…´çš„å‘å¤§å®¶å®£å¸ƒï¼ŒKoordinator v1.2ç‰ˆæœ¬æ­£å¼å‘å¸ƒã€‚æ–°ç‰ˆæœ¬ä¸­Koordinatoræ”¯æŒäº†èŠ‚ç‚¹èµ„æºé¢„ç•™åŠŸèƒ½ï¼Œ
å¹¶å…¼å®¹äº†K8sç¤¾åŒºçš„é‡è°ƒåº¦ç­–ç•¥ï¼ŒåŒæ—¶åœ¨å•æœºä¾§å¢åŠ äº†å¯¹AMDç¯å¢ƒL3 Cacheå’Œå†…å­˜å¸¦å®½éš”ç¦»çš„æ”¯æŒã€‚</p><p>åœ¨æ–°ç‰ˆæœ¬ä¸­ï¼Œå…±æœ‰12ä½æ–°åŠ å…¥çš„å¼€å‘è€…å‚ä¸åˆ°äº†Koordiantorç¤¾åŒºçš„å»ºè®¾ï¼Œä»–ä»¬æ˜¯@Re-Grhï¼Œ@chengweiv5ï¼Œ@kingeasternsunï¼Œ@shelwinnnï¼Œ@yuexian1234ï¼Œ@Syulin7ï¼Œ@tzzcfrank
@Dengerweiï¼Œ@comploneï¼Œ@AlbeeSoï¼Œ@xigangï¼Œ@leason00ï¼Œæ„Ÿè°¢ä»¥ä¸Šå¼€å‘è€…çš„è´¡çŒ®å’Œå‚ä¸ã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ç‰ˆæœ¬åŠŸèƒ½ç‰¹æ€§è§£è¯»">ç‰ˆæœ¬åŠŸèƒ½ç‰¹æ€§è§£è¯»<a href="#ç‰ˆæœ¬åŠŸèƒ½ç‰¹æ€§è§£è¯»" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="èŠ‚ç‚¹èµ„æºé¢„ç•™">èŠ‚ç‚¹èµ„æºé¢„ç•™<a href="#èŠ‚ç‚¹èµ„æºé¢„ç•™" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>æ··éƒ¨åœºæ™¯ä¸­åŒ…å«çš„åº”ç”¨å½¢æ€å¤šç§å¤šæ ·ï¼Œé™¤äº†å·²ç»å®Œæˆäº‘åŸç”ŸåŒ–çš„å®¹å™¨ï¼Œè¿˜åŒ…å«å¾ˆå¤šå°šæœªå®Œæˆå®¹å™¨åŒ–çš„åº”ç”¨ï¼Œè¿™éƒ¨åˆ†åº”ç”¨ä¼šä»¥è¿›ç¨‹çš„å½¢å¼åœ¨å®¿ä¸»æœºä¸Šä¸K8så®¹å™¨å…±åŒè¿è¡Œã€‚
ä¸ºäº†å‡å°‘K8såº”ç”¨å’Œå…¶ä»–ç±»å‹åº”ç”¨åœ¨èŠ‚ç‚¹ä¾§çš„èµ„æºç«äº‰ï¼ŒKoordinator æ”¯æŒå°†ä¸€éƒ¨åˆ†èµ„æºé¢„ç•™ï¼Œä½¿å…¶æ—¢ä¸å‚ä¸è°ƒåº¦å™¨çš„èµ„æºè°ƒåº¦ï¼Œä¹Ÿä¸å‚ä¸èŠ‚ç‚¹ä¾§çš„èµ„æºåˆ†é…ï¼Œè¾¾åˆ°èµ„æºåˆ†éš”ä½¿ç”¨çš„æ•ˆæœã€‚
åœ¨v1.2ç‰ˆæœ¬ä¸­ï¼ŒKoordiantorå·²ç»æ”¯æŒCPUå’Œå†…å­˜èµ„æºç»´åº¦çš„é¢„ç•™ï¼Œå¹¶å…è®¸ç›´æ¥æŒ‡å®šé¢„ç•™çš„CPUç¼–å·ï¼Œå…·ä½“å¦‚ä¸‹ã€‚</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="èŠ‚ç‚¹èµ„æºé¢„ç•™å£°æ˜">èŠ‚ç‚¹èµ„æºé¢„ç•™å£°æ˜<a href="#èŠ‚ç‚¹èµ„æºé¢„ç•™å£°æ˜" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>åœ¨Nodeä¸Šå¯ä»¥é…ç½®éœ€è¦é¢„ç•™çš„èµ„æºé‡æˆ–å…·ä½“çš„CPUç¼–å·ï¼Œä¸¾ä¾‹å¦‚ä¸‹ï¼š</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> fake</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># specific 5 cores will be calculated, e.g. 0, 1, 2, 3, 4, and then those core will be reserved.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">node.koordinator.sh/reservation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;{&quot;resources&quot;:{&quot;cpu&quot;:&quot;5&quot;}}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> fake</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># the cores 0, 1, 2, 3 will be reserved.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">node.koordinator.sh/reservation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;{&quot;reservedCPUs&quot;:&quot;0-3&quot;}&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å•æœºç»„ä»¶Koordletåœ¨ä¸ŠæŠ¥èŠ‚ç‚¹èµ„æºæ‹“æ‰‘ä¿¡æ¯æ—¶ï¼Œä¼šå°†å…·ä½“é¢„ç•™çš„CPUç¼–å·æ›´æ–°åˆ°NodeResourceTopologyå¯¹è±¡çš„Annotationä¸­ã€‚</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="è°ƒåº¦åŠé‡è°ƒåº¦åœºæ™¯é€‚é…">è°ƒåº¦åŠé‡è°ƒåº¦åœºæ™¯é€‚é…<a href="#è°ƒåº¦åŠé‡è°ƒåº¦åœºæ™¯é€‚é…" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>è°ƒåº¦å™¨åœ¨åˆ†é…èµ„æºçš„è¿‡ç¨‹ä¸­ï¼Œæ¶‰åŠäº†å¤šç§æƒ…å†µçš„èµ„æºæ ¡éªŒï¼ŒåŒ…æ‹¬Quotaç®¡ç†ï¼ŒèŠ‚ç‚¹å®¹é‡æ ¡éªŒï¼ŒCPUæ‹“æ‰‘æ ¡éªŒç­‰ç­‰ï¼Œè¿™äº›åœºæ™¯éƒ½éœ€è¦å¢åŠ å¯¹èŠ‚ç‚¹é¢„ç•™èµ„æºçš„è€ƒè™‘ï¼Œä¾‹å¦‚ï¼Œè°ƒåº¦å™¨åœ¨è®¡ç®—èŠ‚ç‚¹CPUå®¹é‡æ—¶ï¼Œéœ€è¦å°†èŠ‚ç‚¹é¢„ç•™çš„èµ„æºè¿›è¡Œæ‰£é™¤ã€‚</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cpus(alloc) = cpus(total) - cpus(allocated) - cpus(kubeletReserved) - cpus(nodeAnnoReserved)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ­¤å¤–ï¼Œå¯¹äºBatchæ··éƒ¨è¶…å–èµ„æºçš„è®¡ç®—åŒæ ·éœ€è¦å°†è¿™éƒ¨åˆ†èµ„æºæ‰£é™¤ï¼Œè€Œè€ƒè™‘åˆ°èŠ‚ç‚¹ä¸­è¿˜åŒ…æ‹¬ä¸€éƒ¨åˆ†ç³»ç»Ÿè¿›ç¨‹çš„èµ„æºæ¶ˆè€—ï¼ŒKoord-Manageråœ¨è®¡ç®—æ—¶ä¼šå–èŠ‚ç‚¹é¢„ç•™å’Œç³»ç»Ÿç”¨é‡çš„æœ€å¤§å€¼ï¼Œå…·ä½“ä¸ºï¼š</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">reserveRatio = (100-thresholdPercent) / 100.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node.reserved = node.alloc * reserveRatio</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">system.used = max(node.used - pod.used, node.anno.reserved)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Node(BE).Alloc = Node.Alloc - Node.Reserved - System.Used - Pod(LS).Used</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å¯¹äºé‡è°ƒåº¦ï¼Œå„æ’ä»¶ç­–ç•¥éœ€è¦åœ¨èŠ‚ç‚¹å®¹é‡ã€åˆ©ç”¨ç‡è®¡ç®—ç­‰åœºæ™¯æ„ŸçŸ¥èŠ‚ç‚¹é¢„ç•™èµ„æºé‡ï¼Œæ­¤å¤–ï¼Œè‹¥å·²ç»æœ‰å®¹å™¨å ç”¨äº†èŠ‚ç‚¹çš„é¢„ç•™èµ„æºï¼Œé‡è°ƒåº¦éœ€è¦è€ƒè™‘å°†å…¶è¿›è¡Œé©±é€ï¼Œç¡®ä¿èŠ‚ç‚¹å®¹é‡å¾—åˆ°æ­£ç¡®ç®¡ç†ï¼Œ
é¿å…èµ„æºç«äº‰ã€‚è¿™éƒ¨åˆ†é‡è°ƒåº¦ç›¸å…³çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å°†åœ¨åç»­ç‰ˆæœ¬è¿›è¡Œæ”¯æŒï¼Œä¹Ÿæ¬¢è¿å¹¿å¤§çˆ±å¥½è€…ä»¬ä¸€èµ·å‚ä¸å…±å»ºã€‚</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="å•æœºèµ„æºç®¡ç†">å•æœºèµ„æºç®¡ç†<a href="#å•æœºèµ„æºç®¡ç†" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>å¯¹äºLSç±»å‹çš„Podï¼Œå•æœºKoordletç»„ä»¶ä¼šæ ¹æ®CPUåˆ†é…æƒ…å†µåŠ¨æ€è®¡ç®—å…±äº«CPUæ± ï¼Œå¯¹äºèŠ‚ç‚¹é¢„ç•™çš„CPUæ ¸å¿ƒä¼šå°†å…¶æ’é™¤åœ¨å¤–ï¼Œç¡®ä¿LSç±»å‹podå’Œå…¶ä»–éå®¹å™¨åŒ–çš„è¿›ç¨‹èµ„æºéš”ç¦»ã€‚
åŒæ—¶ï¼Œå¯¹äºå•æœºç›¸å…³çš„QoSç­–ç•¥ï¼Œä¾‹å¦‚CPUSuppresså‹åˆ¶ç­–ç•¥åœ¨è®¡ç®—èŠ‚ç‚¹åˆ©ç”¨ç‡æ—¶ï¼Œä¼šå°†é¢„ç•™èµ„æºé‡è€ƒè™‘åœ¨å†…ã€‚</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">suppress(BE) := node.Total * SLOPercent - pod(LS).Used - max(system.Used, node.anno.reserved)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å…³äºèŠ‚ç‚¹èµ„æºé¢„ç•™åŠŸèƒ½çš„è¯¦ç»†è¯´æ˜ï¼Œå¯ä»¥å‚è€ƒ <a href="https://github.com/koordinator-sh/koordinator/blob/main/docs/proposals/scheduling/20221227-node-resource-reservation.md" target="_blank" rel="noopener noreferrer">è®¾è®¡æ–‡æ¡£</a> ä¸­çš„ä»‹ç»ã€‚</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="å…¼å®¹ç¤¾åŒºé‡è°ƒåº¦ç­–ç•¥">å…¼å®¹ç¤¾åŒºé‡è°ƒåº¦ç­–ç•¥<a href="#å…¼å®¹ç¤¾åŒºé‡è°ƒåº¦ç­–ç•¥" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>å¾—ç›Šäº Koordinator Descheduler çš„æ¡†æ¶æ—¥ç›Šæˆç†Ÿï¼Œåœ¨ Koordinator v1.2 ç‰ˆæœ¬ä¸­ï¼Œé€šè¿‡å¼•å…¥ä¸€ç§æ¥å£é€‚é…æœºåˆ¶ï¼Œå¯ä»¥æ— ç¼çš„å¯¹ Kubernetes Desceheduler å·²æœ‰æ’ä»¶è¿›è¡Œå…¼å®¹ï¼Œåœ¨ä½¿ç”¨æ—¶æ‚¨åªéœ€éƒ¨ç½² Koordinator Descheduler å³å¯ä½¿ç”¨åˆ°ä¸Šæ¸¸çš„å…¨éƒ¨åŠŸèƒ½ã€‚</p><p>åœ¨å®ç°ä¸Šï¼ŒKoordinator Descheduler é€šè¿‡ import ä¸Šæ¸¸ä»£ç ä¸åšä»»ä½•ä¾µå…¥å¼çš„æ”¹åŠ¨ï¼Œä¿è¯å®Œå…¨å…¼å®¹ä¸Šæ¸¸æ‰€æœ‰çš„æ’ä»¶ã€å‚æ•°é…ç½®ä»¥åŠå…¶è¿è¡Œç­–ç•¥ã€‚åŒæ—¶ï¼ŒKoordinator å…è®¸ç”¨æˆ·ä¸ºä¸Šæ¸¸æ’ä»¶æŒ‡å®šå¢å¼ºçš„ evictorï¼Œä»è€Œå¤ç”¨ Koordinator æä¾›çš„èµ„æºé¢„ç•™ã€å·¥ä½œè´Ÿè½½å¯ç”¨æ€§ä¿éšœä»¥åŠå…¨å±€æµæ§ç­‰å®‰å…¨æ€§ç­–ç•¥ã€‚</p><p>å…¼å®¹çš„æ’ä»¶åˆ—è¡¨åŒ…æ‹¬ï¼š</p><ul><li>HighNodeUtilization</li><li>LowNodeUtilization</li><li>PodLifeTime</li><li>RemoveFailedPods</li><li>RemoveDuplicates</li><li>RemovePodsHavingTooManyRestarts</li><li>RemovePodsViolatingInterPodAntiAffinity</li><li>RemovePodsViolatingNodeAffinity</li><li>RemovePodsViolatingNodeTaints</li><li>RemovePodsViolatingTopologySpreadConstraint</li><li>DefaultEvictor</li></ul><p>åœ¨ä½¿ç”¨æ—¶ï¼Œå¯ä»¥å‚è€ƒå¦‚ä¸‹çš„æ–¹å¼é…ç½®ï¼Œä»¥ RemovePodsHavingTooManyRestarts ä¸ºä¾‹ï¼š</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> descheduler/v1alpha2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> DeschedulerConfiguration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">clientConnection</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">kubeconfig</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/Users/joseph/asi/koord-2/admin.kubeconfig&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">leaderElection</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">leaderElect</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">resourceName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> test</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">descheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">resourceNamespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kube</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">deschedulingInterval</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">dryRun</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">profiles</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> koord</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">descheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">plugins</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">evict</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> MigrationController</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token key atrule" style="color:#00a4db">deschedule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> RemovePodsHavingTooManyRestarts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">pluginConfig</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> RemovePodsHavingTooManyRestarts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">args</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> descheduler/v1alpha2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> RemovePodsHavingTooManyRestartsArgs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">podRestartThreshold</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="èµ„æºé¢„ç•™è°ƒåº¦èƒ½åŠ›å¢å¼º">èµ„æºé¢„ç•™è°ƒåº¦èƒ½åŠ›å¢å¼º<a href="#èµ„æºé¢„ç•™è°ƒåº¦èƒ½åŠ›å¢å¼º" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>Koordinator åœ¨æ¯”è¾ƒæ—©æœŸçš„ç‰ˆæœ¬ä¸­å¼•å…¥äº† Reservation æœºåˆ¶ï¼Œé€šè¿‡é¢„ç•™èµ„æºå¹¶å¤ç”¨ç»™æŒ‡å®šç‰¹å¾çš„ Pod ä½¿ç”¨ï¼Œç”¨äºå¸®åŠ©è§£å†³èµ„æºäº¤ä»˜ç¡®å®šæ€§é—®é¢˜ã€‚
ä¾‹å¦‚é‡è°ƒåº¦åœºæ™¯ä¸­æœŸæœ›è¢«é©±é€çš„ Pod ä¸€å®šæœ‰èµ„æºå¯ä»¥ä½¿ç”¨ï¼Œè€Œä¸æ˜¯è¢«é©±é€åæ— èµ„æºå¯ç”¨å¯¼è‡´å¼•èµ·ç¨³å®šæ€§é—®é¢˜ï¼›åˆæˆ–è€…éœ€è¦æ‰©å®¹æ—¶ï¼Œ
ä¸€äº› PaaS å¹³å°å¸Œæœ›èƒ½å¤Ÿå…ˆç¡®å®šæ˜¯å¦æ»¡è¶³åº”ç”¨è°ƒåº¦ç¼–æ’çš„èµ„æºï¼Œå†å†³å®šæ˜¯å¦æ‰©å®¹ï¼Œæˆ–è€…æå‰åšä¸€äº›é¢„å¤‡å·¥ä½œç­‰ã€‚</p><p>Koordinator Reservation é€šè¿‡ CRD å®šä¹‰ï¼Œæ¯ä¸ª Reservation å¯¹è±¡ä¼šåœ¨ koord-scheduler å†…ä¼ªé€ æˆä¸€ä¸ª Pod è¿›è¡Œè°ƒåº¦ï¼Œ
è¿™æ ·çš„ Pod æˆ‘ä»¬ç§°ä¸º Reserve PodReserve Pod å°±å¯ä»¥å¤ç”¨å·²æœ‰çš„è°ƒåº¦æ’ä»¶å’Œæ‰“åˆ†æ’ä»¶æ‰¾åˆ°åˆé€‚çš„èŠ‚ç‚¹ï¼Œå¹¶æœ€ç»ˆåœ¨è°ƒåº¦å™¨å†…éƒ¨çŠ¶æ€ä¸­å æ®å¯¹åº”çš„èµ„æºã€‚
Reservation åœ¨åˆ›å»ºæ—¶éƒ½ä¼šæŒ‡å®šé¢„ç•™çš„èµ„æºå°†æ¥è¦ç»™å“ªäº› Pod ä½¿ç”¨ï¼Œå¯ä»¥æŒ‡å®šå…·ä½“æŸä¸ª Podï¼Œä¹Ÿå¯ä»¥æŒ‡å®šæŸäº› workload å¯¹è±¡ï¼Œæˆ–è€…å…·å¤‡æŸäº›æ ‡ç­¾çš„ Pod ä½¿ç”¨ã€‚
å½“è¿™äº› Pod é€šè¿‡ koord-scheduler è°ƒåº¦æ—¶ï¼Œè°ƒåº¦å™¨ä¼šæ‰¾åˆ°å¯ä»¥è¢«è¯¥ Pod ä½¿ç”¨çš„ Reservation å¯¹è±¡ï¼Œå¹¶ä¸”ä¼˜å…ˆä½¿ç”¨ Reservation çš„èµ„æºã€‚
å¹¶ä¸” Reservation Status ä¸­ä¼šè®°å½•è¢«å“ªä¸ª Pod ä½¿ç”¨ï¼Œä»¥åŠ Pod Annotations ä¸­ä¹Ÿä¼šè®°å½•ä½¿ç”¨äº†å“ªä¸ª Reservationã€‚
Reservation è¢«ä½¿ç”¨åï¼Œä¼šè‡ªåŠ¨çš„æ¸…ç†å†…éƒ¨çŠ¶æ€ï¼Œç¡®ä¿å…¶ä»– Pod ä¸ä¼šå› ä¸º Reservation å¯¼è‡´æ— æ³•è°ƒåº¦ã€‚</p><p>åœ¨ Koordinator v1.2 ä¸­ï¼Œæˆ‘ä»¬åšäº†å¤§å¹…åº¦çš„ä¼˜åŒ–ã€‚é¦–å…ˆæˆ‘ä»¬æ”¾å¼€äº†åªèƒ½ä½¿ç”¨ Reservation æŒæœ‰çš„èµ„æºçš„é™åˆ¶ï¼Œå…è®¸è·¨å‡º Reservation çš„èµ„æºè¾¹ç•Œï¼Œ
æ—¢å¯ä»¥ä½¿ç”¨ Reservation é¢„ç•™çš„èµ„æºï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨èŠ‚ç‚¹ä¸Šå‰©ä½™çš„èµ„æºã€‚è€Œä¸”æˆ‘ä»¬é€šè¿‡éä¾µå…¥å¼çš„æ–¹å¼æ‰©å±•äº† Kubernetes Scheduler Frameworkï¼Œ
æ”¯æŒé¢„ç•™ç²¾ç»†åŒ–èµ„æºï¼Œå³å¯ä»¥é¢„ç•™ CPU æ ¸å’Œ GPU è®¾å¤‡ç­‰ã€‚æˆ‘ä»¬ä¹Ÿä¿®æ”¹äº† Reservation å¯ä»¥è¢«é‡å¤ä½¿ç”¨çš„é»˜è®¤è¡Œä¸ºï¼Œæ”¹ä¸º AllocateOnceï¼Œ
å³ Reservation ä¸€æ—¦è¢«æŸä¸ª Pod ä½¿ç”¨ï¼Œè¯¥ Reservation ä¼šè¢«åºŸå¼ƒã€‚è¿™æ ·çš„æ”¹åŠ¨æ˜¯è€ƒè™‘åˆ°ï¼ŒAllocateOnce æ›´èƒ½è¦†ç›–å¤§éƒ¨åˆ†åœºæ™¯ï¼Œè¿™æ ·ä½œä¸ºé»˜è®¤è¡Œä¸ºï¼Œå¤§å®¶åœ¨ä½¿ç”¨æ—¶ä¼šæ›´ç®€å•ã€‚</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="æ”¯æŒamdç¯å¢ƒä¸‹çš„l3-cacheå’Œå†…å­˜å¸¦å®½éš”ç¦»">æ”¯æŒAMDç¯å¢ƒä¸‹çš„L3 Cacheå’Œå†…å­˜å¸¦å®½éš”ç¦»<a href="#æ”¯æŒamdç¯å¢ƒä¸‹çš„l3-cacheå’Œå†…å­˜å¸¦å®½éš”ç¦»" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>åœ¨v0.3.0ç‰ˆæœ¬ä¸­ï¼ŒKoordiantorå·²ç»æ”¯æŒäº†Intelç¯å¢ƒçš„L3 Cacheå’Œå†…å­˜å¸¦å®½éš”ç¦»ï¼Œåœ¨æœ€æ–°çš„1.2.0ç‰ˆæœ¬ä¸­æˆ‘ä»¬æ–°å¢äº†å¯¹AMDç¯å¢ƒçš„æ”¯æŒã€‚
Linuxå†…æ ¸L3 Cacheå’Œå†…å­˜å¸¦å®½éš”ç¦»èƒ½åŠ›æä¾›äº†ç»Ÿä¸€çš„resctrlæ¥å£ï¼ŒåŒæ—¶æ”¯æŒIntelå’ŒAMDç¯å¢ƒï¼Œä¸»è¦åŒºåˆ«åœ¨äºï¼ŒIntelæä¾›çš„å†…å­˜å¸¦å®½éš”ç¦»æ¥å£ä¸ºç™¾åˆ†æ¯”æ ¼å¼ï¼Œ
è€ŒAMDæä¾›çš„å†…å­˜å¸¦å®½éš”ç¦»æ¥å£ä¸ºç»å¯¹å€¼æ ¼å¼ï¼Œå…·ä½“å¦‚ä¸‹ã€‚</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Intel Format</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># resctrl schema</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">L3:0=3ff;1=3ff</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MB:0=100;1=100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># AMD Format</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># resctrl schema</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">L3:0=ffff;1=ffff;2=ffff;3=ffff;4=ffff;5=ffff;6=ffff;7=ffff;8=ffff;9=ffff;10=ffff;11=ffff;12=ffff;13=ffff;14=ffff;15=ffff</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MB:0=2048;1=2048;2=2048;3=2048;4=2048;5=2048;6=2048;7=2048;8=2048;9=2048;10=2048;11=2048;12=2048;13=2048;14=2048;15=2048</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ¥å£æ ¼å¼åŒ…å«ä¸¤éƒ¨åˆ†ï¼ŒL3è¡¨ç¤ºå¯¹åº”çš„socketæˆ–CCDå¯ç”¨çš„â€œè·¯æ•°â€ï¼ˆwayï¼‰ï¼Œä»¥16è¿›åˆ¶çš„æ•°æ®æ ¼å¼è¡¨ç¤ºï¼Œæ¯ä¸ªæ¯”ç‰¹ä½è¡¨ç¤ºä¸€è·¯
MBè¡¨ç¤ºå¯¹åº”çš„socketæˆ–CCDå¯ä»¥ä½¿ç”¨çš„å†…å­˜å¸¦å®½èŒƒå›´ï¼ŒIntelå¯é€‰èŒƒå›´ä¸º0~100çš„ç™¾åˆ†æ¯”æ ¼å¼ï¼ŒAMDå¯¹åº”çš„ä¸ºç»å¯¹å€¼æ ¼å¼ï¼Œå•ä½ä¸ºGb/sï¼Œ2048è¡¨ç¤ºä¸é™åˆ¶ã€‚
Koordiantorç»Ÿä¸€æä¾›äº†ç™¾åˆ†æ¯”æ ¼å¼çš„æ¥å£ï¼Œå¹¶è‡ªåŠ¨æ„ŸçŸ¥èŠ‚ç‚¹ç¯å¢ƒæ˜¯å¦ä¸ºAMDï¼Œå†³å®šresctrlæ¥å£ä¸­å¡«å†™çš„æ ¼å¼ã€‚</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ConfigMap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> slo</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">controller</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> koordinator</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">resource-qos-config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">&quot;clusterStrategy&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">&quot;lsClass&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token key atrule" style="color:#00a4db">&quot;resctrlQOS&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token key atrule" style="color:#00a4db">&quot;enable&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token key atrule" style="color:#00a4db">&quot;catRangeStartPercent&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token key atrule" style="color:#00a4db">&quot;catRangeEndPercent&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token key atrule" style="color:#00a4db">&quot;MBAPercent&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">&quot;beClass&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token key atrule" style="color:#00a4db">&quot;resctrlQOS&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token key atrule" style="color:#00a4db">&quot;enable&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token key atrule" style="color:#00a4db">&quot;catRangeStartPercent&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token key atrule" style="color:#00a4db">&quot;catRangeEndPercent&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token key atrule" style="color:#00a4db">&quot;MBAPercent&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="å…¶ä»–åŠŸèƒ½">å…¶ä»–åŠŸèƒ½<a href="#å…¶ä»–åŠŸèƒ½" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>é€šè¿‡ <a href="https://github.com/koordinator-sh/koordinator/releases/tag/v1.2.0" target="_blank" rel="noopener noreferrer">v1.2 release</a> é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°æ›´å¤šç‰ˆæœ¬æ‰€åŒ…å«çš„æ–°å¢åŠŸèƒ½ã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="æœªæ¥è®¡åˆ’">æœªæ¥è®¡åˆ’<a href="#æœªæ¥è®¡åˆ’" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>åœ¨æ¥ä¸‹æ¥çš„ç‰ˆæœ¬ä¸­ï¼ŒKoordiantoré‡ç‚¹è§„åˆ’äº†ä»¥ä¸‹åŠŸèƒ½ï¼Œå…·ä½“åŒ…æ‹¬ï¼š</p><ul><li>ç¡¬ä»¶æ‹“æ‰‘æ„ŸçŸ¥è°ƒåº¦ï¼Œç»¼åˆè€ƒè™‘èŠ‚ç‚¹CPUã€å†…å­˜ã€GPUç­‰å¤šä¸ªèµ„æºç»´åº¦çš„æ‹“æ‰‘å…³ç³»ï¼Œåœ¨é›†ç¾¤èŒƒå›´å†…è¿›è¡Œè°ƒåº¦ä¼˜åŒ–ã€‚</li><li>å¯¹é‡è°ƒåº¦å™¨çš„å¯è§‚æµ‹æ€§å’Œå¯è¿½æº¯æ€§è¿›è¡Œå¢å¼ºã€‚</li><li>GPUèµ„æºè°ƒåº¦èƒ½åŠ›çš„å¢å¼ºã€‚</li></ul><p>Koordinator æ˜¯ä¸€ä¸ªå¼€æ”¾çš„ç¤¾åŒºï¼Œéå¸¸æ¬¢è¿å¹¿å¤§äº‘åŸç”Ÿçˆ±å¥½è€…ä»¬é€šè¿‡å„ç§æ–¹å¼ä¸€èµ·å‚ä¸å…±å»ºï¼Œæ— è®ºæ‚¨åœ¨äº‘åŸç”Ÿé¢†åŸŸæ˜¯åˆå­¦ä¹ç»ƒè¿˜æ˜¯é©¾è½»å°±ç†Ÿï¼Œæˆ‘ä»¬éƒ½éå¸¸æœŸå¾…å¬åˆ°æ‚¨çš„å£°éŸ³ï¼</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>æ ‡ç­¾ï¼š</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/zh-Hans/blog/tags/release">release</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/zh-Hans/blog/anolis-CPU-Co-location">é¾™èœ¥ plugsched ç¥å™¨åŠ©åŠ› Koordinator äº‘åŸç”Ÿå•æœºæ··éƒ¨â€”â€” å†…æ ¸ CPU QoS æ­ç§˜</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-02-28T02:59:03.000Z" itemprop="datePublished">2023å¹´2æœˆ28æ—¥</time> Â· <!-- -->10 åˆ†é’Ÿé˜…è¯»</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/Dengerwei" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/Dengerwei.png" alt="Erwei Deng"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/Dengerwei" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Erwei Deng</span></a></div><small class="avatar__subtitle" itemprop="description">Openanolis developer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ä»€ä¹ˆæ˜¯-cpu-æ··éƒ¨">ä»€ä¹ˆæ˜¯ CPU æ··éƒ¨<a href="#ä»€ä¹ˆæ˜¯-cpu-æ··éƒ¨" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>CPU æ··éƒ¨æ˜¯æŒ‡å°†ä¸åŒç±»å‹çš„ä¸šåŠ¡éƒ¨ç½²åˆ°åŒä¸€å°æœºå™¨ä¸Šè¿è¡Œï¼Œè®©å®ƒä»¬å…±äº«æœºå™¨ä¸Šçš„ CPU èµ„æºä»¥æå‡ CPU åˆ©ç”¨ç‡ï¼Œä»è€Œé™ä½æœºå™¨çš„é‡‡è´­å’Œè¿è¥æˆæœ¬ã€‚ä½†æ˜¯ï¼Œå¯¹äºæœ‰äº›ç±»å‹çš„ä»»åŠ¡æ¥è¯´ï¼Œå®ƒä»¬å¯¹å»¶æ—¶éå¸¸çš„æ•æ„Ÿï¼Œæ¯”å¦‚ç”µå•†ã€æœç´¢æˆ– web æœåŠ¡ç­‰ï¼Œè¿™ç±»ä»»åŠ¡çš„å®æ—¶æ€§å¾ˆé«˜ï¼Œä½†æ˜¯é€šå¸¸å¯¹èµ„æºçš„æ¶ˆè€—å´ä¸æ˜¯å¾ˆå¤šï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºåœ¨çº¿ä»»åŠ¡ï¼›è¿˜æœ‰ä¸€ç±»ä»»åŠ¡ï¼Œå®ƒä»¬æ›´å¤šçš„å…³æ³¨è®¡ç®—æˆ–è€…æ‰¹å¤„ç†ï¼Œå¯¹å»¶æ—¶æ²¡æœ‰è¦æ±‚ï¼Œä½†æ˜¯æ¶ˆè€—çš„èµ„æºç›¸å¯¹è¾ƒå¤šï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºç¦»çº¿ä»»åŠ¡ã€‚</p><p>å½“è¿™ä¸¤ç±»ä»»åŠ¡åŒæ—¶éƒ¨ç½²åˆ°åŒä¸€å°æœºå™¨ä¸Šæ—¶ï¼Œç”±äºç¦»çº¿ä»»åŠ¡å¯¹èµ„æºçš„å ç”¨è¾ƒå¤šï¼Œèµ„æºç«äº‰å¯¼è‡´åœ¨çº¿ä»»åŠ¡çš„å»¶æ—¶å—åˆ°äº†å¾ˆå¤§çš„å½±å“ï¼Œè€Œä¸”ï¼Œåœ¨è¶…çº¿ç¨‹æ¶æ„çš„æœºå™¨ä¸Šï¼Œå³ä½¿ç¦»çº¿ä»»åŠ¡å’Œåœ¨çº¿ä»»åŠ¡è·‘åœ¨ä¸åŒçš„è¶…çº¿ç¨‹ CPU ä¸Šï¼Œæµæ°´çº¿å’Œ cache çš„ç«äº‰ä¹Ÿä¼šå¯¼è‡´åœ¨çº¿ä»»åŠ¡çš„è¿è¡Œå—åˆ°å½±å“ã€‚äºæ˜¯ï¼ŒCPU æ··éƒ¨æŠ€æœ¯è¯ç”Ÿäº†ï¼Œæ¥è§£å†³ç¦»çº¿ä»»åŠ¡å¯¹åœ¨çº¿ä»»åŠ¡å»¶æ—¶çš„å½±å“ï¼ŒåŒæ—¶è¿˜èƒ½è¿›ä¸€æ­¥æå‡ CPU èµ„æºçš„åˆ©ç”¨ç‡ã€‚</p><p align="center"><img loading="lazy" src="https://user-images.githubusercontent.com/33253760/221129910-b68705ae-5906-4294-8bb0-e01d2a6ed849.png" class="img_ev3q"></p><p align="center">å›¾1 å•æœºæ··éƒ¨ CPU åˆ©ç”¨ç‡ç¤ºæ„å›¾</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="å†…æ ¸-cpu-æ··éƒ¨æŠ€æœ¯">å†…æ ¸ CPU æ··éƒ¨æŠ€æœ¯<a href="#å†…æ ¸-cpu-æ··éƒ¨æŠ€æœ¯" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>CPU æ··éƒ¨æŠ€æœ¯ï¼Œä¸»è¦æ˜¯é€šè¿‡å•æœºæ“ä½œç³»ç»Ÿè°ƒåº¦å™¨æ¥å®ç°çš„ï¼Œé€šè¿‡ä»»åŠ¡ç±»å‹æ¥å†³å®šæ‰€åˆ†é…åˆ°çš„ CPU èµ„æºã€‚Koordinator ç¤¾åŒºä¸»è¦ä½¿ç”¨çš„å•æœºæ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆæœ‰ Alibaba Cloud Linux 2/3ï¼ˆç®€ç§° Alinux2/3ï¼‰ å’Œ CentOS7.9ã€‚å¯¹äº Alinux2/3ï¼Œå®ƒä½¿ç”¨çš„æ˜¯é¾™èœ¥ç¤¾åŒºçš„ Group Identity CPU æ··éƒ¨æŠ€æœ¯ï¼Œåœ¨æ“ä½œç³»ç»Ÿå†…æ ¸ä¸­æä¾›äº† CPU æ··éƒ¨èƒ½åŠ›ã€‚Group Identity åœ¨åŸæœ‰çš„ CFS è°ƒåº¦å™¨ä¸­æ–°å¢äº†å¦ä¸€ä¸ªè¿è¡Œé˜Ÿåˆ—æ¥åŒºåˆ†åœ¨çº¿å’Œç¦»çº¿ä»»åŠ¡ï¼Œè€Œä¸”ï¼Œä¸ºäº†é¿å…å¯¹ç«¯ CPUï¼ˆè¶…çº¿ç¨‹æ¶æ„ï¼‰ä¸Šç¦»çº¿ä»»åŠ¡çš„å¹²æ‰°ï¼ŒGroup Identity ä¼šå¯¹å…¶è¿›è¡Œé©±é€ã€‚é¾™èœ¥çš„ Group Identity æŠ€æœ¯å·²ç»ç»è¿‡é˜¿é‡ŒåŒåä¸€ç­‰å¤§å‹æ´»åŠ¨ä»¥åŠå¤§è§„æ¨¡å•†ä¸šåŒ–çš„éªŒè¯ï¼Œå…¶ CPU æ··éƒ¨èƒ½åŠ›ä¹Ÿå¾—åˆ°å¹¿å¤§ç”¨æˆ·å’Œå¼€å‘è€…çš„è®¤å¯ã€‚</p><p>ä½†æ˜¯å¯¹äº CentOS å‘è¡Œç‰ˆæ¥è¯´ï¼Œåˆ°ç›®å‰ä¸ºæ­¢è¿˜æ²¡æœ‰æä¾›ä»»ä½• CPU æ··éƒ¨ç›¸å…³çš„æŠ€æœ¯å’Œèƒ½åŠ›ã€‚å¯¹äº CentOS CPU æ··éƒ¨èƒ½åŠ›çš„ç¼ºå¤±ï¼Œå¯èƒ½æœ‰ä»¥ä¸‹å‡ ç§è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>åˆ¶ä½œ CentOS çš„è¡ç”Ÿç‰ˆç³»ç»Ÿï¼Œå¹¶åŒ…å« CPU æ··éƒ¨æŠ€æœ¯ï¼›</li><li>è¿ç§»åˆ° Alibaba Cloud Linux 2/3 æ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆï¼›</li></ul><p>å¯¹äºç¬¬ä¸€ç§æ–¹æ¡ˆï¼Œéœ€è¦ä» CentOS é•œåƒç«™ä¸­ä¸‹è½½å…¶å†…æ ¸æºç ï¼Œå°† CPU æ··éƒ¨æŠ€æœ¯ç§»æ¤åˆ°å†…æ ¸ï¼Œç¼–è¯‘åå®‰è£…ï¼Œç„¶åé‡å¯ç³»ç»Ÿä¾¿å¯ä»¥ä½¿ç”¨è¯¥æŠ€æœ¯ï¼Œä½†è¿™ä¼šæ¶‰åŠåˆ°ä¸šåŠ¡è¿ç§»å’Œåœæœºï¼ŒåŠ¿å¿…ä¼šç»™ä¸šåŠ¡æ–¹å¸¦æ¥æ˜‚è´µçš„ä»£ä»·ã€‚
å¯¹äºç¬¬äºŒç§æ–¹æ¡ˆï¼Œè™½ç„¶è¿ç§»å·¥ä½œä¼šæœ‰ä¸€å®šçš„å·¥ä½œé‡ï¼Œä½†æ˜¯ï¼ŒAlinux2/3 æˆ– Anolis OS åŒ…å«äº†å®Œæ•´çš„æ··éƒ¨èµ„æºéš”ç¦»æ–¹æ¡ˆï¼ˆCPU æ··éƒ¨ä»…ä»…æ˜¯å…¶ä¸­ä¸€ç‚¹ï¼‰ï¼ŒæŠ€æœ¯çº¢åˆ©æ‰€å¸¦æ¥çš„æ”¶ç›Šè¿œæ¯”è¿ç§»ä»£ä»·è¦å¤§å¾—å¤šã€‚è€Œä¸” CentOS å³å°†åœæœï¼Œä¸ºäº†è§£å†³ CentOS åœæœé—®é¢˜ï¼Œé¾™èœ¥ç¤¾åŒºæ¨å‡ºäº† Anolis OS å‘è¡Œç‰ˆæ“ä½œç³»ç»Ÿï¼Œè¯¥å‘è¡Œç‰ˆç³»ç»Ÿå®Œå…¨å…¼å®¹ CentOSï¼Œç”¨æˆ·å¯ä»¥è¿›è¡Œæ— ç¼è¿ç§»ã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="é¾™èœ¥-cpu-æ··éƒ¨æ’ä»¶">é¾™èœ¥ CPU æ··éƒ¨æ’ä»¶<a href="#é¾™èœ¥-cpu-æ··éƒ¨æ’ä»¶" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>é’ˆå¯¹ Koordinator äº‘åŸç”Ÿ CentOS å•æœºæ“ä½œç³»ç»Ÿ CPU æ··éƒ¨èƒ½åŠ›çš„ç¼ºå¤±ï¼Œé¾™èœ¥ç¤¾åŒºå¼€å‘äººå‘˜ç»™å‡ºäº†å¦ä¸€ç§æ–¹æ¡ˆï¼Œåˆ©ç”¨ plugsched è°ƒåº¦å™¨çƒ­å‡çº§æŠ€æœ¯æä¾›ä¸€ç§ CPU æ··éƒ¨æŠ€æœ¯çš„è°ƒåº¦å™¨æ’ä»¶åŒ…ï¼Œè¯¥æ’ä»¶åŒ…å«äº†é˜¿é‡Œäº‘æ—©æœŸï¼ˆ2017å¹´ï¼‰çš„ CPU æ··éƒ¨æŠ€æœ¯ bvt + noise cleanï¼Œè¯¥æŠ€æœ¯é‡‡ç”¨çš„æ˜¯ throttle æœºåˆ¶ï¼Œå½“è°ƒåº¦å™¨é€‰æ‹©ä¸‹ä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œå®ƒä¼šæ£€æµ‹å¯¹ç«¯ CPU ä¸Šçš„ä»»åŠ¡ç±»å‹ä»¥åŠå½“å‰ CPU æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ç±»å‹ï¼Œå¦‚æœåœ¨ã€ç¦»çº¿ä»»åŠ¡åŒæ—¶å­˜åœ¨ï¼Œåˆ™ä¼šå°†ç¦»çº¿ä»»åŠ¡ throttle æ‰ï¼Œç„¶åç»§ç»­é€‰æ‹©ä¸‹ä¸€ä¸ªä»»åŠ¡è¿›è¡Œè°ƒåº¦ï¼Œä¿è¯åœ¨çº¿ä»»åŠ¡ä¼˜å…ˆæ‰§è¡Œä¸”ä¸è¢«å¯¹ç«¯ CPU ä¸Šçš„ç¦»çº¿å¹²æ‰°ã€‚è¯¥ CPU æ··éƒ¨è°ƒåº¦å™¨æ’ä»¶å¯ç›´æ¥å®‰è£…åˆ° CentOS7.9ï¼Œä¸éœ€è¦åœæœºå’Œä¸šåŠ¡è¿ç§»ç­‰å·¥ä½œã€‚</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="plugsched-sdk-ç¥å™¨">Plugsched SDK ç¥å™¨<a href="#plugsched-sdk-ç¥å™¨" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>Plugsched è°ƒåº¦å™¨çƒ­å‡çº§ï¼Œæ˜¯é¾™èœ¥ç¤¾åŒºæ¨å‡ºçš„ plugsched SDK è°ƒåº¦å™¨çƒ­å‡çº§å¼€å‘å·¥å…·ï¼Œå®ƒå¯ä» Linux å†…æ ¸ä¸­å°†è°ƒåº¦å™¨è§£è€¦ï¼Œå½¢æˆä¸€ä¸ªç‹¬ç«‹çš„æ¨¡å—ï¼Œç„¶åå°† CPU æ··éƒ¨æŠ€æœ¯ç§»æ¤åˆ°è°ƒåº¦å™¨æ¨¡å—ï¼Œå½¢æˆä¸€ä¸ªè°ƒåº¦å™¨æ’ä»¶ï¼Œç„¶åå°†å…¶ç›´æ¥å®‰è£…åˆ°è¿è¡Œçš„ç³»ç»Ÿä¸­å°±å¯ä»¥ä½¿ç”¨ CPU æ··éƒ¨æŠ€æœ¯ã€‚Plugschedï¼Œå¯ä»¥å¯¹å†…æ ¸è°ƒåº¦å™¨ç‰¹æ€§åŠ¨æ€çš„è¿›è¡Œå¢ã€åˆ ã€æ”¹ï¼Œæ¥æ»¡è¶³ä¸šåŠ¡çš„éœ€æ±‚ï¼Œä¸”æ— éœ€è¿›è¡Œä¸šåŠ¡è¿ç§»å’Œåœæœºå‡çº§ï¼Œè¿˜å¯ä»¥å›æ»šã€‚å†…æ ¸å¼€å‘äººå‘˜å¯é€šè¿‡ plugsched SDK ç”Ÿäº§å‡ºå„ç§ç±»å‹çš„è°ƒåº¦å™¨æ’ä»¶æ¥æ»¡è¶³ä¸åŒçš„ä¸šåŠ¡åœºæ™¯ã€‚</p><p>Plugsched è°ƒåº¦å™¨çƒ­å‡çº§è®ºæ–‡ã€ŠEfficient Scheduler Live Update for Linux Kernel with Modularizationã€‹å·²è¢« ASPLOS é¡¶ä¼šæ”¶å½•ï¼Œé‡Œé¢è¯¦ç»†ä»‹ç»äº† plugsched æŠ€æœ¯åŸç†å’Œåº”ç”¨ä»·å€¼ï¼Œä»¥åŠå…¨é¢çš„æµ‹è¯•å’Œè¯„ä¼°ã€‚ç›®å‰ï¼Œplugsched ç”Ÿäº§çš„æ’ä»¶å·²åœ¨èš‚èšé›†å›¢ã€é˜¿é‡Œäº‘å’Œå›½å†…æŸå¤§å‹äº’è”ç½‘ä¼ä¸šè§„æ¨¡éƒ¨ç½²ã€‚</p><p>Plugsched å¼€æºé“¾æ¥ï¼š<a href="https://gitee.com/anolis/plugsched" target="_blank" rel="noopener noreferrer">https://gitee.com/anolis/plugsched</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cpu-æ··éƒ¨æ’ä»¶æµ‹è¯•">CPU æ··éƒ¨æ’ä»¶æµ‹è¯•<a href="#cpu-æ··éƒ¨æ’ä»¶æµ‹è¯•" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>å¼€å‘äººå‘˜å¯¹è¯¥è°ƒåº¦å™¨æ’ä»¶è¿›è¡Œäº† CPU æ··éƒ¨çš„æµ‹è¯•ï¼ŒæœåŠ¡ç«¯é…ç½®ï¼š</p><ul><li>æµ‹è¯•æœºå™¨ï¼šé˜¿é‡Œäº‘ç¥é¾™è£¸é‡‘å±æœåŠ¡å™¨ï¼Œ104 CPUï¼Œ384 GB å†…å­˜</li><li>ç³»ç»Ÿé…ç½®ï¼šCentOS 7.9 å‘è¡Œç‰ˆï¼Œå†…æ ¸ç‰ˆæœ¬ 3.10ï¼Œå®‰è£… CPU æ··éƒ¨è°ƒåº¦å™¨æ’ä»¶</li><li>æµ‹è¯•å†…å®¹ï¼šåœ¨çº¿ä»»åŠ¡æ˜¯ Nginx æœåŠ¡ï¼Œå®¹å™¨é…ç½®ä¸º 80C 10GBï¼ŒNginx workers æ•°é‡ä¸º 80ï¼›ç¦»çº¿ä»»åŠ¡æ˜¯ ffmpeg è§†é¢‘è½¬ç ï¼Œå®¹å™¨é…ç½®ä¸º 50C 20GBï¼Œçº¿ç¨‹æ•°é‡ä¸º 50ã€‚</li><li>æµ‹è¯•caseï¼š<ul><li>åŸºçº¿ï¼šå•ç‹¬å¯åŠ¨ Nginx å®¹å™¨</li><li>å¯¹ç…§ç»„ï¼šåŒæ—¶å¯åŠ¨ Nginx å®¹å™¨å’Œ ffmpeg å®¹å™¨ï¼Œä½†ä¸è®¾ç½®ä¼˜å…ˆçº§ï¼ˆä¸å¯ç”¨æ··éƒ¨åŠŸèƒ½ï¼‰</li><li>å®éªŒç»„ï¼šåŒæ—¶å¯åŠ¨ Nginx å®¹å™¨å’Œ ffmpeg å®¹å™¨ï¼Œç»™ Nginx è®¾ç½®åœ¨çº¿é«˜ä¼˜å…ˆçº§ï¼Œffmpeg ä¸ºç¦»çº¿ä½ä¼˜å…ˆçº§ï¼ˆå¯ç”¨æ··éƒ¨åŠŸèƒ½ï¼‰</li></ul></li></ul><p>åœ¨å¦ä¸€å°å‹æµ‹æœºä¸Šä½¿ç”¨ wrk å·¥å…·å‘ Nginx æœåŠ¡å‘èµ·è¯·æ±‚ï¼Œç»“æœå¦‚ä¸‹ï¼šï¼ˆå•ä½ï¼šmsï¼‰</p><table><thead><tr><th></th><th>åŸºçº¿</th><th>å¯¹ç…§ç»„</th><th>å®éªŒç»„</th></tr></thead><tbody><tr><td>RT-P50</td><td>0.223</td><td>0.245ï¼ˆ+9.86%ï¼‰</td><td>0.224ï¼ˆ+0.44%ï¼‰</td></tr><tr><td>RT-P75</td><td>0.322</td><td>0.387ï¼ˆ+20.18%ï¼‰</td><td>0.338ï¼ˆ+4.96%ï¼‰</td></tr><tr><td>RT-P90</td><td>0.444</td><td>0.575ï¼ˆ+29.50)</td><td>0.504ï¼ˆ+13.51%ï¼‰</td></tr><tr><td>RT-P99</td><td>0.706</td><td>1.7ï¼ˆ+140.79)</td><td>0.88ï¼ˆ+24.64%ï¼‰</td></tr><tr><td>CPU%</td><td>25.15%</td><td>71.7%</td><td>49.15%</td></tr></tbody></table><p>ä»ä¸Šé¢çš„ç»“æœæ¥çœ‹ï¼Œæ²¡æœ‰ CPU æ··éƒ¨æ’ä»¶ï¼Œç¦»çº¿ä»»åŠ¡å¯¹åœ¨çº¿ä»»åŠ¡çš„å½±å“å¾ˆå¤§ï¼ŒP99 å»¶æ—¶å¢é•¿äº†ä¸€å€å¤šï¼Œè€Œå®‰è£… CPU æ··éƒ¨æ’ä»¶åï¼ŒP99 é•¿å°¾å»¶æ—¶çš„å½±å“æ˜¾è‘—é™ä½ï¼ŒCPU åˆ©ç”¨ç‡ä¹Ÿæ¥è¿‘50%ã€‚</p><p>è¯¥æ’ä»¶è™½ç„¶èƒ½æ˜¾è‘—é™ä½ç¦»çº¿å¯¹åœ¨çº¿ä»»åŠ¡çš„å¹²æ‰°ï¼Œä½†è¿˜æ˜¯é€Šè‰²äºé¾™èœ¥ç¤¾åŒºçš„ Group Identity æŠ€æœ¯ã€‚é¾™èœ¥çš„ Group Identity æŠ€æœ¯èƒ½è®©åœ¨çº¿å—åˆ°çš„å¹²æ‰°å°äº 5%ï¼Œè€Œä¸”æ•´æœºåˆ©ç”¨ç‡çš„æå‡ä¹Ÿæ¯”è¯¥æ’ä»¶è¦æ›´å¤šä¸€äº›ï¼Œè¾¾åˆ° 60% ä»¥ä¸Šï¼ˆå¯æŸ¥é˜…ï¼š<a href="https://help.aliyun.com/document_detail/450006.html" target="_blank" rel="noopener noreferrer">koordinator æ··éƒ¨æœ€ä½³å®è·µæ‰‹å†Œ</a>ï¼‰ã€‚è¿™äº›å·®å¼‚çš„åŸå› åœ¨äºï¼Œ1ï¼‰å†…æ ¸è‡ªèº«çš„å·®å¼‚ï¼ŒCentOS 7.9 ä½¿ç”¨çš„æ˜¯æ¯”è¾ƒæ—©çš„ 3.10 å†…æ ¸ï¼Œè€Œé¾™èœ¥ä½¿ç”¨çš„æ˜¯ 4.19/5.10 å†…æ ¸ï¼Œ3.10 å†…æ ¸è°ƒåº¦å™¨æ€§èƒ½æœ¬èº«å°±ä¸åŠ 4.19/5.10ï¼›2ï¼‰Group Identity çš„å®ç°åŸç†ç›¸æ¯” noise clean æ›´é€‚åˆ CPU æ··éƒ¨åœºæ™¯ã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ç»“è¯­">ç»“è¯­<a href="#ç»“è¯­" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>æœ€åï¼Œæ¬¢è¿å¹¿å¤§æŠ€æœ¯äººå‘˜ã€å¼€æºçˆ±å¥½è€…å’Œè¯»è€…ç”¨æˆ·åŠ å…¥ Koordinatorã€openanolis ç¤¾åŒºï¼Œäº«å—ç¤¾åŒºå¸¦æ¥çš„æŠ€æœ¯ï¼Œä¸è®ºæ˜¯ Group Identity è¿˜æ˜¯ Plugsched ç¥å™¨ï¼Œä¸€å®šä¼šç»™å¤§å®¶å¸¦æ¥æ„æƒ³ä¸åˆ°çš„æ”¶ç›Šå’Œä»·å€¼ï¼Œæ¬¢è¿å¤§å®¶å…±å»ºç¤¾åŒºï¼Œä¸ç¤¾åŒºå…±åŒäº¤æµã€æˆé•¿å’Œå‘å±•ã€‚</p></div><footer class="row docusaurus-mt-lg"></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/zh-Hans/blog/release-v1.1.0">Koordinator v1.1: è®©è°ƒåº¦æ„ŸçŸ¥è´Ÿè½½ä¸å¹²æ‰°æ£€æµ‹é‡‡é›†</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-01-03T00:00:00.000Z" itemprop="datePublished">2023å¹´1æœˆ3æ—¥</time> Â· <!-- -->17 åˆ†é’Ÿé˜…è¯»</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/FillZpp" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/FillZpp.png" alt="Siyu Wang"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/FillZpp" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Siyu Wang</span></a></div><small class="avatar__subtitle" itemprop="description">Koordinator maintainer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="èƒŒæ™¯">èƒŒæ™¯<a href="#èƒŒæ™¯" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>Koordinator æ—¨åœ¨ä¸ºç”¨æˆ·æä¾›å®Œæ•´çš„æ··éƒ¨å·¥ä½œè´Ÿè½½ç¼–æ’ã€æ··éƒ¨èµ„æºè°ƒåº¦ã€æ··éƒ¨èµ„æºéš”ç¦»åŠæ€§èƒ½è°ƒä¼˜è§£å†³æ–¹æ¡ˆï¼Œå¸®åŠ©ç”¨æˆ·æé«˜å»¶è¿Ÿæ•æ„ŸæœåŠ¡çš„è¿è¡Œæ€§èƒ½ï¼ŒæŒ–æ˜ç©ºé—²èŠ‚ç‚¹èµ„æºå¹¶åˆ†é…ç»™çœŸæ­£æœ‰éœ€è¦çš„è®¡ç®—ä»»åŠ¡ï¼Œä»è€Œæé«˜å…¨å±€çš„èµ„æºåˆ©ç”¨æ•ˆç‡ã€‚</p><p>ä» 2022 å¹´ 4 æœˆå‘å¸ƒä»¥æ¥ï¼ŒKoordinator è¿„ä»Šä¸€å…±è¿­ä»£å‘å¸ƒäº† 9 ä¸ªç‰ˆæœ¬ã€‚é¡¹ç›®ç»å†çš„å¤§åŠå¹´å‘å±•è¿‡ç¨‹ä¸­ï¼Œç¤¾åŒºå¸çº³äº†åŒ…æ‹¬é˜¿é‡Œå·´å·´ã€å°ç±³ã€å°çº¢ä¹¦ã€çˆ±å¥‡è‰ºã€360ã€æœ‰èµ ç­‰åœ¨å†…çš„å¤§é‡ä¼˜ç§€å·¥ç¨‹å¸ˆï¼Œè´¡çŒ®äº†ä¼—å¤šçš„æƒ³æ³•ã€ä»£ç å’Œåœºæ™¯ï¼Œä¸€èµ·æ¨åŠ¨ Koordinator é¡¹ç›®çš„æˆç†Ÿã€‚</p><p>ä»Šå¤©ï¼Œå¾ˆé«˜å…´çš„å®£å¸ƒ Koordinator v1.1 æ­£å¼å‘å¸ƒï¼Œå®ƒåŒ…å«äº†è´Ÿè½½æ„ŸçŸ¥è°ƒåº¦/é‡è°ƒåº¦ã€cgroup v2 æ”¯æŒã€å¹²æ‰°æ£€æµ‹æŒ‡æ ‡é‡‡é›†ï¼Œä»¥åŠå…¶ä»–ä¸€ç³»åˆ—ä¼˜åŒ–ç‚¹ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±é’ˆå¯¹è¿™äº›æ–°å¢ç‰¹æ€§åšæ·±å…¥è§£è¯»ä¸è¯´æ˜ã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ç‰ˆæœ¬ç‰¹æ€§æ·±å…¥è§£è¯»">ç‰ˆæœ¬ç‰¹æ€§æ·±å…¥è§£è¯»<a href="#ç‰ˆæœ¬ç‰¹æ€§æ·±å…¥è§£è¯»" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="è´Ÿè½½æ„ŸçŸ¥è°ƒåº¦">è´Ÿè½½æ„ŸçŸ¥è°ƒåº¦<a href="#è´Ÿè½½æ„ŸçŸ¥è°ƒåº¦" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="æ”¯æŒæŒ‰å·¥ä½œè´Ÿè½½ç±»å‹ç»Ÿè®¡å’Œå‡è¡¡è´Ÿè½½æ°´ä½">æ”¯æŒæŒ‰å·¥ä½œè´Ÿè½½ç±»å‹ç»Ÿè®¡å’Œå‡è¡¡è´Ÿè½½æ°´ä½<a href="#æ”¯æŒæŒ‰å·¥ä½œè´Ÿè½½ç±»å‹ç»Ÿè®¡å’Œå‡è¡¡è´Ÿè½½æ°´ä½" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>Koordinator v1.0 åŠä¹‹å‰çš„ç‰ˆæœ¬ï¼Œæä¾›äº†è´Ÿè½½æ„ŸçŸ¥è°ƒåº¦æä¾›åŸºæœ¬çš„åˆ©ç”¨ç‡é˜ˆå€¼è¿‡æ»¤ä¿æŠ¤é«˜è´Ÿè½½æ°´ä½çš„èŠ‚ç‚¹ç»§ç»­æ¶åŒ–å½±å“å·¥ä½œè´Ÿè½½çš„è¿è¡Œæ—¶è´¨é‡ï¼Œä»¥åŠé€šè¿‡é¢„ä¼°æœºåˆ¶è§£å†³è§£å†³å†·èŠ‚ç‚¹è¿‡è½½çš„æƒ…å†µã€‚å·²æœ‰çš„è´Ÿè½½æ„ŸçŸ¥è°ƒåº¦èƒ½è§£å†³å¾ˆå¤šå¸¸è§åœºæ™¯çš„é—®é¢˜ã€‚ä½†è´Ÿè½½æ„ŸçŸ¥è°ƒåº¦ä½œä¸ºä¸€ç§ä¼˜åŒ–æ‰‹æ®µï¼Œè¿˜æœ‰æ¯”è¾ƒå¤šçš„åœºæ™¯æ˜¯éœ€è¦å®Œå–„çš„ã€‚</p><p>ç›®å‰çš„è´Ÿè½½æ„ŸçŸ¥è°ƒåº¦ä¸»è¦è§£å†³äº†é›†ç¾¤å†…æ•´æœºç»´åº¦çš„è´Ÿè½½å‡è¡¡æ•ˆæœï¼Œä½†æœ‰å¯èƒ½å‡ºç°ä¸€äº›ç‰¹æ®Šçš„æƒ…å†µï¼šèŠ‚ç‚¹éƒ¨ç½²äº†ä¸å°‘ç¦»çº¿Podè¿è¡Œï¼Œæ‹‰é«˜äº†æ•´æœºçš„åˆ©ç”¨ç‡ï¼Œä½†åœ¨çº¿åº”ç”¨å·¥ä½œè´Ÿè½½çš„æ•´ä½“åˆ©ç”¨ç‡åä½ã€‚è¿™ä¸ªæ—¶å€™å¦‚æœæœ‰æ–°çš„åœ¨çº¿Podï¼Œä¸”æ•´ä¸ªé›†ç¾¤å†…çš„èµ„æºæ¯”è¾ƒç´§å¼ æ—¶ï¼Œä¼šæœ‰å¦‚ä¸‹çš„é—®é¢˜ï¼š</p><ol><li>æœ‰å¯èƒ½å› ä¸ºæ•´æœºåˆ©ç”¨ç‡è¶…è¿‡æ•´æœºå®‰å…¨é˜ˆå€¼å¯¼è‡´æ— æ³•è°ƒåº¦åˆ°è¿™ä¸ªèŠ‚ç‚¹ä¸Šçš„ï¼›</li><li>è¿˜å¯èƒ½å‡ºç°ä¸€ä¸ªèŠ‚ç‚¹çš„åˆ©ç”¨ç‡è™½ç„¶ç›¸å¯¹æ¯”è¾ƒä½ï¼Œä½†ä¸Šé¢è·‘çš„å…¨æ˜¯åœ¨çº¿åº”ç”¨ç‡ï¼Œä»åœ¨çº¿åº”ç”¨è§’åº¦çœ‹ï¼Œåˆ©ç”¨ç‡å·²ç»åé«˜äº†ï¼Œä½†æŒ‰ç…§å½“å‰çš„è°ƒåº¦ç­–ç•¥ï¼Œè¿˜ä¼šç»§ç»­è°ƒåº¦è¿™ä¸ªPodä¸Šæ¥ï¼Œå¯¼è‡´è¯¥èŠ‚ç‚¹å †ç§¯äº†å¤§é‡çš„åœ¨çº¿åº”ç”¨ï¼Œæ•´ä½“çš„è¿è¡Œæ•ˆæœå¹¶ä¸å¥½ã€‚</li></ol><p>åœ¨ Koordinator v1.1 ä¸­ï¼Œkoord-scheduler æ”¯æŒæ„ŸçŸ¥å·¥ä½œè´Ÿè½½ç±»å‹ï¼ŒåŒºåˆ†ä¸åŒçš„æ°´ä½å’Œç­–ç•¥è¿›è¡Œè°ƒåº¦ã€‚</p><p>åœ¨ Filter é˜¶æ®µï¼Œæ–°å¢ threshold é…ç½® <code>prodUsageThresholds</code>ï¼Œè¡¨ç¤ºåœ¨çº¿åº”ç”¨çš„å®‰å…¨é˜ˆå€¼ï¼Œé»˜è®¤ä¸ºç©ºã€‚å¦‚æœå½“å‰è°ƒåº¦çš„ Pod æ˜¯ Prod ç±»å‹ï¼Œkoord-scheduler ä¼šä»å½“å‰èŠ‚ç‚¹çš„ NodeMetric ä¸­ç»Ÿè®¡æ‰€æœ‰åœ¨çº¿åº”ç”¨çš„åˆ©ç”¨ç‡ä¹‹å’Œï¼Œå¦‚æœè¶…è¿‡äº† <code>prodUsageThresholds</code> å°±è¿‡æ»¤æ‰è¯¥èŠ‚ç‚¹ï¼›å¦‚æœæ˜¯ç¦»çº¿ Podï¼Œæˆ–è€…æ²¡æœ‰é…ç½® <code>prodUsageThresholds</code>ï¼Œä¿æŒåŸæœ‰çš„é€»è¾‘ï¼ŒæŒ‰æ•´æœºåˆ©ç”¨ç‡å¤„ç†ã€‚</p><p>åœ¨ Score é˜¶æ®µï¼Œæ–°å¢å¼€å…³ <code>scoreAccordingProdUsage</code> è¡¨ç¤ºæ˜¯å¦æŒ‰ Prod ç±»å‹çš„åˆ©ç”¨ç‡æ‰“åˆ†å‡è¡¡ã€‚é»˜è®¤ä¸å¯ç”¨ã€‚å½“å¼€å¯åï¼Œä¸”å½“å‰ Pod æ˜¯ Prod ç±»å‹çš„è¯ï¼Œkoord-scheduler åœ¨é¢„ä¼°ç®—æ³•ä¸­åªå¤„ç† Prod ç±»å‹çš„ Podï¼Œå¹¶å¯¹ NodeMetrics ä¸­è®°å½•çš„å…¶ä»–çš„æœªä½¿ç”¨é¢„ä¼°æœºåˆ¶å¤„ç†çš„åœ¨çº¿åº”ç”¨çš„ Pod çš„å½“å‰åˆ©ç”¨ç‡å€¼è¿›è¡Œæ±‚å’Œï¼Œæ±‚å’Œåçš„å€¼å‚ä¸æœ€ç»ˆçš„æ‰“åˆ†ã€‚å¦‚æœæ²¡æœ‰å¼€å¯ <code>scoreAccordingProdUsage</code>ï¼Œæˆ–è€…æ˜¯ç¦»çº¿Podï¼Œä¿æŒåŸæœ‰é€»è¾‘ï¼ŒæŒ‰æ•´æœºåˆ©ç”¨ç‡å¤„ç†ã€‚</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="æ”¯æŒæŒ‰ç™¾åˆ†ä½æ•°åˆ©ç”¨ç‡å‡è¡¡">æ”¯æŒæŒ‰ç™¾åˆ†ä½æ•°åˆ©ç”¨ç‡å‡è¡¡<a href="#æ”¯æŒæŒ‰ç™¾åˆ†ä½æ•°åˆ©ç”¨ç‡å‡è¡¡" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>Koordinator v1.0åŠä»¥å‰çš„ç‰ˆæœ¬éƒ½æ˜¯æŒ‰ç…§ koordlet ä¸ŠæŠ¥çš„å¹³å‡åˆ©ç”¨ç‡æ•°æ®è¿›è¡Œè¿‡æ»¤å’Œæ‰“åˆ†ã€‚ä½†å¹³å‡å€¼éšè—äº†æ¯”è¾ƒå¤šçš„ä¿¡æ¯ï¼Œå› æ­¤åœ¨ Koordinator v1.1 ä¸­ koordlet æ–°å¢äº†æ ¹æ®ç™¾åˆ†ä½æ•°ç»Ÿè®¡çš„åˆ©ç”¨ç‡èšåˆæ•°æ®ã€‚è°ƒåº¦å™¨ä¾§ä¹Ÿè·Ÿç€åšäº†ç›¸åº”çš„é€‚é…ã€‚</p><p>æ›´æ”¹è°ƒåº¦å™¨çš„ LoadAware æ’ä»¶çš„é…ç½®ï¼Œ<code>aggregated</code> è¡¨ç¤ºæŒ‰ç…§ç™¾åˆ†ä½æ•°èšåˆæ•°æ®è¿›è¡Œæ‰“åˆ†å’Œè¿‡æ»¤ã€‚<code>aggregated.usageThresholds</code> è¡¨ç¤ºè¿‡æ»¤æ—¶çš„æ°´ä½é˜ˆå€¼ï¼›<code>aggregated.usageAggregationType</code> è¡¨ç¤ºè¿‡æ»¤é˜¶æ®µè¦ä½¿ç”¨çš„ç™¾åˆ†ä½æ•°ç±»å‹ï¼Œæ”¯æŒ <code>avg</code>ï¼Œ<code>p99</code>, <code>p95</code>, <code>p90</code> å’Œ <code>p50</code>ï¼›<code>aggregated.usageAggregatedDuration</code> è¡¨ç¤ºè¿‡æ»¤é˜¶æ®µæœŸæœ›ä½¿ç”¨çš„èšåˆå‘¨æœŸï¼Œå¦‚æœä¸é…ç½®ï¼Œè°ƒåº¦å™¨å°†ä½¿ç”¨ NodeMetrics ä¸­ä¸ŠæŠ¥çš„æœ€å¤§å‘¨æœŸçš„æ•°æ®ï¼›<code>aggregated.scoreAggregationType</code> è¡¨ç¤ºåœ¨æ‰“åˆ†é˜¶æ®µæœŸæœ›ä½¿ç”¨çš„ç™¾åˆ†ä½æ•°ç±»å‹ï¼›<code>aggregated.scoreAggregatedDuration</code> è¡¨ç¤ºæ‰“åˆ†é˜¶æ®µæœŸæœ›ä½¿ç”¨çš„èšåˆå‘¨æœŸï¼Œå¦‚æœä¸é…ç½®ï¼Œè°ƒåº¦å™¨å°†ä½¿ç”¨ NodeMetrics ä¸­ä¸ŠæŠ¥çš„æœ€å¤§å‘¨æœŸçš„æ•°æ®ã€‚</p><p>åœ¨ Filter é˜¶æ®µï¼Œå¦‚æœé…ç½®äº† <code>aggregated.usageThresholds</code> ä»¥åŠå¯¹åº”çš„èšåˆç±»å‹ï¼Œè°ƒåº¦å™¨å°†æŒ‰è¯¥ç™¾åˆ†ä½æ•°ç»Ÿè®¡å€¼è¿›è¡Œè¿‡æ»¤ï¼›</p><p>åœ¨ Score é˜¶æ®µï¼Œå¦‚æœé…ç½®äº† <code>aggregated.scoreAggregationType</code>ï¼Œè°ƒåº¦å™¨å°†ä¼šæŒ‰è¯¥ç™¾åˆ†ä½æ•°ç»Ÿè®¡å€¼æ‰“åˆ†ï¼›ç›®å‰æš‚æ—¶ä¸æ”¯æŒ Prod Pod ä½¿ç”¨ç™¾åˆ†ä½æ•°è¿‡æ»¤ã€‚</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="è´Ÿè½½æ„ŸçŸ¥é‡è°ƒåº¦">è´Ÿè½½æ„ŸçŸ¥é‡è°ƒåº¦<a href="#è´Ÿè½½æ„ŸçŸ¥é‡è°ƒåº¦" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>Koordinator åœ¨è¿‡å»çš„å‡ ä¸ªç‰ˆæœ¬ä¸­ï¼ŒæŒç»­çš„æ¼”è¿›é‡è°ƒåº¦å™¨ï¼Œå…ˆåäº†å¼€æºå®Œæ•´çš„æ¡†æ¶ï¼ŒåŠ å¼ºäº†å®‰å…¨æ€§ï¼Œé¿å…å› è¿‡åº¦é©±é€ Pod å½±å“åœ¨çº¿åº”ç”¨çš„ç¨³å®šæ€§ã€‚è¿™ä¹Ÿå½±å“äº†é‡è°ƒåº¦åŠŸèƒ½çš„è¿›å±•ï¼Œè¿‡å» Koordinator æš‚æ—¶æ²¡æœ‰å¤ªå¤šåŠ›é‡å»ºè®¾é‡è°ƒåº¦èƒ½åŠ›ã€‚è¿™ä¸€æƒ…å†µå°†ä¼šå¾—åˆ°æ”¹å˜ã€‚</p><p>Koordinator v1.1 ä¸­æˆ‘ä»¬æ–°å¢äº†è´Ÿè½½æ„ŸçŸ¥é‡è°ƒåº¦åŠŸèƒ½ã€‚æ–°çš„æ’ä»¶ç§°ä¸º <code>LowNodeLoad</code>ï¼Œè¯¥æ’ä»¶é…åˆç€è°ƒåº¦å™¨çš„è´Ÿè½½æ„ŸçŸ¥è°ƒåº¦èƒ½åŠ›ï¼Œå¯ä»¥å½¢æˆä¸€ä¸ªé—­ç¯ï¼Œè°ƒåº¦å™¨çš„è´Ÿè½½æ„ŸçŸ¥è°ƒåº¦åœ¨è°ƒåº¦æ—¶åˆ»å†³ç­–é€‰æ‹©æœ€ä¼˜èŠ‚ç‚¹ï¼Œä½†éšç€æ—¶é—´å’Œé›†ç¾¤ç¯å¢ƒä»¥åŠå·¥ä½œè´Ÿè½½é¢å¯¹çš„æµé‡/è¯·æ±‚çš„å˜åŒ–æ—¶ï¼Œè´Ÿè½½æ„ŸçŸ¥é‡è°ƒåº¦å¯ä»¥ä»‹å…¥è¿›æ¥ï¼Œå¸®åŠ©ä¼˜åŒ–è´Ÿè½½æ°´ä½è¶…è¿‡å®‰å…¨é˜ˆå€¼çš„èŠ‚ç‚¹ã€‚ <code>LowNodeLoad</code> ä¸ K8s descheduler çš„æ’ä»¶ LowNodeUtilization ä¸åŒçš„æ˜¯ï¼ŒLowNodeLoadæ˜¯æ ¹æ®èŠ‚ç‚¹çœŸå®åˆ©ç”¨ç‡çš„æƒ…å†µå†³ç­–é‡è°ƒåº¦ï¼Œè€Œ LowNodeUtilization æ˜¯æ ¹æ®èµ„æºåˆ†é…ç‡å†³ç­–é‡è°ƒåº¦ã€‚</p><p><code>LowNodeLoad</code> æ’ä»¶æœ‰ä¸¤ä¸ªæœ€é‡è¦çš„å‚æ•°ï¼Œåˆ†åˆ«æ˜¯ <code>highThresholds</code> å’Œ <code>lowThresholds</code>ï¼š</p><ul><li><code>highThresholds</code> è¡¨ç¤ºè´Ÿè½½æ°´ä½çš„è­¦æˆ’é˜ˆå€¼ï¼Œè¶…è¿‡è¯¥é˜ˆå€¼çš„èŠ‚ç‚¹ä¸Šçš„Podå°†å‚ä¸é‡è°ƒåº¦ï¼›</li><li><code>lowThresholds</code> è¡¨ç¤ºè´Ÿè½½æ°´ä½çš„å®‰å…¨æ°´ä½ã€‚ä½äºè¯¥é˜ˆå€¼çš„èŠ‚ç‚¹ä¸Šçš„Podä¸ä¼šè¢«é‡è°ƒåº¦ã€‚</li></ul><p>ä»¥ä¸‹å›¾ä¸ºä¾‹ï¼ŒlowThresholds ä¸º45%ï¼ŒhighThresholds ä¸º 70%ï¼Œé‚£ä¹ˆä½äº 45% çš„èŠ‚ç‚¹æ˜¯å®‰å…¨çš„ï¼Œå› ä¸ºæ°´ä½å·²ç»å¾ˆä½äº†ï¼›é«˜äº45%ï¼Œä½†æ˜¯ä½äº 70%çš„æ˜¯åŒºé—´æ˜¯æˆ‘ä»¬æœŸæœ›çš„è´Ÿè½½æ°´ä½èŒƒå›´ï¼›é«˜äº70%çš„èŠ‚ç‚¹å°±ä¸å®‰å…¨äº†ï¼Œåº”è¯¥æŠŠè¶…è¿‡70%çš„è¿™éƒ¨åˆ†ï¼ˆå‡è®¾å½“å‰èŠ‚ç‚¹Açš„è´Ÿè½½æ°´ä½æ˜¯85%ï¼‰ï¼Œé‚£ä¹ˆ 85% - 70% = 15% çš„è´Ÿè½½é™ä½ï¼Œç­›é€‰ Pod åæ‰§è¡Œè¿ç§»ã€‚</p><p><img loading="lazy" alt="LowNodeLoad ç¤ºä¾‹" src="/zh-Hans/assets/images/lownodeload-sample-53d42010721f0acac9ece644dfff4252.png" width="2288" height="760" class="img_ev3q"></p><p>è¿ç§»æ—¶ï¼Œè¿˜è¦è€ƒè™‘åˆ°ä½äº 45% çš„è¿™éƒ¨åˆ†èŠ‚ç‚¹æ˜¯æˆ‘ä»¬é‡è°ƒåº¦åè¦æ‰¿è½½æ–°Podçš„èŠ‚ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿è¿ç§»çš„Podçš„è´Ÿè½½æ€»é‡ä¸ä¼šè¶…è¿‡è¿™äº›ä½è´Ÿè½½èŠ‚ç‚¹çš„æ‰¿è½½ä¸Šé™ã€‚è¿™ä¸ªæ‰¿è½½ä¸Šé™å³æ˜¯ highThresholds - èŠ‚ç‚¹å½“å‰è´Ÿè½½ï¼Œå‡è®¾èŠ‚ç‚¹Bçš„è´Ÿè½½æ°´ä½æ˜¯20%ï¼Œé‚£ä¹ˆ 70%-20% = 50%ï¼Œè¿™50%å°±æ˜¯å¯ä»¥æ‰¿è½½çš„å®¹é‡äº†ã€‚å› æ­¤è¿ç§»æ—¶æ¯é©±é€ä¸€ä¸ª Podï¼Œè¿™ä¸ªæ‰¿è½½å®¹é‡å°±åº”è¯¥æ‰£æ‰å½“å‰é‡è°ƒåº¦ Pod çš„å½“å‰è´Ÿè½½æˆ–è€…é¢„ä¼°è´Ÿè½½æˆ–è€…ç”»åƒå€¼ï¼ˆè¿™éƒ¨åˆ†å€¼ä¸è´Ÿè½½è°ƒåº¦é‡Œçš„å€¼å¯¹åº”ï¼‰ã€‚è¿™æ ·å°±å¯ä»¥ç¡®ä¿ä¸ä¼šå¤šè¿ç§»ã€‚ </p><p>å¦‚æœä¸€ä¸ªé›†ç¾¤æ€»æ˜¯å¯èƒ½ä¼šå‡ºç°æŸäº›èŠ‚ç‚¹çš„è´Ÿè½½å°±æ˜¯æ¯”è¾ƒé«˜ï¼Œè€Œä¸”æ•°é‡å¹¶ä¸å¤šï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœé¢‘ç¹çš„é‡è°ƒåº¦è¿™äº›èŠ‚ç‚¹ï¼Œä¹Ÿä¼šå¸¦æ¥å®‰å…¨éšæ‚£ï¼Œå› æ­¤å¯ä»¥è®©ç”¨æˆ·æŒ‰éœ€è®¾ç½® <code>numberOfNodes</code>ã€‚</p><p>å¦å¤–ï¼Œ<code>LowNodeLoad</code> è¯†åˆ«å‡ºè¶…è¿‡é˜ˆå€¼çš„èŠ‚ç‚¹åä¼šç­›é€‰ Podï¼Œå½“ç­›é€‰ Pod æ—¶ï¼Œå¯ä»¥é…ç½®è¦æ”¯æŒæˆ–è€…è¿‡æ»¤çš„ namespaceï¼Œæˆ–è€…é…ç½® pod selector ç­›é€‰ï¼Œä¹Ÿå¯ä»¥é…ç½® <code>nodeFit</code> æ£€æŸ¥æ¯ä¸ªå¤‡é€‰ Pod å¯¹åº”çš„ Node Affinity/Node Selector/Toleration æ˜¯å¦æœ‰ä¸ä¹‹åŒ¹é…çš„ Nodeï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œè¿™ç§èŠ‚ç‚¹ä¹Ÿä¼šè¢«å¿½ç•¥ã€‚å½“ç„¶å¯ä»¥è€ƒè™‘ä¸å¯ç”¨è¿™ä¸ªèƒ½åŠ›ï¼Œé€šè¿‡é…ç½® <code>nodeFit</code> ä¸º false åå³å¯ç¦ç”¨ï¼Œæ­¤æ—¶å®Œå…¨ç”±åº•å±‚çš„ <code>MigrationController</code> é€šè¿‡ Koordinator Reservation é¢„ç•™èµ„æºï¼›</p><p>å½“ç­›é€‰å‡º Pod åï¼Œä¼šå¯¹è¿™äº› Pod è¿›è¡Œæ’åºã€‚ä¼šä¾é Koordinator QoSClassã€Kubernetes QoSClassã€Priorityã€ç”¨é‡å’Œåˆ›å»ºæ—¶é—´ç­‰å¤šä¸ªç»´åº¦æ’åºã€‚</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cgroup-v2-æ”¯æŒ">cgroup v2 æ”¯æŒ<a href="#cgroup-v2-æ”¯æŒ" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="èƒŒæ™¯-1">èƒŒæ™¯<a href="#èƒŒæ™¯-1" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>Koordinator ä¸­ä¼—å¤šå•æœº QoS èƒ½åŠ›å’Œèµ„æºå‹åˆ¶/å¼¹æ€§ç­–ç•¥æ„å»ºåœ¨ Linux Control Group (cgroups) æœºåˆ¶ä¸Šï¼Œæ¯”å¦‚ CPU QoS (cpu)ã€Memory QoS (memory)ã€CPU Burst (cpu)ã€CPU Suppress (cpu, cpuset)ï¼Œkoordlet ç»„ä»¶å¯ä»¥é€šè¿‡ cgroups (v1) é™åˆ¶å®¹å™¨å¯ç”¨èµ„æºçš„æ—¶é—´ç‰‡ã€æƒé‡ã€ä¼˜å…ˆçº§ã€æ‹“æ‰‘ç­‰å±æ€§ã€‚Linux é«˜ç‰ˆæœ¬å†…æ ¸ä¹Ÿåœ¨æŒç»­å¢å¼ºå’Œè¿­ä»£äº† cgroups æœºåˆ¶ï¼Œå¸¦æ¥äº† cgroups v2 æœºåˆ¶ï¼Œç»Ÿä¸€ cgroups ç›®å½•ç»“æ„ï¼Œæ”¹å–„ v1 ä¸­ä¸åŒ subsystem/cgroup controller ä¹‹é—´çš„åä½œï¼Œå¹¶è¿›ä¸€æ­¥å¢å¼ºäº†éƒ¨åˆ†å­ç³»ç»Ÿçš„èµ„æºç®¡ç†å’Œç›‘æ§èƒ½åŠ›ã€‚Kubernetes è‡ª 1.25 èµ·å°† cgroups v2 ä½œä¸º GA (general availability) ç‰¹æ€§ï¼Œåœ¨ Kubelet ä¸­å¯ç”¨è¯¥ç‰¹æ€§è¿›è¡Œå®¹å™¨çš„èµ„æºç®¡ç†ï¼Œåœ¨ç»Ÿä¸€çš„ cgroups å±‚æ¬¡ä¸‹è®¾ç½®å®¹å™¨çš„èµ„æºéš”ç¦»å‚æ•°ï¼Œæ”¯æŒ MemoryQoS çš„å¢å¼ºç‰¹æ€§ã€‚</p><p><img loading="lazy" alt="cgroup v1/v2 ç»“æ„" src="/zh-Hans/assets/images/cgroup-v1-and-v2-94df02d090b7f7b4e7f3cc4c6accdaae.svg" width="691" height="171" class="img_ev3q"></p><p>åœ¨ Koordinator v1.1 ä¸­ï¼Œå•æœºç»„ä»¶ koordlet æ–°å¢å¯¹ cgroups v2 çš„æ”¯æŒï¼ŒåŒ…æ‹¬å¦‚ä¸‹å·¥ä½œï¼š</p><ul><li>é‡æ„äº† Resource Executor æ¨¡å—ï¼Œä»¥ç»Ÿä¸€ç›¸åŒæˆ–è¿‘ä¼¼çš„ cgroup æ¥å£åœ¨ v1 å’Œ v2 ä¸åŒç‰ˆæœ¬ä¸Šçš„æ–‡ä»¶æ“ä½œï¼Œä¾¿äº koordlet ç‰¹æ€§å…¼å®¹ cgroups v2 å’Œåˆå¹¶è¯»å†™å†²çªã€‚</li><li>åœ¨å½“å‰å·²å¼€æ”¾çš„å•æœºç‰¹æ€§ä¸­é€‚é… cgroups v2ï¼Œé‡‡ç”¨æ–°çš„ Resource Executor æ¨¡å—æ›¿æ¢ cgroup æ“ä½œï¼Œä¼˜åŒ–ä¸åŒç³»ç»Ÿç¯å¢ƒä¸‹çš„æŠ¥é”™æ—¥å¿—ã€‚</li></ul><p>Koordinator v1.1 ä¸­å¤§éƒ¨åˆ† koordlet ç‰¹æ€§å·²ç»å…¼å®¹ cgroups v2ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š</p><ul><li>èµ„æºåˆ©ç”¨ç‡é‡‡é›†</li><li>åŠ¨æ€èµ„æºè¶…å–</li><li>Batch èµ„æºéš”ç¦»ï¼ˆBatchResourceï¼ŒåºŸå¼ƒBECgroupReconcileï¼‰</li><li>CPU QoSï¼ˆGroupIdentityï¼‰</li><li>Memory QoSï¼ˆCgroupReconcileï¼‰</li><li>CPU åŠ¨æ€å‹åˆ¶ï¼ˆBECPUSuppressï¼‰</li><li>å†…å­˜é©±é€ï¼ˆBEMemoryEvictï¼‰</li><li>CPU Burstï¼ˆCPUBurstï¼‰</li><li>L3 Cache åŠå†…å­˜å¸¦å®½éš”ç¦»ï¼ˆRdtResctrlï¼‰</li></ul><p>é—ç•™çš„æœªå…¼å®¹ç‰¹æ€§å¦‚ PSICollector å°†åœ¨æ¥ä¸‹æ¥çš„ v1.2 ç‰ˆæœ¬ä¸­è¿›è¡Œé€‚é…ï¼Œå¯ä»¥è·Ÿè¿› issue#407 è·å–æœ€æ–°è¿›å±•ã€‚æ¥ä¸‹æ¥çš„ Koordinator ç‰ˆæœ¬ä¸­ä¹Ÿå°†é€æ¸å¼•å…¥æ›´å¤š cgroups v2 çš„å¢å¼ºåŠŸèƒ½ï¼Œæ•¬è¯·æœŸå¾…ã€‚</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="ä½¿ç”¨-cgroups-v2">ä½¿ç”¨ cgroups v2<a href="#ä½¿ç”¨-cgroups-v2" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>åœ¨ Koordinator v1.1 ä¸­ï¼Œkoordlet å¯¹ cgroups v2 çš„é€‚é…å¯¹ä¸Šå±‚åŠŸèƒ½é…ç½®é€æ˜ï¼Œé™¤äº†è¢«åºŸå¼ƒç‰¹æ€§çš„ feature-gate ä»¥å¤–ï¼Œæ‚¨æ— éœ€å˜åŠ¨ ConfigMap <code>slo-controller-config</code> å’Œå…¶ä»– feature-gate é…ç½®ã€‚å½“ koordlet è¿è¡Œåœ¨å¯ç”¨ cgroups v2 çš„èŠ‚ç‚¹ä¸Šæ—¶ï¼Œç›¸åº”å•æœºç‰¹æ€§å°†è‡ªåŠ¨åˆ‡æ¢åˆ° cgroups-v2 ç³»ç»Ÿæ¥å£è¿›è¡Œæ“ä½œã€‚</p><p>æ­¤å¤–ï¼Œcgroups v2 æ˜¯ Linux é«˜ç‰ˆæœ¬å†…æ ¸ï¼ˆå»ºè®® &gt;=5.8ï¼‰çš„ç‰¹æ€§ï¼Œå¯¹ç³»ç»Ÿå†…æ ¸ç‰ˆæœ¬å’Œ Kubernetes ç‰ˆæœ¬æœ‰ä¸€å®šä¾èµ–ã€‚å»ºè®®é‡‡ç”¨é»˜è®¤å¯ç”¨ cgroups v2 çš„ Linux å‘è¡Œç‰ˆä»¥åŠ Kubernetes v1.24 ä»¥ä¸Šç‰ˆæœ¬ã€‚</p><p>æ›´å¤šå…³äºå¦‚ä½•å¯ç”¨ cgroups v2 çš„è¯´æ˜ï¼Œè¯·å‚ç…§ Kubernetes ç¤¾åŒº<a href="https://kubernetes.io/docs/concepts/architecture/cgroups/#using-cgroupv2" target="_blank" rel="noopener noreferrer">æ–‡æ¡£</a>ã€‚</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="å¹²æ‰°æ£€æµ‹æŒ‡æ ‡é‡‡é›†">å¹²æ‰°æ£€æµ‹æŒ‡æ ‡é‡‡é›†<a href="#å¹²æ‰°æ£€æµ‹æŒ‡æ ‡é‡‡é›†" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>åœ¨çœŸå®çš„ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œå•æœºçš„è¿è¡Œæ—¶çŠ¶æ€æ˜¯ä¸€ä¸ªâ€œæ··æ²Œç³»ç»Ÿâ€ï¼Œèµ„æºç«äº‰äº§ç”Ÿçš„åº”ç”¨å¹²æ‰°æ— æ³•ç»å¯¹é¿å…ã€‚Koordinator æ­£åœ¨å»ºç«‹å¹²æ‰°æ£€æµ‹ä¸ä¼˜åŒ–çš„èƒ½åŠ›ï¼Œé€šè¿‡æå–åº”ç”¨è¿è¡ŒçŠ¶æ€çš„æŒ‡æ ‡ï¼Œè¿›è¡Œå®æ—¶çš„åˆ†æå’Œæ£€æµ‹ï¼Œåœ¨å‘ç°å¹²æ‰°åå¯¹ç›®æ ‡åº”ç”¨å’Œå¹²æ‰°æºé‡‡å–æ›´å…·é’ˆå¯¹æ€§çš„ç­–ç•¥ã€‚</p><p>å½“å‰ Koordinator å·²ç»å®ç°äº†ä¸€ç³»åˆ— <code>Performance Collector</code>ï¼Œåœ¨å•æœºä¾§é‡‡é›†ä¸åº”ç”¨è¿è¡ŒçŠ¶æ€é«˜ç›¸å…³æ€§çš„åº•å±‚æŒ‡æ ‡ï¼Œå¹¶é€šè¿‡ Prometheus æš´éœ²å‡ºæ¥ï¼Œä¸ºå¹²æ‰°æ£€æµ‹èƒ½åŠ›å’Œé›†ç¾¤åº”ç”¨è°ƒåº¦æä¾›æ”¯æŒã€‚</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="æŒ‡æ ‡é‡‡é›†">æŒ‡æ ‡é‡‡é›†<a href="#æŒ‡æ ‡é‡‡é›†" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>Performance Collector ç”±å¤šä¸ª feature-gate è¿›è¡Œæ§åˆ¶ï¼ŒKoordinator ç›®å‰æä¾›ä»¥ä¸‹å‡ ä¸ªæŒ‡æ ‡é‡‡é›†å™¨ï¼š</p><ul><li><code>CPICollector</code>ï¼šç”¨äºæ§åˆ¶ CPI æŒ‡æ ‡é‡‡é›†å™¨ã€‚CPIï¼šCycles Per Instructionã€‚æŒ‡ä»¤åœ¨è®¡ç®—æœºä¸­æ‰§è¡Œæ‰€éœ€è¦çš„å¹³å‡æ—¶é’Ÿå‘¨æœŸæ•°ã€‚CPI é‡‡é›†å™¨åŸºäº Cycles å’Œ Instructions è¿™ä¸¤ä¸ª Kernel PMUï¼ˆPerformance Monitoring Unitï¼‰äº‹ä»¶ä»¥åŠ perf_event_open(2) ç³»ç»Ÿè°ƒç”¨å®ç°ã€‚</li><li><code>PSICollector</code>ï¼šç”¨äºæ§åˆ¶ PSI æŒ‡æ ‡é‡‡é›†å™¨ã€‚PSIï¼šPressure Stall Informationã€‚è¡¨ç¤ºå®¹å™¨åœ¨é‡‡é›†æ—¶é—´é—´éš”å†…ï¼Œå› ä¸ºç­‰å¾… cpuã€å†…å­˜ã€IO èµ„æºåˆ†é…è€Œé˜»å¡çš„ä»»åŠ¡æ•°ã€‚ä½¿ç”¨ PSI é‡‡é›†å™¨å‰ï¼Œéœ€è¦åœ¨ Anolis OS ä¸­å¼€å¯ PSI åŠŸèƒ½ï¼Œæ‚¨å¯ä»¥å‚è€ƒ<a href="https://help.aliyun.com/document_detail/155464.html" target="_blank" rel="noopener noreferrer">æ–‡æ¡£</a>è·å–å¼€å¯æ–¹æ³•ã€‚</li></ul><p>Performance Collector ç›®å‰æ˜¯é»˜è®¤å…³é—­çš„ã€‚æ‚¨å¯ä»¥é€šè¿‡ä¿®æ”¹ Koordlet çš„ feature-gates é¡¹æ¥ä½¿ç”¨å®ƒï¼Œæ­¤é¡¹ä¿®æ”¹ä¸ä¼šå½±å“å…¶ä»– feature-gate</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl edit ds koordlet -n koordinator-system</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">args</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># modify here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># - -feature-gates=BECPUEvict=true,BEMemoryEvict=true,CgroupReconcile=true,Accelerators=true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">feature</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">gates=BECPUEvict=true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">BEMemoryEvict=true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">CgroupReconcile=true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">Accelerators=true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">CPICollector=true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">PSICollector=true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="servicemonitor">ServiceMonitor<a href="#servicemonitor" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>v1.1.0 ç‰ˆæœ¬çš„ Koordinator ä¸º Koordlet å¢åŠ äº† ServiceMonitor çš„èƒ½åŠ›ï¼Œå°†æ‰€é‡‡é›†æŒ‡æ ‡é€šè¿‡ Prometheus æš´éœ²å‡ºæ¥ï¼Œç”¨æˆ·å¯åŸºäºæ­¤èƒ½åŠ›é‡‡é›†ç›¸åº”æŒ‡æ ‡è¿›è¡Œåº”ç”¨ç³»ç»Ÿçš„åˆ†æä¸ç®¡ç†ã€‚</p><p>ServiceMonitor ç”± Prometheus å¼•å…¥ï¼Œæ•…åœ¨ helm chart ä¸­è®¾ç½®é»˜è®¤ä¸å¼€å¯å®‰è£…ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å®‰è£…ServiceMonitorï¼š</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm install koordinator https://... --set koordlet.enableServiceMonitor=true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>éƒ¨ç½²åå¯åœ¨ Prometheus UI æ‰¾åˆ°è¯¥ Targetsã€‚</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># HELP koordlet_container_cpi Container cpi collected by koordlet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># TYPE koordlet_container_cpi gauge</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">koordlet_container_cpi{container_id=&quot;containerd://498de02ddd3ad7c901b3c80f96c57db5b3ed9a817dbfab9d16b18be7e7d2d047&quot;,container_name=&quot;koordlet&quot;,cpi_field=&quot;cycles&quot;,node=&quot;your-node-name&quot;,pod_name=&quot;koordlet-x8g2j&quot;,pod_namespace=&quot;koordinator-system&quot;,pod_uid=&quot;3440fb9c-423b-48e9-8850-06a6c50f633d&quot;} 2.228107503e+09</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">koordlet_container_cpi{container_id=&quot;containerd://498de02ddd3ad7c901b3c80f96c57db5b3ed9a817dbfab9d16b18be7e7d2d047&quot;,container_name=&quot;koordlet&quot;,cpi_field=&quot;instructions&quot;,node=&quot;your-node-name&quot;,pod_name=&quot;koordlet-x8g2j&quot;,pod_namespace=&quot;koordinator-system&quot;,pod_uid=&quot;3440fb9c-423b-48e9-8850-06a6c50f633d&quot;} 4.1456092e+09</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å¯ä»¥æœŸå¾…çš„æ˜¯ï¼ŒKoordinator å¹²æ‰°æ£€æµ‹çš„èƒ½åŠ›åœ¨æ›´å¤æ‚çš„çœŸå®åœºæ™¯ä¸‹è¿˜éœ€è¦æ›´å¤šæ£€æµ‹æŒ‡æ ‡çš„è¡¥å……ï¼Œåç»­å°†åœ¨å¦‚å†…å­˜ã€ç£ç›˜ IO ç­‰å…¶ä»–è¯¸å¤šèµ„æºçš„æŒ‡æ ‡é‡‡é›†å»ºè®¾æ–¹é¢æŒç»­å‘åŠ›ã€‚</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="å…¶ä»–æ›´æ–°ç‚¹">å…¶ä»–æ›´æ–°ç‚¹<a href="#å…¶ä»–æ›´æ–°ç‚¹" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>é€šè¿‡ <a href="https://github.com/koordinator-sh/koordinator/releases/tag/v1.1.0" target="_blank" rel="noopener noreferrer">v1.1 release</a> é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°æ›´å¤šç‰ˆæœ¬æ‰€åŒ…å«çš„æ–°å¢åŠŸèƒ½ã€‚</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>æ ‡ç­¾ï¼š</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/zh-Hans/blog/tags/release">release</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/zh-Hans/blog/release-v1.0.0">Koordinator v1.0: æ­£å¼å‘å¸ƒ</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-11-03T00:00:00.000Z" itemprop="datePublished">2022å¹´11æœˆ3æ—¥</time> Â· <!-- -->7 åˆ†é’Ÿé˜…è¯»</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/eahydra" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/eahydra.png" alt="Joseph"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/eahydra" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Joseph</span></a></div><small class="avatar__subtitle" itemprop="description">Koordinator maintainer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Koordinator ä»Šå¹´3æœˆä»½å¼€æºä»¥æ¥ï¼Œå…ˆåå‘å¸ƒäº†7ä¸ªç‰ˆæœ¬ï¼Œé€æ­¥çš„æŠŠé˜¿é‡Œå·´å·´&amp;é˜¿é‡Œäº‘å†…éƒ¨çš„æ··éƒ¨ç³»ç»Ÿçš„æ ¸å¿ƒèƒ½åŠ›è¾“å‡ºåˆ°å¼€æºç¤¾åŒºï¼Œå¹¶åœ¨ä¸­é—´è¿‡ç¨‹ä¸­é€æ¸çš„è¢« Kubernetesã€å¤§æ•°æ®ã€é«˜æ€§èƒ½è®¡ç®—ã€æœºå™¨å­¦ä¹ é¢†åŸŸæˆ–è€…ç¤¾åŒºçš„å…³æ³¨ï¼ŒKoordinator ç¤¾åŒºä¹Ÿé€æ­¥è·å¾—äº†ä¸€äº›è´¡çŒ®è€…çš„æ”¯æŒï¼Œå¹¶æœ‰ä¸€äº›ä¼ä¸šå¼€å§‹é€æ­¥çš„åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ Koordinator è§£å†³å®é™…ç”Ÿäº§ä¸­é‡åˆ°çš„æˆæœ¬é—®é¢˜ã€æ··éƒ¨é—®é¢˜ç­‰ã€‚ ç»è¿‡ Koordinator ç¤¾åŒºçš„åŠªåŠ›ï¼Œæˆ‘ä»¬æ€€ç€ååˆ†æ¿€åŠ¨çš„å¿ƒæƒ…å‘å¤§å®¶å®£å¸ƒ Koordinator 1.0 ç‰ˆæœ¬æ­£å¼å‘å¸ƒã€‚</p><p>Koordinator é¡¹ç›®æ—©æœŸç€é‡å»ºè®¾æ ¸å¿ƒæ··éƒ¨èƒ½åŠ› -- å·®å¼‚åŒ– SLOï¼Œå¹¶ä¸”ä¸ºäº†è®©ç”¨æˆ·æ›´å®¹æ˜“çš„ä½¿ç”¨ Koordinator çš„æ··éƒ¨èƒ½åŠ›ï¼ŒKoordinator æä¾›äº† ClusterColocationProfile æœºåˆ¶å¸®åŠ©ç”¨æˆ·å¯ä»¥ä¸ç”¨ä¿®æ”¹å­˜é‡ä»£ç å®Œæˆä¸åŒå·¥ä½œè´Ÿè½½çš„æ··éƒ¨ï¼Œè®©ç”¨æˆ·é€æ­¥çš„ç†Ÿæ‚‰æ··éƒ¨æŠ€æœ¯ã€‚éšå Koordinaor é€æ­¥åœ¨èŠ‚ç‚¹ä¾§ QoS ä¿éšœæœºåˆ¶ä¸Šåšäº†å¢å¼ºï¼Œæä¾›äº†åŒ…æ‹¬ä½†ä¸é™äº CPU Suppressã€CPU Burstã€ Memory QoSã€L3 Cache/MBA èµ„æºéš”ç¦»æœºåˆ¶å’ŒåŸºäºæ»¡è¶³åº¦é©±é€æœºåˆ¶ç­‰å¤šç§èƒ½åŠ›ï¼Œè§£å†³äº†å¤§éƒ¨åˆ†èŠ‚ç‚¹ä¾§å·¥ä½œè´Ÿè½½çš„ç¨³å®šæ€§é—®é¢˜ã€‚é…åˆä½¿ç”¨ Koordinator Runtime Proxy ç»„ä»¶ï¼Œå¯ä»¥æ›´å¥½çš„å…¼å®¹ Kubernetes kubelet åŸç”Ÿç®¡ç†æœºåˆ¶ã€‚</p><p>å¹¶ä¸” Koordinator åœ¨ä»»åŠ¡è°ƒåº¦å’Œ QoS æ„ŸçŸ¥è°ƒåº¦ä»¥åŠé‡è°ƒåº¦ç­‰æ–¹é¢ä¹Ÿéƒ½æä¾›äº†ä¸€äº›åˆ›æ–°æ–¹æ¡ˆï¼Œå»ºè®¾äº†å…¨é¢å…¼å®¹ Kubernetes CPU ç®¡ç†æœºåˆ¶çš„ç²¾ç»†åŒ– CPU è°ƒåº¦èƒ½åŠ›ï¼Œé¢å‘èŠ‚ç‚¹å®é™…è´Ÿè½½çš„å‡è¡¡è°ƒåº¦èƒ½åŠ›ã€‚ä¸ºäº†æ›´å¥½çš„è®©ç”¨æˆ·ç®¡ç†å¥½èµ„æºï¼Œ Koordinator è¿˜æä¾›äº†èµ„æºé¢„ç•™èƒ½åŠ›ï¼ˆReservation)ï¼Œå¹¶ä¸” Koordinator åŸºäº Kubernetes ç¤¾åŒºå·²æœ‰çš„Coschedulingã€ElasticQuota Scheduling èƒ½åŠ›åšäº†è¿›ä¸€æ­¥çš„å¢å¼ºï¼Œä¸ºä»»åŠ¡è°ƒåº¦é¢†åŸŸæ³¨å…¥äº†æ–°çš„æ´»åŠ›ã€‚Koordinator æä¾›äº†å…¨æ–°çš„é‡è°ƒåº¦å™¨æ¡†æ¶ï¼Œç€é‡å»ºè®¾ Descheduler çš„æ‰©å±•æ€§å’Œå®‰å…¨æ€§é—®é¢˜ã€‚</p><h1>å®‰è£…æˆ–å‡çº§ Koordinator v1.0.0</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ä½¿ç”¨-helm-å®‰è£…">ä½¿ç”¨ Helm å®‰è£…<a href="#ä½¿ç”¨-helm-å®‰è£…" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>æ‚¨å¯ä»¥é€šè¿‡ helm v3.5+ éå¸¸æ–¹ä¾¿çš„å®‰è£… Koordinatorï¼ŒHelm æ˜¯ä¸€ä¸ªç®€å•çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œæ‚¨å¯ä»¥ä» <a href="https://github.com/helm/helm/releases" target="_blank" rel="noopener noreferrer">è¿™é‡Œ</a> è·å–å®ƒã€‚</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Firstly add koordinator charts repository if you haven&#x27;t do this.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ helm repo </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> koordinator-sh https://koordinator-sh.github.io/charts/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># [Optional]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ helm repo update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Install the latest version.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ helm </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> koordinator koordinator-sh/koordinator --version </span><span class="token number" style="color:#36acaa">1.0</span><span class="token plain">.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>ç‰ˆæœ¬åŠŸèƒ½ç‰¹æ€§è§£è¯»</h1><p>Koordinator v1.0 æ•´ä½“æ–°å¢çš„ç‰¹æ€§å¹¶ä¸å¤šï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸€äº›å˜åŒ–</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ç‹¬ç«‹-api-repo">ç‹¬ç«‹ API Repo<a href="#ç‹¬ç«‹-api-repo" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>ä¸ºäº†æ›´æ–¹ä¾¿é›†æˆå’Œä½¿ç”¨ Koordiantor å®šä¹‰çš„ APIï¼Œå¹¶é¿å…å› ä¾èµ– Koordiantor å¼•å…¥é¢å¤–çš„ä¾èµ–æˆ–è€…ä¾èµ–å†²çªé—®é¢˜ï¼Œæˆ‘ä»¬å»ºç«‹äº†ç‹¬ç«‹çš„ API Repo: <a href="https://github.com/koordinator-sh/apis" target="_blank" rel="noopener noreferrer">koordinator-sh/apis</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="æ–°å¢-elasticquota-webhook">æ–°å¢ ElasticQuota Webhook<a href="#æ–°å¢-elasticquota-webhook" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>åœ¨ Koordinator v0.7 ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬åŸºäº Kubernetes sig-scheduler æä¾›çš„ ElasticQuota åšäº†è¯¸å¤šå¢å¼ºï¼Œæä¾›äº†æ ‘å½¢ç®¡ç†æœºåˆ¶ï¼Œå¹¶æä¾›äº†å…¬å¹³æ€§ä¿éšœæœºåˆ¶ç­‰ï¼Œå¯ä»¥å¾ˆå¥½çš„å¸®åŠ©æ‚¨è§£å†³ä½¿ç”¨ ElasticQuota é‡åˆ°çš„é—®é¢˜ã€‚åœ¨ Koordinator v1.0 ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥æä¾›äº† ElasticQuota Webhookï¼Œå¸®åŠ©æ‚¨åœ¨ä½¿ç”¨ ElasticQuota æ ‘å½¢ç®¡ç†æœºåˆ¶æ—¶ï¼Œä¿éšœæ–°çš„ ElasticQuota å¯¹è±¡éµå¾ª Koordinator å®šä¹‰çš„è§„èŒƒæˆ–çº¦æŸï¼š</p><ol><li>é™¤äº†æ ¹èŠ‚ç‚¹ï¼Œå…¶ä»–æ‰€æœ‰å­èŠ‚ç‚¹çš„ min ä¹‹å’Œè¦å°äºçˆ¶èŠ‚ç‚¹çš„ minã€‚</li><li>ä¸é™åˆ¶å­èŠ‚ç‚¹ maxï¼Œå…è®¸å­èŠ‚ç‚¹çš„ max å¤§äºçˆ¶èŠ‚ç‚¹çš„ maxã€‚è€ƒè™‘ä»¥ä¸‹åœºæ™¯ï¼Œé›†ç¾¤ä¸­æœ‰ 2 ä¸ª ElasticQuota å­æ ‘ï¼šdev-parent å’Œ production-parentï¼Œæ¯ä¸ªå­æ ‘éƒ½æœ‰å‡ ä¸ªå­ ElasticQuotaã€‚ å½“ production-parent å¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åªé™ä½ dev-parent çš„ max é™åˆ¶  dev-parent æ•´é¢—å­æ ‘çš„èµ„æºä½¿ç”¨é‡ï¼Œè€Œä¸æ˜¯é™ä½ dev-parent å­æ ‘çš„æ¯ä¸ªå­ ElasticQuota çš„maxé™åˆ¶ç”¨é‡ã€‚</li><li>Pod ä¸èƒ½ä½¿ç”¨çˆ¶èŠ‚ç‚¹ElasticQuotaã€‚å¦‚æœæ”¾å¼€è¿™ä¸ªé™åˆ¶ï¼Œä¼šå¯¼è‡´æ•´ä¸ªå¼¹æ€§ Quota çš„æœºåˆ¶å˜çš„å¼‚å¸¸å¤æ‚ï¼Œæš‚æ—¶ä¸è€ƒè™‘æ”¯æŒè¿™ç§åœºæ™¯ã€‚</li><li>åªæœ‰çˆ¶èŠ‚ç‚¹å¯ä»¥æŒ‚å­èŠ‚ç‚¹ï¼Œä¸å…è®¸å­èŠ‚ç‚¹æŒ‚å­èŠ‚ç‚¹</li><li>æš‚æ—¶ä¸å…è®¸æ”¹å˜ ElasticQuota çš„ <code>quota.scheduling.koordinator.sh/is-parent</code>å±æ€§</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="è¿›ä¸€æ­¥å®Œå–„-elasticquota-scheduling">è¿›ä¸€æ­¥å®Œå–„ ElasticQuota Scheduling<a href="#è¿›ä¸€æ­¥å®Œå–„-elasticquota-scheduling" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>åœ¨ Koordinator v0.7 ç‰ˆæœ¬ä¸­ï¼Œkoord-scheduler çš„ä¸»å‰¯ Pod éƒ½ä¼šå¯åŠ¨ ElasticQuota Controller å¹¶éƒ½ä¼šæ›´æ–° ElasticQuota å¯¹è±¡ã€‚åœ¨ Koordinator v1.0 ä¸­æˆ‘ä»¬ä¿®å¤äº†è¯¥é—®é¢˜ï¼Œç¡®ä¿åªæœ‰ä¸» Pod å¯ä»¥å¯åŠ¨ Controller å¹¶æ›´æ–° ElasticQuota å¯¹è±¡ã€‚ è¿˜ä¼˜åŒ–äº† ElasticQuota Controller æ½œåœ¨çš„é¢‘ç¹æ›´æ–° ElasticQuota å¯¹è±¡çš„é—®é¢˜ï¼Œå½“æ£€æŸ¥åˆ° ElasticQuota å„ç»´åº¦æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶æ‰ä¼šæ›´æ–°ï¼Œé™ä½é¢‘ç¹æ›´æ–°ç»™ APIServer å¸¦æ¥çš„å‹åŠ›ã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="è¿›ä¸€æ­¥å®Œå–„-device-share-scheduling">è¿›ä¸€æ­¥å®Œå–„ Device Share Scheduling<a href="#è¿›ä¸€æ­¥å®Œå–„-device-share-scheduling" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>Koordinator v1.0 ä¸­ koordlet ä¼šä¸ŠæŠ¥ GPU çš„å‹å·å’Œé©±åŠ¨ç‰ˆæœ¬åˆ° Device CRD å¯¹è±¡ä¸­ï¼Œå¹¶ä¼šç”± koord-manager åŒæ­¥æ›´æ–°åˆ° Node å¯¹è±¡ï¼Œè¿½åŠ ç›¸åº”çš„æ ‡ç­¾ã€‚</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">kubernetes.io/gpu-driver</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 460.91.03</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">kubernetes.io/gpu-model</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Tesla</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">T4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cn</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">hangzhou.10.0.4.164</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">status</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="koordinator-runtime-proxy-å¢å¼ºå…¼å®¹æ€§">Koordinator Runtime Proxy å¢å¼ºå…¼å®¹æ€§<a href="#koordinator-runtime-proxy-å¢å¼ºå…¼å®¹æ€§" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>åœ¨ Koordinator ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œkoord-runtime-proxy å’Œ koordlet ä¸€èµ·å®‰è£…åï¼Œå¦‚æœ koordlet å¼‚å¸¸æˆ–è€… koordlet å¸è½½/é‡è£…ç­‰åœºæ™¯ä¸‹ï¼Œä¼šé‡åˆ°æ–°è°ƒåº¦åˆ°èŠ‚ç‚¹çš„ Pod æ— æ³•åˆ›å»ºå®¹å™¨çš„é—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œkoord-runtime-proxy ä¼šæ„ŸçŸ¥ Pod æ˜¯å¦å…·æœ‰ç‰¹æ®Šçš„ label <code>runtimeproxy.koordinator.sh/skip-hookserver=true</code>ï¼Œå¦‚æœ Pod å­˜åœ¨è¯¥æ ‡ç­¾ï¼Œkoord-runtime-proxy ä¼šç›´æ¥æŠŠ CRI è¯·æ±‚è½¬å‘ç»™ containerd/docker ç­‰ runtimeã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="å…¶ä»–æ”¹åŠ¨">å…¶ä»–æ”¹åŠ¨<a href="#å…¶ä»–æ”¹åŠ¨" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>ä½ å¯ä»¥é€šè¿‡ <a href="https://github.com/koordinator-sh/koordinator/releases/tag/v1.0.0" target="_blank" rel="noopener noreferrer">Github release</a> é¡µé¢ï¼Œæ¥æŸ¥çœ‹æ›´å¤šçš„æ”¹åŠ¨ä»¥åŠå®ƒä»¬çš„ä½œè€…ä¸æäº¤è®°å½•ã€‚</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>æ ‡ç­¾ï¼š</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/zh-Hans/blog/tags/release">release</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/zh-Hans/blog/release-v0.7.0">Koordinator v0.7: ä¸ºä»»åŠ¡è°ƒåº¦é¢†åŸŸæ³¨å…¥æ–°æ´»åŠ›</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-09-23T00:00:00.000Z" itemprop="datePublished">2022å¹´9æœˆ23æ—¥</time> Â· <!-- -->34 åˆ†é’Ÿé˜…è¯»</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/eahydra" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/eahydra.png" alt="Joseph"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/eahydra" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Joseph</span></a></div><small class="avatar__subtitle" itemprop="description">Koordinator maintainer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><a href="https://koordinator.sh/" target="_blank" rel="noopener noreferrer">Koordinator[1]</a> ç»§ä¸Šæ¬¡ <a href="https://mp.weixin.qq.com/s/YdoxVxz_91ZFemF8JuxRvQ" target="_blank" rel="noopener noreferrer">v0.6ç‰ˆæœ¬[2]</a> å‘å¸ƒåï¼Œç»è¿‡ Koordinator ç¤¾åŒºçš„åŠªåŠ›ï¼Œæˆ‘ä»¬è¿æ¥äº†å…·æœ‰é‡å¤§æ„ä¹‰çš„ v0.7 ç‰ˆæœ¬ã€‚åœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­ç€é‡è§£å†³æœºå™¨å­¦ä¹ ã€å¤§æ•°æ®åœºæ™¯éœ€è¦çš„ä»»åŠ¡è°ƒåº¦èƒ½åŠ›ï¼Œä¾‹å¦‚ CoSchedulingã€ElasticQuotaå’Œç²¾ç»†åŒ–çš„ GPU å…±äº«è°ƒåº¦èƒ½åŠ›ã€‚å¹¶åœ¨è°ƒåº¦é—®é¢˜è¯Šæ–­åˆ†ææ–¹é¢å¾—åˆ°äº†å¢å¼ºï¼Œé‡è°ƒåº¦å™¨ä¹Ÿæå¤§çš„æå‡äº†å®‰å…¨æ€§ï¼Œé™ä½äº†é‡è°ƒåº¦çš„é£é™©ã€‚</p><h1>ç‰ˆæœ¬åŠŸèƒ½ç‰¹æ€§è§£è¯»</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-ä»»åŠ¡è°ƒåº¦">1. ä»»åŠ¡è°ƒåº¦<a href="#1-ä»»åŠ¡è°ƒåº¦" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-enhanced-coscheduling">1.1 Enhanced Coscheduling<a href="#11-enhanced-coscheduling" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>Gang schedulingæ˜¯åœ¨å¹¶å‘ç³»ç»Ÿä¸­å°†å¤šä¸ªç›¸å…³è”çš„è¿›ç¨‹è°ƒåº¦åˆ°ä¸åŒå¤„ç†å™¨ä¸ŠåŒæ—¶è¿è¡Œçš„ç­–ç•¥ï¼Œå…¶æœ€ä¸»è¦çš„åŸåˆ™æ˜¯ä¿è¯æ‰€æœ‰ç›¸å…³è”çš„è¿›ç¨‹èƒ½å¤ŸåŒæ—¶å¯åŠ¨ï¼Œé˜²æ­¢éƒ¨åˆ†è¿›ç¨‹çš„å¼‚å¸¸ï¼Œå¯¼è‡´æ•´ä¸ªå…³è”è¿›ç¨‹ç»„çš„é˜»å¡ã€‚ä¾‹å¦‚å½“æäº¤ä¸€ä¸ªJobæ—¶ä¼šäº§ç”Ÿå¤šä¸ªä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡æœŸæœ›è¦ä¹ˆå…¨éƒ¨è°ƒåº¦æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚è¿™ç§éœ€æ±‚ç§°ä¸º All-or-Nothingï¼Œå¯¹åº”çš„å®ç°è¢«ç§°ä½œ Gang Scheduling(or Coscheduling) ã€‚<br>Koordinator åœ¨å¯åŠ¨ä¹‹åˆï¼ŒæœŸæœ›æ”¯æŒ Kubernetes å¤šç§å·¥ä½œè´Ÿè½½çš„æ··éƒ¨è°ƒåº¦ï¼Œæé«˜å·¥ä½œè´Ÿè½½çš„è¿è¡Œæ—¶æ•ˆç‡å’Œå¯é æ€§ï¼Œå…¶ä¸­å°±åŒ…æ‹¬äº†æœºå™¨å­¦ä¹ å’Œå¤§æ•°æ®é¢†åŸŸä¸­å¹¿æ³›å­˜åœ¨çš„å…·å¤‡ All-or-Nothing éœ€æ±‚çš„ä½œä¸šè´Ÿè½½ã€‚ ä¸ºäº†è§£å†³ All-or-Nothing è°ƒåº¦éœ€æ±‚ï¼ŒKoordinator v0.7.0 åŸºäºç¤¾åŒºå·²æœ‰çš„ Coscheduling å®ç°äº† Enhanced Coschedulingã€‚<br>Enhanced Coscheduling ç§‰æ‰¿ç€ Koordiantor å…¼å®¹ç¤¾åŒºçš„åŸåˆ™ï¼Œå®Œå…¨å…¼å®¹ç¤¾åŒº Coscheduling å’Œ ä¾èµ–çš„ PodGroup CRDã€‚å·²ç»ä½¿ç”¨ PodGroup çš„ç”¨æˆ·å¯ä»¥æ— ç¼å‡çº§åˆ° Koordinatorã€‚<br>é™¤æ­¤ä¹‹å¤–ï¼ŒEnhanced Coscheduling è¿˜å®ç°äº†å¦‚ä¸‹å¢å¼ºèƒ½åŠ›ï¼š</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="æ”¯æŒ-strict-å’Œ-nonstrict-ä¸¤ç§æ¨¡å¼">æ”¯æŒ <code>Strict</code> å’Œ <code>NonStrict</code> ä¸¤ç§æ¨¡å¼<a href="#æ”¯æŒ-strict-å’Œ-nonstrict-ä¸¤ç§æ¨¡å¼" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>ä¸¤ç§æ¨¡å¼çš„åŒºåˆ«åœ¨äº <code>Strict</code>æ¨¡å¼ï¼ˆå³é»˜è®¤æ¨¡å¼ï¼‰ä¸‹è°ƒåº¦å¤±è´¥ä¼š Reject æ‰€æœ‰åˆ†é…åˆ°èµ„æºå¹¶å¤„äº Wait çŠ¶æ€çš„ Podï¼Œè€Œ <code>NonStrict</code> æ¨¡å¼ä¸ä¼šå‘èµ· Rejectã€‚NonStrict æ¨¡å¼ä¸‹ï¼ŒåŒå±äºä¸€ä¸ª PodGroup çš„ Pod A å’Œ PodB è°ƒåº¦æ—¶ï¼Œå¦‚æœ PodA è°ƒåº¦å¤±è´¥ä¸ä¼šå½±å“ PodB è°ƒåº¦ï¼Œ PodB è¿˜ä¼šç»§ç»­è¢«è°ƒåº¦ã€‚NonStrict æ¨¡å¼å¯¹äºä½“é‡è¾ƒå¤§çš„ Job æ¯”è¾ƒå‹å¥½ï¼Œå¯ä»¥è®©è¿™ç§å¤§ä½“é‡ Job æ›´å¿«çš„è°ƒåº¦å®Œæˆï¼Œä½†åŒæ—¶ä¹Ÿå¢åŠ äº†èµ„æºæ­»é”çš„é£é™©ã€‚åç»­ Koordinator ä¼šæä¾› NonStrict æ¨¡å¼ä¸‹è§£å†³æ­»é”çš„æ–¹æ¡ˆå®ç°ã€‚ <br>ç”¨æˆ·åœ¨ä½¿ç”¨æ—¶ï¼Œå¯ä»¥åœ¨ PodGroup æˆ–è€… Pod ä¸­è¿½åŠ  annotation <code>gang.scheduling.koordinator.sh/mode=NonStrict</code>å¼€å¯ NonStrict æ¨¡å¼ã€‚</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="æ”¹è¿›-podgroup-è°ƒåº¦å¤±è´¥çš„å¤„ç†æœºåˆ¶å®ç°æ›´é«˜æ•ˆçš„é‡è¯•è°ƒåº¦">æ”¹è¿› PodGroup è°ƒåº¦å¤±è´¥çš„å¤„ç†æœºåˆ¶ï¼Œå®ç°æ›´é«˜æ•ˆçš„é‡è¯•è°ƒåº¦<a href="#æ”¹è¿›-podgroup-è°ƒåº¦å¤±è´¥çš„å¤„ç†æœºåˆ¶å®ç°æ›´é«˜æ•ˆçš„é‡è¯•è°ƒåº¦" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>ä¸¾ä¸ªä¾‹å­ï¼ŒPodGroup A å…³è”äº†5ä¸ªPodï¼Œå…¶ä¸­å‰3ä¸ªPodé€šè¿‡Filter/Scoreï¼Œè¿›å…¥Waité˜¶æ®µï¼Œç¬¬4ä¸ªPodè°ƒåº¦å¤±è´¥ï¼Œå½“è°ƒåº¦ç¬¬5ä¸ªPodæ—¶ï¼Œå‘ç°ç¬¬4ä¸ªPodå·²ç»å¤±è´¥ï¼Œåˆ™æ‹’ç»è°ƒåº¦ã€‚åœ¨ç¤¾åŒº Coscheduling å®ç°ä¸­ï¼Œè°ƒåº¦å¤±è´¥çš„PodGroup ä¼šåŠ å…¥åˆ°åŸºäºcacheæœºåˆ¶çš„ lastDeniedPG  å¯¹è±¡ä¸­ï¼Œå½“ cache æ²¡æœ‰è¿‡æœŸï¼Œåˆ™ä¼šæ‹’ç»è°ƒåº¦ï¼›å¦‚æœè¿‡æœŸå°±å…è®¸ç»§ç»­è°ƒåº¦ã€‚å¯ä»¥çœ‹åˆ° cache çš„è¿‡æœŸæ—¶é—´å¾ˆå…³é”®ï¼Œè¿‡æœŸæ—¶é—´è®¾ç½®çš„è¿‡é•¿ä¼šå¯¼è‡´Podè¿Ÿè¿Ÿå¾—ä¸åˆ°è°ƒåº¦æœºä¼šï¼Œè®¾ç½®çš„è¿‡çŸ­ä¼šå‡ºç°é¢‘ç¹çš„æ— æ•ˆè°ƒåº¦ã€‚<br>è€Œåœ¨Enhanced Coscheduling ä¸­ï¼Œå®ç°äº†ä¸€ç§åŸºäº ScheduleCycle çš„é‡è¯•æœºåˆ¶ã€‚ä»¥ä¸Šåœºæ™¯ä¸ºä¾‹ï¼Œ5ä¸ªPodçš„ ScheduleCycle åˆå§‹å€¼ä¸º 0ï¼ŒPodGroup å¯¹åº”çš„ ScheduleCycle åˆå§‹å€¼ä¸º1ï¼›å½“æ¯ä¸€æ¬¡å°è¯•è°ƒåº¦ Pod æ—¶ï¼Œéƒ½ä¼šæ›´æ–° Pod ScheduleCycle ä¸º PodGroup ScheduleCycleã€‚å¦‚æœå…¶ä¸­ä¸€ä¸ª Pod è°ƒåº¦å¤±è´¥ï¼Œä¼šæ ‡è®°å½“å‰çš„ PodGroup ScheduleCycle æ— æ•ˆï¼Œä¹‹åæ‰€æœ‰å°äº PodGroup ScheduleCycle çš„ Pod éƒ½ä¼šè¢«æ‹’ç»è°ƒåº¦ã€‚å½“åŒä¸€ä¸ª PodGroup ä¸‹çš„æ‰€æœ‰ Pod éƒ½å°è¯•è°ƒåº¦ä¸€è½®åï¼ŒPod ScheduleCycle éƒ½æ›´æ–°ä¸ºå½“å‰ PodGroup ScheduleCycleï¼Œå¹¶é€’è¿› PodGroup ScheduleCycleï¼Œå¹¶æ ‡è®°å…è®¸è°ƒåº¦ã€‚è¿™ç§æ–¹å¼å¯ä»¥æœ‰æ•ˆè§„é¿åŸºäºè¿‡æœŸæ—¶é—´çš„ç¼ºé™·ï¼Œå®Œå…¨å–å†³äºè°ƒåº¦é˜Ÿåˆ—çš„é…ç½®é‡è¯•è°ƒåº¦ã€‚<br><img loading="lazy" alt="image.png" src="/zh-Hans/assets/images/gang-schedulue-cycle-597c5d13e7b13ec4e2e0752bc8e0678d.png" title="åŸºäº ScheduleCycle çš„é‡è¯•æœºåˆ¶" width="3078" height="922" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="æ”¯æŒå¤šä¸ª-podgroup-ä¸ºä¸€ç»„å®Œæˆ-gang-scheduling">æ”¯æŒå¤šä¸ª PodGroup ä¸ºä¸€ç»„å®Œæˆ Gang Scheduling<a href="#æ”¯æŒå¤šä¸ª-podgroup-ä¸ºä¸€ç»„å®Œæˆ-gang-scheduling" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>ä¸€äº›å¤æ‚çš„ Job æœ‰å¤šç§è§’è‰²ï¼Œæ¯ä¸ªè§’è‰²ç®¡ç†ä¸€æ‰¹ä»»åŠ¡ï¼Œæ¯ä¸ªè§’è‰²çš„ä»»åŠ¡è¦æ±‚æ”¯æŒ All-or-Nothing ï¼Œæ¯ä¸ªè§’è‰²çš„ MinMember è¦æ±‚ä¹Ÿä¸ä¸€æ ·ï¼Œå¹¶ä¸”æ¯ä¸ªè§’è‰²ä¹‹é—´ä¹Ÿè¦æ±‚ All-or-Nothingã€‚è¿™å°±å¯¼è‡´æ¯ä¸ªè§’è‰²éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ PodGroup ï¼Œå¹¶ä¸”è¿˜è¦æ±‚ PodGroup å³ä½¿æ»¡è¶³äº†ä¹Ÿéœ€è¦ç­‰å¾…å…¶ä»–è§’è‰²çš„ PodGroup å¿…é¡»æ»¡è¶³ã€‚ç¤¾åŒº Coscheduling æ— æ³•æ»¡è¶³è¿™ç§åœºæ™¯éœ€æ±‚ã€‚è€Œ Koordinator å®ç°çš„ Enhanced Coscheduling æ”¯æŒç”¨æˆ·åœ¨å¤šä¸ª PodGroup ä¸­å¢åŠ  anntation ç›¸å…³å…³è”å®ç°ï¼Œå¹¶æ”¯æŒè·¨Namespaceã€‚ä¾‹å¦‚ç”¨æˆ·æœ‰2ä¸ªPodGroup ï¼Œåå­—åˆ†åˆ«æ˜¯PodGroupAå’ŒPodGroupBï¼Œå¯ä»¥æŒ‰ç…§å¦‚ä¸‹ä¾‹å­å…³è”ä¸¤ä¸ª PodGroupï¼š</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PodGroup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> podGroupA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">gang.scheduling.koordinator.sh/groups</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;namespaceA/podGroupA&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;namespaceB/podGroupB&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="æ”¯æŒè½»é‡åŒ–-gang-åè®®">æ”¯æŒè½»é‡åŒ– Gang åè®®<a href="#æ”¯æŒè½»é‡åŒ–-gang-åè®®" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>å¦‚æœç”¨æˆ·ä¸å¸Œæœ›åˆ›å»º PodGroupï¼Œè®¤ä¸ºåˆ›å»º PodGroup å¤ªç¹çï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘åœ¨ä¸€ç»„ Pod ä¸­å¡«å……ç›¸åŒ annotation  <code>gang.scheduling.koordinator.sh/name=&lt;podGroupName&gt;</code> è¡¨ç¤ºè¿™ä¸€ç»„ Pod ä½¿ç”¨ Coscheduling è°ƒåº¦ã€‚å¦‚æœæœŸæœ›è®¾ç½® minMember ï¼Œå¯ä»¥è¿½åŠ  Annotation <code>gang.scheduling.koordinator.sh/min-available=&lt;availableNum&gt;</code>ã€‚ä¸¾ä¸ªä¾‹å­ï¼š</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">gang.scheduling.koordinator.sh/name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;pod-group-a&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">gang.scheduling.koordinator.sh/min-available</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;5&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> demo</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-elasticquota-scheduling">1.2 ElasticQuota Scheduling<a href="#12-elasticquota-scheduling" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>ä¸€å®¶ä¸­å¤§å‹å…¬å¸å†…æœ‰å¤šä¸ªäº§å“å’Œç ”å‘å›¢é˜Ÿï¼Œå…±ç”¨å¤šä¸ªæ¯”è¾ƒå¤§è§„æ¨¡çš„ Kubernetes é›†ç¾¤ï¼Œè¿™äº›é›†ç¾¤å†…å«æœ‰çš„å¤§é‡ CPU/Memory/Disk ç­‰èµ„æºè¢«èµ„æºè¿è¥å›¢é˜Ÿç»Ÿä¸€ç®¡ç†ã€‚è¿è¥å›¢é˜Ÿå¾€å¾€åœ¨é‡‡è´­èµ„æºå‰ï¼Œé€šè¿‡é¢åº¦é¢„ç®—çš„æœºåˆ¶è®©å…¬å¸å†…æ¯ä¸ªå›¢é˜Ÿæ ¹æ®è‡ªèº«çš„éœ€æ±‚æäº¤é¢åº¦é¢„ç®—ã€‚ä¸šåŠ¡å›¢é˜Ÿæ­¤æ—¶ä¸€èˆ¬æ ¹æ®ä¸šåŠ¡å½“å‰å’Œå¯¹æœªæ¥çš„é¢„æœŸåšå¥½é¢åº¦é¢„ç®—ã€‚æœ€ç†æƒ³çš„æƒ…å†µæ˜¯æ¯ä¸€ä»½é¢åº¦éƒ½èƒ½å¤Ÿè¢«ä½¿ç”¨ï¼Œä½†ç°å®å‘Šè¯‰æˆ‘ä»¬è¿™æ˜¯ä¸ç°å®çš„ã€‚å¾€å¾€å‡ºç°çš„é—®é¢˜æ˜¯ï¼š</p><ol><li>å›¢é˜Ÿ A é«˜ä¼°äº†ä¸šåŠ¡çš„å‘å±•é€Ÿåº¦ï¼Œç”³è¯·äº†å¤ªå¤šçš„é¢åº¦ç”¨ä¸å®Œ</li><li>å›¢é˜Ÿ B ä½ä¼°äº†ä¸šåŠ¡çš„å‘å±•é€Ÿåº¦ï¼Œç”³è¯·çš„é¢åº¦ä¸å¤Ÿç”¨</li><li>å›¢é˜Ÿ C å®‰æ’äº†ä¸€åœºæ´»åŠ¨ï¼Œæ‰‹ä¸Šçš„é¢åº¦ä¸å¤Ÿå¤šäº†ï¼Œä½†æ˜¯æ´»åŠ¨åªæŒç»­å‡ å‘¨ï¼Œç”³è¯·å¤ªå¤šé¢åº¦å’Œèµ„æºä¹Ÿä¼šæµªè´¹æ‰ã€‚</li><li>å›¢é˜Ÿ D ä¸‹é¢è¿˜æœ‰å„ä¸ªå­å›¢é˜Ÿå’Œä¸šåŠ¡ï¼Œæ¯ä¸ªå­å›¢é˜Ÿå†…ä¹Ÿä¼šå‡ºç°ç±»ä¼¼A B C ä¸‰ä¸ªå›¢é˜Ÿçš„æƒ…å†µï¼Œè€Œä¸”å…¶ä¸­æœ‰äº›å›¢é˜Ÿçš„ä¸šåŠ¡ä¸´æ—¶çªå‘éœ€è¦æäº¤ä¸€äº›è®¡ç®—ä»»åŠ¡è¦äº¤ä¸ªå®¢æˆ·ï¼Œä½†æ˜¯æ²¡æœ‰é¢åº¦äº†ï¼Œèµ°é¢åº¦é¢„ç®—å®¡æ‰¹ä¹Ÿä¸å¤Ÿäº†ã€‚</li><li>......</li></ol><p>ä»¥ä¸Šå¤§å®¶æ—¥å¸¸ç»å¸¸é‡åˆ°çš„åœºæ™¯ï¼Œåœ¨æ··éƒ¨åœºæ™¯ã€å¤§æ•°æ®åœºæ™¯ï¼Œä¸´æ—¶æ€§çªå‘éœ€æ±‚åˆæ˜¯æ—¶å¸¸å‡ºç°çš„ï¼Œè¿™äº›èµ„æºçš„éœ€æ±‚éƒ½ç»™é¢åº¦ç®¡ç†å·¥ä½œå¸¦æ¥äº†æå¤§çš„æŒ‘æˆ˜ã€‚åšå¥½é¢åº¦ç®¡ç†å·¥ä½œï¼Œä¸€æ–¹é¢é¿å…è¿‡åº¦é‡‡è´­èµ„æºé™ä½æˆæœ¬ï¼Œåˆè¦åœ¨ä¸´æ—¶éœ€è¦é¢åº¦æ—¶ä¸é‡‡è´­èµ„æºæˆ–è€…å°½é‡å°‘çš„é‡‡è´­èµ„æºï¼›å¦ä¸€æ–¹é¢ä¸èƒ½å› ä¸ºé¢åº¦é—®é¢˜é™åˆ¶èµ„æºä½¿ç”¨ç‡ï¼Œé¢åº¦ç®¡ç†ä¸å¥½å°±ä¼šå¯¼è‡´å³ä½¿æœ‰æ¯”è¾ƒå¥½çš„æŠ€æœ¯å¸®åŠ©å¤ç”¨èµ„æºï¼Œä¹Ÿæ— æ³•å‘æŒ¥å…¶ä»·å€¼ã€‚ æ€»ä¹‹ï¼Œé¢åº¦ç®¡ç†å·¥ä½œæ˜¯å¹¿å¤§å…¬å¸æˆ–ç»„ç»‡éœ€é•¿æœŸé¢å¯¹ä¸”å¿…é¡»é¢å¯¹çš„é—®é¢˜ã€‚<br>Kubernetes ResourceQuota å¯ä»¥è§£å†³é¢åº¦ç®¡ç†çš„éƒ¨åˆ†é—®é¢˜ã€‚ åŸç”Ÿ Kubernetes ResourceQuota API ç”¨äºæŒ‡å®šæ¯ä¸ª Namespace çš„æœ€å¤§èµ„æºé¢åº¦é‡ï¼Œå¹¶é€šè¿‡ admission æœºåˆ¶å®Œæˆå‡†å…¥æ£€æŸ¥ã€‚å¦‚æœ Namespace å½“å‰èµ„æºåˆ†é…æ€»é‡è¶…è¿‡ResourceQuota æŒ‡å®šçš„é…é¢ï¼Œåˆ™æ‹’ç»åˆ›å»º Podã€‚ Kubernetes ResourceQuota è®¾è®¡æœ‰ä¸€ä¸ªå±€é™æ€§ï¼šQuota  ç”¨é‡æ˜¯æŒ‰ç…§ Pod Requests èšåˆçš„ã€‚ è™½ç„¶è¿™ç§æœºåˆ¶å¯ä»¥ä¿è¯å®é™…çš„èµ„æºæ¶ˆè€—æ°¸è¿œä¸ä¼šè¶…è¿‡ ResourceQuota çš„é™åˆ¶ï¼Œä½†å®ƒå¯èƒ½ä¼šå¯¼è‡´èµ„æºåˆ©ç”¨ç‡ä½ï¼Œå› ä¸ºä¸€äº› Pod å¯èƒ½å·²ç»ç”³è¯·äº†èµ„æºä½†æœªèƒ½è°ƒåº¦ã€‚ <br>Kuberenetes Scheduler-Sig åæ¥ç»™å‡ºäº†ä¸€ä¸ªå€Ÿé‰´ Yarn Capacity Schedulingï¼Œç§°ä½œ ElasticQuota çš„è®¾è®¡æ–¹æ¡ˆå¹¶ç»™å‡ºäº†å…·ä½“çš„å®ç°ã€‚å…è®¸ç”¨æˆ·è®¾ç½® max å’Œ minï¼š</p><ul><li>max è¡¨ç¤ºç”¨æˆ·å¯ä»¥æ¶ˆè´¹çš„èµ„æºä¸Šé™</li><li>min è¡¨ç¤ºéœ€è¦ä¿éšœç”¨æˆ·å®ç°åŸºæœ¬åŠŸèƒ½/æ€§èƒ½æ‰€éœ€è¦çš„æœ€å°èµ„æºé‡</li></ul><p>é€šè¿‡è¿™ä¸¤ä¸ªå‚æ•°å¯ä»¥å¸®åŠ©ç”¨æˆ·å®ç°å¦‚ä¸‹çš„éœ€æ±‚ï¼š</p><ol><li>ç”¨æˆ·è®¾ç½® min &lt; max æ—¶ï¼Œå½“æœ‰çªå‘èµ„æºéœ€æ±‚æ—¶ï¼Œå³ä½¿å½“å‰ ElasticQuota çš„æ€»ç”¨é‡è¶…è¿‡äº† minï¼Œ ä½†åªè¦æ²¡æœ‰è¾¾åˆ° maxï¼Œé‚£ä¹ˆç”¨æˆ·å¯ä»¥ç»§ç»­åˆ›å»ºæ–°çš„ Pod åº”å¯¹æ–°çš„ä»»åŠ¡è¯·æ±‚ã€‚</li><li>å½“ç”¨æˆ·éœ€è¦æ›´å¤šèµ„æºæ—¶ï¼Œç”¨æˆ·å¯ä»¥ä»å…¶ä»– ElasticQuota ä¸­â€œå€Ÿç”¨(borrow)â€ è¿˜æ²¡æœ‰è¢«ä½¿ç”¨å¹¶ä¸”éœ€è¦é€šä¿éšœçš„ minã€‚</li><li>å½“ä¸€ä¸ª ElasticQuota éœ€è¦ä½¿ç”¨ min èµ„æºæ—¶ï¼Œä¼šé€šè¿‡æŠ¢å æœºåˆ¶ä»å…¶ä»–å€Ÿç”¨æ–¹æŠ¢å›æ¥ï¼Œå³é©±é€ä¸€äº›å…¶ä»–ElasticQuota è¶…è¿‡ min ç”¨é‡çš„ Podã€‚</li></ol><p>ElasticQuota è¿˜æœ‰ä¸€äº›å±€é™æ€§ï¼šæ²¡æœ‰å¾ˆå¥½çš„ä¿éšœå…¬å¹³æ€§ã€‚å‡å¦‚åŒä¸€ä¸ª ElasticQuota æœ‰å¤§é‡æ–°å»ºçš„Podï¼Œæœ‰å¯èƒ½ä¼šæ¶ˆè€—æ‰€æœ‰å…¶ä»–å¯ä»¥è¢«å€Ÿç”¨çš„Quotaï¼Œä»è€Œå¯¼è‡´åæ¥çš„ Pod å¯èƒ½æ‹¿ä¸åˆ° Quotaã€‚æ­¤æ—¶åªèƒ½é€šè¿‡æŠ¢å æœºåˆ¶æŠ¢å›æ¥ä¸€äº› Quotaã€‚<br>å¦å¤– ElasticQuota å’Œ Kubernetes ResourceQuota éƒ½æ˜¯é¢å‘ Namespaceçš„ï¼Œä¸æ”¯æŒå¤šçº§æ ‘å½¢ç»“æ„ï¼Œå¯¹äºä¸€äº›æœ¬èº«å…·å¤‡å¤æ‚ç»„ç»‡å…³ç³»çš„ä¼ä¸š/ç»„ç»‡ä¸èƒ½å¾ˆå¥½çš„ä½¿ç”¨ElasticQuota/Kubenretes ResourceQuota å®Œæˆé¢åº¦ç®¡ç†å·¥ä½œã€‚<br>Koordinator é’ˆå¯¹è¿™äº›é¢åº¦ç®¡ç†é—®é¢˜ï¼Œç»™å‡ºäº†ä¸€ç§åŸºäºç¤¾åŒº ElasticQuota å®ç°çš„æ”¯æŒå¤šçº§ç®¡ç†æ–¹å¼çš„å¼¹æ€§Quotaç®¡ç†æœºåˆ¶(multi hierarchy quota management)ã€‚å…·å¤‡å¦‚ä¸‹ç‰¹æ€§ï¼š</p><ul><li>å…¼å®¹ç¤¾åŒºçš„ ElasticQuota APIã€‚ç”¨æˆ·å¯ä»¥æ— ç¼å‡çº§åˆ° Koordinator</li><li>æ”¯æŒæ ‘å½¢ç»“æ„ç®¡ç† Quotaã€‚</li><li>æ”¯æŒæŒ‰ç…§å…±äº«æƒé‡(shared weight)ä¿éšœå…¬å¹³æ€§ã€‚</li><li>å…è®¸ç”¨æˆ·è®¾ç½®æ˜¯å¦å…è®¸å€Ÿç”¨Quota ç»™å…¶ä»–æ¶ˆè´¹å¯¹è±¡ã€‚</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="pod-å…³è”-elasticquota-æ–¹å¼">Pod å…³è” ElasticQuota æ–¹å¼<a href="#pod-å…³è”-elasticquota-æ–¹å¼" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>ç”¨æˆ·å¯ä»¥éå¸¸ä½¿ç”¨çš„ä½¿ç”¨è¯¥èƒ½åŠ›ï¼Œå¯ä»¥å®Œå…¨æŒ‰ç…§ ElasticQuota çš„ç”¨æ³•ï¼Œå³æ¯ä¸ª Namespace è®¾ç½®ä¸€ä¸ª ElasticQuota å¯¹è±¡ã€‚ä¹Ÿå¯ä»¥åœ¨ Pod ä¸­è¿½åŠ  Label å…³è” ElasticQuotaï¼š</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">quota.scheduling.koordinator.sh/name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;elastic-quota-a&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> demo</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="æ ‘å½¢ç»“æ„ç®¡ç†æœºåˆ¶å’Œä½¿ç”¨æ–¹æ³•">æ ‘å½¢ç»“æ„ç®¡ç†æœºåˆ¶å’Œä½¿ç”¨æ–¹æ³•<a href="#æ ‘å½¢ç»“æ„ç®¡ç†æœºåˆ¶å’Œä½¿ç”¨æ–¹æ³•" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>éœ€è¦ä½¿ç”¨æ ‘å½¢ç»“æ„ç®¡ç† Quota æ—¶ï¼Œéœ€è¦åœ¨ ElasticQuota ä¸­è¿½åŠ  Label  <code>quota.scheduling.koordinator.sh/is-parent</code>è¡¨ç¤ºå½“å‰ ElasticQuota æ˜¯å¦æ˜¯çˆ¶èŠ‚ç‚¹ï¼Œ<code>quota.scheduling.koordinator.sh/parent</code>è¡¨ç¤ºå½“å‰ ElasticQuota çš„çˆ¶èŠ‚ç‚¹ ElasticQuota çš„åå­—ã€‚ä¸¾ä¸ªä¾‹å­ï¼š<br><img loading="lazy" alt="image.png" src="/zh-Hans/assets/images/quota-tree-f8a3e073d27f66f203a45236769b9f58.png" width="2256" height="1156" class="img_ev3q"><br>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª ElasticQuota Root ä½œä¸ºæ ¹èŠ‚ç‚¹ï¼Œèµ„æºæ€»é‡ä¸ºCPU 100Cï¼Œå†…å­˜200Giï¼Œä»¥åŠå­èŠ‚ç‚¹ quota-a</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> scheduling.sigs.k8s.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ElasticQuota</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> parentA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">quota.scheduling.koordinator.sh/is-parent</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;true&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">quota.scheduling.koordinator.sh/allow-lent-resource</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;true&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">max</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 200Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">min</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 200Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> scheduling.sigs.k8s.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ElasticQuota</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> childA1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">quota.scheduling.koordinator.sh/is-parent</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;false&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">quota.scheduling.koordinator.sh/parent</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;parentA&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">quota.scheduling.koordinator.sh/allow-lent-resource</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;true&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">max</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">40</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 100Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">min</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 40Gi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>åœ¨ä½¿ç”¨æ ‘å½¢ç»“æ„ç®¡ç† ElasticQuota æ—¶ï¼Œæœ‰ä¸€äº›éœ€è¦éµå¾ªçš„çº¦æŸï¼š</p><ol><li>é™¤äº†æ ¹èŠ‚ç‚¹ï¼Œå…¶ä»–æ‰€æœ‰å­èŠ‚ç‚¹çš„ min ä¹‹å’Œè¦å°äºçˆ¶èŠ‚ç‚¹çš„ minã€‚</li><li>ä¸é™åˆ¶å­èŠ‚ç‚¹ maxï¼Œå…è®¸å­èŠ‚ç‚¹çš„ max å¤§äºçˆ¶èŠ‚ç‚¹çš„ maxã€‚è€ƒè™‘ä»¥ä¸‹åœºæ™¯ï¼Œé›†ç¾¤ä¸­æœ‰ 2 ä¸ª ElasticQuota å­æ ‘ï¼šdev-parent å’Œ production-parentï¼Œæ¯ä¸ªå­æ ‘éƒ½æœ‰å‡ ä¸ªå­ ElasticQuotaã€‚ å½“ production-parent å¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åªé™ä½ dev-parent çš„ max é™åˆ¶  dev-parent æ•´é¢—å­æ ‘çš„èµ„æºä½¿ç”¨é‡ï¼Œè€Œä¸æ˜¯é™ä½ dev-parent å­æ ‘çš„æ¯ä¸ªå­ ElasticQuota çš„maxé™åˆ¶ç”¨é‡ã€‚</li><li>Pod ä¸èƒ½ä½¿ç”¨çˆ¶èŠ‚ç‚¹ElasticQuotaã€‚å¦‚æœæ”¾å¼€è¿™ä¸ªé™åˆ¶ï¼Œä¼šå¯¼è‡´æ•´ä¸ªå¼¹æ€§ Quota çš„æœºåˆ¶å˜çš„å¼‚å¸¸å¤æ‚ï¼Œæš‚æ—¶ä¸è€ƒè™‘æ”¯æŒè¿™ç§åœºæ™¯ã€‚</li><li>åªæœ‰çˆ¶èŠ‚ç‚¹å¯ä»¥æŒ‚å­èŠ‚ç‚¹ï¼Œä¸å…è®¸å­èŠ‚ç‚¹æŒ‚å­èŠ‚ç‚¹</li><li>æš‚æ—¶ä¸å…è®¸æ”¹å˜ ElasticQuota çš„ <code>quota.scheduling.koordinator.sh/is-parent</code>å±æ€§</li></ol><p>æˆ‘ä»¬å°†åœ¨ä¸‹ä¸ªç‰ˆæœ¬ä¸­é€šè¿‡ webhook æœºåˆ¶å®ç°è¿™äº›çº¦æŸã€‚</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="å…¬å¹³æ€§ä¿éšœæœºåˆ¶">å…¬å¹³æ€§ä¿éšœæœºåˆ¶<a href="#å…¬å¹³æ€§ä¿éšœæœºåˆ¶" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>ä¸ºäº†æ–¹ä¾¿é˜…è¯»å’Œç†è§£å°†è¦ä»‹ç»çš„å…¬å¹³æ€§ä¿éšœæœºåˆ¶ï¼Œå…ˆæ˜ç¡®å‡ ä¸ªæ–°æ¦‚å¿µï¼š</p><ul><li>request è¡¨ç¤ºåŒä¸€ä¸ª ElasticQuota å…³è”çš„æ‰€æœ‰ Pod çš„èµ„æºè¯·æ±‚é‡ã€‚å¦‚æœä¸€ä¸ª ElasticQuota A çš„ request å°äº minï¼ŒElasticQuota B çš„ request å¤§äº minï¼Œé‚£ä¹ˆ ElasticQuota A æœªä½¿ç”¨çš„éƒ¨åˆ†ï¼Œå³ min - request å‰©ä½™çš„é‡é€šè¿‡å…¬å¹³æ€§ä¿éšœæœºåˆ¶å€Ÿç”¨ç»™ ElasticQuota B. å½“ ElasticQuota A éœ€è¦ä½¿ç”¨è¿™äº›å€Ÿèµ°çš„é‡æ—¶ï¼Œè¦æ±‚ ElasticQuota B ä¾æ®å…¬å¹³æ€§ä¿éšœæœºåˆ¶å½’è¿˜ç»™ ElasticQuota Aã€‚</li><li>runtime è¡¨ç¤º ElasticQuota å½“å‰å¯ä»¥ä½¿ç”¨çš„å®é™…èµ„æºé‡ã€‚å¦‚æœ request å°äº minï¼Œruntime ç­‰äº requestã€‚è¿™ä¹Ÿæ„å‘³ç€ï¼Œéœ€è¦éµå¾ª min è¯­ä¹‰ï¼Œåº”æ— æ¡ä»¶æ»¡è¶³ requestã€‚å¦‚æœ request å¤§äº minï¼Œä¸” min å°äº maxï¼Œå…¬å¹³æ€§ä¿éšœæœºåˆ¶ä¼šåˆ†é… runtime åœ¨min ä¸ max ä¹‹å‰ï¼Œå³ max &gt;= runtime &gt;= minã€‚</li><li>shared-weight è¡¨ç¤ºä¸€ä¸ª ElasticQuota çš„ç«äº‰åŠ›ï¼Œé»˜è®¤ç­‰äº ElasticQuota Maxã€‚</li></ul><p>é€šè¿‡å‡ ä¸ªä¾‹å­ä¸ºå¤§å®¶ä»‹ç»å…¬å¹³æ€§ä¿éšœæœºåˆ¶çš„è¿è¡Œè¿‡ç¨‹ï¼Œå‡è®¾å½“å‰é›†ç¾¤çš„ CPU æ€»é‡ä¸º100Cï¼Œå¹¶ä¸”æœ‰4ä¸ªElasticQuotaï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç»¿è‰²éƒ¨åˆ†ä¸º Request é‡ï¼šA å½“å‰çš„request ä¸º5ï¼ŒBå½“å‰çš„requestä¸º20ï¼ŒCå½“å‰çš„Requestä¸º30ï¼ŒDå½“å‰çš„Requestä¸º70ã€‚<br><img loading="lazy" alt="image.png" src="/zh-Hans/assets/images/quota-init-example-f430132dc764dc42583bca4042c06af4.png" width="1338" height="732" class="img_ev3q"><br>å¹¶ä¸”æˆ‘ä»¬æ³¨æ„åˆ°ï¼Œ A, B, C, D çš„ min ä¹‹å’Œæ˜¯60ï¼Œå‰©ä¸‹ 40 ä¸ªç©ºé—²é¢åº¦ï¼Œ åŒæ—¶ A è¿˜å¯ä»¥å€Ÿç»™ B, C, D 5ä¸ªé¢åº¦ï¼Œæ‰€ä»¥ä¸€å…±æœ‰45ä¸ªé¢åº¦è¢«Bï¼ŒCï¼ŒDå…±äº«ï¼Œæ ¹æ®å„ä¸ªElasticQuotaçš„ shared-weightï¼ŒBï¼ŒCï¼ŒDåˆ†åˆ«å¯¹åº”60ï¼Œ50å’Œ80ï¼Œè®¡ç®—å‡ºå„è‡ªå¯ä»¥å…±äº«çš„é‡ï¼š</p><ul><li>B å¯ä»¥è·å– 14ä¸ªé¢åº¦ï¼Œ 45 * 60 / (60 + 50 + 80) = 14</li><li>C å¯ä»¥è·å– 12ä¸ªé¢åº¦ï¼Œ 45 * 50 / (60 + 50 + 80) = 12</li><li>D å¯ä»¥è·å– 19ä¸ªé¢åº¦ï¼Œ 45 * 80 / (60 + 50 + 80) = 19</li></ul><p><img loading="lazy" alt="image.png" src="/zh-Hans/assets/images/quota-init-runtime-example-e5701da3ac0576ceb3dba51e52021c06.png" width="1444" height="736" class="img_ev3q"><br>ä½†æˆ‘ä»¬ä¹Ÿè¦æ³¨æ„çš„æ˜¯ï¼ŒCå’ŒDéœ€è¦æ›´å¤šé¢åº¦ï¼Œè€Œ Båªéœ€è¦5ä¸ªé¢åº¦å°±èƒ½æ»¡è¶³ Requestï¼Œå¹¶ä¸” B çš„minæ˜¯15ï¼Œä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬åªéœ€è¦ç»™ B 5ä¸ªé¢åº¦ï¼Œå‰©ä½™çš„9ä¸ªé¢åº¦ç»§ç»­åˆ†ç»™Cå’ŒDã€‚</p><ul><li>C å¯ä»¥è·å– 3ä¸ªé¢åº¦ï¼Œ 9 * 50 / (50 + 80) = 3</li><li>D å¯ä»¥è·å– 6ä¸ªé¢åº¦ï¼Œ  9 * 80 / (50 + 80) = 6</li></ul><p><a href="https://github.com/koordinator-sh/koordinator/blob/main/docs/images/runtimequota3.jpg" target="_blank" rel="noopener noreferrer"><img loading="lazy" src="https://github.com/koordinator-sh/koordinator/raw/main/docs/images/runtimequota3.jpg#crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=url&amp;id=XJyFI&amp;margin=%5Bobject%20Object%5D&amp;originHeight=782&amp;originWidth=1570&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=" class="img_ev3q"></a><br>æœ€ç»ˆæˆ‘ä»¬å¾—å‡ºå¦‚ä¸‹çš„åˆ†é…ç»“æœç»“æœï¼š</p><ul><li>A runtime = 5</li><li>B runtime = 20</li><li>C runtime = 35</li><li>D runtime = 40</li></ul><p><a href="https://github.com/koordinator-sh/koordinator/blob/main/docs/images/runtimequota4.jpg" target="_blank" rel="noopener noreferrer"><img loading="lazy" src="https://github.com/koordinator-sh/koordinator/raw/main/docs/images/runtimequota4.jpg#crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=url&amp;id=J8tN9&amp;margin=%5Bobject%20Object%5D&amp;originHeight=778&amp;originWidth=1560&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=" class="img_ev3q"></a><br>æ€»ç»“æ•´ä¸ªè¿‡ç¨‹å¯ä»¥çŸ¥é“ï¼š</p><ol><li>å½“å‰ request &lt; min æ—¶ï¼Œéœ€è¦å€Ÿå‡º lent-to-quotasï¼›å½“ request &gt; min æ—¶ï¼Œéœ€è¦å€Ÿå…¥ borrowed-qutoas</li><li>ç»Ÿè®¡æ‰€æœ‰ runtime &lt; min çš„ Quotaï¼Œè¿™äº›æ€»é‡å°±æ˜¯æ¥ä¸‹æ¥å¯è¢«å€Ÿå‡ºçš„é‡ã€‚</li><li>æ ¹æ® shared-weight è®¡ç®—æ¯ä¸ªElasticQuotaå¯ä»¥å€Ÿå…¥çš„é‡</li><li>å¦‚æœæœ€æ–°çš„ runtime &gt; reuqestï¼Œé‚£ä¹ˆ runtime - request å‰©ä½™çš„é‡å¯ä»¥å€Ÿç»™æ›´éœ€è¦çš„å¯¹è±¡ã€‚</li></ol><p>å¦å¤–è¿˜æœ‰ä¸€ç§æ—¥å¸¸ç”Ÿäº§æ—¶ä¼šé‡åˆ°çš„æƒ…å†µï¼šå³é›†ç¾¤å†…èµ„æºæ€»é‡ä¼šéšç€èŠ‚ç‚¹æ•…éšœã€èµ„æºè¿è¥ç­‰åŸå› é™ä½ï¼Œå¯¼è‡´æ‰€æœ‰ElasticQuotaçš„ min ä¹‹å’Œå¤§äºèµ„æºæ€»é‡ã€‚å½“å‡ºç°è¿™ç§æƒ…å†µæ—¶ï¼Œæˆ‘ä»¬æ— æ³•ç¡®ä¿ min çš„èµ„æºè¿°æ±‚ã€‚æ­¤æ—¶æˆ‘ä»¬ä¼šæŒ‰ç…§ä¸€å®šçš„æ¯”ä¾‹è°ƒæ•´å„ä¸ªElasticQuotaçš„minï¼Œç¡®ä¿æ‰€æœ‰minä¹‹å’Œå°äºæˆ–è€…ç­‰äºå½“å‰å®é™…çš„èµ„æºæ€»é‡ã€‚</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="æŠ¢å æœºåˆ¶">æŠ¢å æœºåˆ¶<a href="#æŠ¢å æœºåˆ¶" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>Koordinator ElasticQuota æœºåˆ¶åœ¨è°ƒåº¦é˜¶æ®µå¦‚æœå‘ç° Quota ä¸è¶³ï¼Œä¼šè¿›å…¥æŠ¢å é˜¶æ®µï¼ŒæŒ‰ç…§ä¼˜å…ˆçº§æ’åºï¼ŒæŠ¢å å±äºåŒä¸€ä¸ªElasticQuota å†…çš„ ä½ä¼˜å…ˆçº§ Podã€‚ åŒæ—¶ï¼Œæˆ‘ä»¬ä¸æ”¯æŒè·¨ ElasticQuota æŠ¢å å…¶ä»– Podã€‚ä½†æ˜¯æˆ‘ä»¬ä¹Ÿæä¾›äº†å¦å¤–çš„æœºåˆ¶æ”¯æŒä»å€Ÿç”¨ Quota çš„ ElasticQuota æŠ¢å›ã€‚<br>ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨é›†ç¾¤ä¸­ï¼Œæœ‰ä¸¤ä¸ª ElasticQuotaï¼ŒElasticQuota A {min = 50, max = 100}ï¼Œ ElasticQuota B {min = 50,  max = 100}ã€‚ç”¨æˆ·åœ¨ä¸Šåˆ10ç‚¹ä½¿ç”¨ ElasticQuota A æäº¤äº†ä¸€ä¸ª Jobï¼Œ Request = 100 ï¼Œæ­¤æ—¶å› ä¸º ElasticQuota B æ— äººä½¿ç”¨ï¼ŒElasticQuota A èƒ½ä» B æ‰‹é‡Œå€Ÿç”¨50ä¸ªQuotaï¼Œæ»¡è¶³äº† Request = 100ï¼Œ å¹¶ä¸”æ­¤æ—¶ Used = 100ã€‚åœ¨11ç‚¹é’Ÿæ—¶ï¼Œå¦ä¸€ä¸ªç”¨æˆ·å¼€å§‹ä½¿ç”¨ ElasticQuota B æäº¤Jobï¼ŒRequest = 100ï¼Œå› ä¸º ElasticQuota B çš„ min = 50ï¼Œæ˜¯å¿…é¡»ä¿éšœçš„ï¼Œé€šè¿‡å…¬å¹³æ€§ä¿éšœæœºåˆ¶ï¼Œæ­¤æ—¶ A å’Œ B çš„ runtime å‡ä¸º50ã€‚é‚£ä¹ˆæ­¤æ—¶å¯¹äº ElasticQuota A ï¼ŒUsed = 100 æ˜¯å¤§äºå½“å‰ runtime = 50 çš„ï¼Œå› æ­¤æˆ‘ä»¬ä¼šæä¾›ä¸€ä¸ª Controllerï¼Œé©±é€æ‰ä¸€éƒ¨åˆ† Pod ï¼Œä½¿å¾—å½“å‰ ElasticQuota A çš„ Used é™ä½åˆ° runtime ç›¸ç­‰çš„æ°´ä½ã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-ç²¾ç»†åŒ–èµ„æºè°ƒåº¦">2. ç²¾ç»†åŒ–èµ„æºè°ƒåº¦<a href="#2-ç²¾ç»†åŒ–èµ„æºè°ƒåº¦" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="device-share-scheduling">Device Share Scheduling<a href="#device-share-scheduling" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>æœºå™¨å­¦ä¹ é¢†åŸŸé‡Œä¾é å¤§é‡å¼ºå¤§ç®—åŠ›æ€§èƒ½çš„ GPU è®¾å¤‡å®Œæˆæ¨¡å‹è®­ç»ƒï¼Œä½†æ˜¯ GPU è‡ªèº«ä»·æ ¼ååˆ†æ˜‚è´µã€‚å¦‚ä½•æ›´å¥½åœ°åˆ©ç”¨GPUè®¾å¤‡ï¼Œå‘æŒ¥GPUçš„ä»·å€¼ï¼Œé™ä½æˆæœ¬ï¼Œæ˜¯ä¸€ä¸ªäºŸå¾…è§£å†³çš„é—®é¢˜ã€‚  Kubernetes ç¤¾åŒºç°æœ‰çš„ GPU åˆ†é…æœºåˆ¶ä¸­ï¼ŒGPU æ˜¯ç”± kubelet åˆ†é…çš„ï¼Œå¹¶åªæ”¯æŒåˆ†é…ä¸€ä¸ªæˆ–å¤šä¸ªå®Œæ•´çš„ GPU å®ä¾‹ã€‚ è¿™ç§æ–¹æ³•ç®€å•å¯é ï¼Œä½†ç±»ä¼¼äº CPU å’Œ Memoryï¼ŒGPU å¹¶ä¸æ˜¯ä¸€ç›´å¤„äºé«˜åˆ©ç”¨ç‡æ°´ä½ï¼ŒåŒæ ·å­˜åœ¨èµ„æºæµªè´¹çš„é—®é¢˜ã€‚ å› æ­¤ï¼ŒKoordinator å¸Œæœ›æ”¯æŒå¤šå·¥ä½œè´Ÿè½½å…±äº«ä½¿ç”¨ GPU è®¾å¤‡ä»¥èŠ‚çœæˆæœ¬ã€‚ æ­¤å¤–ï¼ŒGPU æœ‰å…¶ç‰¹æ®Šæ€§ã€‚ æ¯”å¦‚ä¸‹é¢çš„ NVIDIA GPU æ”¯æŒçš„ NVLink å’Œè¶…å–åœºæ™¯ï¼Œéƒ½éœ€è¦é€šè¿‡è°ƒåº¦å™¨è¿›è¡Œä¸­å¤®å†³ç­–ï¼Œä»¥è·å¾—å…¨å±€æœ€ä¼˜çš„åˆ†é…ç»“æœã€‚<br><img loading="lazy" alt="image.png" src="/zh-Hans/assets/images/nvlink-87c3973857a32b2efaa5dd2f714766b2.png" width="2222" height="828" class="img_ev3q"></p><p>ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œè™½ç„¶è¯¥èŠ‚ç‚¹æœ‰8ä¸ª GPU å®ä¾‹ï¼Œå‹å·ä¸ºA100/V100ï¼Œä½† GPU å®ä¾‹ä¹‹é—´çš„æ•°æ®ä¼ è¾“é€Ÿåº¦æ˜¯ä¸åŒçš„ã€‚ å½“ä¸€ä¸ª Pod éœ€è¦å¤šä¸ª GPU å®ä¾‹æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä¸º Pod åˆ†é…å…·æœ‰æœ€å¤§æ•°æ®ä¼ è¾“é€Ÿåº¦ç»„åˆå…³ç³»çš„ GPU å®ä¾‹ã€‚ æ­¤å¤–ï¼Œå½“æˆ‘ä»¬å¸Œæœ›ä¸€ç»„ Pod ä¸­çš„ GPU å®ä¾‹å…·æœ‰æœ€å¤§æ•°æ®ä¼ è¾“é€Ÿåº¦ç»„åˆå…³ç³»æ—¶ï¼Œè°ƒåº¦å™¨åº”è¯¥å°†æœ€ä½³ GPU å®ä¾‹æ‰¹é‡åˆ†é…ç»™è¿™äº› Podï¼Œå¹¶å°†å®ƒä»¬åˆ†é…åˆ°åŒä¸€ä¸ªèŠ‚ç‚¹ã€‚</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="gpu-èµ„æºåè®®">GPU èµ„æºåè®®<a href="#gpu-èµ„æºåè®®" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>Koordinator å…¼å®¹ç¤¾åŒºå·²æœ‰çš„ <code>nvidia.com/gpu</code>èµ„æºåè®®ï¼Œå¹¶ä¸”è¿˜è‡ªå®šä¹‰äº†æ‰©å±•èµ„æºåè®®ï¼Œæ”¯æŒç”¨æˆ·æ›´ç»†ç²’åº¦çš„åˆ†é… GPU èµ„æºã€‚</p><ul><li>kubernetes.io/gpu-core ä»£è¡¨GPUçš„è®¡ç®—èƒ½åŠ›ã€‚ ä¸ Kuberetes MilliCPU ç±»ä¼¼ï¼Œæˆ‘ä»¬å°† GPU çš„æ€»ç®—åŠ›æŠ½è±¡ä¸º100ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦ç”³è¯·ç›¸åº”æ•°é‡çš„ GPU ç®—åŠ›ã€‚</li><li>kubernetes.io/gpu-memory è¡¨ç¤º GPU çš„å†…å­˜å®¹é‡ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ã€‚</li><li>kubernetes.io/gpu-memory-ratio ä»£è¡¨ GPU å†…å­˜çš„ç™¾åˆ†æ¯”ã€‚</li></ul><p>å‡è®¾ä¸€ä¸ªèŠ‚ç‚¹æœ‰4ä¸ªGPUè®¾å¤‡å®ä¾‹ï¼Œæ¯ä¸ªGPUè®¾å¤‡å®ä¾‹æœ‰ 8Gi æ˜¾å­˜ã€‚ç”¨æˆ·å¦‚æœæœŸæœ›ç”³è¯·ä¸€ä¸ªå®Œæ•´çš„ GPU å®ä¾‹ï¼Œé™¤äº†ä½¿ç”¨ <code>nvidia.com/gpu</code>ä¹‹å¤–ï¼Œè¿˜å¯ä»¥æŒ‰ç…§å¦‚ä¸‹æ–¹å¼ç”³è¯·ï¼š</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> demo</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">limits</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">kubernetes.io/gpu-core</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">kubernetes.io/gpu-memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;8Gi&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">kubernetes.io/gpu-core</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">kubernetes.io/gpu-memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;8Gi&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å¦‚æœæœŸæœ›åªä½¿ç”¨ä¸€ä¸ª GPU å®ä¾‹ä¸€åŠçš„èµ„æºï¼Œå¯ä»¥æŒ‰ç…§å¦‚ä¸‹æ–¹å¼ç”³è¯·ï¼š</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> demo</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">limits</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">kubernetes.io/gpu-core</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">kubernetes.io/gpu-memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;4Gi&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">kubernetes.io/gpu-core</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">kubernetes.io/gpu-memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;4Gi&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="è®¾å¤‡ä¿¡æ¯å’Œè®¾å¤‡å®¹é‡ä¸ŠæŠ¥">è®¾å¤‡ä¿¡æ¯å’Œè®¾å¤‡å®¹é‡ä¸ŠæŠ¥<a href="#è®¾å¤‡ä¿¡æ¯å’Œè®¾å¤‡å®¹é‡ä¸ŠæŠ¥" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>åœ¨ Koordinator v0.7.0 ç‰ˆæœ¬ä¸­ï¼Œå•æœºä¾§ koordlet å®‰è£…åä¼šè‡ªåŠ¨è¯†åˆ«èŠ‚ç‚¹ä¸Šæ˜¯å¦å«æœ‰ GPU è®¾å¤‡ï¼Œå¦‚æœå­˜åœ¨çš„è¯ï¼Œä¼šä¸ŠæŠ¥è¿™äº› GPU è®¾å¤‡çš„ Minor IDã€ UUIDã€ç®—åŠ›å’Œæ˜¾å­˜å¤§å°åˆ°ä¸€ä¸ªç±»å‹ä¸º Device CRD ä¸­ã€‚æ¯ä¸ªèŠ‚ç‚¹å¯¹åº”ä¸€ä¸ª Device CRD å®ä¾‹ã€‚Device CRD ä¸ä»…æ”¯æŒæè¿° GPUï¼Œè¿˜æ”¯æŒç±»ä¼¼äº FPGA/RDMAç­‰è®¾å¤‡ç±»å‹ï¼Œç›®å‰ v0.7.0 ç‰ˆæœ¬åªæ”¯æŒ GPUï¼Œ æš‚æœªæ”¯æŒè¿™äº›è®¾å¤‡ç±»å‹ã€‚ <br>Device CRD ä¼šè¢« koord-manager å†…çš„ NodeResource controller å’Œ koord-scheduler æ¶ˆè´¹ã€‚NodeResource controller ä¼šæ ¹æ® Device CRD ä¸­æè¿°çš„ä¿¡æ¯ï¼Œæ¢ç®—æˆ Koordinator æ”¯æŒçš„èµ„æºåè®® <code>kubernetes.io/gpu-core</code>,<code>kubernetes.io/gpu-memory</code> æ›´æ–°åˆ°  Node.Status.Allocatable å’Œ Node.Status.Capacity å­—æ®µï¼Œå¸®åŠ©è°ƒåº¦å™¨å’Œ kubelet å®Œæˆèµ„æºè°ƒåº¦ã€‚gpu-core è¡¨ç¤ºGPU è®¾å¤‡å®ä¾‹çš„ç®—åŠ›ï¼Œä¸€ä¸ªå®ä¾‹çš„å®Œæ•´ç®—åŠ›ä¸º100ã€‚å‡è®¾ä¸€ä¸ªèŠ‚ç‚¹æœ‰ 8 ä¸ª GPU è®¾å¤‡å®ä¾‹ï¼Œé‚£ä¹ˆèŠ‚ç‚¹çš„ gpu-core å®¹é‡ä¸º 8 <em> 100 = 800ï¼› gpu-memory è¡¨ç¤º GPU è®¾å¤‡å®ä¾‹çš„æ˜¾å­˜å¤§å°ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼ŒåŒæ ·çš„èŠ‚ç‚¹å¯ä»¥åˆ†é…çš„æ˜¾å­˜æ€»é‡ä¸º è®¾å¤‡æ•°é‡ </em> æ¯ä¸ªå®ä¾‹çš„å•ä½å®¹é‡ï¼Œä¾‹å¦‚ä¸€ä¸ª GPU è®¾å¤‡çš„æ˜¾å­˜æ˜¯ 8Gï¼ŒèŠ‚ç‚¹ä¸Šæœ‰8 ä¸ª GPU å®ä¾‹ï¼Œæ€»é‡ä¸º 8 * 8G = 64Gã€‚</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">status</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">capacity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">koordinator.sh/gpu-core</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">800</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">koordinator.sh/gpu-memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;64Gi&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">koordinator.sh/gpu-memory-ratio</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">800</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">allocatable</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">koordinator.sh/gpu-core</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">800</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">koordinator.sh/gpu-memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;64Gi&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">koordinator.sh/gpu-memory-ratio</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">800</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="ä¸­å¿ƒè°ƒåº¦åˆ†é…è®¾å¤‡èµ„æº">ä¸­å¿ƒè°ƒåº¦åˆ†é…è®¾å¤‡èµ„æº<a href="#ä¸­å¿ƒè°ƒåº¦åˆ†é…è®¾å¤‡èµ„æº" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>Kuberetes ç¤¾åŒºåŸç”Ÿæä¾›çš„è®¾å¤‡è°ƒåº¦æœºåˆ¶ä¸­ï¼Œè°ƒåº¦å™¨åªè´Ÿè´£æ ¡éªŒè®¾å¤‡å®¹é‡æ˜¯å¦æ»¡è¶³ Podï¼Œå¯¹äºä¸€äº›ç®€å•çš„è®¾å¤‡ç±»å‹æ˜¯è¶³å¤Ÿçš„ï¼Œä½†æ˜¯å½“éœ€è¦æ›´ç»†ç²’åº¦åˆ†é… GPU æ—¶ï¼Œéœ€è¦ä¸­å¿ƒè°ƒåº¦å™¨ç»™äºˆæ”¯æŒæ‰èƒ½å®ç°å…¨å±€æœ€ä¼˜ã€‚<br>Koordinator è°ƒåº¦å™¨ koord-scheduler æ–°å¢äº†è°ƒåº¦æ’ä»¶ DeviceShareï¼Œè´Ÿè´£ç²¾ç»†åº¦è®¾å¤‡èµ„æºè°ƒåº¦ã€‚DeviceShare æ’ä»¶æ¶ˆè´¹ Device CRDï¼Œè®°å½•æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥åˆ†é…çš„è®¾å¤‡ä¿¡æ¯ã€‚DeviceShare åœ¨è°ƒåº¦æ—¶ï¼Œä¼šæŠŠ Pod çš„GPUèµ„æºè¯·æ±‚è½¬æ¢ä¸º Koordinator çš„èµ„æºåè®®ï¼Œå¹¶è¿‡æ»¤æ¯ä¸ªèŠ‚ç‚¹çš„æœªåˆ†é…çš„ GPU è®¾å¤‡å®ä¾‹ã€‚ç¡®ä¿æœ‰èµ„æºå¯ç”¨åï¼Œåœ¨ Reserve é˜¶æ®µæ›´æ–°å†…éƒ¨çŠ¶æ€ï¼Œå¹¶åœ¨ PreBind é˜¶æ®µæ›´æ–° Pod Annotationï¼Œè®°å½•å½“å‰ Pod åº”è¯¥ä½¿ç”¨å“ªäº› GPU è®¾å¤‡ã€‚<br>DeviceShare å°†åœ¨åç»­ç‰ˆæœ¬æ”¯æŒ Binpacking  å’Œ Spread ç­–ç•¥ï¼Œå®ç°æ›´å¥½çš„è®¾å¤‡èµ„æºè°ƒåº¦èƒ½åŠ›ã€‚</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="å•æœºä¾§ç²¾å‡†ç»‘å®šè®¾å¤‡ä¿¡æ¯">å•æœºä¾§ç²¾å‡†ç»‘å®šè®¾å¤‡ä¿¡æ¯<a href="#å•æœºä¾§ç²¾å‡†ç»‘å®šè®¾å¤‡ä¿¡æ¯" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>Kubernetes ç¤¾åŒºåœ¨ kubelet ä¸­æä¾›äº† DevicePlugin æœºåˆ¶ï¼Œæ”¯æŒè®¾å¤‡å‚å•†åœ¨ kubelet åˆ†é…å¥½è®¾å¤‡åæœ‰æœºä¼šè·å¾—è®¾å¤‡ä¿¡æ¯ï¼Œå¹¶å¡«å……åˆ°ç¯å¢ƒå˜é‡æˆ–è€…æ›´æ–°æŒ‚è½½è·¯å¾„ã€‚ä½†æ˜¯ä¸èƒ½æ”¯æŒ ä¸­å¿ƒåŒ–çš„ GPU ç²¾ç»†åŒ–è°ƒåº¦åœºæ™¯ã€‚<br>é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œ Koordinator æ‰©å±•äº† koord-runtime-proxy ï¼Œæ”¯æŒåœ¨ kubelet åˆ›å»ºå®¹å™¨æ—¶æ›´æ–°ç¯å¢ƒå˜é‡ï¼Œæ³¨å…¥è°ƒåº¦å™¨åˆ†é…çš„ GPU è®¾å¤‡ä¿¡æ¯ã€‚<br><img loading="lazy" src="/zh-Hans/assets/images/koordlet-inject-env-80dc8617520f3b4f4ce0bff46548d467.jpeg" width="1394" height="700" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-è°ƒåº¦å™¨è¯Šæ–­åˆ†æ">3. è°ƒåº¦å™¨è¯Šæ–­åˆ†æ<a href="#3-è°ƒåº¦å™¨è¯Šæ–­åˆ†æ" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>å¤§å®¶åœ¨ä½¿ç”¨ Kubernetes æ—¶ç»å¸¸ä¼šé‡åˆ°ä¸€äº›è°ƒåº¦ç›¸å…³çš„é—®é¢˜ï¼š</p><ol><li>æˆ‘è¿™ä¸ª Pod ä¸ºä»€ä¹ˆä¸èƒ½è°ƒåº¦ï¼Ÿ</li><li>è¿™ä¸ª Pod ä¸ºä»€ä¹ˆä¼šè°ƒåº¦åˆ°è¿™ä¸ªèŠ‚ç‚¹ï¼Œä¸æ˜¯åº”è¯¥è¢«å¦ä¸€ä¸ªæ‰“åˆ†æ’ä»¶å½±å“åˆ°ä¹ˆï¼Ÿ </li><li>æˆ‘æ–°å¼€å‘äº†ä¸€ä¸ªæ’ä»¶ï¼Œå‘ç°è°ƒåº¦ç»“æœä¸ç¬¦åˆé¢„æœŸï¼Œä½†æ˜¯æœ‰ä¸çŸ¥é“å“ªé‡Œå‡ºäº†é—®é¢˜ã€‚</li></ol><p>è¦è¯Šæ–­åˆ†æè¿™äº›é—®é¢˜ï¼Œé™¤äº†è¦æŒæ¡ Kubernetes åŸºæœ¬çš„è°ƒåº¦æœºåˆ¶å’Œèµ„æºåˆ†é…æœºåˆ¶å¤–ï¼Œè¿˜éœ€è¦è°ƒåº¦å™¨è‡ªèº«ç»™äºˆæ”¯æŒã€‚ä½†æ˜¯ Kubernetes kube-scheduler æä¾›çš„è¯Šæ–­èƒ½åŠ›æ¯”è¾ƒæœ‰é™ï¼Œæœ‰æ—¶å€™ç”šè‡³æ²¡æœ‰ä»€ä¹ˆæ—¥å¿—å¯ä»¥æŸ¥çœ‹ã€‚kube-scheduler åŸç”Ÿæ˜¯æ”¯æŒé€šè¿‡ HTTP æ›´æ”¹æ—¥å¿—ç­‰çº§ï¼Œå¯ä»¥è·å¾—æ›´å¤šæ—¥å¿—ä¿¡æ¯ï¼Œä¾‹å¦‚æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å¯ä»¥æ›´æ”¹æ—¥å¿—ç­‰çº§åˆ°5ï¼š</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -X PUT schedulerLeaderIP:10251/debug/flags/v --data </span><span class="token string" style="color:#e3116c">&#x27;5&#x27;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">successfully </span><span class="token builtin class-name">set</span><span class="token plain"> klog.logging.verbosity to </span><span class="token number" style="color:#36acaa">5</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Koordinator é’ˆå¯¹è¿™äº›é—®é¢˜ï¼Œå®ç°äº†ä¸€å¥— Restful API ï¼Œå¸®åŠ©ç”¨æˆ·æå‡é—®é¢˜è¯Šæ–­åˆ†æçš„æ•ˆç‡</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="åˆ†æ-score-ç»“æœ">åˆ†æ Score ç»“æœ<a href="#åˆ†æ-score-ç»“æœ" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p><code>PUT /debug/flags/s</code>  å…è®¸ç”¨æˆ·æ‰“å¼€ Debug Score å¼€å…³ï¼Œåœ¨æ‰“åˆ†ç»“æŸåï¼Œä»¥Markdown æ ¼å¼æ‰“å° TopN èŠ‚ç‚¹å„ä¸ªæ’ä»¶çš„åˆ†å€¼ã€‚ä¾‹å¦‚ï¼š</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -X PUT schedulerLeaderIP:10251/debug/flags/s --data </span><span class="token string" style="color:#e3116c">&#x27;100&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">successfully </span><span class="token builtin class-name">set</span><span class="token plain"> debugTopNScores to </span><span class="token number" style="color:#36acaa">100</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p> å½“æœ‰æ–° Pod è°ƒåº¦æ—¶ï¼Œè§‚å¯Ÿ scheduler log å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># | Pod | Node | Score | ImageLocality | InterPodAffinity | LoadAwareScheduling | NodeAffinity | NodeNUMAResource | NodeResourcesBalancedAllocation | NodeResourcesFit | PodTopologySpread | Reservation | TaintToleration |</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> --- </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> --- </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> --- </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> ---:</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> ---:</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> ---:</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> ---:</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> ---:</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> ---:</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> ---:</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> ---:</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> ---:</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> ---:</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> ---:</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> default/curlimage-545745d8f8-rngp7 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> cn-hangzhou.10.0.4.51 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">577</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">87</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">96</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">94</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> default/curlimage-545745d8f8-rngp7 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> cn-hangzhou.10.0.4.50 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">574</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">85</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">96</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">93</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> default/curlimage-545745d8f8-rngp7 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> cn-hangzhou.10.0.4.19 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">541</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">55</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">95</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">91</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> default/curlimage-545745d8f8-rngp7 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> cn-hangzhou.10.0.4.18 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">487</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">15</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">90</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">82</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ‰¾ä¸ª Markdown å·¥å…·ï¼Œå°±å¯ä»¥è½¬ä¸ºå¦‚ä¸‹è¡¨æ ¼</p><table><thead><tr><th>#</th><th>Pod</th><th>Node</th><th>Score</th><th>LoadAwareScheduling</th><th>NodeNUMAResource</th><th>NodeResourcesFit</th><th>PodTopologySpread</th></tr></thead><tbody><tr><td>0</td><td>default/curlimage-545745d8f8-rngp7</td><td>cn-hangzhou.10.0.4.51</td><td>577</td><td>87</td><td>0</td><td>94</td><td>200</td></tr><tr><td>1</td><td>default/curlimage-545745d8f8-rngp7</td><td>cn-hangzhou.10.0.4.50</td><td>574</td><td>85</td><td>0</td><td>93</td><td>200</td></tr><tr><td>2</td><td>default/curlimage-545745d8f8-rngp7</td><td>cn-hangzhou.10.0.4.19</td><td>541</td><td>55</td><td>0</td><td>91</td><td>200</td></tr><tr><td>3</td><td>default/curlimage-545745d8f8-rngp7</td><td>cn-hangzhou.10.0.4.18</td><td>487</td><td>15</td><td>0</td><td>82</td><td>200</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="è°ƒåº¦æ’ä»¶å¯¼å‡ºå†…éƒ¨çŠ¶æ€">è°ƒåº¦æ’ä»¶å¯¼å‡ºå†…éƒ¨çŠ¶æ€<a href="#è°ƒåº¦æ’ä»¶å¯¼å‡ºå†…éƒ¨çŠ¶æ€" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>åƒ koord-scheduler å†…éƒ¨çš„ NodeNUMAResource ã€ DeviceShareå’ŒElasticQuotaç­‰æ’ä»¶å†…éƒ¨éƒ½æœ‰ç»´æŠ¤ä¸€äº›çŠ¶æ€å¸®åŠ©è°ƒåº¦ã€‚ koord-scheduler è‡ªå®šä¹‰äº†ä¸€ä¸ªæ–°çš„æ’ä»¶æ‰©å±•æ¥å£ï¼ˆå®šä¹‰è§ä¸‹æ–‡ï¼‰ï¼Œå¹¶ä¼šåœ¨åˆå§‹åŒ–æ’ä»¶åï¼Œè¯†åˆ«è¯¥æ’ä»¶æ˜¯å¦å®ç°äº†è¯¥æ¥å£å¹¶è°ƒç”¨è¯¥æ¥å£ï¼Œè®©æ’ä»¶æ³¨å…¥éœ€è¦æš´éœ²çš„ RestfulAPIã€‚ä»¥ NodeNUMAResource æ’ä»¶ä¸ºä¾‹ï¼Œä¼šæä¾› <code>/cpuTopologyOptions/:nodeName</code>å’Œ <code>/availableCPUs/:nodeName</code>ä¸¤ä¸ªEndpointsï¼Œå¯ä»¥æŸ¥çœ‹æ’ä»¶å†…éƒ¨è®°å½•çš„ CPU æ‹“æ‰‘ä¿¡æ¯å’Œåˆ†é…ç»“æœã€‚</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> APIServiceProvider </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">RegisterEndpoints</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">group </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">gin</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">RouterGroup</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç”¨æˆ·åœ¨ä½¿ç”¨æ—¶ï¼ŒæŒ‰ç…§ <code>/apis/v1/plugins/&lt;pluginName&gt;/&lt;pluginEndpoints&gt;</code>æ–¹ å¼æ„å»º URL æŸ¥çœ‹æ•°æ®ï¼Œä¾‹å¦‚è¦æŸ¥çœ‹ <code>/cpuTopologyOptions/:nodeName</code>ï¼š</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> schedulerLeaderIP:10252/apis/v1/plugins/NodeNUMAResources/cpuTopologyOptions/node-1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;cpuTopology&quot;</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;numCPUs&quot;</span><span class="token plain">:32,</span><span class="token string" style="color:#e3116c">&quot;numCores&quot;</span><span class="token plain">:16,</span><span class="token string" style="color:#e3116c">&quot;numNodes&quot;</span><span class="token plain">:1,</span><span class="token string" style="color:#e3116c">&quot;numSockets&quot;</span><span class="token plain">:1,</span><span class="token string" style="color:#e3116c">&quot;cpuDetails&quot;</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="æŸ¥çœ‹å½“å‰æ”¯æŒçš„æ’ä»¶-api">æŸ¥çœ‹å½“å‰æ”¯æŒçš„æ’ä»¶ API<a href="#æŸ¥çœ‹å½“å‰æ”¯æŒçš„æ’ä»¶-api" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>ä¸ºäº†æ–¹ä¾¿å¤§å®¶ä½¿ç”¨ï¼Œkoord-scheduler æä¾›äº† <code>/apis/v1/__services__</code> æŸ¥çœ‹æ”¯æŒçš„ API Endpoints</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> schedulerLeaderIP:10251/apis/v1/__services__</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;GET&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/v1/__services__&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/v1/nodes/:nodeName&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/v1/plugins/Coscheduling/gang/:namespace/:name&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/v1/plugins/DeviceShare/nodeDeviceSummaries&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/v1/plugins/DeviceShare/nodeDeviceSummaries/:name&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/v1/plugins/ElasticQuota/quota/:name&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/v1/plugins/NodeNUMAResource/availableCPUs/:nodeName&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;/apis/v1/plugins/NodeNUMAResource/cpuTopologyOptions/:nodeName&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-æ›´å®‰å…¨çš„é‡è°ƒåº¦">4. æ›´å®‰å…¨çš„é‡è°ƒåº¦<a href="#4-æ›´å®‰å…¨çš„é‡è°ƒåº¦" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>åœ¨ Koordinator v0.6 ç‰ˆæœ¬ä¸­æˆ‘ä»¬å‘å¸ƒäº†å…¨æ–°çš„ koord-deschedulerï¼Œæ”¯æŒæ’ä»¶åŒ–å®ç°éœ€è¦çš„é‡è°ƒåº¦ç­–ç•¥å’Œè‡ªå®šä¹‰é©±é€æœºåˆ¶ï¼Œå¹¶å†…ç½®äº†é¢å‘ PodMigrationJob çš„è¿ç§»æ§åˆ¶å™¨ï¼Œé€šè¿‡ Koordinator Reservation æœºåˆ¶é¢„ç•™èµ„æºï¼Œç¡®ä¿æœ‰èµ„æºçš„æƒ…å†µä¸‹å‘èµ·é©±é€ã€‚è§£å†³äº† Pod è¢«é©±é€åæ— èµ„æºå¯ç”¨å½±å“åº”ç”¨çš„å¯ç”¨æ€§é—®é¢˜ã€‚<br>Koordinator v0.7 ç‰ˆæœ¬ä¸­ï¼Œkoord-descheduler å®ç°äº†æ›´å®‰å…¨çš„é‡è°ƒåº¦</p><ul><li>æ”¯æŒ Evict é™æµï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦é…ç½®é™æµç­–ç•¥ï¼Œä¾‹å¦‚å…è®¸æ¯åˆ†é’Ÿé©±é€å¤šå°‘ä¸ª Pod</li><li>æ”¯æŒé…ç½® Namespace ç°åº¦é‡è°ƒåº¦èƒ½åŠ›ï¼Œè®©ç”¨æˆ·å¯ä»¥æ›´æ”¾å¿ƒçš„ç°åº¦</li><li>æ”¯æŒæŒ‰ç…§ Node/Namespace é…ç½®é©±é€æ•°é‡ï¼Œä¾‹å¦‚é…ç½®èŠ‚ç‚¹ç»´åº¦æœ€å¤šåªé©±é€ä¸¤ä¸ªï¼Œé‚£ä¹ˆå³ä½¿æœ‰æ’ä»¶è¦æ±‚é©±é€è¯¥èŠ‚ç‚¹ä¸Šçš„æ›´å¤šPodï¼Œä¼šè¢«æ‹’ç»ã€‚</li><li>æ„ŸçŸ¥ Workload ï¼Œå¦‚æœä¸€ä¸ª Workload æ­£åœ¨å‘å¸ƒã€ç¼©å®¹ã€å·²ç»æœ‰ä¸€å®šé‡çš„ Pod æ­£åœ¨è¢«é©±é€æˆ–è€…ä¸€äº›Pod NotReadyï¼Œé‡è°ƒåº¦å™¨ä¼šæ‹’ç»æ–°çš„é‡è°ƒåº¦è¯·æ±‚ã€‚ç›®å‰æ”¯æŒåŸç”Ÿçš„ Deploymentï¼ŒStatefulSet ä»¥åŠ Kruise  CloneSetï¼ŒKruise AdvancedStatefulSetã€‚</li></ul><p>åç»­é‡è°ƒåº¦å™¨è¿˜ä¼šæå‡å…¬å¹³æ€§ï¼Œé˜²æ­¢ä¸€ç›´é‡å¤çš„é‡è°ƒåº¦åŒä¸€ä¸ª workload ï¼Œå°½é‡é™ä½é‡è°ƒåº¦å¯¹åº”ç”¨çš„å¯ç”¨æ€§çš„å½±å“ã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-å…¶ä»–æ”¹åŠ¨">5. å…¶ä»–æ”¹åŠ¨<a href="#5-å…¶ä»–æ”¹åŠ¨" class="hash-link" aria-label="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><ul><li>Koordinator è¿›ä¸€æ­¥å¢å¼ºäº† CPU ç²¾ç»†åŒ–è°ƒåº¦èƒ½åŠ›ï¼Œå®Œå…¨å…¼å®¹ kubelet ( &lt;= v1.22) CPU Manager static ç­–ç•¥ã€‚è°ƒåº¦å™¨åˆ†é… CPU æ—¶ä¼šé¿å…åˆ†é…è¢« kubelet é¢„ç•™çš„ CPUï¼Œå•æœºä¾§koordletå®Œæ•´é€‚é…äº†kubeletä»1.18åˆ°1.22ç‰ˆæœ¬çš„åˆ†é…ç­–ç•¥ï¼Œæœ‰æ•ˆé¿å…äº† CPU å†²çªã€‚</li><li>èµ„æºé¢„ç•™æœºåˆ¶æ”¯æŒ AllocateOnce è¯­ä¹‰ï¼Œæ»¡è¶³å•æ¬¡é¢„ç•™åœºæ™¯ã€‚å¹¶æ”¹è¿›äº† Reservation çŠ¶æ€è¯­ä¹‰ï¼Œæ›´åŠ å‡†ç¡®æè¿° Reservation å¯¹è±¡å½“å‰çš„çŠ¶æ€ã€‚</li><li>æ”¹è¿›äº†ç¦»çº¿èµ„æº(Batch CPU/Memory) çš„å£°æ˜æ–¹å¼ï¼Œæ”¯æŒlimitå¤§äºrequestçš„èµ„æºæè¿°å½¢å¼ï¼Œå¯ä»¥æ–¹ä¾¿åŸburstableç±»å‹çš„ä»»åŠ¡ç›´æ¥è½¬æ¢ä¸ºæ··éƒ¨æ¨¡å¼è¿è¡Œã€‚</li></ul><p>ä½ å¯ä»¥é€šè¿‡ <a href="https://github.com/koordinator-sh/koordinator/releases/tag/v0.6.1" target="_blank" rel="noopener noreferrer">Github release[6]</a> é¡µé¢ï¼Œæ¥æŸ¥çœ‹æ›´å¤šçš„æ”¹åŠ¨ä»¥åŠå®ƒä»¬çš„ä½œè€…ä¸æäº¤è®°å½•ã€‚</p><h1>ç›¸å…³é“¾æ¥</h1><ul><li><a href="https://koordinator.sh" target="_blank" rel="noopener noreferrer">[1] Koordinator</a> </li><li><a href="https://mp.weixin.qq.com/s/YdoxVxz_91ZFemF8JuxRvQ" target="_blank" rel="noopener noreferrer">[2]  Koordinator 0.6 Release Note</a></li><li><a href="https://github.com/koordinator-sh/koordinator/blob/main/docs/proposals/scheduling/20220901-gang-scheduling.md" target="_blank" rel="noopener noreferrer">[3] Design: Gang Scheduling</a></li><li><a href="https://github.com/koordinator-sh/koordinator/blob/main/docs/proposals/scheduling/20220722-multi-hierarchy-elastic-quota-management.md" target="_blank" rel="noopener noreferrer">[4] Design: Multi Hierarchy ElasticQuota Management</a></li><li><a href="https://github.com/koordinator-sh/koordinator/blob/main/docs/proposals/scheduling/20220629-fine-grained-device-scheduling.md" target="_blank" rel="noopener noreferrer">[5] Design: Fine-grained Device Scheduling</a></li><li><a href="https://github.com/koordinator-sh/koordinator/releases/tag/v0.6.1" target="_blank" rel="noopener noreferrer">[6] Github Release</a></li><li><a href="https://join.slack.com/t/koordinator-sh/shared_invite/zt-1756qoub4-Cn4~esfdlfAPsD7cwO2NzA" target="_blank" rel="noopener noreferrer">[7] Slack Channel</a></li><li><a href="https://mp.weixin.qq.com/s/y8k_q6rhTIubQ-lqvDp2hw" target="_blank" rel="noopener noreferrer">[8] äº‘åŸç”Ÿæ··éƒ¨ç³»ç»Ÿ Koordinator æ¶æ„è¯¦è§£</a></li></ul></div><footer class="row docusaurus-mt-lg"><div class="col"><b>æ ‡ç­¾ï¼š</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/zh-Hans/blog/tags/release">release</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="åšæ–‡åˆ—è¡¨åˆ†é¡µå¯¼èˆª"><a class="pagination-nav__link pagination-nav__link--next" href="/zh-Hans/blog/page/2"><div class="pagination-nav__label">è¾ƒæ—§çš„åšæ–‡</div></a></nav></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">æ–‡æ¡£</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/zh-Hans/docs/installation">å¿«é€Ÿå¼€å§‹</a></li><li class="footer__item"><a class="footer__link-item" href="/zh-Hans/docs/user-manuals/colocation-profile">ç”¨æˆ·æ‰‹å†Œ</a></li><li class="footer__item"><a class="footer__link-item" href="/zh-Hans/docs/architecture/overview">æ¶æ„</a></li></ul></div><div class="col footer__col"><div class="footer__title">ç¤¾åŒº</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://join.slack.com/t/koordinator-sh/shared_invite/zt-1756qoub4-Cn4~esfdlfAPsD7cwO2NzA" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack ( #koordinator channel )<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/zh-Hans/">DingTalk (GroupID: 33383887)</a></li></ul></div><div class="col footer__col"><div class="footer__title">æ›´å¤š</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/koordinator-sh/koordinator" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/zh-Hans/blog">åšå®¢</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
        <div style="font-size: 18px">
        <br>
        <strong>Koordinatoræ˜¯ <a href="https://www.cncf.io/">Cloud Native Computing Foundation</a> æ²™ç®±é¡¹ç›® </strong>
        <br>
        </div>
        <br>
        <img src="img/cncf-color.svg" alt="CNCF" width="auto" height="100px">
        <br>
        <div style="font-size: 14px">
        LinuxåŸºé‡‘ä¼šÂ® (TLF) å·²æ³¨å†Œå¹¶ä½¿ç”¨å•†æ ‡ã€‚å¦‚éœ€äº†è§£LinuxåŸºé‡‘ä¼šçš„å•†æ ‡åˆ—è¡¨ï¼Œè¯·è®¿é—®<a href="https://www.linuxfoundation.org/trademark-usage/">å•†æ ‡ä½¿ç”¨</a>é¡µé¢ã€‚
        <br>
        Copyright Â© 2024 Koordinatoré¡¹ç›®ä½œè€…ã€‚ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚
        </div>
        </div></div></div></footer></div>
<script src="/zh-Hans/assets/js/runtime~main.004cc254.js"></script>
<script src="/zh-Hans/assets/js/main.7c3c3fd8.js"></script>
</body>
</html>