"use strict";(self.webpackChunkkoordinator_sh=self.webpackChunkkoordinator_sh||[]).push([[3851],{3905:(e,t,a)=>{a.d(t,{Zo:()=>s,kt:()=>k});var n=a(67294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var u=n.createContext({}),d=function(e){var t=n.useContext(u),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},s=function(e){var t=d(e.components);return n.createElement(u.Provider,{value:t},e.children)},p="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,l=e.originalType,u=e.parentName,s=i(e,["components","mdxType","originalType","parentName"]),p=d(a),m=o,k=p["".concat(u,".").concat(m)]||p[m]||c[m]||l;return a?n.createElement(k,r(r({ref:t},s),{},{components:a})):n.createElement(k,r({ref:t},s))}));function k(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var l=a.length,r=new Array(l);r[0]=m;var i={};for(var u in t)hasOwnProperty.call(t,u)&&(i[u]=t[u]);i.originalType=e,i[p]="string"==typeof e?e:o,r[1]=i;for(var d=2;d<l;d++)r[d]=a[d];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},14111:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>u,contentTitle:()=>r,default:()=>c,frontMatter:()=>l,metadata:()=>i,toc:()=>d});var n=a(87462),o=(a(67294),a(3905));const l={slug:"release-v0.7.0",title:"Koordinator v0.7: \u4e3a\u4efb\u52a1\u8c03\u5ea6\u9886\u57df\u6ce8\u5165\u65b0\u6d3b\u529b",authors:["joseph"],tags:["release"]},r=void 0,i={permalink:"/zh-Hans/blog/release-v0.7.0",editUrl:"https://github.com/koordinator-sh/koordinator.sh/edit/main/blog/2022-09-23-release/index.md",source:"@site/i18n/zh-Hans/docusaurus-plugin-content-blog/2022-09-23-release/index.md",title:"Koordinator v0.7: \u4e3a\u4efb\u52a1\u8c03\u5ea6\u9886\u57df\u6ce8\u5165\u65b0\u6d3b\u529b",description:"Koordinator[1] \u7ee7\u4e0a\u6b21 v0.6\u7248\u672c[2] \u53d1\u5e03\u540e\uff0c\u7ecf\u8fc7 Koordinator \u793e\u533a\u7684\u52aa\u529b\uff0c\u6211\u4eec\u8fce\u6765\u4e86\u5177\u6709\u91cd\u5927\u610f\u4e49\u7684 v0.7 \u7248\u672c\u3002\u5728\u8fd9\u4e2a\u7248\u672c\u4e2d\u7740\u91cd\u89e3\u51b3\u673a\u5668\u5b66\u4e60\u3001\u5927\u6570\u636e\u573a\u666f\u9700\u8981\u7684\u4efb\u52a1\u8c03\u5ea6\u80fd\u529b\uff0c\u4f8b\u5982 CoScheduling\u3001ElasticQuota\u548c\u7cbe\u7ec6\u5316\u7684 GPU \u5171\u4eab\u8c03\u5ea6\u80fd\u529b\u3002\u5e76\u5728\u8c03\u5ea6\u95ee\u9898\u8bca\u65ad\u5206\u6790\u65b9\u9762\u5f97\u5230\u4e86\u589e\u5f3a\uff0c\u91cd\u8c03\u5ea6\u5668\u4e5f\u6781\u5927\u7684\u63d0\u5347\u4e86\u5b89\u5168\u6027\uff0c\u964d\u4f4e\u4e86\u91cd\u8c03\u5ea6\u7684\u98ce\u9669\u3002",date:"2022-09-23T00:00:00.000Z",formattedDate:"2022\u5e749\u670823\u65e5",tags:[{label:"release",permalink:"/zh-Hans/blog/tags/release"}],readingTime:33.82,hasTruncateMarker:!1,authors:[{name:"Joseph",title:"Koordinator maintainer",url:"https://github.com/eahydra",imageURL:"https://github.com/eahydra.png",key:"joseph"}],frontMatter:{slug:"release-v0.7.0",title:"Koordinator v0.7: \u4e3a\u4efb\u52a1\u8c03\u5ea6\u9886\u57df\u6ce8\u5165\u65b0\u6d3b\u529b",authors:["joseph"],tags:["release"]},prevItem:{title:"Koordinator v1.0: \u6b63\u5f0f\u53d1\u5e03",permalink:"/zh-Hans/blog/release-v1.0.0"},nextItem:{title:"Koordinator v0.6: Complete fine-grained CPU orchestration, Resource Reservation and Descheduling",permalink:"/zh-Hans/blog/release-v0.6.0"}},u={authorsImageUrls:[void 0]},d=[{value:"1. \u4efb\u52a1\u8c03\u5ea6",id:"1-\u4efb\u52a1\u8c03\u5ea6",level:2},{value:"1.1 Enhanced Coscheduling",id:"11-enhanced-coscheduling",level:3},{value:"\u652f\u6301 <code>Strict</code> \u548c <code>NonStrict</code> \u4e24\u79cd\u6a21\u5f0f",id:"\u652f\u6301-strict-\u548c-nonstrict-\u4e24\u79cd\u6a21\u5f0f",level:4},{value:"\u6539\u8fdb PodGroup \u8c03\u5ea6\u5931\u8d25\u7684\u5904\u7406\u673a\u5236\uff0c\u5b9e\u73b0\u66f4\u9ad8\u6548\u7684\u91cd\u8bd5\u8c03\u5ea6",id:"\u6539\u8fdb-podgroup-\u8c03\u5ea6\u5931\u8d25\u7684\u5904\u7406\u673a\u5236\u5b9e\u73b0\u66f4\u9ad8\u6548\u7684\u91cd\u8bd5\u8c03\u5ea6",level:4},{value:"\u652f\u6301\u591a\u4e2a PodGroup \u4e3a\u4e00\u7ec4\u5b8c\u6210 Gang Scheduling",id:"\u652f\u6301\u591a\u4e2a-podgroup-\u4e3a\u4e00\u7ec4\u5b8c\u6210-gang-scheduling",level:4},{value:"\u652f\u6301\u8f7b\u91cf\u5316 Gang \u534f\u8bae",id:"\u652f\u6301\u8f7b\u91cf\u5316-gang-\u534f\u8bae",level:4},{value:"1.2 ElasticQuota Scheduling",id:"12-elasticquota-scheduling",level:3},{value:"Pod \u5173\u8054 ElasticQuota \u65b9\u5f0f",id:"pod-\u5173\u8054-elasticquota-\u65b9\u5f0f",level:4},{value:"\u6811\u5f62\u7ed3\u6784\u7ba1\u7406\u673a\u5236\u548c\u4f7f\u7528\u65b9\u6cd5",id:"\u6811\u5f62\u7ed3\u6784\u7ba1\u7406\u673a\u5236\u548c\u4f7f\u7528\u65b9\u6cd5",level:4},{value:"\u516c\u5e73\u6027\u4fdd\u969c\u673a\u5236",id:"\u516c\u5e73\u6027\u4fdd\u969c\u673a\u5236",level:4},{value:"\u62a2\u5360\u673a\u5236",id:"\u62a2\u5360\u673a\u5236",level:4},{value:"2. \u7cbe\u7ec6\u5316\u8d44\u6e90\u8c03\u5ea6",id:"2-\u7cbe\u7ec6\u5316\u8d44\u6e90\u8c03\u5ea6",level:2},{value:"Device Share Scheduling",id:"device-share-scheduling",level:3},{value:"GPU \u8d44\u6e90\u534f\u8bae",id:"gpu-\u8d44\u6e90\u534f\u8bae",level:4},{value:"\u8bbe\u5907\u4fe1\u606f\u548c\u8bbe\u5907\u5bb9\u91cf\u4e0a\u62a5",id:"\u8bbe\u5907\u4fe1\u606f\u548c\u8bbe\u5907\u5bb9\u91cf\u4e0a\u62a5",level:4},{value:"\u4e2d\u5fc3\u8c03\u5ea6\u5206\u914d\u8bbe\u5907\u8d44\u6e90",id:"\u4e2d\u5fc3\u8c03\u5ea6\u5206\u914d\u8bbe\u5907\u8d44\u6e90",level:4},{value:"\u5355\u673a\u4fa7\u7cbe\u51c6\u7ed1\u5b9a\u8bbe\u5907\u4fe1\u606f",id:"\u5355\u673a\u4fa7\u7cbe\u51c6\u7ed1\u5b9a\u8bbe\u5907\u4fe1\u606f",level:4},{value:"3. \u8c03\u5ea6\u5668\u8bca\u65ad\u5206\u6790",id:"3-\u8c03\u5ea6\u5668\u8bca\u65ad\u5206\u6790",level:2},{value:"\u5206\u6790 Score \u7ed3\u679c",id:"\u5206\u6790-score-\u7ed3\u679c",level:3},{value:"\u8c03\u5ea6\u63d2\u4ef6\u5bfc\u51fa\u5185\u90e8\u72b6\u6001",id:"\u8c03\u5ea6\u63d2\u4ef6\u5bfc\u51fa\u5185\u90e8\u72b6\u6001",level:3},{value:"\u67e5\u770b\u5f53\u524d\u652f\u6301\u7684\u63d2\u4ef6 API",id:"\u67e5\u770b\u5f53\u524d\u652f\u6301\u7684\u63d2\u4ef6-api",level:3},{value:"4. \u66f4\u5b89\u5168\u7684\u91cd\u8c03\u5ea6",id:"4-\u66f4\u5b89\u5168\u7684\u91cd\u8c03\u5ea6",level:2},{value:"5. \u5176\u4ed6\u6539\u52a8",id:"5-\u5176\u4ed6\u6539\u52a8",level:2}],s={toc:d},p="wrapper";function c(e){let{components:t,...l}=e;return(0,o.kt)(p,(0,n.Z)({},s,l,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://koordinator.sh/"},"Koordinator[1]")," \u7ee7\u4e0a\u6b21 ",(0,o.kt)("a",{parentName:"p",href:"https://mp.weixin.qq.com/s/YdoxVxz_91ZFemF8JuxRvQ"},"v0.6\u7248\u672c[2]")," \u53d1\u5e03\u540e\uff0c\u7ecf\u8fc7 Koordinator \u793e\u533a\u7684\u52aa\u529b\uff0c\u6211\u4eec\u8fce\u6765\u4e86\u5177\u6709\u91cd\u5927\u610f\u4e49\u7684 v0.7 \u7248\u672c\u3002\u5728\u8fd9\u4e2a\u7248\u672c\u4e2d\u7740\u91cd\u89e3\u51b3\u673a\u5668\u5b66\u4e60\u3001\u5927\u6570\u636e\u573a\u666f\u9700\u8981\u7684\u4efb\u52a1\u8c03\u5ea6\u80fd\u529b\uff0c\u4f8b\u5982 CoScheduling\u3001ElasticQuota\u548c\u7cbe\u7ec6\u5316\u7684 GPU \u5171\u4eab\u8c03\u5ea6\u80fd\u529b\u3002\u5e76\u5728\u8c03\u5ea6\u95ee\u9898\u8bca\u65ad\u5206\u6790\u65b9\u9762\u5f97\u5230\u4e86\u589e\u5f3a\uff0c\u91cd\u8c03\u5ea6\u5668\u4e5f\u6781\u5927\u7684\u63d0\u5347\u4e86\u5b89\u5168\u6027\uff0c\u964d\u4f4e\u4e86\u91cd\u8c03\u5ea6\u7684\u98ce\u9669\u3002"),(0,o.kt)("h1",{id:"\u7248\u672c\u529f\u80fd\u7279\u6027\u89e3\u8bfb"},"\u7248\u672c\u529f\u80fd\u7279\u6027\u89e3\u8bfb"),(0,o.kt)("h2",{id:"1-\u4efb\u52a1\u8c03\u5ea6"},"1. \u4efb\u52a1\u8c03\u5ea6"),(0,o.kt)("h3",{id:"11-enhanced-coscheduling"},"1.1 Enhanced Coscheduling"),(0,o.kt)("p",null,"Gang scheduling\u662f\u5728\u5e76\u53d1\u7cfb\u7edf\u4e2d\u5c06\u591a\u4e2a\u76f8\u5173\u8054\u7684\u8fdb\u7a0b\u8c03\u5ea6\u5230\u4e0d\u540c\u5904\u7406\u5668\u4e0a\u540c\u65f6\u8fd0\u884c\u7684\u7b56\u7565\uff0c\u5176\u6700\u4e3b\u8981\u7684\u539f\u5219\u662f\u4fdd\u8bc1\u6240\u6709\u76f8\u5173\u8054\u7684\u8fdb\u7a0b\u80fd\u591f\u540c\u65f6\u542f\u52a8\uff0c\u9632\u6b62\u90e8\u5206\u8fdb\u7a0b\u7684\u5f02\u5e38\uff0c\u5bfc\u81f4\u6574\u4e2a\u5173\u8054\u8fdb\u7a0b\u7ec4\u7684\u963b\u585e\u3002\u4f8b\u5982\u5f53\u63d0\u4ea4\u4e00\u4e2aJob\u65f6\u4f1a\u4ea7\u751f\u591a\u4e2a\u4efb\u52a1\uff0c\u8fd9\u4e9b\u4efb\u52a1\u671f\u671b\u8981\u4e48\u5168\u90e8\u8c03\u5ea6\u6210\u529f\uff0c\u8981\u4e48\u5168\u90e8\u5931\u8d25\u3002\u8fd9\u79cd\u9700\u6c42\u79f0\u4e3a All-or-Nothing\uff0c\u5bf9\u5e94\u7684\u5b9e\u73b0\u88ab\u79f0\u4f5c Gang Scheduling(or Coscheduling) \u3002",(0,o.kt)("br",null),"Koordinator \u5728\u542f\u52a8\u4e4b\u521d\uff0c\u671f\u671b\u652f\u6301 Kubernetes \u591a\u79cd\u5de5\u4f5c\u8d1f\u8f7d\u7684\u6df7\u90e8\u8c03\u5ea6\uff0c\u63d0\u9ad8\u5de5\u4f5c\u8d1f\u8f7d\u7684\u8fd0\u884c\u65f6\u6548\u7387\u548c\u53ef\u9760\u6027\uff0c\u5176\u4e2d\u5c31\u5305\u62ec\u4e86\u673a\u5668\u5b66\u4e60\u548c\u5927\u6570\u636e\u9886\u57df\u4e2d\u5e7f\u6cdb\u5b58\u5728\u7684\u5177\u5907 All-or-Nothing \u9700\u6c42\u7684\u4f5c\u4e1a\u8d1f\u8f7d\u3002 \u4e3a\u4e86\u89e3\u51b3 All-or-Nothing \u8c03\u5ea6\u9700\u6c42\uff0cKoordinator v0.7.0 \u57fa\u4e8e\u793e\u533a\u5df2\u6709\u7684 Coscheduling \u5b9e\u73b0\u4e86 Enhanced Coscheduling\u3002",(0,o.kt)("br",null),"Enhanced Coscheduling \u79c9\u627f\u7740 Koordiantor \u517c\u5bb9\u793e\u533a\u7684\u539f\u5219\uff0c\u5b8c\u5168\u517c\u5bb9\u793e\u533a Coscheduling \u548c \u4f9d\u8d56\u7684 PodGroup CRD\u3002\u5df2\u7ecf\u4f7f\u7528 PodGroup \u7684\u7528\u6237\u53ef\u4ee5\u65e0\u7f1d\u5347\u7ea7\u5230 Koordinator\u3002",(0,o.kt)("br",null),"\u9664\u6b64\u4e4b\u5916\uff0cEnhanced Coscheduling \u8fd8\u5b9e\u73b0\u4e86\u5982\u4e0b\u589e\u5f3a\u80fd\u529b\uff1a"),(0,o.kt)("h4",{id:"\u652f\u6301-strict-\u548c-nonstrict-\u4e24\u79cd\u6a21\u5f0f"},"\u652f\u6301 ",(0,o.kt)("inlineCode",{parentName:"h4"},"Strict")," \u548c ",(0,o.kt)("inlineCode",{parentName:"h4"},"NonStrict")," \u4e24\u79cd\u6a21\u5f0f"),(0,o.kt)("p",null,"\u4e24\u79cd\u6a21\u5f0f\u7684\u533a\u522b\u5728\u4e8e ",(0,o.kt)("inlineCode",{parentName:"p"},"Strict"),"\u6a21\u5f0f\uff08\u5373\u9ed8\u8ba4\u6a21\u5f0f\uff09\u4e0b\u8c03\u5ea6\u5931\u8d25\u4f1a Reject \u6240\u6709\u5206\u914d\u5230\u8d44\u6e90\u5e76\u5904\u4e8e Wait \u72b6\u6001\u7684 Pod\uff0c\u800c ",(0,o.kt)("inlineCode",{parentName:"p"},"NonStrict")," \u6a21\u5f0f\u4e0d\u4f1a\u53d1\u8d77 Reject\u3002NonStrict \u6a21\u5f0f\u4e0b\uff0c\u540c\u5c5e\u4e8e\u4e00\u4e2a PodGroup \u7684 Pod A \u548c PodB \u8c03\u5ea6\u65f6\uff0c\u5982\u679c PodA \u8c03\u5ea6\u5931\u8d25\u4e0d\u4f1a\u5f71\u54cd PodB \u8c03\u5ea6\uff0c PodB \u8fd8\u4f1a\u7ee7\u7eed\u88ab\u8c03\u5ea6\u3002NonStrict \u6a21\u5f0f\u5bf9\u4e8e\u4f53\u91cf\u8f83\u5927\u7684 Job \u6bd4\u8f83\u53cb\u597d\uff0c\u53ef\u4ee5\u8ba9\u8fd9\u79cd\u5927\u4f53\u91cf Job \u66f4\u5feb\u7684\u8c03\u5ea6\u5b8c\u6210\uff0c\u4f46\u540c\u65f6\u4e5f\u589e\u52a0\u4e86\u8d44\u6e90\u6b7b\u9501\u7684\u98ce\u9669\u3002\u540e\u7eed Koordinator \u4f1a\u63d0\u4f9b NonStrict \u6a21\u5f0f\u4e0b\u89e3\u51b3\u6b7b\u9501\u7684\u65b9\u6848\u5b9e\u73b0\u3002 ",(0,o.kt)("br",null),"\u7528\u6237\u5728\u4f7f\u7528\u65f6\uff0c\u53ef\u4ee5\u5728 PodGroup \u6216\u8005 Pod \u4e2d\u8ffd\u52a0 annotation ",(0,o.kt)("inlineCode",{parentName:"p"},"gang.scheduling.koordinator.sh/mode=NonStrict"),"\u5f00\u542f NonStrict \u6a21\u5f0f\u3002"),(0,o.kt)("h4",{id:"\u6539\u8fdb-podgroup-\u8c03\u5ea6\u5931\u8d25\u7684\u5904\u7406\u673a\u5236\u5b9e\u73b0\u66f4\u9ad8\u6548\u7684\u91cd\u8bd5\u8c03\u5ea6"},"\u6539\u8fdb PodGroup \u8c03\u5ea6\u5931\u8d25\u7684\u5904\u7406\u673a\u5236\uff0c\u5b9e\u73b0\u66f4\u9ad8\u6548\u7684\u91cd\u8bd5\u8c03\u5ea6"),(0,o.kt)("p",null,"\u4e3e\u4e2a\u4f8b\u5b50\uff0cPodGroup A \u5173\u8054\u4e865\u4e2aPod\uff0c\u5176\u4e2d\u524d3\u4e2aPod\u901a\u8fc7Filter/Score\uff0c\u8fdb\u5165Wait\u9636\u6bb5\uff0c\u7b2c4\u4e2aPod\u8c03\u5ea6\u5931\u8d25\uff0c\u5f53\u8c03\u5ea6\u7b2c5\u4e2aPod\u65f6\uff0c\u53d1\u73b0\u7b2c4\u4e2aPod\u5df2\u7ecf\u5931\u8d25\uff0c\u5219\u62d2\u7edd\u8c03\u5ea6\u3002\u5728\u793e\u533a Coscheduling \u5b9e\u73b0\u4e2d\uff0c\u8c03\u5ea6\u5931\u8d25\u7684PodGroup \u4f1a\u52a0\u5165\u5230\u57fa\u4e8ecache\u673a\u5236\u7684 lastDeniedPG  \u5bf9\u8c61\u4e2d\uff0c\u5f53 cache \u6ca1\u6709\u8fc7\u671f\uff0c\u5219\u4f1a\u62d2\u7edd\u8c03\u5ea6\uff1b\u5982\u679c\u8fc7\u671f\u5c31\u5141\u8bb8\u7ee7\u7eed\u8c03\u5ea6\u3002\u53ef\u4ee5\u770b\u5230 cache \u7684\u8fc7\u671f\u65f6\u95f4\u5f88\u5173\u952e\uff0c\u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e\u7684\u8fc7\u957f\u4f1a\u5bfc\u81f4Pod\u8fdf\u8fdf\u5f97\u4e0d\u5230\u8c03\u5ea6\u673a\u4f1a\uff0c\u8bbe\u7f6e\u7684\u8fc7\u77ed\u4f1a\u51fa\u73b0\u9891\u7e41\u7684\u65e0\u6548\u8c03\u5ea6\u3002",(0,o.kt)("br",null),"\u800c\u5728Enhanced Coscheduling \u4e2d\uff0c\u5b9e\u73b0\u4e86\u4e00\u79cd\u57fa\u4e8e ScheduleCycle \u7684\u91cd\u8bd5\u673a\u5236\u3002\u4ee5\u4e0a\u573a\u666f\u4e3a\u4f8b\uff0c5\u4e2aPod\u7684 ScheduleCycle \u521d\u59cb\u503c\u4e3a 0\uff0cPodGroup \u5bf9\u5e94\u7684 ScheduleCycle \u521d\u59cb\u503c\u4e3a1\uff1b\u5f53\u6bcf\u4e00\u6b21\u5c1d\u8bd5\u8c03\u5ea6 Pod \u65f6\uff0c\u90fd\u4f1a\u66f4\u65b0 Pod ScheduleCycle \u4e3a PodGroup ScheduleCycle\u3002\u5982\u679c\u5176\u4e2d\u4e00\u4e2a Pod \u8c03\u5ea6\u5931\u8d25\uff0c\u4f1a\u6807\u8bb0\u5f53\u524d\u7684 PodGroup ScheduleCycle \u65e0\u6548\uff0c\u4e4b\u540e\u6240\u6709\u5c0f\u4e8e PodGroup ScheduleCycle \u7684 Pod \u90fd\u4f1a\u88ab\u62d2\u7edd\u8c03\u5ea6\u3002\u5f53\u540c\u4e00\u4e2a PodGroup \u4e0b\u7684\u6240\u6709 Pod \u90fd\u5c1d\u8bd5\u8c03\u5ea6\u4e00\u8f6e\u540e\uff0cPod ScheduleCycle \u90fd\u66f4\u65b0\u4e3a\u5f53\u524d PodGroup ScheduleCycle\uff0c\u5e76\u9012\u8fdb PodGroup ScheduleCycle\uff0c\u5e76\u6807\u8bb0\u5141\u8bb8\u8c03\u5ea6\u3002\u8fd9\u79cd\u65b9\u5f0f\u53ef\u4ee5\u6709\u6548\u89c4\u907f\u57fa\u4e8e\u8fc7\u671f\u65f6\u95f4\u7684\u7f3a\u9677\uff0c\u5b8c\u5168\u53d6\u51b3\u4e8e\u8c03\u5ea6\u961f\u5217\u7684\u914d\u7f6e\u91cd\u8bd5\u8c03\u5ea6\u3002",(0,o.kt)("br",null),(0,o.kt)("img",{alt:"image.png",src:a(2511).Z,title:"\u57fa\u4e8e ScheduleCycle \u7684\u91cd\u8bd5\u673a\u5236",width:"3078",height:"922"})),(0,o.kt)("h4",{id:"\u652f\u6301\u591a\u4e2a-podgroup-\u4e3a\u4e00\u7ec4\u5b8c\u6210-gang-scheduling"},"\u652f\u6301\u591a\u4e2a PodGroup \u4e3a\u4e00\u7ec4\u5b8c\u6210 Gang Scheduling"),(0,o.kt)("p",null,"\u4e00\u4e9b\u590d\u6742\u7684 Job \u6709\u591a\u79cd\u89d2\u8272\uff0c\u6bcf\u4e2a\u89d2\u8272\u7ba1\u7406\u4e00\u6279\u4efb\u52a1\uff0c\u6bcf\u4e2a\u89d2\u8272\u7684\u4efb\u52a1\u8981\u6c42\u652f\u6301 All-or-Nothing \uff0c\u6bcf\u4e2a\u89d2\u8272\u7684 MinMember \u8981\u6c42\u4e5f\u4e0d\u4e00\u6837\uff0c\u5e76\u4e14\u6bcf\u4e2a\u89d2\u8272\u4e4b\u95f4\u4e5f\u8981\u6c42 All-or-Nothing\u3002\u8fd9\u5c31\u5bfc\u81f4\u6bcf\u4e2a\u89d2\u8272\u90fd\u6709\u4e00\u4e2a\u5bf9\u5e94\u7684 PodGroup \uff0c\u5e76\u4e14\u8fd8\u8981\u6c42 PodGroup \u5373\u4f7f\u6ee1\u8db3\u4e86\u4e5f\u9700\u8981\u7b49\u5f85\u5176\u4ed6\u89d2\u8272\u7684 PodGroup \u5fc5\u987b\u6ee1\u8db3\u3002\u793e\u533a Coscheduling \u65e0\u6cd5\u6ee1\u8db3\u8fd9\u79cd\u573a\u666f\u9700\u6c42\u3002\u800c Koordinator \u5b9e\u73b0\u7684 Enhanced Coscheduling \u652f\u6301\u7528\u6237\u5728\u591a\u4e2a PodGroup \u4e2d\u589e\u52a0 anntation \u76f8\u5173\u5173\u8054\u5b9e\u73b0\uff0c\u5e76\u652f\u6301\u8de8Namespace\u3002\u4f8b\u5982\u7528\u6237\u67092\u4e2aPodGroup \uff0c\u540d\u5b57\u5206\u522b\u662fPodGroupA\u548cPodGroupB\uff0c\u53ef\u4ee5\u6309\u7167\u5982\u4e0b\u4f8b\u5b50\u5173\u8054\u4e24\u4e2a PodGroup\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: v1alpha1\nkind: PodGroup\nmetadata:\n  name: podGroupA\n  namespace: default\n  annotations:\n    gang.scheduling.koordinator.sh/groups: ["namespaceA/podGroupA", "namespaceB/podGroupB"]\nspec:\n    ...\n')),(0,o.kt)("h4",{id:"\u652f\u6301\u8f7b\u91cf\u5316-gang-\u534f\u8bae"},"\u652f\u6301\u8f7b\u91cf\u5316 Gang \u534f\u8bae"),(0,o.kt)("p",null,"\u5982\u679c\u7528\u6237\u4e0d\u5e0c\u671b\u521b\u5efa PodGroup\uff0c\u8ba4\u4e3a\u521b\u5efa PodGroup \u592a\u7e41\u7410\uff0c\u90a3\u4e48\u53ef\u4ee5\u8003\u8651\u5728\u4e00\u7ec4 Pod \u4e2d\u586b\u5145\u76f8\u540c annotation  ",(0,o.kt)("inlineCode",{parentName:"p"},"gang.scheduling.koordinator.sh/name=<podGroupName>")," \u8868\u793a\u8fd9\u4e00\u7ec4 Pod \u4f7f\u7528 Coscheduling \u8c03\u5ea6\u3002\u5982\u679c\u671f\u671b\u8bbe\u7f6e minMember \uff0c\u53ef\u4ee5\u8ffd\u52a0 Annotation ",(0,o.kt)("inlineCode",{parentName:"p"},"gang.scheduling.koordinator.sh/min-available=<availableNum>"),"\u3002\u4e3e\u4e2a\u4f8b\u5b50\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: v1\nkind: Pod\nmetadata:\n  annotations:\n    gang.scheduling.koordinator.sh/name: "pod-group-a"\n    gang.scheduling.koordinator.sh/min-available: "5"\n  name: demo-pod\n  namespace: default\nspec:\n    ...\n')),(0,o.kt)("h3",{id:"12-elasticquota-scheduling"},"1.2 ElasticQuota Scheduling"),(0,o.kt)("p",null,"\u4e00\u5bb6\u4e2d\u5927\u578b\u516c\u53f8\u5185\u6709\u591a\u4e2a\u4ea7\u54c1\u548c\u7814\u53d1\u56e2\u961f\uff0c\u5171\u7528\u591a\u4e2a\u6bd4\u8f83\u5927\u89c4\u6a21\u7684 Kubernetes \u96c6\u7fa4\uff0c\u8fd9\u4e9b\u96c6\u7fa4\u5185\u542b\u6709\u7684\u5927\u91cf CPU/Memory/Disk \u7b49\u8d44\u6e90\u88ab\u8d44\u6e90\u8fd0\u8425\u56e2\u961f\u7edf\u4e00\u7ba1\u7406\u3002\u8fd0\u8425\u56e2\u961f\u5f80\u5f80\u5728\u91c7\u8d2d\u8d44\u6e90\u524d\uff0c\u901a\u8fc7\u989d\u5ea6\u9884\u7b97\u7684\u673a\u5236\u8ba9\u516c\u53f8\u5185\u6bcf\u4e2a\u56e2\u961f\u6839\u636e\u81ea\u8eab\u7684\u9700\u6c42\u63d0\u4ea4\u989d\u5ea6\u9884\u7b97\u3002\u4e1a\u52a1\u56e2\u961f\u6b64\u65f6\u4e00\u822c\u6839\u636e\u4e1a\u52a1\u5f53\u524d\u548c\u5bf9\u672a\u6765\u7684\u9884\u671f\u505a\u597d\u989d\u5ea6\u9884\u7b97\u3002\u6700\u7406\u60f3\u7684\u60c5\u51b5\u662f\u6bcf\u4e00\u4efd\u989d\u5ea6\u90fd\u80fd\u591f\u88ab\u4f7f\u7528\uff0c\u4f46\u73b0\u5b9e\u544a\u8bc9\u6211\u4eec\u8fd9\u662f\u4e0d\u73b0\u5b9e\u7684\u3002\u5f80\u5f80\u51fa\u73b0\u7684\u95ee\u9898\u662f\uff1a"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u56e2\u961f A \u9ad8\u4f30\u4e86\u4e1a\u52a1\u7684\u53d1\u5c55\u901f\u5ea6\uff0c\u7533\u8bf7\u4e86\u592a\u591a\u7684\u989d\u5ea6\u7528\u4e0d\u5b8c"),(0,o.kt)("li",{parentName:"ol"},"\u56e2\u961f B \u4f4e\u4f30\u4e86\u4e1a\u52a1\u7684\u53d1\u5c55\u901f\u5ea6\uff0c\u7533\u8bf7\u7684\u989d\u5ea6\u4e0d\u591f\u7528"),(0,o.kt)("li",{parentName:"ol"},"\u56e2\u961f C \u5b89\u6392\u4e86\u4e00\u573a\u6d3b\u52a8\uff0c\u624b\u4e0a\u7684\u989d\u5ea6\u4e0d\u591f\u591a\u4e86\uff0c\u4f46\u662f\u6d3b\u52a8\u53ea\u6301\u7eed\u51e0\u5468\uff0c\u7533\u8bf7\u592a\u591a\u989d\u5ea6\u548c\u8d44\u6e90\u4e5f\u4f1a\u6d6a\u8d39\u6389\u3002"),(0,o.kt)("li",{parentName:"ol"},"\u56e2\u961f D \u4e0b\u9762\u8fd8\u6709\u5404\u4e2a\u5b50\u56e2\u961f\u548c\u4e1a\u52a1\uff0c\u6bcf\u4e2a\u5b50\u56e2\u961f\u5185\u4e5f\u4f1a\u51fa\u73b0\u7c7b\u4f3cA B C \u4e09\u4e2a\u56e2\u961f\u7684\u60c5\u51b5\uff0c\u800c\u4e14\u5176\u4e2d\u6709\u4e9b\u56e2\u961f\u7684\u4e1a\u52a1\u4e34\u65f6\u7a81\u53d1\u9700\u8981\u63d0\u4ea4\u4e00\u4e9b\u8ba1\u7b97\u4efb\u52a1\u8981\u4ea4\u4e2a\u5ba2\u6237\uff0c\u4f46\u662f\u6ca1\u6709\u989d\u5ea6\u4e86\uff0c\u8d70\u989d\u5ea6\u9884\u7b97\u5ba1\u6279\u4e5f\u4e0d\u591f\u4e86\u3002"),(0,o.kt)("li",{parentName:"ol"},"......")),(0,o.kt)("p",null,"\u4ee5\u4e0a\u5927\u5bb6\u65e5\u5e38\u7ecf\u5e38\u9047\u5230\u7684\u573a\u666f\uff0c\u5728\u6df7\u90e8\u573a\u666f\u3001\u5927\u6570\u636e\u573a\u666f\uff0c\u4e34\u65f6\u6027\u7a81\u53d1\u9700\u6c42\u53c8\u662f\u65f6\u5e38\u51fa\u73b0\u7684\uff0c\u8fd9\u4e9b\u8d44\u6e90\u7684\u9700\u6c42\u90fd\u7ed9\u989d\u5ea6\u7ba1\u7406\u5de5\u4f5c\u5e26\u6765\u4e86\u6781\u5927\u7684\u6311\u6218\u3002\u505a\u597d\u989d\u5ea6\u7ba1\u7406\u5de5\u4f5c\uff0c\u4e00\u65b9\u9762\u907f\u514d\u8fc7\u5ea6\u91c7\u8d2d\u8d44\u6e90\u964d\u4f4e\u6210\u672c\uff0c\u53c8\u8981\u5728\u4e34\u65f6\u9700\u8981\u989d\u5ea6\u65f6\u4e0d\u91c7\u8d2d\u8d44\u6e90\u6216\u8005\u5c3d\u91cf\u5c11\u7684\u91c7\u8d2d\u8d44\u6e90\uff1b\u53e6\u4e00\u65b9\u9762\u4e0d\u80fd\u56e0\u4e3a\u989d\u5ea6\u95ee\u9898\u9650\u5236\u8d44\u6e90\u4f7f\u7528\u7387\uff0c\u989d\u5ea6\u7ba1\u7406\u4e0d\u597d\u5c31\u4f1a\u5bfc\u81f4\u5373\u4f7f\u6709\u6bd4\u8f83\u597d\u7684\u6280\u672f\u5e2e\u52a9\u590d\u7528\u8d44\u6e90\uff0c\u4e5f\u65e0\u6cd5\u53d1\u6325\u5176\u4ef7\u503c\u3002 \u603b\u4e4b\uff0c\u989d\u5ea6\u7ba1\u7406\u5de5\u4f5c\u662f\u5e7f\u5927\u516c\u53f8\u6216\u7ec4\u7ec7\u9700\u957f\u671f\u9762\u5bf9\u4e14\u5fc5\u987b\u9762\u5bf9\u7684\u95ee\u9898\u3002",(0,o.kt)("br",null),"Kubernetes ResourceQuota \u53ef\u4ee5\u89e3\u51b3\u989d\u5ea6\u7ba1\u7406\u7684\u90e8\u5206\u95ee\u9898\u3002 \u539f\u751f Kubernetes ResourceQuota API \u7528\u4e8e\u6307\u5b9a\u6bcf\u4e2a Namespace \u7684\u6700\u5927\u8d44\u6e90\u989d\u5ea6\u91cf\uff0c\u5e76\u901a\u8fc7 admission \u673a\u5236\u5b8c\u6210\u51c6\u5165\u68c0\u67e5\u3002\u5982\u679c Namespace \u5f53\u524d\u8d44\u6e90\u5206\u914d\u603b\u91cf\u8d85\u8fc7ResourceQuota \u6307\u5b9a\u7684\u914d\u989d\uff0c\u5219\u62d2\u7edd\u521b\u5efa Pod\u3002 Kubernetes ResourceQuota \u8bbe\u8ba1\u6709\u4e00\u4e2a\u5c40\u9650\u6027\uff1aQuota  \u7528\u91cf\u662f\u6309\u7167 Pod Requests \u805a\u5408\u7684\u3002 \u867d\u7136\u8fd9\u79cd\u673a\u5236\u53ef\u4ee5\u4fdd\u8bc1\u5b9e\u9645\u7684\u8d44\u6e90\u6d88\u8017\u6c38\u8fdc\u4e0d\u4f1a\u8d85\u8fc7 ResourceQuota \u7684\u9650\u5236\uff0c\u4f46\u5b83\u53ef\u80fd\u4f1a\u5bfc\u81f4\u8d44\u6e90\u5229\u7528\u7387\u4f4e\uff0c\u56e0\u4e3a\u4e00\u4e9b Pod \u53ef\u80fd\u5df2\u7ecf\u7533\u8bf7\u4e86\u8d44\u6e90\u4f46\u672a\u80fd\u8c03\u5ea6\u3002 ",(0,o.kt)("br",null),"Kuberenetes Scheduler-Sig \u540e\u6765\u7ed9\u51fa\u4e86\u4e00\u4e2a\u501f\u9274 Yarn Capacity Scheduling\uff0c\u79f0\u4f5c ElasticQuota \u7684\u8bbe\u8ba1\u65b9\u6848\u5e76\u7ed9\u51fa\u4e86\u5177\u4f53\u7684\u5b9e\u73b0\u3002\u5141\u8bb8\u7528\u6237\u8bbe\u7f6e max \u548c min\uff1a"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"max \u8868\u793a\u7528\u6237\u53ef\u4ee5\u6d88\u8d39\u7684\u8d44\u6e90\u4e0a\u9650"),(0,o.kt)("li",{parentName:"ul"},"min \u8868\u793a\u9700\u8981\u4fdd\u969c\u7528\u6237\u5b9e\u73b0\u57fa\u672c\u529f\u80fd/\u6027\u80fd\u6240\u9700\u8981\u7684\u6700\u5c0f\u8d44\u6e90\u91cf")),(0,o.kt)("p",null,"\u901a\u8fc7\u8fd9\u4e24\u4e2a\u53c2\u6570\u53ef\u4ee5\u5e2e\u52a9\u7528\u6237\u5b9e\u73b0\u5982\u4e0b\u7684\u9700\u6c42\uff1a"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u7528\u6237\u8bbe\u7f6e min < max \u65f6\uff0c\u5f53\u6709\u7a81\u53d1\u8d44\u6e90\u9700\u6c42\u65f6\uff0c\u5373\u4f7f\u5f53\u524d ElasticQuota \u7684\u603b\u7528\u91cf\u8d85\u8fc7\u4e86 min\uff0c \u4f46\u53ea\u8981\u6ca1\u6709\u8fbe\u5230 max\uff0c\u90a3\u4e48\u7528\u6237\u53ef\u4ee5\u7ee7\u7eed\u521b\u5efa\u65b0\u7684 Pod \u5e94\u5bf9\u65b0\u7684\u4efb\u52a1\u8bf7\u6c42\u3002"),(0,o.kt)("li",{parentName:"ol"},"\u5f53\u7528\u6237\u9700\u8981\u66f4\u591a\u8d44\u6e90\u65f6\uff0c\u7528\u6237\u53ef\u4ee5\u4ece\u5176\u4ed6 ElasticQuota \u4e2d\u201c\u501f\u7528(borrow)\u201d \u8fd8\u6ca1\u6709\u88ab\u4f7f\u7528\u5e76\u4e14\u9700\u8981\u901a\u4fdd\u969c\u7684 min\u3002"),(0,o.kt)("li",{parentName:"ol"},"\u5f53\u4e00\u4e2a ElasticQuota \u9700\u8981\u4f7f\u7528 min \u8d44\u6e90\u65f6\uff0c\u4f1a\u901a\u8fc7\u62a2\u5360\u673a\u5236\u4ece\u5176\u4ed6\u501f\u7528\u65b9\u62a2\u56de\u6765\uff0c\u5373\u9a71\u9010\u4e00\u4e9b\u5176\u4ed6ElasticQuota \u8d85\u8fc7 min \u7528\u91cf\u7684 Pod\u3002")),(0,o.kt)("p",null,"ElasticQuota \u8fd8\u6709\u4e00\u4e9b\u5c40\u9650\u6027\uff1a\u6ca1\u6709\u5f88\u597d\u7684\u4fdd\u969c\u516c\u5e73\u6027\u3002\u5047\u5982\u540c\u4e00\u4e2a ElasticQuota \u6709\u5927\u91cf\u65b0\u5efa\u7684Pod\uff0c\u6709\u53ef\u80fd\u4f1a\u6d88\u8017\u6240\u6709\u5176\u4ed6\u53ef\u4ee5\u88ab\u501f\u7528\u7684Quota\uff0c\u4ece\u800c\u5bfc\u81f4\u540e\u6765\u7684 Pod \u53ef\u80fd\u62ff\u4e0d\u5230 Quota\u3002\u6b64\u65f6\u53ea\u80fd\u901a\u8fc7\u62a2\u5360\u673a\u5236\u62a2\u56de\u6765\u4e00\u4e9b Quota\u3002",(0,o.kt)("br",null),"\u53e6\u5916 ElasticQuota \u548c Kubernetes ResourceQuota \u90fd\u662f\u9762\u5411 Namespace\u7684\uff0c\u4e0d\u652f\u6301\u591a\u7ea7\u6811\u5f62\u7ed3\u6784\uff0c\u5bf9\u4e8e\u4e00\u4e9b\u672c\u8eab\u5177\u5907\u590d\u6742\u7ec4\u7ec7\u5173\u7cfb\u7684\u4f01\u4e1a/\u7ec4\u7ec7\u4e0d\u80fd\u5f88\u597d\u7684\u4f7f\u7528ElasticQuota/Kubenretes ResourceQuota \u5b8c\u6210\u989d\u5ea6\u7ba1\u7406\u5de5\u4f5c\u3002",(0,o.kt)("br",null),"Koordinator \u9488\u5bf9\u8fd9\u4e9b\u989d\u5ea6\u7ba1\u7406\u95ee\u9898\uff0c\u7ed9\u51fa\u4e86\u4e00\u79cd\u57fa\u4e8e\u793e\u533a ElasticQuota \u5b9e\u73b0\u7684\u652f\u6301\u591a\u7ea7\u7ba1\u7406\u65b9\u5f0f\u7684\u5f39\u6027Quota\u7ba1\u7406\u673a\u5236(multi hierarchy quota management)\u3002\u5177\u5907\u5982\u4e0b\u7279\u6027\uff1a"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u517c\u5bb9\u793e\u533a\u7684 ElasticQuota API\u3002\u7528\u6237\u53ef\u4ee5\u65e0\u7f1d\u5347\u7ea7\u5230 Koordinator"),(0,o.kt)("li",{parentName:"ul"},"\u652f\u6301\u6811\u5f62\u7ed3\u6784\u7ba1\u7406 Quota\u3002"),(0,o.kt)("li",{parentName:"ul"},"\u652f\u6301\u6309\u7167\u5171\u4eab\u6743\u91cd(shared weight)\u4fdd\u969c\u516c\u5e73\u6027\u3002"),(0,o.kt)("li",{parentName:"ul"},"\u5141\u8bb8\u7528\u6237\u8bbe\u7f6e\u662f\u5426\u5141\u8bb8\u501f\u7528Quota \u7ed9\u5176\u4ed6\u6d88\u8d39\u5bf9\u8c61\u3002")),(0,o.kt)("h4",{id:"pod-\u5173\u8054-elasticquota-\u65b9\u5f0f"},"Pod \u5173\u8054 ElasticQuota \u65b9\u5f0f"),(0,o.kt)("p",null,"\u7528\u6237\u53ef\u4ee5\u975e\u5e38\u4f7f\u7528\u7684\u4f7f\u7528\u8be5\u80fd\u529b\uff0c\u53ef\u4ee5\u5b8c\u5168\u6309\u7167 ElasticQuota \u7684\u7528\u6cd5\uff0c\u5373\u6bcf\u4e2a Namespace \u8bbe\u7f6e\u4e00\u4e2a ElasticQuota \u5bf9\u8c61\u3002\u4e5f\u53ef\u4ee5\u5728 Pod \u4e2d\u8ffd\u52a0 Label \u5173\u8054 ElasticQuota\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: v1\nkind: Pod\nmetadata:\n  labels:\n    quota.scheduling.koordinator.sh/name: "elastic-quota-a"\n  name: demo-pod\n  namespace: default\nspec:\n    ...\n')),(0,o.kt)("h4",{id:"\u6811\u5f62\u7ed3\u6784\u7ba1\u7406\u673a\u5236\u548c\u4f7f\u7528\u65b9\u6cd5"},"\u6811\u5f62\u7ed3\u6784\u7ba1\u7406\u673a\u5236\u548c\u4f7f\u7528\u65b9\u6cd5"),(0,o.kt)("p",null,"\u9700\u8981\u4f7f\u7528\u6811\u5f62\u7ed3\u6784\u7ba1\u7406 Quota \u65f6\uff0c\u9700\u8981\u5728 ElasticQuota \u4e2d\u8ffd\u52a0 Label  ",(0,o.kt)("inlineCode",{parentName:"p"},"quota.scheduling.koordinator.sh/is-parent"),"\u8868\u793a\u5f53\u524d ElasticQuota \u662f\u5426\u662f\u7236\u8282\u70b9\uff0c",(0,o.kt)("inlineCode",{parentName:"p"},"quota.scheduling.koordinator.sh/parent"),"\u8868\u793a\u5f53\u524d ElasticQuota \u7684\u7236\u8282\u70b9 ElasticQuota \u7684\u540d\u5b57\u3002\u4e3e\u4e2a\u4f8b\u5b50\uff1a",(0,o.kt)("br",null),(0,o.kt)("img",{alt:"image.png",src:a(1265).Z,width:"2256",height:"1156"}),(0,o.kt)("br",null),"\u6211\u4eec\u521b\u5efa\u4e00\u4e2a ElasticQuota Root \u4f5c\u4e3a\u6839\u8282\u70b9\uff0c\u8d44\u6e90\u603b\u91cf\u4e3aCPU 100C\uff0c\u5185\u5b58200Gi\uff0c\u4ee5\u53ca\u5b50\u8282\u70b9 quota-a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: scheduling.sigs.k8s.io/v1alpha1\nkind: ElasticQuota\nmetadata:\n  name: parentA\n  namespace: default\n  labels:\n    quota.scheduling.koordinator.sh/is-parent: "true"\n    quota.scheduling.koordinator.sh/allow-lent-resource: "true"\nspec:\n  max:\n    cpu: 100\n    memory: 200Gi\n  min:\n    cpu: 100\n    memory: 200Gi\n---\napiVersion: scheduling.sigs.k8s.io/v1alpha1\nkind: ElasticQuota\nmetadata:\n  name: childA1\n  namespace: default\n  labels:\n    quota.scheduling.koordinator.sh/is-parent: "false"\n    quota.scheduling.koordinator.sh/parent: "parentA"\n    quota.scheduling.koordinator.sh/allow-lent-resource: "true"\nspec:\n  max:\n    cpu: 40\n    memory: 100Gi\n  min:\n    cpu: 20\n    memory: 40Gi\n')),(0,o.kt)("p",null,"\u5728\u4f7f\u7528\u6811\u5f62\u7ed3\u6784\u7ba1\u7406 ElasticQuota \u65f6\uff0c\u6709\u4e00\u4e9b\u9700\u8981\u9075\u5faa\u7684\u7ea6\u675f\uff1a"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u9664\u4e86\u6839\u8282\u70b9\uff0c\u5176\u4ed6\u6240\u6709\u5b50\u8282\u70b9\u7684 min \u4e4b\u548c\u8981\u5c0f\u4e8e\u7236\u8282\u70b9\u7684 min\u3002"),(0,o.kt)("li",{parentName:"ol"},"\u4e0d\u9650\u5236\u5b50\u8282\u70b9 max\uff0c\u5141\u8bb8\u5b50\u8282\u70b9\u7684 max \u5927\u4e8e\u7236\u8282\u70b9\u7684 max\u3002\u8003\u8651\u4ee5\u4e0b\u573a\u666f\uff0c\u96c6\u7fa4\u4e2d\u6709 2 \u4e2a ElasticQuota \u5b50\u6811\uff1adev-parent \u548c production-parent\uff0c\u6bcf\u4e2a\u5b50\u6811\u90fd\u6709\u51e0\u4e2a\u5b50 ElasticQuota\u3002 \u5f53 production-parent \u5fd9\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u53ea\u964d\u4f4e dev-parent \u7684 max \u9650\u5236  dev-parent \u6574\u9897\u5b50\u6811\u7684\u8d44\u6e90\u4f7f\u7528\u91cf\uff0c\u800c\u4e0d\u662f\u964d\u4f4e dev-parent \u5b50\u6811\u7684\u6bcf\u4e2a\u5b50 ElasticQuota \u7684max\u9650\u5236\u7528\u91cf\u3002"),(0,o.kt)("li",{parentName:"ol"},"Pod \u4e0d\u80fd\u4f7f\u7528\u7236\u8282\u70b9ElasticQuota\u3002\u5982\u679c\u653e\u5f00\u8fd9\u4e2a\u9650\u5236\uff0c\u4f1a\u5bfc\u81f4\u6574\u4e2a\u5f39\u6027 Quota \u7684\u673a\u5236\u53d8\u7684\u5f02\u5e38\u590d\u6742\uff0c\u6682\u65f6\u4e0d\u8003\u8651\u652f\u6301\u8fd9\u79cd\u573a\u666f\u3002"),(0,o.kt)("li",{parentName:"ol"},"\u53ea\u6709\u7236\u8282\u70b9\u53ef\u4ee5\u6302\u5b50\u8282\u70b9\uff0c\u4e0d\u5141\u8bb8\u5b50\u8282\u70b9\u6302\u5b50\u8282\u70b9"),(0,o.kt)("li",{parentName:"ol"},"\u6682\u65f6\u4e0d\u5141\u8bb8\u6539\u53d8 ElasticQuota \u7684 ",(0,o.kt)("inlineCode",{parentName:"li"},"quota.scheduling.koordinator.sh/is-parent"),"\u5c5e\u6027")),(0,o.kt)("p",null,"\u6211\u4eec\u5c06\u5728\u4e0b\u4e2a\u7248\u672c\u4e2d\u901a\u8fc7 webhook \u673a\u5236\u5b9e\u73b0\u8fd9\u4e9b\u7ea6\u675f\u3002"),(0,o.kt)("h4",{id:"\u516c\u5e73\u6027\u4fdd\u969c\u673a\u5236"},"\u516c\u5e73\u6027\u4fdd\u969c\u673a\u5236"),(0,o.kt)("p",null,"\u4e3a\u4e86\u65b9\u4fbf\u9605\u8bfb\u548c\u7406\u89e3\u5c06\u8981\u4ecb\u7ecd\u7684\u516c\u5e73\u6027\u4fdd\u969c\u673a\u5236\uff0c\u5148\u660e\u786e\u51e0\u4e2a\u65b0\u6982\u5ff5\uff1a"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"request \u8868\u793a\u540c\u4e00\u4e2a ElasticQuota \u5173\u8054\u7684\u6240\u6709 Pod \u7684\u8d44\u6e90\u8bf7\u6c42\u91cf\u3002\u5982\u679c\u4e00\u4e2a ElasticQuota A \u7684 request \u5c0f\u4e8e min\uff0cElasticQuota B \u7684 request \u5927\u4e8e min\uff0c\u90a3\u4e48 ElasticQuota A \u672a\u4f7f\u7528\u7684\u90e8\u5206\uff0c\u5373 min - request \u5269\u4f59\u7684\u91cf\u901a\u8fc7\u516c\u5e73\u6027\u4fdd\u969c\u673a\u5236\u501f\u7528\u7ed9 ElasticQuota B. \u5f53 ElasticQuota A \u9700\u8981\u4f7f\u7528\u8fd9\u4e9b\u501f\u8d70\u7684\u91cf\u65f6\uff0c\u8981\u6c42 ElasticQuota B \u4f9d\u636e\u516c\u5e73\u6027\u4fdd\u969c\u673a\u5236\u5f52\u8fd8\u7ed9 ElasticQuota A\u3002"),(0,o.kt)("li",{parentName:"ul"},"runtime \u8868\u793a ElasticQuota \u5f53\u524d\u53ef\u4ee5\u4f7f\u7528\u7684\u5b9e\u9645\u8d44\u6e90\u91cf\u3002\u5982\u679c request \u5c0f\u4e8e min\uff0cruntime \u7b49\u4e8e request\u3002\u8fd9\u4e5f\u610f\u5473\u7740\uff0c\u9700\u8981\u9075\u5faa min \u8bed\u4e49\uff0c\u5e94\u65e0\u6761\u4ef6\u6ee1\u8db3 request\u3002\u5982\u679c request \u5927\u4e8e min\uff0c\u4e14 min \u5c0f\u4e8e max\uff0c\u516c\u5e73\u6027\u4fdd\u969c\u673a\u5236\u4f1a\u5206\u914d runtime \u5728min \u4e0e max \u4e4b\u524d\uff0c\u5373 max >= runtime >= min\u3002"),(0,o.kt)("li",{parentName:"ul"},"shared-weight \u8868\u793a\u4e00\u4e2a ElasticQuota \u7684\u7ade\u4e89\u529b\uff0c\u9ed8\u8ba4\u7b49\u4e8e ElasticQuota Max\u3002")),(0,o.kt)("p",null,"\u901a\u8fc7\u51e0\u4e2a\u4f8b\u5b50\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u516c\u5e73\u6027\u4fdd\u969c\u673a\u5236\u7684\u8fd0\u884c\u8fc7\u7a0b\uff0c\u5047\u8bbe\u5f53\u524d\u96c6\u7fa4\u7684 CPU \u603b\u91cf\u4e3a100C\uff0c\u5e76\u4e14\u67094\u4e2aElasticQuota\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u7eff\u8272\u90e8\u5206\u4e3a Request \u91cf\uff1aA \u5f53\u524d\u7684request \u4e3a5\uff0cB\u5f53\u524d\u7684request\u4e3a20\uff0cC\u5f53\u524d\u7684Request\u4e3a30\uff0cD\u5f53\u524d\u7684Request\u4e3a70\u3002",(0,o.kt)("br",null),(0,o.kt)("img",{alt:"image.png",src:a(72242).Z,width:"1338",height:"732"}),(0,o.kt)("br",null),"\u5e76\u4e14\u6211\u4eec\u6ce8\u610f\u5230\uff0c A, B, C, D \u7684 min \u4e4b\u548c\u662f60\uff0c\u5269\u4e0b 40 \u4e2a\u7a7a\u95f2\u989d\u5ea6\uff0c \u540c\u65f6 A \u8fd8\u53ef\u4ee5\u501f\u7ed9 B, C, D 5\u4e2a\u989d\u5ea6\uff0c\u6240\u4ee5\u4e00\u5171\u670945\u4e2a\u989d\u5ea6\u88abB\uff0cC\uff0cD\u5171\u4eab\uff0c\u6839\u636e\u5404\u4e2aElasticQuota\u7684 shared-weight\uff0cB\uff0cC\uff0cD\u5206\u522b\u5bf9\u5e9460\uff0c50\u548c80\uff0c\u8ba1\u7b97\u51fa\u5404\u81ea\u53ef\u4ee5\u5171\u4eab\u7684\u91cf\uff1a"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"B \u53ef\u4ee5\u83b7\u53d6 14\u4e2a\u989d\u5ea6\uff0c 45 * 60 / (60 + 50 + 80) = 14"),(0,o.kt)("li",{parentName:"ul"},"C \u53ef\u4ee5\u83b7\u53d6 12\u4e2a\u989d\u5ea6\uff0c 45 * 50 / (60 + 50 + 80) = 12"),(0,o.kt)("li",{parentName:"ul"},"D \u53ef\u4ee5\u83b7\u53d6 19\u4e2a\u989d\u5ea6\uff0c 45 * 80 / (60 + 50 + 80) = 19")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"image.png",src:a(53172).Z,width:"1444",height:"736"}),(0,o.kt)("br",null),"\u4f46\u6211\u4eec\u4e5f\u8981\u6ce8\u610f\u7684\u662f\uff0cC\u548cD\u9700\u8981\u66f4\u591a\u989d\u5ea6\uff0c\u800c B\u53ea\u9700\u89815\u4e2a\u989d\u5ea6\u5c31\u80fd\u6ee1\u8db3 Request\uff0c\u5e76\u4e14 B \u7684min\u662f15\uff0c\u4e5f\u5c31\u610f\u5473\u7740\u6211\u4eec\u53ea\u9700\u8981\u7ed9 B 5\u4e2a\u989d\u5ea6\uff0c\u5269\u4f59\u76849\u4e2a\u989d\u5ea6\u7ee7\u7eed\u5206\u7ed9C\u548cD\u3002"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"C \u53ef\u4ee5\u83b7\u53d6 3\u4e2a\u989d\u5ea6\uff0c 9 * 50 / (50 + 80) = 3"),(0,o.kt)("li",{parentName:"ul"},"D \u53ef\u4ee5\u83b7\u53d6 6\u4e2a\u989d\u5ea6\uff0c  9 * 80 / (50 + 80) = 6")),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/koordinator-sh/koordinator/blob/main/docs/images/runtimequota3.jpg"},(0,o.kt)("img",{parentName:"a",src:"https://github.com/koordinator-sh/koordinator/raw/main/docs/images/runtimequota3.jpg#crop=0&crop=0&crop=1&crop=1&from=url&id=XJyFI&margin=%5Bobject%20Object%5D&originHeight=782&originWidth=1570&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=",alt:null})),(0,o.kt)("br",null),"\u6700\u7ec8\u6211\u4eec\u5f97\u51fa\u5982\u4e0b\u7684\u5206\u914d\u7ed3\u679c\u7ed3\u679c\uff1a"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"A runtime = 5"),(0,o.kt)("li",{parentName:"ul"},"B runtime = 20"),(0,o.kt)("li",{parentName:"ul"},"C runtime = 35"),(0,o.kt)("li",{parentName:"ul"},"D runtime = 40")),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/koordinator-sh/koordinator/blob/main/docs/images/runtimequota4.jpg"},(0,o.kt)("img",{parentName:"a",src:"https://github.com/koordinator-sh/koordinator/raw/main/docs/images/runtimequota4.jpg#crop=0&crop=0&crop=1&crop=1&from=url&id=J8tN9&margin=%5Bobject%20Object%5D&originHeight=778&originWidth=1560&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=",alt:null})),(0,o.kt)("br",null),"\u603b\u7ed3\u6574\u4e2a\u8fc7\u7a0b\u53ef\u4ee5\u77e5\u9053\uff1a"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u5f53\u524d request < min \u65f6\uff0c\u9700\u8981\u501f\u51fa lent-to-quotas\uff1b\u5f53 request > min \u65f6\uff0c\u9700\u8981\u501f\u5165 borrowed-qutoas"),(0,o.kt)("li",{parentName:"ol"},"\u7edf\u8ba1\u6240\u6709 runtime < min \u7684 Quota\uff0c\u8fd9\u4e9b\u603b\u91cf\u5c31\u662f\u63a5\u4e0b\u6765\u53ef\u88ab\u501f\u51fa\u7684\u91cf\u3002"),(0,o.kt)("li",{parentName:"ol"},"\u6839\u636e shared-weight \u8ba1\u7b97\u6bcf\u4e2aElasticQuota\u53ef\u4ee5\u501f\u5165\u7684\u91cf"),(0,o.kt)("li",{parentName:"ol"},"\u5982\u679c\u6700\u65b0\u7684 runtime > reuqest\uff0c\u90a3\u4e48 runtime - request \u5269\u4f59\u7684\u91cf\u53ef\u4ee5\u501f\u7ed9\u66f4\u9700\u8981\u7684\u5bf9\u8c61\u3002")),(0,o.kt)("p",null,"\u53e6\u5916\u8fd8\u6709\u4e00\u79cd\u65e5\u5e38\u751f\u4ea7\u65f6\u4f1a\u9047\u5230\u7684\u60c5\u51b5\uff1a\u5373\u96c6\u7fa4\u5185\u8d44\u6e90\u603b\u91cf\u4f1a\u968f\u7740\u8282\u70b9\u6545\u969c\u3001\u8d44\u6e90\u8fd0\u8425\u7b49\u539f\u56e0\u964d\u4f4e\uff0c\u5bfc\u81f4\u6240\u6709ElasticQuota\u7684 min \u4e4b\u548c\u5927\u4e8e\u8d44\u6e90\u603b\u91cf\u3002\u5f53\u51fa\u73b0\u8fd9\u79cd\u60c5\u51b5\u65f6\uff0c\u6211\u4eec\u65e0\u6cd5\u786e\u4fdd min \u7684\u8d44\u6e90\u8ff0\u6c42\u3002\u6b64\u65f6\u6211\u4eec\u4f1a\u6309\u7167\u4e00\u5b9a\u7684\u6bd4\u4f8b\u8c03\u6574\u5404\u4e2aElasticQuota\u7684min\uff0c\u786e\u4fdd\u6240\u6709min\u4e4b\u548c\u5c0f\u4e8e\u6216\u8005\u7b49\u4e8e\u5f53\u524d\u5b9e\u9645\u7684\u8d44\u6e90\u603b\u91cf\u3002"),(0,o.kt)("h4",{id:"\u62a2\u5360\u673a\u5236"},"\u62a2\u5360\u673a\u5236"),(0,o.kt)("p",null,"Koordinator ElasticQuota \u673a\u5236\u5728\u8c03\u5ea6\u9636\u6bb5\u5982\u679c\u53d1\u73b0 Quota \u4e0d\u8db3\uff0c\u4f1a\u8fdb\u5165\u62a2\u5360\u9636\u6bb5\uff0c\u6309\u7167\u4f18\u5148\u7ea7\u6392\u5e8f\uff0c\u62a2\u5360\u5c5e\u4e8e\u540c\u4e00\u4e2aElasticQuota \u5185\u7684 \u4f4e\u4f18\u5148\u7ea7 Pod\u3002 \u540c\u65f6\uff0c\u6211\u4eec\u4e0d\u652f\u6301\u8de8 ElasticQuota \u62a2\u5360\u5176\u4ed6 Pod\u3002\u4f46\u662f\u6211\u4eec\u4e5f\u63d0\u4f9b\u4e86\u53e6\u5916\u7684\u673a\u5236\u652f\u6301\u4ece\u501f\u7528 Quota \u7684 ElasticQuota \u62a2\u56de\u3002",(0,o.kt)("br",null),"\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5728\u96c6\u7fa4\u4e2d\uff0c\u6709\u4e24\u4e2a ElasticQuota\uff0cElasticQuota A {min = 50, max = 100}\uff0c ElasticQuota B {min = 50,  max = 100}\u3002\u7528\u6237\u5728\u4e0a\u534810\u70b9\u4f7f\u7528 ElasticQuota A \u63d0\u4ea4\u4e86\u4e00\u4e2a Job\uff0c Request = 100 \uff0c\u6b64\u65f6\u56e0\u4e3a ElasticQuota B \u65e0\u4eba\u4f7f\u7528\uff0cElasticQuota A \u80fd\u4ece B \u624b\u91cc\u501f\u752850\u4e2aQuota\uff0c\u6ee1\u8db3\u4e86 Request = 100\uff0c \u5e76\u4e14\u6b64\u65f6 Used = 100\u3002\u572811\u70b9\u949f\u65f6\uff0c\u53e6\u4e00\u4e2a\u7528\u6237\u5f00\u59cb\u4f7f\u7528 ElasticQuota B \u63d0\u4ea4Job\uff0cRequest = 100\uff0c\u56e0\u4e3a ElasticQuota B \u7684 min = 50\uff0c\u662f\u5fc5\u987b\u4fdd\u969c\u7684\uff0c\u901a\u8fc7\u516c\u5e73\u6027\u4fdd\u969c\u673a\u5236\uff0c\u6b64\u65f6 A \u548c B \u7684 runtime \u5747\u4e3a50\u3002\u90a3\u4e48\u6b64\u65f6\u5bf9\u4e8e ElasticQuota A \uff0cUsed = 100 \u662f\u5927\u4e8e\u5f53\u524d runtime = 50 \u7684\uff0c\u56e0\u6b64\u6211\u4eec\u4f1a\u63d0\u4f9b\u4e00\u4e2a Controller\uff0c\u9a71\u9010\u6389\u4e00\u90e8\u5206 Pod \uff0c\u4f7f\u5f97\u5f53\u524d ElasticQuota A \u7684 Used \u964d\u4f4e\u5230 runtime \u76f8\u7b49\u7684\u6c34\u4f4d\u3002"),(0,o.kt)("h2",{id:"2-\u7cbe\u7ec6\u5316\u8d44\u6e90\u8c03\u5ea6"},"2. \u7cbe\u7ec6\u5316\u8d44\u6e90\u8c03\u5ea6"),(0,o.kt)("h3",{id:"device-share-scheduling"},"Device Share Scheduling"),(0,o.kt)("p",null,"\u673a\u5668\u5b66\u4e60\u9886\u57df\u91cc\u4f9d\u9760\u5927\u91cf\u5f3a\u5927\u7b97\u529b\u6027\u80fd\u7684 GPU \u8bbe\u5907\u5b8c\u6210\u6a21\u578b\u8bad\u7ec3\uff0c\u4f46\u662f GPU \u81ea\u8eab\u4ef7\u683c\u5341\u5206\u6602\u8d35\u3002\u5982\u4f55\u66f4\u597d\u5730\u5229\u7528GPU\u8bbe\u5907\uff0c\u53d1\u6325GPU\u7684\u4ef7\u503c\uff0c\u964d\u4f4e\u6210\u672c\uff0c\u662f\u4e00\u4e2a\u4e9f\u5f85\u89e3\u51b3\u7684\u95ee\u9898\u3002  Kubernetes \u793e\u533a\u73b0\u6709\u7684 GPU \u5206\u914d\u673a\u5236\u4e2d\uff0cGPU \u662f\u7531 kubelet \u5206\u914d\u7684\uff0c\u5e76\u53ea\u652f\u6301\u5206\u914d\u4e00\u4e2a\u6216\u591a\u4e2a\u5b8c\u6574\u7684 GPU \u5b9e\u4f8b\u3002 \u8fd9\u79cd\u65b9\u6cd5\u7b80\u5355\u53ef\u9760\uff0c\u4f46\u7c7b\u4f3c\u4e8e CPU \u548c Memory\uff0cGPU \u5e76\u4e0d\u662f\u4e00\u76f4\u5904\u4e8e\u9ad8\u5229\u7528\u7387\u6c34\u4f4d\uff0c\u540c\u6837\u5b58\u5728\u8d44\u6e90\u6d6a\u8d39\u7684\u95ee\u9898\u3002 \u56e0\u6b64\uff0cKoordinator \u5e0c\u671b\u652f\u6301\u591a\u5de5\u4f5c\u8d1f\u8f7d\u5171\u4eab\u4f7f\u7528 GPU \u8bbe\u5907\u4ee5\u8282\u7701\u6210\u672c\u3002 \u6b64\u5916\uff0cGPU \u6709\u5176\u7279\u6b8a\u6027\u3002 \u6bd4\u5982\u4e0b\u9762\u7684 NVIDIA GPU \u652f\u6301\u7684 NVLink \u548c\u8d85\u5356\u573a\u666f\uff0c\u90fd\u9700\u8981\u901a\u8fc7\u8c03\u5ea6\u5668\u8fdb\u884c\u4e2d\u592e\u51b3\u7b56\uff0c\u4ee5\u83b7\u5f97\u5168\u5c40\u6700\u4f18\u7684\u5206\u914d\u7ed3\u679c\u3002",(0,o.kt)("br",null),(0,o.kt)("img",{alt:"image.png",src:a(12241).Z,width:"2222",height:"828"})),(0,o.kt)("p",null,"\u4ece\u56fe\u4e2d\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u867d\u7136\u8be5\u8282\u70b9\u67098\u4e2a GPU \u5b9e\u4f8b\uff0c\u578b\u53f7\u4e3aA100/V100\uff0c\u4f46 GPU \u5b9e\u4f8b\u4e4b\u95f4\u7684\u6570\u636e\u4f20\u8f93\u901f\u5ea6\u662f\u4e0d\u540c\u7684\u3002 \u5f53\u4e00\u4e2a Pod \u9700\u8981\u591a\u4e2a GPU \u5b9e\u4f8b\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u4e3a Pod \u5206\u914d\u5177\u6709\u6700\u5927\u6570\u636e\u4f20\u8f93\u901f\u5ea6\u7ec4\u5408\u5173\u7cfb\u7684 GPU \u5b9e\u4f8b\u3002 \u6b64\u5916\uff0c\u5f53\u6211\u4eec\u5e0c\u671b\u4e00\u7ec4 Pod \u4e2d\u7684 GPU \u5b9e\u4f8b\u5177\u6709\u6700\u5927\u6570\u636e\u4f20\u8f93\u901f\u5ea6\u7ec4\u5408\u5173\u7cfb\u65f6\uff0c\u8c03\u5ea6\u5668\u5e94\u8be5\u5c06\u6700\u4f73 GPU \u5b9e\u4f8b\u6279\u91cf\u5206\u914d\u7ed9\u8fd9\u4e9b Pod\uff0c\u5e76\u5c06\u5b83\u4eec\u5206\u914d\u5230\u540c\u4e00\u4e2a\u8282\u70b9\u3002"),(0,o.kt)("h4",{id:"gpu-\u8d44\u6e90\u534f\u8bae"},"GPU \u8d44\u6e90\u534f\u8bae"),(0,o.kt)("p",null,"Koordinator \u517c\u5bb9\u793e\u533a\u5df2\u6709\u7684 ",(0,o.kt)("inlineCode",{parentName:"p"},"nvidia.com/gpu"),"\u8d44\u6e90\u534f\u8bae\uff0c\u5e76\u4e14\u8fd8\u81ea\u5b9a\u4e49\u4e86\u6269\u5c55\u8d44\u6e90\u534f\u8bae\uff0c\u652f\u6301\u7528\u6237\u66f4\u7ec6\u7c92\u5ea6\u7684\u5206\u914d GPU \u8d44\u6e90\u3002"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"kubernetes.io/gpu-core \u4ee3\u8868GPU\u7684\u8ba1\u7b97\u80fd\u529b\u3002 \u4e0e Kuberetes MilliCPU \u7c7b\u4f3c\uff0c\u6211\u4eec\u5c06 GPU \u7684\u603b\u7b97\u529b\u62bd\u8c61\u4e3a100\uff0c\u7528\u6237\u53ef\u4ee5\u6839\u636e\u9700\u8981\u7533\u8bf7\u76f8\u5e94\u6570\u91cf\u7684 GPU \u7b97\u529b\u3002"),(0,o.kt)("li",{parentName:"ul"},"kubernetes.io/gpu-memory \u8868\u793a GPU \u7684\u5185\u5b58\u5bb9\u91cf\uff0c\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\u3002"),(0,o.kt)("li",{parentName:"ul"},"kubernetes.io/gpu-memory-ratio \u4ee3\u8868 GPU \u5185\u5b58\u7684\u767e\u5206\u6bd4\u3002")),(0,o.kt)("p",null,"\u5047\u8bbe\u4e00\u4e2a\u8282\u70b9\u67094\u4e2aGPU\u8bbe\u5907\u5b9e\u4f8b\uff0c\u6bcf\u4e2aGPU\u8bbe\u5907\u5b9e\u4f8b\u6709 8Gi \u663e\u5b58\u3002\u7528\u6237\u5982\u679c\u671f\u671b\u7533\u8bf7\u4e00\u4e2a\u5b8c\u6574\u7684 GPU \u5b9e\u4f8b\uff0c\u9664\u4e86\u4f7f\u7528 ",(0,o.kt)("inlineCode",{parentName:"p"},"nvidia.com/gpu"),"\u4e4b\u5916\uff0c\u8fd8\u53ef\u4ee5\u6309\u7167\u5982\u4e0b\u65b9\u5f0f\u7533\u8bf7\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: v1\nkind: Pod\nmetadata:\n  name: demo-pod\n  namespace: default\nspec:\n  containers:\n  - name: main\n    resources:\n      limits: \n        kubernetes.io/gpu-core: 100\n        kubernetes.io/gpu-memory: "8Gi"\n      requests:\n        kubernetes.io/gpu-core: 100\n        kubernetes.io/gpu-memory: "8Gi"\n')),(0,o.kt)("p",null,"\u5982\u679c\u671f\u671b\u53ea\u4f7f\u7528\u4e00\u4e2a GPU \u5b9e\u4f8b\u4e00\u534a\u7684\u8d44\u6e90\uff0c\u53ef\u4ee5\u6309\u7167\u5982\u4e0b\u65b9\u5f0f\u7533\u8bf7\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: v1\nkind: Pod\nmetadata:\n  name: demo-pod\n  namespace: default\nspec:\n  containers:\n  - name: main\n    resources:\n      limits: \n        kubernetes.io/gpu-core: 50\n        kubernetes.io/gpu-memory: "4Gi"\n      requests:\n        kubernetes.io/gpu-core: 50\n        kubernetes.io/gpu-memory: "4Gi"\n')),(0,o.kt)("h4",{id:"\u8bbe\u5907\u4fe1\u606f\u548c\u8bbe\u5907\u5bb9\u91cf\u4e0a\u62a5"},"\u8bbe\u5907\u4fe1\u606f\u548c\u8bbe\u5907\u5bb9\u91cf\u4e0a\u62a5"),(0,o.kt)("p",null,"\u5728 Koordinator v0.7.0 \u7248\u672c\u4e2d\uff0c\u5355\u673a\u4fa7 koordlet \u5b89\u88c5\u540e\u4f1a\u81ea\u52a8\u8bc6\u522b\u8282\u70b9\u4e0a\u662f\u5426\u542b\u6709 GPU \u8bbe\u5907\uff0c\u5982\u679c\u5b58\u5728\u7684\u8bdd\uff0c\u4f1a\u4e0a\u62a5\u8fd9\u4e9b GPU \u8bbe\u5907\u7684 Minor ID\u3001 UUID\u3001\u7b97\u529b\u548c\u663e\u5b58\u5927\u5c0f\u5230\u4e00\u4e2a\u7c7b\u578b\u4e3a Device CRD \u4e2d\u3002\u6bcf\u4e2a\u8282\u70b9\u5bf9\u5e94\u4e00\u4e2a Device CRD \u5b9e\u4f8b\u3002Device CRD \u4e0d\u4ec5\u652f\u6301\u63cf\u8ff0 GPU\uff0c\u8fd8\u652f\u6301\u7c7b\u4f3c\u4e8e FPGA/RDMA\u7b49\u8bbe\u5907\u7c7b\u578b\uff0c\u76ee\u524d v0.7.0 \u7248\u672c\u53ea\u652f\u6301 GPU\uff0c \u6682\u672a\u652f\u6301\u8fd9\u4e9b\u8bbe\u5907\u7c7b\u578b\u3002 ",(0,o.kt)("br",null),"Device CRD \u4f1a\u88ab koord-manager \u5185\u7684 NodeResource controller \u548c koord-scheduler \u6d88\u8d39\u3002NodeResource controller \u4f1a\u6839\u636e Device CRD \u4e2d\u63cf\u8ff0\u7684\u4fe1\u606f\uff0c\u6362\u7b97\u6210 Koordinator \u652f\u6301\u7684\u8d44\u6e90\u534f\u8bae ",(0,o.kt)("inlineCode",{parentName:"p"},"kubernetes.io/gpu-core"),",",(0,o.kt)("inlineCode",{parentName:"p"},"kubernetes.io/gpu-memory")," \u66f4\u65b0\u5230  Node.Status.Allocatable \u548c Node.Status.Capacity \u5b57\u6bb5\uff0c\u5e2e\u52a9\u8c03\u5ea6\u5668\u548c kubelet \u5b8c\u6210\u8d44\u6e90\u8c03\u5ea6\u3002gpu-core \u8868\u793aGPU \u8bbe\u5907\u5b9e\u4f8b\u7684\u7b97\u529b\uff0c\u4e00\u4e2a\u5b9e\u4f8b\u7684\u5b8c\u6574\u7b97\u529b\u4e3a100\u3002\u5047\u8bbe\u4e00\u4e2a\u8282\u70b9\u6709 8 \u4e2a GPU \u8bbe\u5907\u5b9e\u4f8b\uff0c\u90a3\u4e48\u8282\u70b9\u7684 gpu-core \u5bb9\u91cf\u4e3a 8 ",(0,o.kt)("em",{parentName:"p"}," 100 = 800\uff1b gpu-memory \u8868\u793a GPU \u8bbe\u5907\u5b9e\u4f8b\u7684\u663e\u5b58\u5927\u5c0f\uff0c\u5355\u4f4d\u4e3a\u5b57\u8282\uff0c\u540c\u6837\u7684\u8282\u70b9\u53ef\u4ee5\u5206\u914d\u7684\u663e\u5b58\u603b\u91cf\u4e3a \u8bbe\u5907\u6570\u91cf ")," \u6bcf\u4e2a\u5b9e\u4f8b\u7684\u5355\u4f4d\u5bb9\u91cf\uff0c\u4f8b\u5982\u4e00\u4e2a GPU \u8bbe\u5907\u7684\u663e\u5b58\u662f 8G\uff0c\u8282\u70b9\u4e0a\u67098 \u4e2a GPU \u5b9e\u4f8b\uff0c\u603b\u91cf\u4e3a 8 * 8G = 64G\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: v1\nkind: Node\nmetadata:\n  name: node-a\nstatus:\n  capacity:\n    koordinator.sh/gpu-core: 800\n    koordinator.sh/gpu-memory: "64Gi"\n    koordinator.sh/gpu-memory-ratio: 800\n  allocatable:\n    koordinator.sh/gpu-core: 800\n    koordinator.sh/gpu-memory: "64Gi"\n    koordinator.sh/gpu-memory-ratio: 800\n')),(0,o.kt)("h4",{id:"\u4e2d\u5fc3\u8c03\u5ea6\u5206\u914d\u8bbe\u5907\u8d44\u6e90"},"\u4e2d\u5fc3\u8c03\u5ea6\u5206\u914d\u8bbe\u5907\u8d44\u6e90"),(0,o.kt)("p",null,"Kuberetes \u793e\u533a\u539f\u751f\u63d0\u4f9b\u7684\u8bbe\u5907\u8c03\u5ea6\u673a\u5236\u4e2d\uff0c\u8c03\u5ea6\u5668\u53ea\u8d1f\u8d23\u6821\u9a8c\u8bbe\u5907\u5bb9\u91cf\u662f\u5426\u6ee1\u8db3 Pod\uff0c\u5bf9\u4e8e\u4e00\u4e9b\u7b80\u5355\u7684\u8bbe\u5907\u7c7b\u578b\u662f\u8db3\u591f\u7684\uff0c\u4f46\u662f\u5f53\u9700\u8981\u66f4\u7ec6\u7c92\u5ea6\u5206\u914d GPU \u65f6\uff0c\u9700\u8981\u4e2d\u5fc3\u8c03\u5ea6\u5668\u7ed9\u4e88\u652f\u6301\u624d\u80fd\u5b9e\u73b0\u5168\u5c40\u6700\u4f18\u3002",(0,o.kt)("br",null),"Koordinator \u8c03\u5ea6\u5668 koord-scheduler \u65b0\u589e\u4e86\u8c03\u5ea6\u63d2\u4ef6 DeviceShare\uff0c\u8d1f\u8d23\u7cbe\u7ec6\u5ea6\u8bbe\u5907\u8d44\u6e90\u8c03\u5ea6\u3002DeviceShare \u63d2\u4ef6\u6d88\u8d39 Device CRD\uff0c\u8bb0\u5f55\u6bcf\u4e2a\u8282\u70b9\u53ef\u4ee5\u5206\u914d\u7684\u8bbe\u5907\u4fe1\u606f\u3002DeviceShare \u5728\u8c03\u5ea6\u65f6\uff0c\u4f1a\u628a Pod \u7684GPU\u8d44\u6e90\u8bf7\u6c42\u8f6c\u6362\u4e3a Koordinator \u7684\u8d44\u6e90\u534f\u8bae\uff0c\u5e76\u8fc7\u6ee4\u6bcf\u4e2a\u8282\u70b9\u7684\u672a\u5206\u914d\u7684 GPU \u8bbe\u5907\u5b9e\u4f8b\u3002\u786e\u4fdd\u6709\u8d44\u6e90\u53ef\u7528\u540e\uff0c\u5728 Reserve \u9636\u6bb5\u66f4\u65b0\u5185\u90e8\u72b6\u6001\uff0c\u5e76\u5728 PreBind \u9636\u6bb5\u66f4\u65b0 Pod Annotation\uff0c\u8bb0\u5f55\u5f53\u524d Pod \u5e94\u8be5\u4f7f\u7528\u54ea\u4e9b GPU \u8bbe\u5907\u3002",(0,o.kt)("br",null),"DeviceShare \u5c06\u5728\u540e\u7eed\u7248\u672c\u652f\u6301 Binpacking  \u548c Spread \u7b56\u7565\uff0c\u5b9e\u73b0\u66f4\u597d\u7684\u8bbe\u5907\u8d44\u6e90\u8c03\u5ea6\u80fd\u529b\u3002"),(0,o.kt)("h4",{id:"\u5355\u673a\u4fa7\u7cbe\u51c6\u7ed1\u5b9a\u8bbe\u5907\u4fe1\u606f"},"\u5355\u673a\u4fa7\u7cbe\u51c6\u7ed1\u5b9a\u8bbe\u5907\u4fe1\u606f"),(0,o.kt)("p",null,"Kubernetes \u793e\u533a\u5728 kubelet \u4e2d\u63d0\u4f9b\u4e86 DevicePlugin \u673a\u5236\uff0c\u652f\u6301\u8bbe\u5907\u5382\u5546\u5728 kubelet \u5206\u914d\u597d\u8bbe\u5907\u540e\u6709\u673a\u4f1a\u83b7\u5f97\u8bbe\u5907\u4fe1\u606f\uff0c\u5e76\u586b\u5145\u5230\u73af\u5883\u53d8\u91cf\u6216\u8005\u66f4\u65b0\u6302\u8f7d\u8def\u5f84\u3002\u4f46\u662f\u4e0d\u80fd\u652f\u6301 \u4e2d\u5fc3\u5316\u7684 GPU \u7cbe\u7ec6\u5316\u8c03\u5ea6\u573a\u666f\u3002",(0,o.kt)("br",null),"\u9488\u5bf9\u8fd9\u4e2a\u95ee\u9898\uff0c Koordinator \u6269\u5c55\u4e86 koord-runtime-proxy \uff0c\u652f\u6301\u5728 kubelet \u521b\u5efa\u5bb9\u5668\u65f6\u66f4\u65b0\u73af\u5883\u53d8\u91cf\uff0c\u6ce8\u5165\u8c03\u5ea6\u5668\u5206\u914d\u7684 GPU \u8bbe\u5907\u4fe1\u606f\u3002",(0,o.kt)("br",null),(0,o.kt)("img",{src:a(858).Z,width:"1394",height:"700"})),(0,o.kt)("h2",{id:"3-\u8c03\u5ea6\u5668\u8bca\u65ad\u5206\u6790"},"3. \u8c03\u5ea6\u5668\u8bca\u65ad\u5206\u6790"),(0,o.kt)("p",null,"\u5927\u5bb6\u5728\u4f7f\u7528 Kubernetes \u65f6\u7ecf\u5e38\u4f1a\u9047\u5230\u4e00\u4e9b\u8c03\u5ea6\u76f8\u5173\u7684\u95ee\u9898\uff1a"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u6211\u8fd9\u4e2a Pod \u4e3a\u4ec0\u4e48\u4e0d\u80fd\u8c03\u5ea6\uff1f"),(0,o.kt)("li",{parentName:"ol"},"\u8fd9\u4e2a Pod \u4e3a\u4ec0\u4e48\u4f1a\u8c03\u5ea6\u5230\u8fd9\u4e2a\u8282\u70b9\uff0c\u4e0d\u662f\u5e94\u8be5\u88ab\u53e6\u4e00\u4e2a\u6253\u5206\u63d2\u4ef6\u5f71\u54cd\u5230\u4e48\uff1f "),(0,o.kt)("li",{parentName:"ol"},"\u6211\u65b0\u5f00\u53d1\u4e86\u4e00\u4e2a\u63d2\u4ef6\uff0c\u53d1\u73b0\u8c03\u5ea6\u7ed3\u679c\u4e0d\u7b26\u5408\u9884\u671f\uff0c\u4f46\u662f\u6709\u4e0d\u77e5\u9053\u54ea\u91cc\u51fa\u4e86\u95ee\u9898\u3002")),(0,o.kt)("p",null,"\u8981\u8bca\u65ad\u5206\u6790\u8fd9\u4e9b\u95ee\u9898\uff0c\u9664\u4e86\u8981\u638c\u63e1 Kubernetes \u57fa\u672c\u7684\u8c03\u5ea6\u673a\u5236\u548c\u8d44\u6e90\u5206\u914d\u673a\u5236\u5916\uff0c\u8fd8\u9700\u8981\u8c03\u5ea6\u5668\u81ea\u8eab\u7ed9\u4e88\u652f\u6301\u3002\u4f46\u662f Kubernetes kube-scheduler \u63d0\u4f9b\u7684\u8bca\u65ad\u80fd\u529b\u6bd4\u8f83\u6709\u9650\uff0c\u6709\u65f6\u5019\u751a\u81f3\u6ca1\u6709\u4ec0\u4e48\u65e5\u5fd7\u53ef\u4ee5\u67e5\u770b\u3002kube-scheduler \u539f\u751f\u662f\u652f\u6301\u901a\u8fc7 HTTP \u66f4\u6539\u65e5\u5fd7\u7b49\u7ea7\uff0c\u53ef\u4ee5\u83b7\u5f97\u66f4\u591a\u65e5\u5fd7\u4fe1\u606f\uff0c\u4f8b\u5982\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u53ef\u4ee5\u66f4\u6539\u65e5\u5fd7\u7b49\u7ea7\u52305\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ curl -X PUT schedulerLeaderIP:10251/debug/flags/v --data '5' \nsuccessfully set klog.logging.verbosity to 5\n")),(0,o.kt)("p",null,"Koordinator \u9488\u5bf9\u8fd9\u4e9b\u95ee\u9898\uff0c\u5b9e\u73b0\u4e86\u4e00\u5957 Restful API \uff0c\u5e2e\u52a9\u7528\u6237\u63d0\u5347\u95ee\u9898\u8bca\u65ad\u5206\u6790\u7684\u6548\u7387"),(0,o.kt)("h3",{id:"\u5206\u6790-score-\u7ed3\u679c"},"\u5206\u6790 Score \u7ed3\u679c"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"PUT /debug/flags/s"),"  \u5141\u8bb8\u7528\u6237\u6253\u5f00 Debug Score \u5f00\u5173\uff0c\u5728\u6253\u5206\u7ed3\u675f\u540e\uff0c\u4ee5Markdown \u683c\u5f0f\u6253\u5370 TopN \u8282\u70b9\u5404\u4e2a\u63d2\u4ef6\u7684\u5206\u503c\u3002\u4f8b\u5982\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ curl -X PUT schedulerLeaderIP:10251/debug/flags/s --data '100'\nsuccessfully set debugTopNScores to 100\n")),(0,o.kt)("p",null," \u5f53\u6709\u65b0 Pod \u8c03\u5ea6\u65f6\uff0c\u89c2\u5bdf scheduler log \u53ef\u4ee5\u770b\u5230\u5982\u4e0b\u4fe1\u606f"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"| # | Pod | Node | Score | ImageLocality | InterPodAffinity | LoadAwareScheduling | NodeAffinity | NodeNUMAResource | NodeResourcesBalancedAllocation | NodeResourcesFit | PodTopologySpread | Reservation | TaintToleration |\n| --- | --- | --- | ---:| ---:| ---:| ---:| ---:| ---:| ---:| ---:| ---:| ---:| ---:|\n| 0 | default/curlimage-545745d8f8-rngp7 | cn-hangzhou.10.0.4.51 | 577 | 0 | 0 | 87 | 0 | 0 | 96 | 94 | 200 | 0 | 100 |\n| 1 | default/curlimage-545745d8f8-rngp7 | cn-hangzhou.10.0.4.50 | 574 | 0 | 0 | 85 | 0 | 0 | 96 | 93 | 200 | 0 | 100 |\n| 2 | default/curlimage-545745d8f8-rngp7 | cn-hangzhou.10.0.4.19 | 541 | 0 | 0 | 55 | 0 | 0 | 95 | 91 | 200 | 0 | 100 |\n| 3 | default/curlimage-545745d8f8-rngp7 | cn-hangzhou.10.0.4.18 | 487 | 0 | 0 | 15 | 0 | 0 | 90 | 82 | 200 | 0 | 100 |\n\n")),(0,o.kt)("p",null,"\u627e\u4e2a Markdown \u5de5\u5177\uff0c\u5c31\u53ef\u4ee5\u8f6c\u4e3a\u5982\u4e0b\u8868\u683c"),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"#"),(0,o.kt)("th",{parentName:"tr",align:null},"Pod"),(0,o.kt)("th",{parentName:"tr",align:null},"Node"),(0,o.kt)("th",{parentName:"tr",align:null},"Score"),(0,o.kt)("th",{parentName:"tr",align:null},"LoadAwareScheduling"),(0,o.kt)("th",{parentName:"tr",align:null},"NodeNUMAResource"),(0,o.kt)("th",{parentName:"tr",align:null},"NodeResourcesFit"),(0,o.kt)("th",{parentName:"tr",align:null},"PodTopologySpread"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"0"),(0,o.kt)("td",{parentName:"tr",align:null},"default/curlimage-545745d8f8-rngp7"),(0,o.kt)("td",{parentName:"tr",align:null},"cn-hangzhou.10.0.4.51"),(0,o.kt)("td",{parentName:"tr",align:null},"577"),(0,o.kt)("td",{parentName:"tr",align:null},"87"),(0,o.kt)("td",{parentName:"tr",align:null},"0"),(0,o.kt)("td",{parentName:"tr",align:null},"94"),(0,o.kt)("td",{parentName:"tr",align:null},"200")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"1"),(0,o.kt)("td",{parentName:"tr",align:null},"default/curlimage-545745d8f8-rngp7"),(0,o.kt)("td",{parentName:"tr",align:null},"cn-hangzhou.10.0.4.50"),(0,o.kt)("td",{parentName:"tr",align:null},"574"),(0,o.kt)("td",{parentName:"tr",align:null},"85"),(0,o.kt)("td",{parentName:"tr",align:null},"0"),(0,o.kt)("td",{parentName:"tr",align:null},"93"),(0,o.kt)("td",{parentName:"tr",align:null},"200")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"2"),(0,o.kt)("td",{parentName:"tr",align:null},"default/curlimage-545745d8f8-rngp7"),(0,o.kt)("td",{parentName:"tr",align:null},"cn-hangzhou.10.0.4.19"),(0,o.kt)("td",{parentName:"tr",align:null},"541"),(0,o.kt)("td",{parentName:"tr",align:null},"55"),(0,o.kt)("td",{parentName:"tr",align:null},"0"),(0,o.kt)("td",{parentName:"tr",align:null},"91"),(0,o.kt)("td",{parentName:"tr",align:null},"200")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"3"),(0,o.kt)("td",{parentName:"tr",align:null},"default/curlimage-545745d8f8-rngp7"),(0,o.kt)("td",{parentName:"tr",align:null},"cn-hangzhou.10.0.4.18"),(0,o.kt)("td",{parentName:"tr",align:null},"487"),(0,o.kt)("td",{parentName:"tr",align:null},"15"),(0,o.kt)("td",{parentName:"tr",align:null},"0"),(0,o.kt)("td",{parentName:"tr",align:null},"82"),(0,o.kt)("td",{parentName:"tr",align:null},"200")))),(0,o.kt)("h3",{id:"\u8c03\u5ea6\u63d2\u4ef6\u5bfc\u51fa\u5185\u90e8\u72b6\u6001"},"\u8c03\u5ea6\u63d2\u4ef6\u5bfc\u51fa\u5185\u90e8\u72b6\u6001"),(0,o.kt)("p",null,"\u50cf koord-scheduler \u5185\u90e8\u7684 NodeNUMAResource \u3001 DeviceShare\u548cElasticQuota\u7b49\u63d2\u4ef6\u5185\u90e8\u90fd\u6709\u7ef4\u62a4\u4e00\u4e9b\u72b6\u6001\u5e2e\u52a9\u8c03\u5ea6\u3002 koord-scheduler \u81ea\u5b9a\u4e49\u4e86\u4e00\u4e2a\u65b0\u7684\u63d2\u4ef6\u6269\u5c55\u63a5\u53e3\uff08\u5b9a\u4e49\u89c1\u4e0b\u6587\uff09\uff0c\u5e76\u4f1a\u5728\u521d\u59cb\u5316\u63d2\u4ef6\u540e\uff0c\u8bc6\u522b\u8be5\u63d2\u4ef6\u662f\u5426\u5b9e\u73b0\u4e86\u8be5\u63a5\u53e3\u5e76\u8c03\u7528\u8be5\u63a5\u53e3\uff0c\u8ba9\u63d2\u4ef6\u6ce8\u5165\u9700\u8981\u66b4\u9732\u7684 RestfulAPI\u3002\u4ee5 NodeNUMAResource \u63d2\u4ef6\u4e3a\u4f8b\uff0c\u4f1a\u63d0\u4f9b ",(0,o.kt)("inlineCode",{parentName:"p"},"/cpuTopologyOptions/:nodeName"),"\u548c ",(0,o.kt)("inlineCode",{parentName:"p"},"/availableCPUs/:nodeName"),"\u4e24\u4e2aEndpoints\uff0c\u53ef\u4ee5\u67e5\u770b\u63d2\u4ef6\u5185\u90e8\u8bb0\u5f55\u7684 CPU \u62d3\u6251\u4fe1\u606f\u548c\u5206\u914d\u7ed3\u679c\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-go"},"type APIServiceProvider interface {\n    RegisterEndpoints(group *gin.RouterGroup)\n}\n")),(0,o.kt)("p",null,"\u7528\u6237\u5728\u4f7f\u7528\u65f6\uff0c\u6309\u7167 ",(0,o.kt)("inlineCode",{parentName:"p"},"/apis/v1/plugins/<pluginName>/<pluginEndpoints>"),"\u65b9 \u5f0f\u6784\u5efa URL \u67e5\u770b\u6570\u636e\uff0c\u4f8b\u5982\u8981\u67e5\u770b ",(0,o.kt)("inlineCode",{parentName:"p"},"/cpuTopologyOptions/:nodeName"),"\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'$ curl schedulerLeaderIP:10252/apis/v1/plugins/NodeNUMAResources/cpuTopologyOptions/node-1\n{"cpuTopology":{"numCPUs":32,"numCores":16,"numNodes":1,"numSockets":1,"cpuDetails":....\n')),(0,o.kt)("h3",{id:"\u67e5\u770b\u5f53\u524d\u652f\u6301\u7684\u63d2\u4ef6-api"},"\u67e5\u770b\u5f53\u524d\u652f\u6301\u7684\u63d2\u4ef6 API"),(0,o.kt)("p",null,"\u4e3a\u4e86\u65b9\u4fbf\u5927\u5bb6\u4f7f\u7528\uff0ckoord-scheduler \u63d0\u4f9b\u4e86 ",(0,o.kt)("inlineCode",{parentName:"p"},"/apis/v1/__services__")," \u67e5\u770b\u652f\u6301\u7684 API Endpoints"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'$ curl schedulerLeaderIP:10251/apis/v1/__services__\n{\n    "GET": [\n        "/apis/v1/__services__",\n        "/apis/v1/nodes/:nodeName",\n        "/apis/v1/plugins/Coscheduling/gang/:namespace/:name",\n        "/apis/v1/plugins/DeviceShare/nodeDeviceSummaries",\n        "/apis/v1/plugins/DeviceShare/nodeDeviceSummaries/:name",\n        "/apis/v1/plugins/ElasticQuota/quota/:name",\n        "/apis/v1/plugins/NodeNUMAResource/availableCPUs/:nodeName",\n        "/apis/v1/plugins/NodeNUMAResource/cpuTopologyOptions/:nodeName"\n    ]\n}\n')),(0,o.kt)("h2",{id:"4-\u66f4\u5b89\u5168\u7684\u91cd\u8c03\u5ea6"},"4. \u66f4\u5b89\u5168\u7684\u91cd\u8c03\u5ea6"),(0,o.kt)("p",null,"\u5728 Koordinator v0.6 \u7248\u672c\u4e2d\u6211\u4eec\u53d1\u5e03\u4e86\u5168\u65b0\u7684 koord-descheduler\uff0c\u652f\u6301\u63d2\u4ef6\u5316\u5b9e\u73b0\u9700\u8981\u7684\u91cd\u8c03\u5ea6\u7b56\u7565\u548c\u81ea\u5b9a\u4e49\u9a71\u9010\u673a\u5236\uff0c\u5e76\u5185\u7f6e\u4e86\u9762\u5411 PodMigrationJob \u7684\u8fc1\u79fb\u63a7\u5236\u5668\uff0c\u901a\u8fc7 Koordinator Reservation \u673a\u5236\u9884\u7559\u8d44\u6e90\uff0c\u786e\u4fdd\u6709\u8d44\u6e90\u7684\u60c5\u51b5\u4e0b\u53d1\u8d77\u9a71\u9010\u3002\u89e3\u51b3\u4e86 Pod \u88ab\u9a71\u9010\u540e\u65e0\u8d44\u6e90\u53ef\u7528\u5f71\u54cd\u5e94\u7528\u7684\u53ef\u7528\u6027\u95ee\u9898\u3002",(0,o.kt)("br",null),"Koordinator v0.7 \u7248\u672c\u4e2d\uff0ckoord-descheduler \u5b9e\u73b0\u4e86\u66f4\u5b89\u5168\u7684\u91cd\u8c03\u5ea6"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u652f\u6301 Evict \u9650\u6d41\uff0c\u7528\u6237\u53ef\u4ee5\u6839\u636e\u9700\u8981\u914d\u7f6e\u9650\u6d41\u7b56\u7565\uff0c\u4f8b\u5982\u5141\u8bb8\u6bcf\u5206\u949f\u9a71\u9010\u591a\u5c11\u4e2a Pod"),(0,o.kt)("li",{parentName:"ul"},"\u652f\u6301\u914d\u7f6e Namespace \u7070\u5ea6\u91cd\u8c03\u5ea6\u80fd\u529b\uff0c\u8ba9\u7528\u6237\u53ef\u4ee5\u66f4\u653e\u5fc3\u7684\u7070\u5ea6"),(0,o.kt)("li",{parentName:"ul"},"\u652f\u6301\u6309\u7167 Node/Namespace \u914d\u7f6e\u9a71\u9010\u6570\u91cf\uff0c\u4f8b\u5982\u914d\u7f6e\u8282\u70b9\u7ef4\u5ea6\u6700\u591a\u53ea\u9a71\u9010\u4e24\u4e2a\uff0c\u90a3\u4e48\u5373\u4f7f\u6709\u63d2\u4ef6\u8981\u6c42\u9a71\u9010\u8be5\u8282\u70b9\u4e0a\u7684\u66f4\u591aPod\uff0c\u4f1a\u88ab\u62d2\u7edd\u3002"),(0,o.kt)("li",{parentName:"ul"},"\u611f\u77e5 Workload \uff0c\u5982\u679c\u4e00\u4e2a Workload \u6b63\u5728\u53d1\u5e03\u3001\u7f29\u5bb9\u3001\u5df2\u7ecf\u6709\u4e00\u5b9a\u91cf\u7684 Pod \u6b63\u5728\u88ab\u9a71\u9010\u6216\u8005\u4e00\u4e9bPod NotReady\uff0c\u91cd\u8c03\u5ea6\u5668\u4f1a\u62d2\u7edd\u65b0\u7684\u91cd\u8c03\u5ea6\u8bf7\u6c42\u3002\u76ee\u524d\u652f\u6301\u539f\u751f\u7684 Deployment\uff0cStatefulSet \u4ee5\u53ca Kruise  CloneSet\uff0cKruise AdvancedStatefulSet\u3002")),(0,o.kt)("p",null,"\u540e\u7eed\u91cd\u8c03\u5ea6\u5668\u8fd8\u4f1a\u63d0\u5347\u516c\u5e73\u6027\uff0c\u9632\u6b62\u4e00\u76f4\u91cd\u590d\u7684\u91cd\u8c03\u5ea6\u540c\u4e00\u4e2a workload \uff0c\u5c3d\u91cf\u964d\u4f4e\u91cd\u8c03\u5ea6\u5bf9\u5e94\u7528\u7684\u53ef\u7528\u6027\u7684\u5f71\u54cd\u3002"),(0,o.kt)("h2",{id:"5-\u5176\u4ed6\u6539\u52a8"},"5. \u5176\u4ed6\u6539\u52a8"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Koordinator \u8fdb\u4e00\u6b65\u589e\u5f3a\u4e86 CPU \u7cbe\u7ec6\u5316\u8c03\u5ea6\u80fd\u529b\uff0c\u5b8c\u5168\u517c\u5bb9 kubelet ( <= v1.22) CPU Manager static \u7b56\u7565\u3002\u8c03\u5ea6\u5668\u5206\u914d CPU \u65f6\u4f1a\u907f\u514d\u5206\u914d\u88ab kubelet \u9884\u7559\u7684 CPU\uff0c\u5355\u673a\u4fa7koordlet\u5b8c\u6574\u9002\u914d\u4e86kubelet\u4ece1.18\u52301.22\u7248\u672c\u7684\u5206\u914d\u7b56\u7565\uff0c\u6709\u6548\u907f\u514d\u4e86 CPU \u51b2\u7a81\u3002"),(0,o.kt)("li",{parentName:"ul"},"\u8d44\u6e90\u9884\u7559\u673a\u5236\u652f\u6301 AllocateOnce \u8bed\u4e49\uff0c\u6ee1\u8db3\u5355\u6b21\u9884\u7559\u573a\u666f\u3002\u5e76\u6539\u8fdb\u4e86 Reservation \u72b6\u6001\u8bed\u4e49\uff0c\u66f4\u52a0\u51c6\u786e\u63cf\u8ff0 Reservation \u5bf9\u8c61\u5f53\u524d\u7684\u72b6\u6001\u3002"),(0,o.kt)("li",{parentName:"ul"},"\u6539\u8fdb\u4e86\u79bb\u7ebf\u8d44\u6e90(Batch CPU/Memory) \u7684\u58f0\u660e\u65b9\u5f0f\uff0c\u652f\u6301limit\u5927\u4e8erequest\u7684\u8d44\u6e90\u63cf\u8ff0\u5f62\u5f0f\uff0c\u53ef\u4ee5\u65b9\u4fbf\u539fburstable\u7c7b\u578b\u7684\u4efb\u52a1\u76f4\u63a5\u8f6c\u6362\u4e3a\u6df7\u90e8\u6a21\u5f0f\u8fd0\u884c\u3002")),(0,o.kt)("p",null,"\u4f60\u53ef\u4ee5\u901a\u8fc7 ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/koordinator-sh/koordinator/releases/tag/v0.6.1"},"Github release[6]")," \u9875\u9762\uff0c\u6765\u67e5\u770b\u66f4\u591a\u7684\u6539\u52a8\u4ee5\u53ca\u5b83\u4eec\u7684\u4f5c\u8005\u4e0e\u63d0\u4ea4\u8bb0\u5f55\u3002"),(0,o.kt)("h1",{id:"\u76f8\u5173\u94fe\u63a5"},"\u76f8\u5173\u94fe\u63a5"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://koordinator.sh"},"[1] Koordinator")," "),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://mp.weixin.qq.com/s/YdoxVxz_91ZFemF8JuxRvQ"},"[2]  Koordinator 0.6 Release Note")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/blob/main/docs/proposals/scheduling/20220901-gang-scheduling.md"},"[3] Design: Gang Scheduling")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/blob/main/docs/proposals/scheduling/20220722-multi-hierarchy-elastic-quota-management.md"},"[4] Design: Multi Hierarchy ElasticQuota Management")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/blob/main/docs/proposals/scheduling/20220629-fine-grained-device-scheduling.md"},"[5] Design: Fine-grained Device Scheduling")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/releases/tag/v0.6.1"},"[6] Github Release")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://join.slack.com/t/koordinator-sh/shared_invite/zt-1756qoub4-Cn4~esfdlfAPsD7cwO2NzA"},"[7] Slack Channel")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://mp.weixin.qq.com/s/y8k_q6rhTIubQ-lqvDp2hw"},"[8] \u4e91\u539f\u751f\u6df7\u90e8\u7cfb\u7edf Koordinator \u67b6\u6784\u8be6\u89e3"))))}c.isMDXComponent=!0},2511:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/gang-schedulue-cycle-597c5d13e7b13ec4e2e0752bc8e0678d.png"},858:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/koordlet-inject-env-80dc8617520f3b4f4ce0bff46548d467.jpeg"},12241:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/nvlink-87c3973857a32b2efaa5dd2f714766b2.png"},72242:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/quota-init-example-f430132dc764dc42583bca4042c06af4.png"},53172:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/quota-init-runtime-example-e5701da3ac0576ceb3dba51e52021c06.png"},1265:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/quota-tree-f8a3e073d27f66f203a45236769b9f58.png"}}]);