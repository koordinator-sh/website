"use strict";(self.webpackChunkkoordinator_sh=self.webpackChunkkoordinator_sh||[]).push([[9682],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>k});var o=a(7294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,o)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,o,n=function(e,t){if(null==e)return{};var a,o,n={},l=Object.keys(e);for(o=0;o<l.length;o++)a=l[o],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)a=l[o],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var s=o.createContext({}),c=function(e){var t=o.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},u=function(e){var t=c(e.components);return o.createElement(s.Provider,{value:t},e.children)},p="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var a=e.components,n=e.mdxType,l=e.originalType,s=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),p=c(a),d=n,k=p["".concat(s,".").concat(d)]||p[d]||m[d]||l;return a?o.createElement(k,r(r({ref:t},u),{},{components:a})):o.createElement(k,r({ref:t},u))}));function k(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var l=a.length,r=new Array(l);r[0]=d;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i[p]="string"==typeof e?e:n,r[1]=i;for(var c=2;c<l;c++)r[c]=a[c];return o.createElement.apply(null,r)}return o.createElement.apply(null,a)}d.displayName="MDXCreateElement"},9410:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>m,frontMatter:()=>l,metadata:()=>i,toc:()=>c});var o=a(7462),n=(a(7294),a(3905));const l={},r="Custom Resource Definitions",i={unversionedId:"api-reference/custom-resource-definitions",id:"api-reference/custom-resource-definitions",title:"Custom Resource Definitions",description:"This document is generated with assistance from Qoder AI.",source:"@site/i18n/zh-Hans/docusaurus-plugin-content-docs/current/api-reference/custom-resource-definitions.md",sourceDirName:"api-reference",slug:"/api-reference/custom-resource-definitions",permalink:"/zh-Hans/docs/next/api-reference/custom-resource-definitions",draft:!1,editUrl:"https://github.com/koordinator-sh/koordinator.sh/edit/main/docs/api-reference/custom-resource-definitions.md",tags:[],version:"current",lastUpdatedBy:"Frame",lastUpdatedAt:1760590662,formattedLastUpdatedAt:"2025\u5e7410\u670816\u65e5",frontMatter:{},sidebar:"docs",previous:{title:"Webhook \u6269\u5c55",permalink:"/zh-Hans/docs/next/developer-guide/webhook-extensions"},next:{title:"Client Libraries",permalink:"/zh-Hans/docs/next/api-reference/client-libraries"}},s={},c=[{value:"Introduction",id:"introduction",level:2},{value:"API Groups and Versions",id:"api-groups-and-versions",level:2},{value:"Recommendation CRD",id:"recommendation-crd",level:2},{value:"Schema Documentation",id:"schema-documentation",level:3},{value:"Spec Fields",id:"spec-fields",level:4},{value:"Status Fields",id:"status-fields",level:4},{value:"Validation Rules",id:"validation-rules",level:4},{value:"Default Values",id:"default-values",level:4},{value:"ClusterColocationProfile CRD",id:"clustercolocationprofile-crd",level:2},{value:"Schema Documentation",id:"schema-documentation-1",level:3},{value:"Spec Fields",id:"spec-fields-1",level:4},{value:"Validation Rules",id:"validation-rules-1",level:4},{value:"Default Values",id:"default-values-1",level:4},{value:"ElasticQuotaProfile CRD",id:"elasticquotaprofile-crd",level:2},{value:"Schema Documentation",id:"schema-documentation-2",level:3},{value:"Spec Fields",id:"spec-fields-2",level:4},{value:"Validation Rules",id:"validation-rules-2",level:4},{value:"Default Values",id:"default-values-2",level:4},{value:"Reservation CRD",id:"reservation-crd",level:2},{value:"Schema Documentation",id:"schema-documentation-3",level:3},{value:"Spec Fields",id:"spec-fields-3",level:4},{value:"Status Fields",id:"status-fields-1",level:4},{value:"Validation Rules",id:"validation-rules-3",level:4},{value:"Default Values",id:"default-values-3",level:4},{value:"NodeMetric CRD",id:"nodemetric-crd",level:2},{value:"Schema Documentation",id:"schema-documentation-4",level:3},{value:"Spec Fields",id:"spec-fields-4",level:4},{value:"Status Fields",id:"status-fields-2",level:4},{value:"Validation Rules",id:"validation-rules-4",level:4},{value:"Default Values",id:"default-values-4",level:4},{value:"NodeSLO CRD",id:"nodeslo-crd",level:2},{value:"Schema Documentation",id:"schema-documentation-5",level:3},{value:"Spec Fields",id:"spec-fields-5",level:4},{value:"Validation Rules",id:"validation-rules-5",level:4},{value:"Default Values",id:"default-values-5",level:4},{value:"Usage Examples",id:"usage-examples",level:2},{value:"Creating Resources with kubectl",id:"creating-resources-with-kubectl",level:3},{value:"Programmatic Creation with Go Client",id:"programmatic-creation-with-go-client",level:3},{value:"Sample YAML Manifests",id:"sample-yaml-manifests",level:3},{value:"Recommendation",id:"recommendation",level:4},{value:"ClusterColocationProfile",id:"clustercolocationprofile",level:4},{value:"ElasticQuotaProfile",id:"elasticquotaprofile",level:4},{value:"Reservation",id:"reservation",level:4},{value:"NodeMetric",id:"nodemetric",level:4},{value:"NodeSLO",id:"nodeslo",level:4},{value:"Controller Integration",id:"controller-integration",level:2},{value:"Controller Responsibilities",id:"controller-responsibilities",level:3},{value:"Reconciliation Process",id:"reconciliation-process",level:3},{value:"Common Configuration Pitfalls",id:"common-configuration-pitfalls",level:2},{value:"Invalid Field Combinations",id:"invalid-field-combinations",level:3},{value:"Missing Required Fields",id:"missing-required-fields",level:3},{value:"Validation Errors",id:"validation-errors",level:3},{value:"Best Practices",id:"best-practices",level:3}],u={toc:c},p="wrapper";function m(e){let{components:t,...a}=e;return(0,n.kt)(p,(0,o.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"custom-resource-definitions"},"Custom Resource Definitions"),(0,n.kt)("admonition",{title:"\u6587\u6863\u8bf4\u660e",type:"info"},(0,n.kt)("p",{parentName:"admonition"},"This document is generated with assistance from Qoder AI.")),(0,n.kt)("h2",{id:"introduction"},"Introduction"),(0,n.kt)("p",null,"Koordinator extends Kubernetes functionality through Custom Resource Definitions (CRDs) that enable advanced scheduling, resource management, and performance optimization. These CRDs provide declarative interfaces for configuring and managing various aspects of cluster behavior, including resource recommendations, colocation policies, quota management, reservations, and system-level objectives. This documentation provides comprehensive details on each CRD, including schema definitions, field descriptions, validation rules, and usage patterns."),(0,n.kt)("h2",{id:"api-groups-and-versions"},"API Groups and Versions"),(0,n.kt)("p",null,"Koordinator's CRDs are organized into several API groups, each serving a specific purpose within the system architecture:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"analysis.koordinator.sh"),": Provides resource optimization recommendations"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"config.koordinator.sh"),": Manages colocation profiles for workload placement"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"quota.koordinator.sh"),": Handles elastic quota profiles for resource allocation"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"scheduling.koordinator.sh"),": Manages resource reservations and scheduling policies"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"slo.koordinator.sh"),": Defines Service Level Objectives for node performance and resource quality")),(0,n.kt)("p",null,"All CRDs are currently at version ",(0,n.kt)("strong",{parentName:"p"},"v1alpha1"),", indicating they are in early development and subject to change. The CRDs follow Kubernetes API conventions with proper metadata, spec, and status fields, and leverage controller patterns for reconciliation and lifecycle management."),(0,n.kt)("h2",{id:"recommendation-crd"},"Recommendation CRD"),(0,n.kt)("p",null,"The Recommendation CRD in the analysis.koordinator.sh API group provides resource optimization suggestions for workloads based on historical usage patterns."),(0,n.kt)("h3",{id:"schema-documentation"},"Schema Documentation"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-go"},'type Recommendation struct {\n    metav1.TypeMeta   `json:",inline"`\n    metav1.ObjectMeta `json:"metadata,omitempty"`\n    Spec   RecommendationSpec   `json:"spec,omitempty"`\n    Status RecommendationStatus `json:"status,omitempty"`\n}\n')),(0,n.kt)("h4",{id:"spec-fields"},"Spec Fields"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"target"),": Defines the analysis target with the following subfields:",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"type"),": Specifies the target type (workload or podSelector)"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"workload"),': References a Kubernetes workload object when type is "workload"'),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"podSelector"),': Label selector for targeting specific pods when type is "podSelector"')))),(0,n.kt)("h4",{id:"status-fields"},"Status Fields"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"podStatus"),": Contains resource recommendations with:",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"containerStatuses"),": Array of container-specific recommendations",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"containerName"),": Name of the container"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"resources"),": Recommended resource amounts (CPU, memory)"))))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"updateTime"),": Timestamp of the last recommendation update"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"conditions"),": Lifecycle and status conditions")),(0,n.kt)("h4",{id:"validation-rules"},"Validation Rules"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"The target field is required"),(0,n.kt)("li",{parentName:"ul"},'Type must be either "workload" or "podSelector"'),(0,n.kt)("li",{parentName:"ul"},'When type is "workload", the workload field must be specified'),(0,n.kt)("li",{parentName:"ul"},'When type is "podSelector", the podSelector field must be specified')),(0,n.kt)("h4",{id:"default-values"},"Default Values"),(0,n.kt)("p",null,"No default values are explicitly defined in the schema."),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Section sources")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/apis/analysis/v1alpha1/recommendation_types.go#L95-L115"},"recommendation_types.go")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/config/crd/bases/analysis.koordinator.sh_recommendations.yaml#L1-L245"},"analysis.koordinator.sh_recommendations.yaml"))),(0,n.kt)("h2",{id:"clustercolocationprofile-crd"},"ClusterColocationProfile CRD"),(0,n.kt)("p",null,"The ClusterColocationProfile CRD in the config.koordinator.sh API group defines policies for workload colocation and QoS configuration."),(0,n.kt)("h3",{id:"schema-documentation-1"},"Schema Documentation"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-go"},'type ClusterColocationProfile struct {\n    metav1.TypeMeta   `json:",inline"`\n    metav1.ObjectMeta `json:"metadata,omitempty"`\n    Spec              ClusterColocationProfileSpec   `json:"spec,omitempty"`\n    Status            ClusterColocationProfileStatus `json:"status,omitempty"`\n}\n')),(0,n.kt)("h4",{id:"spec-fields-1"},"Spec Fields"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"namespaceSelector"),": Label selector to filter namespaces (optional, defaults to all)"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"selector"),": Label selector to filter pods (optional, defaults to all)"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"probability"),": Probability (0-100%) that the profile will be applied"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"qosClass"),": QoS class to assign (LSE, LSR, LS, BE, SYSTEM)"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"priorityClassName"),": Priority class to inject into pods"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"koordinatorPriority"),": Sub-priority value for Koordinator scheduling"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"labels"),": Key-value pairs to inject as pod labels"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"annotations"),": Key-value pairs to inject as pod annotations"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"labelKeysMapping"),": Maps existing label keys to new keys"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"annotationKeysMapping"),": Maps existing annotation keys to new keys"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"labelSuffixes"),": Appends suffixes to existing label values"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"schedulerName"),": Scheduler to dispatch pods"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"patch"),": Raw extension for patching pod templates")),(0,n.kt)("h4",{id:"validation-rules-1"},"Validation Rules"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"qosClass must be one of: LSE, LSR, LS, BE, SYSTEM"),(0,n.kt)("li",{parentName:"ul"},"namespaceSelector and selector follow standard Kubernetes label selector validation"),(0,n.kt)("li",{parentName:"ul"},"probability must be a valid integer or string percentage")),(0,n.kt)("h4",{id:"default-values-1"},"Default Values"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"namespaceSelector and selector default to empty (matches all)"),(0,n.kt)("li",{parentName:"ul"},"probability has no default (optional)")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Section sources")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/apis/config/v1alpha1/cluster_colocation_profile_types.go#L114-L134"},"cluster_colocation_profile_types.go")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/config/crd/bases/config.koordinator.sh_clustercolocationprofiles.yaml#L1-L225"},"config.koordinator.sh_clustercolocationprofiles.yaml"))),(0,n.kt)("h2",{id:"elasticquotaprofile-crd"},"ElasticQuotaProfile CRD"),(0,n.kt)("p",null,"The ElasticQuotaProfile CRD in the quota.koordinator.sh API group manages quota profiles for flexible resource allocation."),(0,n.kt)("h3",{id:"schema-documentation-2"},"Schema Documentation"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-go"},'type ElasticQuotaProfile struct {\n    metav1.TypeMeta   `json:",inline"`\n    metav1.ObjectMeta `json:"metadata,omitempty"`\n    Spec   ElasticQuotaProfileSpec   `json:"spec,omitempty"`\n    Status ElasticQuotaProfileStatus `json:"status,omitempty"`\n}\n')),(0,n.kt)("h4",{id:"spec-fields-2"},"Spec Fields"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"quotaName"),": Required name of the associated quota"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"quotaLabels"),": Labels to apply to the quota"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"resourceRatio"),': Ratio to address resource fragmentation (e.g., "0.9")'),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"nodeSelector"),": Required node selector to target specific nodes")),(0,n.kt)("h4",{id:"validation-rules-2"},"Validation Rules"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"quotaName is required"),(0,n.kt)("li",{parentName:"ul"},"nodeSelector is required"),(0,n.kt)("li",{parentName:"ul"},"resourceRatio must be a valid string representation of a ratio")),(0,n.kt)("h4",{id:"default-values-2"},"Default Values"),(0,n.kt)("p",null,"No default values are explicitly defined."),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Section sources")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/apis/quota/v1alpha1/elastic_quota_profile_types.go#L49-L69"},"elastic_quota_profile_types.go")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/config/crd/bases/quota.koordinator.sh_elasticquotaprofiles.yaml#L1-L108"},"quota.koordinator.sh_elasticquotaprofiles.yaml"))),(0,n.kt)("h2",{id:"reservation-crd"},"Reservation CRD"),(0,n.kt)("p",null,"The Reservation CRD in the scheduling.koordinator.sh API group enables resource reservation for future workload placement."),(0,n.kt)("h3",{id:"schema-documentation-3"},"Schema Documentation"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-go"},'type Reservation struct {\n    metav1.TypeMeta   `json:",inline"`\n    metav1.ObjectMeta `json:"metadata,omitempty"`\n    Spec   ReservationSpec   `json:"spec,omitempty"`\n    Status ReservationStatus `json:"status,omitempty"`\n}\n')),(0,n.kt)("h4",{id:"spec-fields-3"},"Spec Fields"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"template"),": Pod template specifying resource requirements and scheduling constraints"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"owners"),": Array of reservation owners (object reference, controller reference, or label selector)"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"ttl"),": Time-to-live duration (default: 24h)"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"expires"),": Absolute expiration timestamp"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"preAllocation"),": Allows overcommitment when set"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"allocateOnce"),": Limits allocation to first successful owner (default: true)"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"allocatePolicy"),": Allocation policy (Aligned, Restricted)"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"unschedulable"),": Controls reservation schedulability"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"taints"),": Taints applied to the reservation")),(0,n.kt)("h4",{id:"status-fields-1"},"Status Fields"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"phase"),": Current phase (Pending, Available, Succeeded, Waiting, Failed)"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"conditions"),": Status conditions with type, status, reason, and message"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"currentOwners"),": Currently allocated owners"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"nodeName"),": Node where resources are reserved"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"allocatable"),": Total allocatable resources"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"allocated"),": Currently allocated resources")),(0,n.kt)("h4",{id:"validation-rules-3"},"Validation Rules"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"template and owners are required"),(0,n.kt)("li",{parentName:"ul"},"ttl and expires are mutually exclusive"),(0,n.kt)("li",{parentName:"ul"},"allocatePolicy must be Aligned or Restricted"),(0,n.kt)("li",{parentName:"ul"},"preAllocation and allocateOnce have specific interaction rules")),(0,n.kt)("h4",{id:"default-values-3"},"Default Values"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},'ttl defaults to "24h"'),(0,n.kt)("li",{parentName:"ul"},"allocateOnce defaults to true"),(0,n.kt)("li",{parentName:"ul"},'phase defaults to "Pending"')),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Section sources")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/apis/scheduling/v1alpha1/reservation_types.go#L219-L240"},"reservation_types.go")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/config/crd/bases/scheduling.koordinator.sh_reservations.yaml#L1-L409"},"scheduling.koordinator.sh_reservations.yaml"))),(0,n.kt)("h2",{id:"nodemetric-crd"},"NodeMetric CRD"),(0,n.kt)("p",null,"The NodeMetric CRD in the slo.koordinator.sh API group collects and reports node-level resource metrics."),(0,n.kt)("h3",{id:"schema-documentation-4"},"Schema Documentation"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-go"},'type NodeMetric struct {\n    metav1.TypeMeta   `json:",inline"`\n    metav1.ObjectMeta `json:"metadata,omitempty"`\n    Spec   NodeMetricSpec   `json:"spec,omitempty"`\n    Status NodeMetricStatus `json:"status,omitempty"`\n}\n')),(0,n.kt)("h4",{id:"spec-fields-4"},"Spec Fields"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"metricCollectPolicy"),": Collection policy with:",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"aggregateDurationSeconds"),": Aggregation period in seconds"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"reportIntervalSeconds"),": Reporting interval in seconds"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"nodeAggregatePolicy"),": Target grain for node aggregation"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"nodeMemoryCollectPolicy"),": Memory collection method (usageWithHotPageCache, usageWithoutPageCache, usageWithPageCache)")))),(0,n.kt)("h4",{id:"status-fields-2"},"Status Fields"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"updateTime"),": Last update timestamp"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"nodeMetric"),": Node resource usage metrics",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"nodeUsage"),": Total node resource usage"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"aggregatedNodeUsages"),": Historical usage aggregates"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"systemUsage"),": System-level resource usage"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"aggregatedSystemUsages"),": Historical system usage aggregates"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"podsMetric"),": Array of pod-level metrics"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"hostApplicationMetric"),": Metrics for host applications"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"prodReclaimableMetric"),": Reclaimable resource indicators")),(0,n.kt)("h4",{id:"validation-rules-4"},"Validation Rules"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"nodeMemoryCollectPolicy must be one of the defined enum values"),(0,n.kt)("li",{parentName:"ul"},"Duration fields must be valid time durations")),(0,n.kt)("h4",{id:"default-values-4"},"Default Values"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"nodeMemoryCollectPolicy defaults to usageWithoutPageCache")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Section sources")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/apis/slo/v1alpha1/nodemetric_types.go#L134-L151"},"nodemetric_types.go")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/config/crd/bases/slo.koordinator.sh_nodemetrics.yaml#L1-L799"},"slo.koordinator.sh_nodemetrics.yaml"))),(0,n.kt)("h2",{id:"nodeslo-crd"},"NodeSLO CRD"),(0,n.kt)("p",null,"The NodeSLO CRD in the slo.koordinator.sh API group defines Service Level Objectives for node performance and resource quality."),(0,n.kt)("h3",{id:"schema-documentation-5"},"Schema Documentation"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-go"},'type NodeSLO struct {\n    metav1.TypeMeta   `json:",inline"`\n    metav1.ObjectMeta `json:"metadata,omitempty"`\n    Spec   NodeSLOSpec   `json:"spec,omitempty"`\n    Status NodeSLOStatus `json:"status,omitempty"`\n}\n')),(0,n.kt)("h4",{id:"spec-fields-5"},"Spec Fields"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"resourceUsedThresholdWithBE"),": Resource threshold strategy for BE workloads"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"resourceQOSStrategy"),": QoS configuration strategy for different workload classes"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"cpuBurstStrategy"),": CPU burst configuration"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"systemStrategy"),": Node-level system configuration"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"extensions"),": Third-party extensions"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"hostApplications"),": QoS management for host applications")),(0,n.kt)("p",null,"The resourceQOSStrategy supports detailed configuration for CPU, memory, block I/O, network, and resctrl QoS across different workload classes (LSR, LS, BE, SYSTEM)."),(0,n.kt)("h4",{id:"validation-rules-5"},"Validation Rules"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Various percentage fields have minimum and maximum constraints (0-100)"),(0,n.kt)("li",{parentName:"ul"},"CPU and memory burst policies have specific value ranges"),(0,n.kt)("li",{parentName:"ul"},"Network bandwidth values must be non-negative")),(0,n.kt)("h4",{id:"default-values-5"},"Default Values"),(0,n.kt)("p",null,"Many fields have sensible defaults for production environments, such as:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"cpuSuppressThresholdPercent: 65"),(0,n.kt)("li",{parentName:"ul"},"memoryEvictThresholdPercent: 70"),(0,n.kt)("li",{parentName:"ul"},"cpuEvictTimeWindowSeconds: 300")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Section sources")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/apis/slo/v1alpha1/nodeslo_types.go#L472-L493"},"nodeslo_types.go")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/config/crd/bases/slo.koordinator.sh_nodeslos.yaml#L1-L799"},"slo.koordinator.sh_nodeslos.yaml"))),(0,n.kt)("h2",{id:"usage-examples"},"Usage Examples"),(0,n.kt)("h3",{id:"creating-resources-with-kubectl"},"Creating Resources with kubectl"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"# Create a Recommendation\nkubectl apply -f recommendation.yaml\n\n# Create a ClusterColocationProfile\nkubectl apply -f cluster-colocation-profile.yaml\n\n# Create an ElasticQuotaProfile\nkubectl apply -f elastic-quota-profile.yaml\n\n# Create a Reservation\nkubectl apply -f reservation.yaml\n\n# Create a NodeMetric\nkubectl apply -f nodemetric.yaml\n\n# Create a NodeSLO\nkubectl apply -f nodeslo.yaml\n")),(0,n.kt)("h3",{id:"programmatic-creation-with-go-client"},"Programmatic Creation with Go Client"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-go"},'// Example of creating a Reservation programmatically\nreservation := &schedulingv1alpha1.Reservation{\n    ObjectMeta: metav1.ObjectMeta{\n        Name: "example-reservation",\n    },\n    Spec: schedulingv1alpha1.ReservationSpec{\n        Template: &corev1.PodTemplateSpec{\n            // Template specification\n        },\n        Owners: []schedulingv1alpha1.ReservationOwner{\n            {\n                LabelSelector: &metav1.LabelSelector{\n                    MatchLabels: map[string]string{"app": "example"},\n                },\n            },\n        },\n        TTL: &metav1.Duration{Duration: 24 * time.Hour},\n    },\n}\n\ncreatedReservation, err := client.SchedulingV1alpha1().Reservations().Create(context.TODO(), reservation, metav1.CreateOptions{})\n')),(0,n.kt)("h3",{id:"sample-yaml-manifests"},"Sample YAML Manifests"),(0,n.kt)("h4",{id:"recommendation"},"Recommendation"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: analysis.koordinator.sh/v1alpha1\nkind: Recommendation\nmetadata:\n  name: example-recommendation\nspec:\n  target:\n    type: workload\n    workload:\n      kind: Deployment\n      name: example-app\n      apiVersion: apps/v1\n")),(0,n.kt)("h4",{id:"clustercolocationprofile"},"ClusterColocationProfile"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: config.koordinator.sh/v1alpha1\nkind: ClusterColocationProfile\nmetadata:\n  name: high-priority\nspec:\n  selector:\n    matchLabels:\n      priority: high\n  qosClass: LSE\n  priorityClassName: system-cluster-critical\n")),(0,n.kt)("h4",{id:"elasticquotaprofile"},"ElasticQuotaProfile"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: quota.koordinator.sh/v1alpha1\nkind: ElasticQuotaProfile\nmetadata:\n  name: gpu-quota-profile\nspec:\n  quotaName: gpu-quota\n  nodeSelector:\n    matchLabels:\n      accelerator: gpu\n  resourceRatio: "0.8"\n')),(0,n.kt)("h4",{id:"reservation"},"Reservation"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: scheduling.koordinator.sh/v1alpha1\nkind: Reservation\nmetadata:\n  name: batch-job-reservation\nspec:\n  template:\n    spec:\n      containers:\n      - name: placeholder\n        resources:\n          requests:\n            cpu: "8"\n            memory: "32Gi"\n  owners:\n  - labelSelector:\n      matchLabels:\n        job-type: batch\n  ttl: "12h"\n')),(0,n.kt)("h4",{id:"nodemetric"},"NodeMetric"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: slo.koordinator.sh/v1alpha1\nkind: NodeMetric\nmetadata:\n  name: node-sample\nspec:\n  metricCollectPolicy:\n    aggregateDurationSeconds: 60\n    reportIntervalSeconds: 15\n    nodeMemoryCollectPolicy: usageWithoutPageCache\n")),(0,n.kt)("h4",{id:"nodeslo"},"NodeSLO"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: slo.koordinator.sh/v1alpha1\nkind: NodeSLO\nmetadata:\n  name: production-node-slo\nspec:\n  resourceUsedThresholdWithBE:\n    enable: true\n    cpuSuppressThresholdPercent: 70\n    memoryEvictThresholdPercent: 75\n  resourceQOSStrategy:\n    beClass:\n      cpuQOS:\n        enable: true\n        groupIdentity: 1\n      memoryQOS:\n        enable: true\n        minLimitPercent: 20\n        lowLimitPercent: 40\n        throttlingPercent: 80\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Section sources")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/examples/spark-jobs/cluster-colocation-profile.yaml"},"examples/spark-jobs/cluster-colocation-profile.yaml")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/config/samples/analysis_v1aplha1_recommendation.yaml"},"config/samples/analysis_v1aplha1_recommendation.yaml")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/config/samples/scheduling_v1alpha1_reservation.yaml"},"config/samples/scheduling_v1alpha1_reservation.yaml")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/config/samples/slo_v1alpha1_nodemetric.yaml"},"config/samples/slo_v1alpha1_nodemetric.yaml"))),(0,n.kt)("h2",{id:"controller-integration"},"Controller Integration"),(0,n.kt)("p",null,"Koordinator's CRDs integrate with the Kubernetes controller pattern through dedicated controllers that reconcile the desired state defined in the spec with the actual cluster state."),(0,n.kt)("h3",{id:"controller-responsibilities"},"Controller Responsibilities"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"RecommendationController"),": Analyzes workload resource usage and generates optimization recommendations"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"ColocationProfileController"),": Applies colocation policies to matching pods during admission"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"QuotaProfileController"),": Manages elastic quota profiles and their application to workloads"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"ReservationController"),": Handles resource reservation lifecycle, scheduling, and allocation"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"NodeMetricController"),": Collects and aggregates node resource metrics"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"NodeSLOController"),": Enforces node-level SLOs and QoS policies")),(0,n.kt)("h3",{id:"reconciliation-process"},"Reconciliation Process"),(0,n.kt)("p",null,"Each controller follows the standard reconciliation loop:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Watches for CRD events (create, update, delete)"),(0,n.kt)("li",{parentName:"ol"},"Fetches the current resource state"),(0,n.kt)("li",{parentName:"ol"},"Compares spec (desired state) with status (current state)"),(0,n.kt)("li",{parentName:"ol"},"Takes actions to reconcile differences"),(0,n.kt)("li",{parentName:"ol"},"Updates status to reflect current state"),(0,n.kt)("li",{parentName:"ol"},"Emits events and conditions for observability")),(0,n.kt)("p",null,"Controllers use Kubernetes client-go libraries for API interactions and leverage informers for efficient event handling. They also implement proper error handling and retry mechanisms to ensure reliability."),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Section sources")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/pkg/controller/colocationprofile/colocationprofile_controller.go"},"pkg/controller/colocationprofile/colocationprofile_controller.go")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/pkg/slo-controller/nodemetric/nodemetric_controller.go"},"pkg/slo-controller/nodemetric/nodemetric_controller.go")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/pkg/slo-controller/nodeslo/nodeslo_controller.go"},"pkg/slo-controller/nodeslo/nodeslo_controller.go"))),(0,n.kt)("h2",{id:"common-configuration-pitfalls"},"Common Configuration Pitfalls"),(0,n.kt)("h3",{id:"invalid-field-combinations"},"Invalid Field Combinations"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Setting both ttl and expires in Reservation (mutually exclusive)"),(0,n.kt)("li",{parentName:"ul"},"Specifying conflicting QoS policies in NodeSLO"),(0,n.kt)("li",{parentName:"ul"},"Using invalid enum values for qosClass or allocationPolicy")),(0,n.kt)("h3",{id:"missing-required-fields"},"Missing Required Fields"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Omitting quotaName or nodeSelector in ElasticQuotaProfile"),(0,n.kt)("li",{parentName:"ul"},"Not specifying template or owners in Reservation"),(0,n.kt)("li",{parentName:"ul"},"Forgetting to set required selectors in ClusterColocationProfile")),(0,n.kt)("h3",{id:"validation-errors"},"Validation Errors"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Exceeding percentage limits (e.g., cpuSuppressThresholdPercent > 100)"),(0,n.kt)("li",{parentName:"ul"},"Using invalid duration formats in TTL fields"),(0,n.kt)("li",{parentName:"ul"},"Providing malformed label selectors or match expressions")),(0,n.kt)("h3",{id:"best-practices"},"Best Practices"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Use descriptive names and labels for easy identification"),(0,n.kt)("li",{parentName:"ul"},"Set appropriate TTL values to avoid resource leaks"),(0,n.kt)("li",{parentName:"ul"},"Test colocation profiles in staging environments before production"),(0,n.kt)("li",{parentName:"ul"},"Monitor reservation utilization to optimize resource allocation"),(0,n.kt)("li",{parentName:"ul"},"Regularly review and update NodeSLO configurations based on workload patterns")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Section sources")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/pkg/util/sloconfig/validator.go"},"pkg/util/sloconfig/validator.go")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook"},"pkg/webhook")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/pkg/scheduler/plugins"},"pkg/scheduler/plugins"))))}m.isMDXComponent=!0}}]);