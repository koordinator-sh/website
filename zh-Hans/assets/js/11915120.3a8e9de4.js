"use strict";(self.webpackChunkkoordinator_sh=self.webpackChunkkoordinator_sh||[]).push([[7883],{3905:(e,n,t)=>{t.d(n,{Zo:()=>d,kt:()=>g});var o=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,o,a=function(e,n){if(null==e)return{};var t,o,a={},l=Object.keys(e);for(o=0;o<l.length;o++)t=l[o],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)t=l[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var p=o.createContext({}),s=function(e){var n=o.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},d=function(e){var n=s(e.components);return o.createElement(p.Provider,{value:n},e.children)},m="mdxType",k={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},u=o.forwardRef((function(e,n){var t=e.components,a=e.mdxType,l=e.originalType,p=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),m=s(t),u=a,g=m["".concat(p,".").concat(u)]||m[u]||k[u]||l;return t?o.createElement(g,r(r({ref:n},d),{},{components:t})):o.createElement(g,r({ref:n},d))}));function g(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var l=t.length,r=new Array(l);r[0]=u;var i={};for(var p in n)hasOwnProperty.call(n,p)&&(i[p]=n[p]);i.originalType=e,i[m]="string"==typeof e?e:a,r[1]=i;for(var s=2;s<l;s++)r[s]=t[s];return o.createElement.apply(null,r)}return o.createElement.apply(null,t)}u.displayName="MDXCreateElement"},1167:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>r,default:()=>k,frontMatter:()=>l,metadata:()=>i,toc:()=>s});var o=t(7462),a=(t(7294),t(3905));const l={},r="\u7f51\u7edc\u62d3\u6251\u611f\u77e5\u8c03\u5ea6",i={unversionedId:"user-manuals/network-topology-aware-scheduling",id:"user-manuals/network-topology-aware-scheduling",title:"\u7f51\u7edc\u62d3\u6251\u611f\u77e5\u8c03\u5ea6",description:"\u7b80\u4ecb",source:"@site/i18n/zh-Hans/docusaurus-plugin-content-docs/current/user-manuals/network-topology-aware-scheduling.md",sourceDirName:"user-manuals",slug:"/user-manuals/network-topology-aware-scheduling",permalink:"/zh-Hans/docs/next/user-manuals/network-topology-aware-scheduling",draft:!1,editUrl:"https://github.com/koordinator-sh/koordinator.sh/edit/main/docs/user-manuals/network-topology-aware-scheduling.md",tags:[],version:"current",lastUpdatedBy:"\u4e54\u666e",lastUpdatedAt:1761208501,formattedLastUpdatedAt:"2025\u5e7410\u670823\u65e5",frontMatter:{},sidebar:"docs",previous:{title:"Job \u7ea7\u522b\u62a2\u5360",permalink:"/zh-Hans/docs/next/user-manuals/job-level-preemption"},next:{title:"Capacity Scheduling - Elastic Quota Management",permalink:"/zh-Hans/docs/next/user-manuals/capacity-scheduling"}},p={},s=[{value:"\u7b80\u4ecb",id:"\u7b80\u4ecb",level:2},{value:"\u524d\u7f6e\u6761\u4ef6",id:"\u524d\u7f6e\u6761\u4ef6",level:2},{value:"\u9a8c\u8bc1\u7f51\u7edc\u62d3\u6251\u652f\u6301\u662f\u5426\u542f\u7528",id:"\u9a8c\u8bc1\u7f51\u7edc\u62d3\u6251\u652f\u6301\u662f\u5426\u542f\u7528",level:2},{value:"\u68c0\u67e5 koord-scheduler \u542f\u52a8\u53c2\u6570",id:"\u68c0\u67e5-koord-scheduler-\u542f\u52a8\u53c2\u6570",level:3},{value:"\u68c0\u67e5 Coscheduling \u63d2\u4ef6\u914d\u7f6e",id:"\u68c0\u67e5-coscheduling-\u63d2\u4ef6\u914d\u7f6e",level:3},{value:"\u914d\u7f6e\u7f51\u7edc\u62d3\u6251",id:"\u914d\u7f6e\u7f51\u7edc\u62d3\u6251",level:2},{value:"\u4e3a\u8282\u70b9\u6dfb\u52a0\u62d3\u6251\u4fe1\u606f\u6807\u7b7e",id:"\u4e3a\u8282\u70b9\u6dfb\u52a0\u62d3\u6251\u4fe1\u606f\u6807\u7b7e",level:3},{value:"\u521b\u5efa ClusterNetworkTopology",id:"\u521b\u5efa-clusternetworktopology",level:3},{value:"\u9a8c\u8bc1\u62d3\u6251\u914d\u7f6e",id:"\u9a8c\u8bc1\u62d3\u6251\u914d\u7f6e",level:3},{value:"\u4f7f\u7528\u793a\u4f8b",id:"\u4f7f\u7528\u793a\u4f8b",level:2},{value:"\u73af\u5883\u8bbe\u7f6e",id:"\u73af\u5883\u8bbe\u7f6e",level:3},{value:"\u793a\u4f8b 1: \u4f7f\u7528 <code>PreferGather</code> \u548c Binpack \u7684\u62d3\u6251\u611f\u77e5\u8c03\u5ea6",id:"\u793a\u4f8b-1-\u4f7f\u7528-prefergather-\u548c-binpack-\u7684\u62d3\u6251\u611f\u77e5\u8c03\u5ea6",level:3},{value:"\u573a\u666f",id:"\u573a\u666f",level:4},{value:"\u6b65\u9aa4 1: \u521b\u5efa\u5177\u6709 <code>PreferGather</code> \u7b56\u7565\u7684 PodGroup",id:"\u6b65\u9aa4-1-\u521b\u5efa\u5177\u6709-prefergather-\u7b56\u7565\u7684-podgroup",level:4},{value:"\u6b65\u9aa4 2: \u521b\u5efa 4 Pod \u8bad\u7ec3\u4f5c\u4e1a",id:"\u6b65\u9aa4-2-\u521b\u5efa-4-pod-\u8bad\u7ec3\u4f5c\u4e1a",level:4},{value:"\u6b65\u9aa4 3: \u5e94\u7528\u5e76\u9a8c\u8bc1\u8c03\u5ea6\u7ed3\u679c",id:"\u6b65\u9aa4-3-\u5e94\u7528\u5e76\u9a8c\u8bc1\u8c03\u5ea6\u7ed3\u679c",level:4},{value:"Binpack \u7b97\u6cd5\u5982\u4f55\u5de5\u4f5c",id:"binpack-\u7b97\u6cd5\u5982\u4f55\u5de5\u4f5c",level:4},{value:"\u793a\u4f8b 2: <code>MustGather</code> \u548c\u62d3\u6251\u611f\u77e5\u62a2\u5360",id:"\u793a\u4f8b-2-mustgather-\u548c\u62d3\u6251\u611f\u77e5\u62a2\u5360",level:3},{value:"\u573a\u666f",id:"\u573a\u666f-1",level:4},{value:"\u6b65\u9aa4 1: \u5b9a\u4e49 PriorityClass",id:"\u6b65\u9aa4-1-\u5b9a\u4e49-priorityclass",level:4},{value:"\u6b65\u9aa4 2: \u5728 node-0\u3001node-1 \u548c node-5 \u4e0a\u521b\u5efa\u4f4e\u4f18\u5148\u7ea7 Pod",id:"\u6b65\u9aa4-2-\u5728-node-0node-1-\u548c-node-5-\u4e0a\u521b\u5efa\u4f4e\u4f18\u5148\u7ea7-pod",level:4},{value:"\u6b65\u9aa4 3: \u521b\u5efa\u5177\u6709 <code>MustGather</code> \u5230 SpineLayer \u7684\u9ad8\u4f18\u5148\u7ea7\u4f5c\u4e1a",id:"\u6b65\u9aa4-3-\u521b\u5efa\u5177\u6709-mustgather-\u5230-spinelayer-\u7684\u9ad8\u4f18\u5148\u7ea7\u4f5c\u4e1a",level:4},{value:"\u6b65\u9aa4 4: \u5e94\u7528\u5e76\u89c2\u5bdf\u62a2\u5360",id:"\u6b65\u9aa4-4-\u5e94\u7528\u5e76\u89c2\u5bdf\u62a2\u5360",level:4},{value:"\u6b65\u9aa4 5: \u9a8c\u8bc1\u6700\u7ec8\u8c03\u5ea6\u7ed3\u679c",id:"\u6b65\u9aa4-5-\u9a8c\u8bc1\u6700\u7ec8\u8c03\u5ea6\u7ed3\u679c",level:4},{value:"\u62d3\u6251\u611f\u77e5\u62a2\u5360\u5982\u4f55\u5de5\u4f5c",id:"\u62d3\u6251\u611f\u77e5\u62a2\u5360\u5982\u4f55\u5de5\u4f5c",level:4},{value:"\u9ad8\u7ea7\u914d\u7f6e",id:"\u9ad8\u7ea7\u914d\u7f6e",level:2},{value:"\u62d3\u6251\u5c42\u547d\u540d\u7ea6\u5b9a",id:"\u62d3\u6251\u5c42\u547d\u540d\u7ea6\u5b9a",level:3},{value:"\u62d3\u6251\u7b56\u7565\u9009\u62e9\u6307\u5357",id:"\u62d3\u6251\u7b56\u7565\u9009\u62e9\u6307\u5357",level:3},{value:"\u591a PodGroup \u534f\u8c03\u8c03\u5ea6",id:"\u591a-podgroup-\u534f\u8c03\u8c03\u5ea6",level:3},{value:"\u6545\u969c\u6392\u67e5",id:"\u6545\u969c\u6392\u67e5",level:2},{value:"Pod \u5361\u5728 Pending \u72b6\u6001",id:"pod-\u5361\u5728-pending-\u72b6\u6001",level:3},{value:"\u62d3\u6251\u611f\u77e5\u8c03\u5ea6\u672a\u751f\u6548",id:"\u62d3\u6251\u611f\u77e5\u8c03\u5ea6\u672a\u751f\u6548",level:3},{value:"\u62a2\u5360\u672a\u6309\u9884\u671f\u53d1\u751f",id:"\u62a2\u5360\u672a\u6309\u9884\u671f\u53d1\u751f",level:3},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2},{value:"\u53c2\u8003\u8d44\u6599",id:"\u53c2\u8003\u8d44\u6599",level:2}],d={toc:s},m="wrapper";function k(e){let{components:n,...t}=e;return(0,a.kt)(m,(0,o.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"\u7f51\u7edc\u62d3\u6251\u611f\u77e5\u8c03\u5ea6"},"\u7f51\u7edc\u62d3\u6251\u611f\u77e5\u8c03\u5ea6"),(0,a.kt)("h2",{id:"\u7b80\u4ecb"},"\u7b80\u4ecb"),(0,a.kt)("p",null,"\u5728\u5927\u89c4\u6a21 AI \u8bad\u7ec3\u573a\u666f\u4e2d,\u5c24\u5176\u662f\u5927\u8bed\u8a00\u6a21\u578b(LLMs)\u8bad\u7ec3,\u9ad8\u6548\u7684 Pod \u95f4\u901a\u4fe1\u5bf9\u8bad\u7ec3\u6027\u80fd\u81f3\u5173\u91cd\u8981\u3002\u6a21\u578b\u5e76\u884c\u6280\u672f,\u5982\u5f20\u91cf\u5e76\u884c(TP)\u3001\u6d41\u6c34\u7ebf\u5e76\u884c(PP)\u548c\u6570\u636e\u5e76\u884c(DP),\u9700\u8981\u5728 GPU \u4e4b\u95f4\u8fdb\u884c\u9891\u7e41\u7684\u9ad8\u5e26\u5bbd\u6570\u636e\u4ea4\u6362\u2014\u2014\u901a\u5e38\u8de8\u8d8a\u591a\u4e2a\u8282\u70b9\u3002\u5728\u8fd9\u4e9b\u5de5\u4f5c\u8d1f\u8f7d\u4e0b,",(0,a.kt)("strong",{parentName:"p"},"\u7f51\u7edc\u62d3\u6251\u6210\u4e3a\u5173\u952e\u7684\u6027\u80fd\u74f6\u9888"),",\u901a\u4fe1\u5ef6\u8fdf\u548c\u5e26\u5bbd\u53d7\u7269\u7406\u7f51\u7edc\u5c42\u6b21\u7ed3\u6784(\u5982 NVLink\u3001block\u3001spine)\u7684\u4e25\u91cd\u5f71\u54cd\u3002"),(0,a.kt)("p",null,"\u4e3a\u4e86\u4f18\u5316\u8bad\u7ec3\u6548\u7387,Koordinator \u63d0\u4f9b\u4e86",(0,a.kt)("strong",{parentName:"p"},"\u7f51\u7edc\u62d3\u6251\u611f\u77e5\u8c03\u5ea6"),"\u80fd\u529b,\u8be5\u80fd\u529b\u786e\u4fdd:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u5f53\u96c6\u7fa4\u8d44\u6e90\u5145\u8db3\u65f6,\u5177\u6709\u7f51\u7edc\u62d3\u6251\u8c03\u5ea6\u9700\u6c42\u7684 Pod \u5c06\u6839\u636e\u7528\u6237\u6307\u5b9a\u7684\u7b56\u7565\u88ab\u8c03\u5ea6\u5230\u6027\u80fd\u66f4\u597d\u7684\u62d3\u6251\u57df(\u4f8b\u5982,\u66f4\u4f4e\u7684\u5ef6\u8fdf\u3001\u66f4\u9ad8\u7684\u5e26\u5bbd)\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u5f53\u96c6\u7fa4\u8d44\u6e90\u4e0d\u8db3\u65f6,\u8c03\u5ea6\u5668\u5c06\u57fa\u4e8e\u7f51\u7edc\u62d3\u6251\u7ea6\u675f\u901a\u8fc7\u4f5c\u4e1a\u7ea7\u62a2\u5360\u4e3a GangGroup \u62a2\u5360\u8d44\u6e90,\u5e76\u5728 ",(0,a.kt)("inlineCode",{parentName:"li"},".status.nominatedNode")," \u5b57\u6bb5\u4e2d\u8bb0\u5f55\u8d44\u6e90\u9884\u7559,\u4ee5\u786e\u4fdd\u4e00\u81f4\u7684\u653e\u7f6e\u3002")),(0,a.kt)("p",null,"\u6b64\u529f\u80fd\u4e0e ",(0,a.kt)("a",{parentName:"p",href:"https://koordinator.sh/docs/next/architecture/job/"},"PodGroup/GangGroup")," \u8bed\u4e49\u65e0\u7f1d\u534f\u4f5c\u3002"),(0,a.kt)("h2",{id:"\u524d\u7f6e\u6761\u4ef6"},"\u524d\u7f6e\u6761\u4ef6"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Kubernetes >= 1.18"),(0,a.kt)("li",{parentName:"ul"},"Koordinator >= 1.7.0")),(0,a.kt)("h2",{id:"\u9a8c\u8bc1\u7f51\u7edc\u62d3\u6251\u652f\u6301\u662f\u5426\u542f\u7528"},"\u9a8c\u8bc1\u7f51\u7edc\u62d3\u6251\u652f\u6301\u662f\u5426\u542f\u7528"),(0,a.kt)("p",null,"\u867d\u7136\u4ece Koordinator >= 1.7.0 \u5f00\u59cb,\u7f51\u7edc\u62d3\u6251\u611f\u77e5\u8c03\u5ea6",(0,a.kt)("strong",{parentName:"p"},"\u9ed8\u8ba4\u542f\u7528"),",\u4f46\u5efa\u8bae\u5728\u7ee7\u7eed\u4e4b\u524d\u786e\u8ba4\u914d\u7f6e\u3002"),(0,a.kt)("h3",{id:"\u68c0\u67e5-koord-scheduler-\u542f\u52a8\u53c2\u6570"},"\u68c0\u67e5 koord-scheduler \u542f\u52a8\u53c2\u6570"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u9a8c\u8bc1 koord-scheduler \u5df2\u542f\u7528\u7f51\u7edc\u62d3\u6251\u7ba1\u7406\u5668:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl -n koordinator-system get deployment koord-scheduler -o yaml | grep enable-network-topology-manager\n")),(0,a.kt)("p",null,"\u9884\u671f\u8f93\u51fa:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"- --enable-network-topology-manager=true\n")),(0,a.kt)("p",null,"\u5982\u679c\u53c2\u6570\u7f3a\u5931\u6216\u8bbe\u7f6e\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"false"),",\u8bf7\u66f4\u65b0 koord-scheduler \u90e8\u7f72\u4ee5\u6dfb\u52a0\u6b64\u6807\u5fd7\u3002"),(0,a.kt)("h3",{id:"\u68c0\u67e5-coscheduling-\u63d2\u4ef6\u914d\u7f6e"},"\u68c0\u67e5 Coscheduling \u63d2\u4ef6\u914d\u7f6e"),(0,a.kt)("ol",{start:2},(0,a.kt)("li",{parentName:"ol"},"\u9a8c\u8bc1 Coscheduling \u63d2\u4ef6\u5df2\u542f\u7528\u7f51\u7edc\u62d3\u6251\u611f\u77e5:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl -n koordinator-system get cm koord-scheduler-config -o yaml\n")),(0,a.kt)("p",null,"\u786e\u4fdd Coscheduling \u63d2\u4ef6\u914d\u7f6e\u5305\u542b ",(0,a.kt)("inlineCode",{parentName:"p"},"awareNetworkTopology: true"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: koord-scheduler-config\n  namespace: koordinator-system\ndata:\n  koord-scheduler-config: |\n    apiVersion: kubescheduler.config.k8s.io/v1\n    kind: KubeSchedulerConfiguration\n    profiles:\n    - pluginConfig:\n      - name: Coscheduling\n        args:\n          apiVersion: kubescheduler.config.k8s.io/v1\n          kind: CoschedulingArgs\n          awareNetworkTopology: true\n          enablePreemption: true\n")),(0,a.kt)("p",null,"\u5982\u679c ",(0,a.kt)("inlineCode",{parentName:"p"},"awareNetworkTopology")," \u7f3a\u5931\u6216\u8bbe\u7f6e\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"false"),",\u8bf7\u66f4\u65b0 ConfigMap \u5e76\u91cd\u542f koord-scheduler Pod:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl delete po -l koord-app=koord-scheduler -n koordinator-system \n")),(0,a.kt)("h2",{id:"\u914d\u7f6e\u7f51\u7edc\u62d3\u6251"},"\u914d\u7f6e\u7f51\u7edc\u62d3\u6251"),(0,a.kt)("h3",{id:"\u4e3a\u8282\u70b9\u6dfb\u52a0\u62d3\u6251\u4fe1\u606f\u6807\u7b7e"},"\u4e3a\u8282\u70b9\u6dfb\u52a0\u62d3\u6251\u4fe1\u606f\u6807\u7b7e"),(0,a.kt)("p",null,"\u9996\u5148,\u4f7f\u7528 NVIDIA \u7684 ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/NVIDIA/topograph/blob/main/docs/k8s.md"},"topograph")," \u7b49\u5de5\u5177\u4e3a\u8282\u70b9\u6807\u8bb0\u5176\u7f51\u7edc\u62d3\u6251\u4f4d\u7f6e:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: v1\nkind: Node\nmetadata:\n  name: node-0\n  labels:\n    network.topology.nvidia.com/block: b1\n    network.topology.nvidia.com/spine: s1\n")),(0,a.kt)("h3",{id:"\u521b\u5efa-clusternetworktopology"},"\u521b\u5efa ClusterNetworkTopology"),(0,a.kt)("p",null,"\u7ba1\u7406\u5458\u901a\u8fc7\u540d\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"default")," \u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"ClusterNetworkTopology")," CR \u5b9a\u4e49\u62d3\u6251\u5c42\u6b21\u7ed3\u6784:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: scheduling.koordinator.sh/v1alpha1\nkind: ClusterNetworkTopology\nmetadata:\n  name: default\nspec:\n  networkTopologySpec:\n    - labelKey:\n      - network.topology.nvidia.com/spine\n      topologyLayer: SpineLayer\n    - labelKey:\n      - network.topology.nvidia.com/block\n      parentTopologyLayer: SpineLayer\n      topologyLayer: BlockLayer\n    - parentTopologyLayer: BlockLayer\n      topologyLayer: NodeTopologyLayer\n")),(0,a.kt)("p",null,"\u62d3\u6251\u5f62\u6210\u6811\u72b6\u7ed3\u6784,\u5176\u4e2d\u6bcf\u4e00\u5c42\u4ee3\u8868\u7f51\u7edc\u4e2d\u7684\u805a\u5408\u7ea7\u522b(\u4f8b\u5982,Node \u2192 Block \u2192 Spine)\u3002"),(0,a.kt)("h3",{id:"\u9a8c\u8bc1\u62d3\u6251\u914d\u7f6e"},"\u9a8c\u8bc1\u62d3\u6251\u914d\u7f6e"),(0,a.kt)("p",null,"\u5e94\u7528 ClusterNetworkTopology \u540e,\u68c0\u67e5\u5176\u72b6\u6001:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get clusternetworktopology default -o yaml\n")),(0,a.kt)("p",null,"\u793a\u4f8b\u8f93\u51fa:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'status:\n  detailStatus:\n  - childTopologyLayer: SpineLayer\n    childTopologyNames:\n    - spine-0\n    - spine-1\n    - spine-2\n    nodeNum: 12\n    topologyInfo:\n      topologyLayer: ClusterTopologyLayer\n      topologyName: ""\n  - childTopologyLayer: BlockLayer\n    childTopologyNames:\n    - block-0\n    - block-1\n    nodeNum: 5\n    parentTopologyInfo:\n      topologyLayer: ClusterTopologyLayer\n      topologyName: ""\n    topologyInfo:\n      topologyLayer: SpineLayer\n      topologyName: spine-0\n  - childTopologyLayer: NodeTopologyLayer\n    nodeNum: 3\n    parentTopologyInfo:\n      topologyLayer: SpineLayer\n      topologyName: spine-0\n    topologyInfo:\n      topologyLayer: BlockLayer\n      topologyName: block-0\n  - childTopologyLayer: NodeTopologyLayer\n    nodeNum: 2\n    parentTopologyInfo:\n      topologyLayer: SpineLayer\n      topologyName: spine-0\n    topologyInfo:\n      topologyLayer: BlockLayer\n      topologyName: block-1\n  - childTopologyLayer: BlockLayer\n    childTopologyNames:\n    - block-2\n    - block-3\n    nodeNum: 4\n    parentTopologyInfo:\n      topologyLayer: ClusterTopologyLayer\n      topologyName: ""\n    topologyInfo:\n      topologyLayer: SpineLayer\n      topologyName: spine-1\n  - childTopologyLayer: NodeTopologyLayer\n    nodeNum: 2\n    parentTopologyInfo:\n      topologyLayer: SpineLayer\n      topologyName: spine-1\n    topologyInfo:\n      topologyLayer: BlockLayer\n      topologyName: block-2\n  - childTopologyLayer: NodeTopologyLayer\n    nodeNum: 2\n    parentTopologyInfo:\n      topologyLayer: SpineLayer\n      topologyName: spine-1\n    topologyInfo:\n      topologyLayer: BlockLayer\n      topologyName: block-3\n  - childTopologyLayer: BlockLayer\n    childTopologyNames:\n    - block-4\n    nodeNum: 3\n    parentTopologyInfo:\n      topologyLayer: ClusterTopologyLayer\n      topologyName: ""\n    topologyInfo:\n      topologyLayer: SpineLayer\n      topologyName: spine-2\n  - childTopologyLayer: NodeTopologyLayer\n    nodeNum: 3\n    parentTopologyInfo:\n      topologyLayer: SpineLayer\n      topologyName: spine-2\n    topologyInfo:\n      topologyLayer: BlockLayer\n      topologyName: block-4\n')),(0,a.kt)("p",null,"\u57fa\u4e8e\u4e0a\u8ff0 ",(0,a.kt)("inlineCode",{parentName:"p"},"status"),",\u96c6\u7fa4\u5177\u6709\u4e24\u5c42 ",(0,a.kt)("strong",{parentName:"p"},"spine-block")," \u67b6\u6784:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"ClusterTopologyLayer\n\u251c\u2500\u2500 SpineLayer: spine-0\n\u2502   \u251c\u2500\u2500 BlockLayer: block-0\n\u2502   \u2502   \u2514\u2500\u2500 NodeTopologyLayer: 3 nodes\n\u2502   \u2514\u2500\u2500 BlockLayer: block-1\n\u2502       \u2514\u2500\u2500 NodeTopologyLayer: 2 nodes\n\u2502\n\u251c\u2500\u2500 SpineLayer: spine-1\n\u2502   \u251c\u2500\u2500 BlockLayer: block-2\n\u2502   \u2502   \u2514\u2500\u2500 NodeTopologyLayer: 2 nodes\n\u2502   \u2514\u2500\u2500 BlockLayer: block-3\n\u2502       \u2514\u2500\u2500 NodeTopologyLayer: 2 nodes\n\u2502\n\u2514\u2500\u2500 SpineLayer: spine-2\n    \u2514\u2500\u2500 BlockLayer: block-4\n        \u2514\u2500\u2500 NodeTopologyLayer: 3 nodes\n")),(0,a.kt)("p",null,"\u6211\u4eec\u53ef\u80fd\u5df2\u7ecf\u6ce8\u610f\u5230,\u6b64\u7f51\u7edc\u62d3\u6251\u67b6\u6784\u4e0e",(0,a.kt)("a",{parentName:"p",href:"https://koordinator.sh/docs/next/architecture/job#topology-gather-algorithm"},"\u7f51\u7edc\u62d3\u6251\u7b97\u6cd5\u6f14\u793a"),"\u4e2d\u4f7f\u7528\u7684\u67b6\u6784\u4e00\u81f4\u3002"),(0,a.kt)("h2",{id:"\u4f7f\u7528\u793a\u4f8b"},"\u4f7f\u7528\u793a\u4f8b"),(0,a.kt)("h3",{id:"\u73af\u5883\u8bbe\u7f6e"},"\u73af\u5883\u8bbe\u7f6e"),(0,a.kt)("p",null,"\u4e3a\u4e86\u6f14\u793a\u7f51\u7edc\u62d3\u6251\u611f\u77e5\u8c03\u5ea6,\u6211\u4eec\u5047\u8bbe\u96c6\u7fa4\u5177\u6709",(0,a.kt)("a",{parentName:"p",href:"#%E9%AA%8C%E8%AF%81%E6%8B%93%E6%89%91%E9%85%8D%E7%BD%AE"},"\u9a8c\u8bc1\u62d3\u6251\u914d\u7f6e"),"\u90e8\u5206\u6240\u793a\u7684\u62d3\u6251\u914d\u7f6e:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u603b\u5171 12 \u4e2a\u5de5\u4f5c\u8282\u70b9(node-0 \u5230 node-11)"),(0,a.kt)("li",{parentName:"ul"},"3 \u4e2a Spine:",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"spine-0: 5 \u4e2a\u8282\u70b9(block-0 \u6709 3 \u4e2a\u8282\u70b9:node-0\u3001node-1\u3001node-2;block-1 \u6709 2 \u4e2a\u8282\u70b9:node-3\u3001node-4)"),(0,a.kt)("li",{parentName:"ul"},"spine-1: 4 \u4e2a\u8282\u70b9(block-2 \u6709 2 \u4e2a\u8282\u70b9:node-5\u3001node-6;block-3 \u6709 2 \u4e2a\u8282\u70b9:node-7\u3001node-8)"),(0,a.kt)("li",{parentName:"ul"},"spine-2: 3 \u4e2a\u8282\u70b9(block-4 \u6709 3 \u4e2a\u8282\u70b9:node-9\u3001node-10\u3001node-11)"))),(0,a.kt)("li",{parentName:"ul"},"\u6bcf\u4e2a\u8282\u70b9\u914d\u7f6e: 8 \u4e2a CPU \u6838\u5fc3,32 GiB \u5185\u5b58")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"ClusterTopologyLayer\n\u251c\u2500\u2500 SpineLayer: spine-0 (5 nodes)\n\u2502   \u251c\u2500\u2500 BlockLayer: block-0 (node-0, node-1, node-2)\n\u2502   \u2514\u2500\u2500 BlockLayer: block-1 (node-3, node-4)\n\u251c\u2500\u2500 SpineLayer: spine-1 (4 nodes)\n\u2502   \u251c\u2500\u2500 BlockLayer: block-2 (node-5, node-6)\n\u2502   \u2514\u2500\u2500 BlockLayer: block-3 (node-7, node-8)\n\u2514\u2500\u2500 SpineLayer: spine-2 (3 nodes)\n    \u2514\u2500\u2500 BlockLayer: block-4 (node-9, node-10, node-11)\n")),(0,a.kt)("p",null,"\u6211\u4eec\u7684\u6f14\u793a\u5c06\u5305\u62ec:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"\u793a\u4f8b 1"),": \u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"li"},"PreferGather")," \u7b56\u7565\u548c Binpack \u7b97\u6cd5\u7684\u62d3\u6251\u611f\u77e5\u8c03\u5ea6"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"\u793a\u4f8b 2"),": \u5f53\u7ea6\u675f\u65e0\u6cd5\u6ee1\u8db3\u65f6\u7684 ",(0,a.kt)("inlineCode",{parentName:"li"},"MustGather")," \u8c03\u5ea6\u548c\u62d3\u6251\u611f\u77e5\u62a2\u5360")),(0,a.kt)("h3",{id:"\u793a\u4f8b-1-\u4f7f\u7528-prefergather-\u548c-binpack-\u7684\u62d3\u6251\u611f\u77e5\u8c03\u5ea6"},"\u793a\u4f8b 1: \u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"h3"},"PreferGather")," \u548c Binpack \u7684\u62d3\u6251\u611f\u77e5\u8c03\u5ea6"),(0,a.kt)("p",null,"\u6b64\u793a\u4f8b\u6f14\u793a\u4e86 Koordinator \u5982\u4f55\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"PreferGather")," \u7b56\u7565\u8c03\u5ea6 Pod,\u4ee5\u5b9e\u73b0",(0,a.kt)("strong",{parentName:"p"},"\u6700\u4f18\u7f51\u7edc\u6027\u80fd"),"\u548c",(0,a.kt)("strong",{parentName:"p"},"\u6700\u5c0f\u8d44\u6e90\u6d6a\u8d39"),"\u3002",(0,a.kt)("inlineCode",{parentName:"p"},"PreferGather")," \u7b56\u7565\u786e\u4fdd Pod \u805a\u96c6\u5728\u540c\u4e00\u62d3\u6251\u57df\u5185\u4ee5\u83b7\u5f97\u66f4\u597d\u7684\u7f51\u7edc\u5c40\u90e8\u6027,\u800c Binpack \u7b97\u6cd5\u9009\u62e9\u6700\u7d27\u51d1\u7684\u57df\u4ee5\u6700\u5c0f\u5316\u8d44\u6e90\u788e\u7247\u3002"),(0,a.kt)("h4",{id:"\u573a\u666f"},"\u573a\u666f"),(0,a.kt)("p",null,"\u6211\u4eec\u5c06\u5728\u6240\u6709 12 \u4e2a\u8282\u70b9\u7a7a\u95f2\u65f6\u521b\u5efa\u4e00\u4e2a 4 Pod \u8bad\u7ec3\u4f5c\u4e1a:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u6bcf\u4e2a Pod \u9700\u8981 ",(0,a.kt)("strong",{parentName:"li"},"8 \u4e2a CPU \u6838\u5fc3"),"(\u5360\u7528\u6574\u4e2a\u8282\u70b9)"),(0,a.kt)("li",{parentName:"ul"},"\u603b\u9700\u6c42: 4 \u4e2a Pod = 4 \u4e2a\u8282\u70b9"),(0,a.kt)("li",{parentName:"ul"},"\u8c03\u5ea6\u5668\u5e94\u9009\u62e9\u63d0\u4f9b\u4ee5\u4e0b\u5185\u5bb9\u7684\u6700\u7d27\u51d1\u62d3\u6251\u57df:",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"\u6700\u4f73\u7f51\u7edc\u6027\u80fd"),": Pod \u805a\u96c6\u5728\u540c\u4e00 Spine \u4e2d\u4ee5\u83b7\u5f97\u66f4\u4f4e\u7684\u5ef6\u8fdf\u548c\u66f4\u9ad8\u7684\u5e26\u5bbd"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"\u6700\u5c11\u8d44\u6e90\u6d6a\u8d39"),": \u80fd\u591f\u5bb9\u7eb3\u6240\u6709 Pod \u7684\u6700\u5c0f\u62d3\u6251\u57df")))),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),": Pod \u8c03\u5ea6\u5230 ",(0,a.kt)("strong",{parentName:"p"},"spine-1"),"(node-5 \u5230 node-8),\u8fd9\u662f\u6700\u4f18\u9009\u62e9,\u56e0\u4e3a:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u5b83\u6070\u597d\u6709 4 \u4e2a\u8282\u70b9(\u5b8c\u7f8e\u5339\u914d,\u96f6\u6d6a\u8d39)"),(0,a.kt)("li",{parentName:"ul"},"\u6240\u6709 Pod \u90fd\u5728\u540c\u4e00 Spine \u4e2d\u4ee5\u83b7\u5f97\u6700\u4f73\u7f51\u7edc\u6027\u80fd"),(0,a.kt)("li",{parentName:"ul"},"\u5176\u4ed6 Spine \u4e2d\u6ca1\u6709\u8d44\u6e90\u788e\u7247")),(0,a.kt)("h4",{id:"\u6b65\u9aa4-1-\u521b\u5efa\u5177\u6709-prefergather-\u7b56\u7565\u7684-podgroup"},"\u6b65\u9aa4 1: \u521b\u5efa\u5177\u6709 ",(0,a.kt)("inlineCode",{parentName:"h4"},"PreferGather")," \u7b56\u7565\u7684 PodGroup"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: scheduling.sigs.k8s.io/v1alpha1\nkind: PodGroup\nmetadata:\n  name: topology-demo-job\n  namespace: default\n  annotations:\n    gang.scheduling.koordinator.sh/network-topology-spec: |\n      {\n        "gatherStrategy": [\n          {\n            "layer": "BlockLayer",\n            "strategy": "PreferGather"\n          },\n          {\n            "layer": "SpineLayer",\n            "strategy": "PreferGather"\n          }\n        ]\n      }\nspec:\n  minMember: 4\n  scheduleTimeoutSeconds: 300\n')),(0,a.kt)("h4",{id:"\u6b65\u9aa4-2-\u521b\u5efa-4-pod-\u8bad\u7ec3\u4f5c\u4e1a"},"\u6b65\u9aa4 2: \u521b\u5efa 4 Pod \u8bad\u7ec3\u4f5c\u4e1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: v1\nkind: Pod\nmetadata:\n  name: training-pod-0\n  namespace: default\n  labels:\n    pod-group.scheduling.sigs.k8s.io: topology-demo-job\n  annotations:\n    gang.scheduling.koordinator.sh/network-topology-index: "0"\nspec:\n  schedulerName: koord-scheduler\n  containers:\n  - name: curlimage\n    image: busybox\n    imagePullPolicy: IfNotPresent\n    command:\n    - sleep\n    - 365d\n    resources:\n      requests:\n        cpu: 8\n        memory: 32Gi\n      limits:\n        cpu: 8\n        memory: 32Gi\n    terminationMessagePath: /dev/termination-log\n    terminationMessagePolicy: File\n  restartPolicy: Always\n---\napiVersion: v1\nkind: Pod\nmetadata:\n  name: training-pod-1\n  namespace: default\n  labels:\n    pod-group.scheduling.sigs.k8s.io: topology-demo-job\n  annotations:\n    gang.scheduling.koordinator.sh/network-topology-index: "1"\nspec:\n  schedulerName: koord-scheduler\n  containers:\n  - name: curlimage\n    image: busybox\n    imagePullPolicy: IfNotPresent\n    command:\n    - sleep\n    - 365d\n    resources:\n      requests:\n        cpu: 8\n        memory: 32Gi\n      limits:\n        cpu: 8\n        memory: 32Gi\n    terminationMessagePath: /dev/termination-log\n    terminationMessagePolicy: File\n  restartPolicy: Always\n---\napiVersion: v1\nkind: Pod\nmetadata:\n  name: training-pod-2\n  namespace: default\n  labels:\n    pod-group.scheduling.sigs.k8s.io: topology-demo-job\n  annotations:\n    gang.scheduling.koordinator.sh/network-topology-index: "2"\nspec:\n  schedulerName: koord-scheduler\n  containers:\n  - name: curlimage\n    image: busybox\n    imagePullPolicy: IfNotPresent\n    command:\n    - sleep\n    - 365d\n    resources:\n      requests:\n        cpu: 8\n        memory: 32Gi\n      limits:\n        cpu: 8\n        memory: 32Gi\n    terminationMessagePath: /dev/termination-log\n    terminationMessagePolicy: File\n  restartPolicy: Always\n---\napiVersion: v1\nkind: Pod\nmetadata:\n  name: training-pod-3\n  namespace: default\n  labels:\n    pod-group.scheduling.sigs.k8s.io: topology-demo-job\n  annotations:\n    gang.scheduling.koordinator.sh/network-topology-index: "3"\nspec:\n  schedulerName: koord-scheduler\n  containers:\n  - name: curlimage\n    image: busybox\n    imagePullPolicy: IfNotPresent\n    command:\n    - sleep\n    - 365d\n    resources:\n      requests:\n        cpu: 8\n        memory: 32Gi\n      limits:\n        cpu: 8\n        memory: 32Gi\n    terminationMessagePath: /dev/termination-log\n    terminationMessagePolicy: File\n  restartPolicy: Always\n')),(0,a.kt)("h4",{id:"\u6b65\u9aa4-3-\u5e94\u7528\u5e76\u9a8c\u8bc1\u8c03\u5ea6\u7ed3\u679c"},"\u6b65\u9aa4 3: \u5e94\u7528\u5e76\u9a8c\u8bc1\u8c03\u5ea6\u7ed3\u679c"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl apply -f topology-demo-job.yaml\n")),(0,a.kt)("p",null,"\u51e0\u79d2\u949f\u540e,\u68c0\u67e5 Pod \u8c03\u5ea6\u7ed3\u679c:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get pods -o wide | grep training-pod\n")),(0,a.kt)("p",null,"\u9884\u671f\u8f93\u51fa:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"NAME            READY   STATUS    RESTARTS   AGE   IP            NODE      NOMINATED NODE\ntraining-pod-0  1/1     Running   0          30s   10.244.5.10   node-5    <none>\ntraining-pod-1  1/1     Running   0          30s   10.244.6.11   node-6    <none>\ntraining-pod-2  1/1     Running   0          30s   10.244.7.10   node-7    <none>\ntraining-pod-3  1/1     Running   0          30s   10.244.8.11   node-8    <none>\n")),(0,a.kt)("h4",{id:"binpack-\u7b97\u6cd5\u5982\u4f55\u5de5\u4f5c"},"Binpack \u7b97\u6cd5\u5982\u4f55\u5de5\u4f5c"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u6b65\u9aa4 1: \u81ea\u4e0b\u800c\u4e0a\u8ba1\u7b97 offerslots")),(0,a.kt)("p",null,"\u5bf9\u4e8e\u6bcf\u4e2a\u8282\u70b9(\u6bcf\u4e2a Pod \u9700\u8981 8 \u4e2a CPU \u6838\u5fc3\u4ee5\u5360\u7528\u6574\u4e2a\u8282\u70b9):"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u6240\u6709\u8282\u70b9(node-0 \u5230 node-11): offerslots = 1 (8 \u4e2a\u53ef\u7528\u6838\u5fc3 / \u6bcf\u4e2a Pod 8 \u4e2a\u6838\u5fc3)")),(0,a.kt)("p",null,"\u5bf9\u4e8e\u6bcf\u4e2a Block:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"block-0 (node-0, node-1, node-2): offerslots = 3"),(0,a.kt)("li",{parentName:"ul"},"block-1 (node-3, node-4): offerslots = 2"),(0,a.kt)("li",{parentName:"ul"},"block-2 (node-5, node-6): offerslots = 2"),(0,a.kt)("li",{parentName:"ul"},"block-3 (node-7, node-8): offerslots = 2"),(0,a.kt)("li",{parentName:"ul"},"block-4 (node-9, node-10, node-11): offerslots = 3")),(0,a.kt)("p",null,"\u5bf9\u4e8e\u6bcf\u4e2a Spine:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"spine-0 (block-0, block-1): offerslots = 5"),(0,a.kt)("li",{parentName:"ul"},"spine-1 (block-2, block-3): offerslots = 4"),(0,a.kt)("li",{parentName:"ul"},"spine-2 (block-4): offerslots = 3")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u6b65\u9aa4 2: \u67e5\u627e\u5019\u9009\u62d3\u6251\u8282\u70b9")),(0,a.kt)("p",null,"\u6211\u4eec\u9700\u8981 4 \u4e2a Pod(4 \u4e2a offerslots)\u3002\u53ea\u6709 spine-0(5 \u4e2a\u69fd\u4f4d)\u548c spine-1(4 \u4e2a\u69fd\u4f4d)\u53ef\u4ee5\u5bb9\u7eb3\u8be5\u4f5c\u4e1a\u3002"),(0,a.kt)("p",null,"\u5728 Block \u7ea7\u522b,\u6ca1\u6709\u5355\u4e2a block \u53ef\u4ee5\u5bb9\u7eb3\u6240\u6709 4 \u4e2a Pod,\u56e0\u6b64\u5019\u9009\u8005\u5728 Spine \u7ea7\u522b\u3002"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u6b65\u9aa4 3: \u5e94\u7528 Binpack \u7b97\u6cd5")),(0,a.kt)("p",null,"\u5728\u5019\u9009 Spine \u4e2d:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"spine-0: offerslots = 5, \u9700\u8981 = 4, \u6d6a\u8d39 = 1"),(0,a.kt)("li",{parentName:"ul"},"spine-1: offerslots = 4, \u9700\u8981 = 4, \u6d6a\u8d39 = 0  \u2190 ",(0,a.kt)("strong",{parentName:"li"},"\u88ab\u9009\u4e2d(\u6700\u5c0f\u6d6a\u8d39)"))),(0,a.kt)("p",null,"Binpack \u7b97\u6cd5\u9009\u62e9 ",(0,a.kt)("strong",{parentName:"p"},"spine-1"),"(node-5 \u5230 node-8),\u653e\u7f6e\u6240\u6709 4 \u4e2a Pod \u540e\u96f6\u6d6a\u8d39\u3002"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u6700\u7ec8\u653e\u7f6e"),": \u6240\u6709 4 \u4e2a Pod \u90fd\u8c03\u5ea6\u5230 ",(0,a.kt)("strong",{parentName:"p"},"spine-1"),"(node-5\u3001node-6\u3001node-7\u3001node-8),\u5b9e\u73b0\u4e86:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"\u6700\u4f18\u7f51\u7edc\u6027\u80fd(",(0,a.kt)("inlineCode",{parentName:"strong"},"PreferGather")," \u6548\u679c)"),": \u6240\u6709 Pod \u90fd\u805a\u96c6\u5728\u540c\u4e00 Spine(spine-1)\u5185,\u6700\u5c0f\u5316\u8de8 Spine \u6d41\u91cf\u5e76\u6700\u5927\u5316 Pod \u95f4\u901a\u4fe1\u7684\u7f51\u7edc\u5e26\u5bbd"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"\u6700\u5c0f\u8d44\u6e90\u6d6a\u8d39(Binpack \u6548\u679c)"),": spine-1 \u6070\u597d\u6709 4 \u4e2a\u69fd\u4f4d\u4f9b 4 \u4e2a Pod \u4f7f\u7528(\u96f6\u6d6a\u8d39),\u800c spine-0 \u4f1a\u6709 1 \u4e2a\u69fd\u4f4d\u6d6a\u8d39\u3002\u8fd9\u4f7f\u5f97 spine-0 \u7684\u6240\u6709 5 \u4e2a\u8282\u70b9\u90fd\u53ef\u7528\u4e8e\u672a\u6765\u7684\u5de5\u4f5c\u8d1f\u8f7d,\u9632\u6b62\u8d44\u6e90\u788e\u7247")),(0,a.kt)("h3",{id:"\u793a\u4f8b-2-mustgather-\u548c\u62d3\u6251\u611f\u77e5\u62a2\u5360"},"\u793a\u4f8b 2: ",(0,a.kt)("inlineCode",{parentName:"h3"},"MustGather")," \u548c\u62d3\u6251\u611f\u77e5\u62a2\u5360"),(0,a.kt)("p",null,"\u6b64\u793a\u4f8b\u6f14\u793a\u4e86\u4e3a\u4ec0\u4e48\u67d0\u4e9b\u5de5\u4f5c\u8d1f\u8f7d\u9700\u8981 ",(0,a.kt)("inlineCode",{parentName:"p"},"MustGather")," \u4ee5\u53ca\u62a2\u5360\u5982\u4f55\u9075\u5faa\u7f51\u7edc\u62d3\u6251\u7ea6\u675f\u3002"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4e3a\u4ec0\u4e48\u9700\u8981 ",(0,a.kt)("inlineCode",{parentName:"strong"},"MustGather")),": \u5728\u5ef6\u8fdf\u654f\u611f\u7684\u5206\u5e03\u5f0f\u8bad\u7ec3\u573a\u666f\u4e2d,\u7f51\u7edc\u901a\u4fe1\u6a21\u5f0f\u5bf9\u5ef6\u8fdf\u6781\u5176\u654f\u611f\u3002\u5982\u679c Pod \u5206\u6563\u5728\u4e0d\u540c\u7684 Spine \u4e0a,\u8de8 Spine \u901a\u4fe1\u5f00\u9500\u4f1a\u4f7f\u8bad\u7ec3\u65f6\u95f4\u589e\u52a0 3-5 \u500d,\u4f7f\u4f5c\u4e1a\u5728\u7ecf\u6d4e\u4e0a\u4e0d\u53ef\u884c\u3002\u56e0\u6b64,",(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("inlineCode",{parentName:"strong"},"MustGather")," \u4e0d\u4ec5\u4ec5\u662f\u4f18\u5316\u2014\u2014\u5b83\u662f\u8fd9\u4e9b\u5de5\u4f5c\u8d1f\u8f7d\u7684\u786c\u6027\u8981\u6c42"),"\u3002"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u62a2\u5360\u5982\u4f55\u9075\u5faa\u62d3\u6251"),": \u5f53\u7531\u4e8e\u8d44\u6e90\u4e0d\u8db3\u800c\u65e0\u6cd5\u6ee1\u8db3 ",(0,a.kt)("inlineCode",{parentName:"p"},"MustGather")," \u7ea6\u675f\u65f6,Koordinator \u6267\u884c",(0,a.kt)("strong",{parentName:"p"},"\u62d3\u6251\u611f\u77e5\u62a2\u5360"),"\u3002\u8fd9\u610f\u5473\u7740:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u8c03\u5ea6\u5668\u8bc6\u522b\u9700\u8981\u62a2\u5360\u54ea\u4e9b\u4f4e\u4f18\u5148\u7ea7 Pod"),(0,a.kt)("li",{parentName:"ol"},"\u62a2\u5360\u51b3\u7b56\u9075\u5faa\u4e0e\u8c03\u5ea6\u76f8\u540c\u7684\u62d3\u6251\u7ea6\u675f"),(0,a.kt)("li",{parentName:"ol"},"\u8c03\u5ea6\u5668\u786e\u4fdd\u91ca\u653e\u7684\u8d44\u6e90\u53ef\u4ee5\u6ee1\u8db3 ",(0,a.kt)("inlineCode",{parentName:"li"},"MustGather")," \u8981\u6c42"),(0,a.kt)("li",{parentName:"ol"},"\u901a\u8fc7 ",(0,a.kt)("inlineCode",{parentName:"li"},"nominatedNode")," \u9884\u7559\u8d44\u6e90\u4ee5\u9632\u6b62\u5176\u4ed6 Pod \u7a83\u53d6\u5b83\u4eec")),(0,a.kt)("h4",{id:"\u573a\u666f-1"},"\u573a\u666f"),(0,a.kt)("p",null,"\u6b64\u793a\u4f8b\u5c55\u793a\u4e86\u4ee5\u4e0b\u573a\u666f:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u4f4e\u4f18\u5148\u7ea7 Pod \u5360\u7528 node-0\u3001node-1 \u548c node-5(\u6bcf\u4e2a Pod \u5360\u7528\u6574\u4e2a\u8282\u70b9)"),(0,a.kt)("li",{parentName:"ol"},"\u63d0\u4ea4\u4e00\u4e2a\u5177\u6709 ",(0,a.kt)("inlineCode",{parentName:"li"},"MustGather")," \u5230 SpineLayer \u7684\u9ad8\u4f18\u5148\u7ea7 4 Pod \u4f5c\u4e1a(\u6bcf\u4e2a Pod \u5360\u7528\u6574\u4e2a\u8282\u70b9)"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"\u6ca1\u6709\u5355\u4e2a Spine \u5728\u4e0d\u62a2\u5360\u7684\u60c5\u51b5\u4e0b\u62e5\u6709 4 \u4e2a\u53ef\u7528\u8282\u70b9")),(0,a.kt)("li",{parentName:"ol"},"Koordinator \u6267\u884c\u62d3\u6251\u611f\u77e5\u62a2\u5360:\u62a2\u5360 node-5 \u4e0a\u7684 Pod \u5e76\u5c06\u6240\u6709 4 \u4e2a\u9ad8\u4f18\u5148\u7ea7 Pod \u8c03\u5ea6\u5230 node-5 \u5230 node-8(\u5728 spine-1 \u5185),",(0,a.kt)("strong",{parentName:"li"},"\u5728\u6574\u4e2a\u62a2\u5360\u8fc7\u7a0b\u4e2d\u7ef4\u62a4 ",(0,a.kt)("inlineCode",{parentName:"strong"},"MustGather")," \u7ea6\u675f"))),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"3 \u4e2a\u4f4e\u4f18\u5148\u7ea7 Pod \u5df2\u5728 node-0\u3001node-1 \u548c node-5 \u4e0a\u8fd0\u884c(\u6bcf\u4e2a\u5360\u7528 8 \u6838\u5fc3\u7684\u6574\u4e2a\u8282\u70b9)"),(0,a.kt)("li",{parentName:"ul"},"\u4e00\u4e2a\u5177\u6709\u4e25\u683c\u7f51\u7edc\u8981\u6c42\u7684\u9ad8\u4f18\u5148\u7ea7 4 Pod \u8bad\u7ec3\u4f5c\u4e1a:",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"\u9700\u8981 ",(0,a.kt)("inlineCode",{parentName:"strong"},"MustGather"))," \u5230 SpineLayer:\u8de8 Spine \u5ef6\u8fdf\u4f1a\u4f7f\u6027\u80fd\u964d\u4f4e 3-5 \u500d"),(0,a.kt)("li",{parentName:"ul"},"\u6bcf\u4e2a Pod \u9700\u8981 ",(0,a.kt)("strong",{parentName:"li"},"8 \u4e2a CPU \u6838\u5fc3"),"(\u5360\u7528\u6574\u4e2a\u8282\u70b9)"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"\u5f53\u524d\u72b6\u6001"),": \u6ca1\u6709\u5355\u4e2a Spine \u62e5\u6709 4 \u4e2a\u53ef\u7528\u8282\u70b9",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"spine-0: 3 \u4e2a\u53ef\u7528\u8282\u70b9(node-2\u3001node-3\u3001node-4) - node-0\u3001node-1 \u88ab\u5360\u7528"),(0,a.kt)("li",{parentName:"ul"},"spine-1: 3 \u4e2a\u53ef\u7528\u8282\u70b9(node-6\u3001node-7\u3001node-8) - node-5 \u88ab\u5360\u7528"),(0,a.kt)("li",{parentName:"ul"},"spine-2: 3 \u4e2a\u53ef\u7528\u8282\u70b9(node-9\u3001node-10\u3001node-11)")))),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),": \u8c03\u5ea6\u5668\u6267\u884c",(0,a.kt)("strong",{parentName:"p"},"\u62d3\u6251\u611f\u77e5\u62a2\u5360"),",\u62a2\u5360 node-5 \u4e0a\u7684\u4f4e\u4f18\u5148\u7ea7 Pod \u4ee5\u6ee1\u8db3 ",(0,a.kt)("inlineCode",{parentName:"p"},"MustGather")," \u7ea6\u675f,\u5e76\u5c06\u6240\u6709 4 \u4e2a\u9ad8\u4f18\u5148\u7ea7 Pod \u8c03\u5ea6\u5230 ",(0,a.kt)("strong",{parentName:"p"},"spine-1"),"(node-5 \u5230 node-8)\u3002"),(0,a.kt)("h4",{id:"\u6b65\u9aa4-1-\u5b9a\u4e49-priorityclass"},"\u6b65\u9aa4 1: \u5b9a\u4e49 PriorityClass"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: scheduling.k8s.io/v1\nkind: PriorityClass\nmetadata:\n  name: high-priority\nvalue: 1000000\npreemptionPolicy: PreemptLowerPriority\ndescription: "High priority for critical training jobs"\n---\napiVersion: scheduling.k8s.io/v1\nkind: PriorityClass\nmetadata:\n  name: low-priority\nvalue: 1000\npreemptionPolicy: PreemptLowerPriority\ndescription: "Low priority for best-effort jobs"\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl apply -f priorityclasses.yaml\n")),(0,a.kt)("h4",{id:"\u6b65\u9aa4-2-\u5728-node-0node-1-\u548c-node-5-\u4e0a\u521b\u5efa\u4f4e\u4f18\u5148\u7ea7-pod"},"\u6b65\u9aa4 2: \u5728 node-0\u3001node-1 \u548c node-5 \u4e0a\u521b\u5efa\u4f4e\u4f18\u5148\u7ea7 Pod"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: v1\nkind: Pod\nmetadata:\n  name: low-priority-pod-0\n  namespace: default\nspec:\n  schedulerName: koord-scheduler\n  priorityClassName: low-priority\n  nodeName: node-0\n  containers:\n  - name: curlimage\n    image: busybox\n    imagePullPolicy: IfNotPresent\n    command:\n    - sleep\n    - 365d\n    resources:\n      requests:\n        cpu: 8\n        memory: 32Gi\n      limits:\n        cpu: 8\n        memory: 32Gi\n    terminationMessagePath: /dev/termination-log\n    terminationMessagePolicy: File\n  restartPolicy: Always\n---\napiVersion: v1\nkind: Pod\nmetadata:\n  name: low-priority-pod-1\n  namespace: default\nspec:\n  schedulerName: koord-scheduler\n  priorityClassName: low-priority\n  nodeName: node-1\n  containers:\n  - name: curlimage\n    image: busybox\n    imagePullPolicy: IfNotPresent\n    command:\n    - sleep\n    - 365d\n    resources:\n      requests:\n        cpu: 8\n        memory: 32Gi\n      limits:\n        cpu: 8\n        memory: 32Gi\n    terminationMessagePath: /dev/termination-log\n    terminationMessagePolicy: File\n  restartPolicy: Always\n---\napiVersion: v1\nkind: Pod\nmetadata:\n  name: low-priority-pod-5\n  namespace: default\nspec:\n  schedulerName: koord-scheduler\n  priorityClassName: low-priority\n  nodeName: node-5\n  containers:\n  - name: curlimage\n    image: busybox\n    imagePullPolicy: IfNotPresent\n    command:\n    - sleep\n    - 365d\n    resources:\n      requests:\n        cpu: 8\n        memory: 32Gi\n      limits:\n        cpu: 8\n        memory: 32Gi\n    terminationMessagePath: /dev/termination-log\n    terminationMessagePolicy: File\n  restartPolicy: Always\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl apply -f low-priority-pods.yaml\n")),(0,a.kt)("p",null,"\u9a8c\u8bc1 Pod \u6b63\u5728\u8fd0\u884c:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get pods -o wide\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"NAME                  READY   STATUS    RESTARTS   AGE   IP            NODE     NOMINATED NODE\nlow-priority-pod-0    1/1     Running   0          10s   10.244.0.10   node-0   <none>\nlow-priority-pod-1    1/1     Running   0          10s   10.244.1.10   node-1   <none>\nlow-priority-pod-5    1/1     Running   0          10s   10.244.5.10   node-5   <none>\n")),(0,a.kt)("h4",{id:"\u6b65\u9aa4-3-\u521b\u5efa\u5177\u6709-mustgather-\u5230-spinelayer-\u7684\u9ad8\u4f18\u5148\u7ea7\u4f5c\u4e1a"},"\u6b65\u9aa4 3: \u521b\u5efa\u5177\u6709 ",(0,a.kt)("inlineCode",{parentName:"h4"},"MustGather")," \u5230 SpineLayer \u7684\u9ad8\u4f18\u5148\u7ea7\u4f5c\u4e1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: scheduling.sigs.k8s.io/v1alpha1\nkind: PodGroup\nmetadata:\n  name: high-priority-training\n  namespace: default\n  annotations:\n    gang.scheduling.koordinator.sh/network-topology-spec: |\n      {\n        "gatherStrategy": [\n          {\n            "layer": "SpineLayer",\n            "strategy": "MustGather"\n          }\n        ]\n      }\nspec:\n  minMember: 4\n  scheduleTimeoutSeconds: 300\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: v1\nkind: Pod\nmetadata:\n  name: hp-training-pod-0\n  namespace: default\n  labels:\n    pod-group.scheduling.sigs.k8s.io: high-priority-training\n  annotations:\n    gang.scheduling.koordinator.sh/network-topology-index: "0"\nspec:\n  schedulerName: koord-scheduler\n  priorityClassName: high-priority\n  preemptionPolicy: PreemptLowerPriority\n  containers:\n  - name: curlimage\n    image: busybox\n    imagePullPolicy: IfNotPresent\n    command:\n    - sleep\n    - 365d\n    resources:\n      requests:\n        cpu: 8\n        memory: 32Gi\n      limits:\n        cpu: 8\n        memory: 32Gi\n    terminationMessagePath: /dev/termination-log\n    terminationMessagePolicy: File\n  restartPolicy: Always\n---\napiVersion: v1\nkind: Pod\nmetadata:\n  name: hp-training-pod-1\n  namespace: default\n  labels:\n    pod-group.scheduling.sigs.k8s.io: high-priority-training\n  annotations:\n    gang.scheduling.koordinator.sh/network-topology-index: "1"\nspec:\n  schedulerName: koord-scheduler\n  priorityClassName: high-priority\n  preemptionPolicy: PreemptLowerPriority\n  containers:\n  - name: curlimage\n    image: busybox\n    imagePullPolicy: IfNotPresent\n    command:\n    - sleep\n    - 365d\n    resources:\n      requests:\n        cpu: 8\n        memory: 32Gi\n      limits:\n        cpu: 8\n        memory: 32Gi\n    terminationMessagePath: /dev/termination-log\n    terminationMessagePolicy: File\n  restartPolicy: Always\n---\napiVersion: v1\nkind: Pod\nmetadata:\n  name: hp-training-pod-2\n  namespace: default\n  labels:\n    pod-group.scheduling.sigs.k8s.io: high-priority-training\n  annotations:\n    gang.scheduling.koordinator.sh/network-topology-index: "2"\nspec:\n  schedulerName: koord-scheduler\n  priorityClassName: high-priority\n  preemptionPolicy: PreemptLowerPriority\n  containers:\n  - name: curlimage\n    image: busybox\n    imagePullPolicy: IfNotPresent\n    command:\n    - sleep\n    - 365d\n    resources:\n      requests:\n        cpu: 8\n        memory: 32Gi\n      limits:\n        cpu: 8\n        memory: 32Gi\n    terminationMessagePath: /dev/termination-log\n    terminationMessagePolicy: File\n  restartPolicy: Always\n---\napiVersion: v1\nkind: Pod\nmetadata:\n  name: hp-training-pod-3\n  namespace: default\n  labels:\n    pod-group.scheduling.sigs.k8s.io: high-priority-training\n  annotations:\n    gang.scheduling.koordinator.sh/network-topology-index: "3"\nspec:\n  schedulerName: koord-scheduler\n  priorityClassName: high-priority\n  preemptionPolicy: PreemptLowerPriority\n  containers:\n  - name: curlimage\n    image: busybox\n    imagePullPolicy: IfNotPresent\n    command:\n    - sleep\n    - 365d\n    resources:\n      requests:\n        cpu: 8\n        memory: 32Gi\n      limits:\n        cpu: 8\n        memory: 32Gi\n    terminationMessagePath: /dev/termination-log\n    terminationMessagePolicy: File\n  restartPolicy: Always\n')),(0,a.kt)("h4",{id:"\u6b65\u9aa4-4-\u5e94\u7528\u5e76\u89c2\u5bdf\u62a2\u5360"},"\u6b65\u9aa4 4: \u5e94\u7528\u5e76\u89c2\u5bdf\u62a2\u5360"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl apply -f high-priority-training.yaml\n")),(0,a.kt)("p",null,"\u63d0\u4ea4\u540e\u7acb\u5373\u68c0\u67e5 Pod \u72b6\u6001:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get pods -o wide\n")),(0,a.kt)("p",null,"\u62a2\u5360\u671f\u95f4\u7684\u9884\u671f\u8f93\u51fa:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"NAME                  READY   STATUS        RESTARTS   AGE   IP            NODE     NOMINATED NODE\nlow-priority-pod-0    1/1     Running       0          2m    10.244.0.10   node-0   <none>\nlow-priority-pod-1    1/1     Running       0          2m    10.244.1.10   node-1   <none>\nlow-priority-pod-5    0/1     Terminating   0          2m    10.244.5.10   node-5   <none>\nhp-training-pod-0     0/1     Pending       0          10s   <none>        <none>   node-5\nhp-training-pod-1     0/1     Pending       0          10s   <none>        <none>   node-6\nhp-training-pod-2     0/1     Pending       0          10s   <none>        <none>   node-7\nhp-training-pod-3     0/1     Pending       0          10s   <none>        <none>   node-8\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7406\u89e3\u62d3\u6251\u611f\u77e5\u62a2\u5360\u671f\u95f4\u7684\u8c03\u5ea6\u5668\u6d88\u606f")),(0,a.kt)("p",null,"\u5728\u62a2\u5360\u8fdb\u884c\u4e2d(\u5728\u53d7\u5bb3 Pod \u5b8c\u5168\u7ec8\u6b62\u4e4b\u524d),\u9ad8\u4f18\u5148\u7ea7 Pod \u5c06\u5904\u4e8e ",(0,a.kt)("inlineCode",{parentName:"p"},"Pending")," \u72b6\u6001\u3002\u60a8\u53ef\u4ee5\u68c0\u67e5\u8be6\u7ec6\u7684\u8c03\u5ea6\u5668\u6d88\u606f:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get pod hp-training-pod-0 -o yaml\n")),(0,a.kt)("p",null,"Pod \u72b6\u6001\u5c06\u5305\u542b\u8bf4\u660e\u4e3a\u4ec0\u4e48\u8c03\u5ea6\u6b63\u5728\u7b49\u5f85\u7684\u4fe1\u606f\u6027\u6d88\u606f:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'status:\n  conditions:\n  - lastProbeTime: null\n    lastTransitionTime: "2025-10-23T07:35:30Z"\n    message: \'0/12 nodes are available: no candidate topology nodes can accommodate\n      job, desiredOfferSlot: 4, topology topologyNode SpineLayer/spine-0: 3;topology\n      topologyNode SpineLayer/spine-1: 3;topology topologyNode SpineLayer/spine-2:\n      3. preemption: not eligible due to terminating pod on the nominated node..\'\n    reason: Unschedulable\n    status: "False"\n    type: PodScheduled\n  nominatedNodeName: node-5\n  phase: Pending\n')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u6d88\u606f\u4e2d\u7684\u5173\u952e\u4fe1\u606f:")),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"\u62d3\u6251\u7ea6\u675f\u8bc4\u4f30"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"no candidate topology nodes can accommodate job, desiredOfferSlot: 4")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u4f5c\u4e1a\u9700\u8981\u5728\u5355\u4e2a\u62d3\u6251\u57df\u5185\u6709 4 \u4e2a\u69fd\u4f4d(\u8282\u70b9)"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"\u6bcf\u4e2a Spine \u7684\u53ef\u7528\u6027"),": "),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"topology topologyNode SpineLayer/spine-0: 3")," - \u53ea\u6709 3 \u4e2a\u53ef\u7528\u8282\u70b9"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"topology topologyNode SpineLayer/spine-1: 3")," - \u53ea\u6709 3 \u4e2a\u53ef\u7528\u8282\u70b9"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"topology topologyNode SpineLayer/spine-2: 3")," - \u53ea\u6709 3 \u4e2a\u53ef\u7528\u8282\u70b9"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"\u6ca1\u6709\u4efb\u4f55 Spine \u53ef\u4ee5\u5728\u4e0d\u62a2\u5360\u7684\u60c5\u51b5\u4e0b\u6ee1\u8db3 ",(0,a.kt)("inlineCode",{parentName:"strong"},"MustGather")," \u8981\u6c42")))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"\u62a2\u5360\u72b6\u6001"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"preemption: not eligible due to terminating pod on the nominated node")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u5df2\u4e3a node-5 \u4e0a\u7684 low-priority-pod-5 \u89e6\u53d1\u62a2\u5360"),(0,a.kt)("li",{parentName:"ul"},"\u8c03\u5ea6\u5668\u6b63\u5728\u7b49\u5f85\u53d7\u5bb3 Pod \u5b8c\u5168\u7ec8\u6b62"),(0,a.kt)("li",{parentName:"ul"},"\u8d44\u6e90\u5df2\u901a\u8fc7 ",(0,a.kt)("inlineCode",{parentName:"li"},"nominatedNodeName: node-5")," \u9884\u7559"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"GangGroup \u534f\u8c03"),": \u5176\u4ed6\u6210\u5458 Pod(hp-training-pod-1\u3001hp-training-pod-2\u3001hp-training-pod-3)\u5c06\u663e\u793a\u7c7b\u4f3c\u6d88\u606f,\u8868\u660e\u5b83\u4eec\u7531\u4e8e GangGroup \u7ea6\u675f\u800c\u7b49\u5f85:"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'message: \'GangGroup "default/high-priority-training" gets rejected due to member Pod \n  "default/hp-training-pod-0" is unschedulable with reason "no candidate topology nodes \n  can accommodate job, desiredOfferSlot: 4...", alreadyWaitForBound: 0. preemption: \n  preemption already attempted by default/hp-training-pod-0 with message not eligible \n  due to terminating pod on the nominated node..\'\n')),(0,a.kt)("p",null,"\u6b64\u6d88\u606f\u786e\u8ba4:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"GangGroup \u4e2d\u7684\u6240\u6709 Pod \u4e00\u8d77\u7b49\u5f85(gang \u8c03\u5ea6\u8bed\u4e49)"),(0,a.kt)("li",{parentName:"ul"},"\u62a2\u5360\u5728\u4f5c\u4e1a\u7ea7\u522b\u534f\u8c03"),(0,a.kt)("li",{parentName:"ul"},"\u5728\u6574\u4e2a\u62a2\u5360\u8fc7\u7a0b\u4e2d\u5f3a\u5236\u6267\u884c\u62d3\u6251\u7ea6\u675f")),(0,a.kt)("h4",{id:"\u6b65\u9aa4-5-\u9a8c\u8bc1\u6700\u7ec8\u8c03\u5ea6\u7ed3\u679c"},"\u6b65\u9aa4 5: \u9a8c\u8bc1\u6700\u7ec8\u8c03\u5ea6\u7ed3\u679c"),(0,a.kt)("p",null,"\u5728 node-5 \u4e0a\u7684\u4f4e\u4f18\u5148\u7ea7 Pod \u7ec8\u6b62\u540e,\u518d\u6b21\u68c0\u67e5:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get pods -o wide\n")),(0,a.kt)("p",null,"\u9884\u671f\u7684\u6700\u7ec8\u8f93\u51fa:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"NAME                  READY   STATUS    RESTARTS   AGE   IP            NODE     NOMINATED NODE\nlow-priority-pod-0    1/1     Running   0          3m    10.244.0.10   node-0   <none>\nlow-priority-pod-1    1/1     Running   0          3m    10.244.1.10   node-1   <none>\nhp-training-pod-0     1/1     Running   0          45s   10.244.5.20   node-5   <none>\nhp-training-pod-1     1/1     Running   0          45s   10.244.6.20   node-6   <none>\nhp-training-pod-2     1/1     Running   0          45s   10.244.7.20   node-7   <none>\nhp-training-pod-3     1/1     Running   0          45s   10.244.8.20   node-8   <none>\n")),(0,a.kt)("h4",{id:"\u62d3\u6251\u611f\u77e5\u62a2\u5360\u5982\u4f55\u5de5\u4f5c"},"\u62d3\u6251\u611f\u77e5\u62a2\u5360\u5982\u4f55\u5de5\u4f5c"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u6b65\u9aa4 1: \u8bc6\u522b\u62d3\u6251\u8981\u6c42\u5e76\u9a8c\u8bc1 ",(0,a.kt)("inlineCode",{parentName:"strong"},"MustGather")," \u7ea6\u675f")),(0,a.kt)("p",null,"\u9ad8\u4f18\u5148\u7ea7\u4f5c\u4e1a\u8981\u6c42\u6240\u6709 4 \u4e2a Pod \u90fd\u5728\u540c\u4e00\u4e2a Spine \u4e2d(",(0,a.kt)("inlineCode",{parentName:"p"},"MustGather")," \u5230 SpineLayer)\u3002\u8fd9\u662f\u4e00\u4e2a",(0,a.kt)("strong",{parentName:"p"},"\u786c\u7ea6\u675f"),"\u2014\u2014\u5982\u679c\u4e0d\u6ee1\u8db3\u6b64\u8981\u6c42,\u4f5c\u4e1a\u5c06\u65e0\u6cd5\u8fd0\u884c\u3002\u6bcf\u4e2a Pod \u9700\u8981 8 \u4e2a CPU \u6838\u5fc3(\u6574\u4e2a\u8282\u70b9)\u3002"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u6b65\u9aa4 2: \u8bc4\u4f30\u6bcf\u4e2a Spine \u7684\u53ef\u7528\u8d44\u6e90(\u9075\u5faa\u62d3\u6251)")),(0,a.kt)("p",null,"\u5f53\u524d\u96c6\u7fa4\u72b6\u6001:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"spine-0 (5 \u4e2a\u8282\u70b9):",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"node-0: \u88ab low-priority-pod-0 \u5360\u7528(8 \u6838\u5fc3\u5df2\u4f7f\u7528,0 \u6838\u5fc3\u53ef\u7528)"),(0,a.kt)("li",{parentName:"ul"},"node-1: \u88ab low-priority-pod-1 \u5360\u7528(8 \u6838\u5fc3\u5df2\u4f7f\u7528,0 \u6838\u5fc3\u53ef\u7528)"),(0,a.kt)("li",{parentName:"ul"},"node-2: \u53ef\u7528(8 \u6838\u5fc3)"),(0,a.kt)("li",{parentName:"ul"},"node-3: \u53ef\u7528(8 \u6838\u5fc3)"),(0,a.kt)("li",{parentName:"ul"},"node-4: \u53ef\u7528(8 \u6838\u5fc3)"),(0,a.kt)("li",{parentName:"ul"},"\u603b\u8ba1: 3 \u4e2a\u8282\u70b9\u53ef\u7528(\u4f5c\u4e1a\u9700\u8981 4 \u4e2a)"))),(0,a.kt)("li",{parentName:"ul"},"spine-1 (4 \u4e2a\u8282\u70b9):",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"node-5: \u88ab low-priority-pod-5 \u5360\u7528(8 \u6838\u5fc3\u5df2\u4f7f\u7528,0 \u6838\u5fc3\u53ef\u7528)"),(0,a.kt)("li",{parentName:"ul"},"node-6: \u53ef\u7528(8 \u6838\u5fc3)"),(0,a.kt)("li",{parentName:"ul"},"node-7: \u53ef\u7528(8 \u6838\u5fc3)"),(0,a.kt)("li",{parentName:"ul"},"node-8: \u53ef\u7528(8 \u6838\u5fc3)"),(0,a.kt)("li",{parentName:"ul"},"\u603b\u8ba1: 3 \u4e2a\u8282\u70b9\u53ef\u7528(\u4f5c\u4e1a\u9700\u8981 4 \u4e2a)"))),(0,a.kt)("li",{parentName:"ul"},"spine-2 (3 \u4e2a\u8282\u70b9):",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"node-9: \u53ef\u7528(8 \u6838\u5fc3)"),(0,a.kt)("li",{parentName:"ul"},"node-10: \u53ef\u7528(8 \u6838\u5fc3)"),(0,a.kt)("li",{parentName:"ul"},"node-11: \u53ef\u7528(8 \u6838\u5fc3)"),(0,a.kt)("li",{parentName:"ul"},"\u603b\u8ba1: 3 \u4e2a\u8282\u70b9\u53ef\u7528(\u5373\u4f7f\u62a2\u5360\u4e5f\u65e0\u6cd5\u5bb9\u7eb3 4 \u4e2a Pod)")))),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5173\u952e\u89c2\u5bdf"),": \u6ca1\u6709\u5355\u4e2a Spine \u5728\u4e0d\u62a2\u5360\u7684\u60c5\u51b5\u4e0b\u62e5\u6709\u8db3\u591f\u7684\u53ef\u7528\u8d44\u6e90\u3002",(0,a.kt)("strong",{parentName:"p"},"\u8c03\u5ea6\u5668\u5fc5\u987b\u6267\u884c\u62d3\u6251\u611f\u77e5\u62a2\u5360\u4ee5\u6ee1\u8db3 ",(0,a.kt)("inlineCode",{parentName:"strong"},"MustGather")," \u7ea6\u675f\u3002")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u6b65\u9aa4 3: \u786e\u5b9a\u62d3\u6251\u611f\u77e5\u62a2\u5360\u7b56\u7565")),(0,a.kt)("p",null,"\u8c03\u5ea6\u5668\u5728",(0,a.kt)("strong",{parentName:"p"},"\u9075\u5faa SpineLayer \u62d3\u6251\u7ea6\u675f"),"\u7684\u540c\u65f6\u8bc4\u4f30\u6700\u5c0f\u62a2\u5360\u9009\u9879:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"spine-0"),": \u9700\u8981\u62a2\u5360 1 \u4e2a\u8282\u70b9(node-0 \u6216 node-1),\u7ed3\u679c\u6709 4 \u4e2a\u53ef\u7528\u8282\u70b9",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u62a2\u5360\u6570\u91cf: 1 \u4e2a Pod"),(0,a.kt)("li",{parentName:"ul"},"\u62a2\u5360\u540e: \u53ef\u4ee5\u6ee1\u8db3 ",(0,a.kt)("inlineCode",{parentName:"li"},"MustGather")," \u5230 SpineLayer"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"spine-1"),": \u9700\u8981\u62a2\u5360 1 \u4e2a\u8282\u70b9(node-5),\u7ed3\u679c\u6709 4 \u4e2a\u53ef\u7528\u8282\u70b9",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u62a2\u5360\u6570\u91cf: 1 \u4e2a Pod"),(0,a.kt)("li",{parentName:"ul"},"\u62a2\u5360\u540e: \u53ef\u4ee5\u6ee1\u8db3 ",(0,a.kt)("inlineCode",{parentName:"li"},"MustGather")," \u5230 SpineLayer"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"spine-2"),": \u65e0\u6cd5\u5bb9\u7eb3 4 \u4e2a Pod(\u603b\u5171\u53ea\u6709 3 \u4e2a\u8282\u70b9)",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u4e0d\u662f\u6709\u6548\u5019\u9009\u8005")))),(0,a.kt)("p",null,"spine-0 \u548c spine-1 \u90fd\u9700\u8981\u76f8\u540c\u6570\u91cf\u7684\u62a2\u5360(1 \u4e2a Pod)\u3002Binpack \u7b97\u6cd5\u9009\u62e9 ",(0,a.kt)("strong",{parentName:"p"},"spine-1"),",\u56e0\u4e3a:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u5b83\u6070\u597d\u6709 4 \u4e2a\u8282\u70b9(\u5b8c\u7f8e\u5339\u914d,\u96f6\u6d6a\u8d39)"),(0,a.kt)("li",{parentName:"ol"},"\u62a2\u5360 node-5 \u540e: spine-1 \u4e2d\u7684\u6240\u6709 4 \u4e2a\u8282\u70b9\u90fd\u53d8\u4e3a\u53ef\u7528"),(0,a.kt)("li",{parentName:"ol"},"\u8fd9\u4ee5\u6700\u5c0f\u7684\u5e72\u6270\u6ee1\u8db3\u4e86 ",(0,a.kt)("inlineCode",{parentName:"li"},"MustGather")," \u7ea6\u675f")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u6b65\u9aa4 4: \u6267\u884c\u62d3\u6251\u611f\u77e5\u62a2\u5360")),(0,a.kt)("p",null,"Koordinator \u5728",(0,a.kt)("strong",{parentName:"p"},"\u7ef4\u62a4\u62d3\u6251\u7ea6\u675f"),"\u7684\u540c\u65f6\u6267\u884c\u62a2\u5360:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u6807\u8bb0 low-priority-pod-5 \u8fdb\u884c\u62a2\u5360(\u8bbe\u7f6e DisruptionTarget \u6761\u4ef6)"),(0,a.kt)("li",{parentName:"ol"},"\u4e3a\u6240\u6709 4 \u4e2a\u9ad8\u4f18\u5148\u7ea7 Pod \u8bbe\u7f6e ",(0,a.kt)("inlineCode",{parentName:"li"},"nominatedNode")," \u5230 ",(0,a.kt)("strong",{parentName:"li"},"spine-1 \u5185"),"\u7684\u8282\u70b9(node-5 \u5230 node-8)",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u8fd9\u786e\u4fdd\u5728\u8d44\u6e90\u9884\u7559\u671f\u95f4\u4fdd\u7559\u62d3\u6251\u7ea6\u675f"))),(0,a.kt)("li",{parentName:"ol"},"\u5220\u9664 low-priority-pod-5"),(0,a.kt)("li",{parentName:"ol"},"\u5c06\u6240\u6709\u9ad8\u4f18\u5148\u7ea7 Pod \u8c03\u5ea6\u5230 spine-1,",(0,a.kt)("strong",{parentName:"li"},"\u6ee1\u8db3 ",(0,a.kt)("inlineCode",{parentName:"strong"},"MustGather")," \u7ea6\u675f"))),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5173\u952e\u8981\u70b9:")),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("inlineCode",{parentName:"strong"},"MustGather")," \u662f\u786c\u6027\u8981\u6c42"),": \u5bf9\u4e8e\u5f20\u91cf\u5e76\u884c\u8bad\u7ec3\u7b49\u5ef6\u8fdf\u654f\u611f\u7684\u5de5\u4f5c\u8d1f\u8f7d,",(0,a.kt)("inlineCode",{parentName:"p"},"MustGather")," \u4e0d\u662f\u53ef\u9009\u7684\u2014\u2014\u5b83\u5bf9\u4e8e\u53ef\u63a5\u53d7\u7684\u6027\u80fd\u81f3\u5173\u91cd\u8981\u3002\u8de8 Spine \u901a\u4fe1\u4f1a\u4f7f\u4f5c\u4e1a\u901f\u5ea6\u964d\u4f4e 3-5 \u500d\u3002")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"\u62a2\u5360\u9075\u5faa\u62d3\u6251\u7ea6\u675f"),": \u5f53\u53ef\u7528\u8d44\u6e90\u65e0\u6cd5\u6ee1\u8db3 ",(0,a.kt)("inlineCode",{parentName:"p"},"MustGather")," \u65f6,\u8c03\u5ea6\u5668\u6267\u884c",(0,a.kt)("strong",{parentName:"p"},"\u62d3\u6251\u611f\u77e5\u62a2\u5360"),"\u3002\u5b83",(0,a.kt)("strong",{parentName:"p"},"\u5728\u6bcf\u4e2a\u62d3\u6251\u57df"),"(Spine)\u5185\u5206\u522b\u8bc4\u4f30\u62a2\u5360\u5019\u9009\u8005,\u786e\u4fdd\u6700\u7ec8\u653e\u7f6e\u6ee1\u8db3\u62d3\u6251\u8981\u6c42\u3002")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"\u6700\u5c0f\u5e72\u6270"),": \u8c03\u5ea6\u5668\u4ec5\u62a2\u5360\u4e86 1 \u4e2a Pod(\u6ee1\u8db3 ",(0,a.kt)("inlineCode",{parentName:"p"},"MustGather")," \u7ea6\u675f\u6240\u9700\u7684\u6700\u5c0f\u6570\u91cf),\u9009\u62e9 spine-1 \u662f\u56e0\u4e3a\u5b83\u662f\u5b8c\u7f8e\u5339\u914d(4 \u4e2a\u8282\u70b9\u4f9b 4 \u4e2a Pod \u4f7f\u7528)\u3002")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"\u8d44\u6e90\u9884\u7559\u7ef4\u62a4\u62d3\u6251"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"nominatedNode")," \u673a\u5236\u5728",(0,a.kt)("strong",{parentName:"p"},"\u6240\u9009\u62d3\u6251\u57df"),"(spine-1)\u5185\u9884\u7559\u8d44\u6e90,\u9632\u6b62\u5176\u4ed6 Pod \u5728\u62a2\u5360\u8fc7\u7a0b\u4e2d\u7834\u574f\u62d3\u6251\u7ea6\u675f\u3002")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"\u7aef\u5230\u7aef\u62d3\u6251\u4fdd\u8bc1"),": \u4ece\u62a2\u5360\u51b3\u7b56\u901a\u8fc7\u8d44\u6e90\u9884\u7559\u5230\u6700\u7ec8\u8c03\u5ea6,\u6574\u4e2a\u8fc7\u7a0b\u90fd\u7ef4\u62a4 ",(0,a.kt)("inlineCode",{parentName:"p"},"MustGather")," \u7ea6\u675f,\u786e\u4fdd\u6240\u6709 4 \u4e2a Pod \u90fd\u653e\u7f6e\u5728 spine-1 \u5185\u3002"))),(0,a.kt)("h2",{id:"\u9ad8\u7ea7\u914d\u7f6e"},"\u9ad8\u7ea7\u914d\u7f6e"),(0,a.kt)("h3",{id:"\u62d3\u6251\u5c42\u547d\u540d\u7ea6\u5b9a"},"\u62d3\u6251\u5c42\u547d\u540d\u7ea6\u5b9a"),(0,a.kt)("p",null,"\u5efa\u8bae\u4f7f\u7528\u6e05\u6670\u7684\u547d\u540d\u7ea6\u5b9a\u6765\u8bc6\u522b\u62d3\u6251\u5c42:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"# \u63a8\u8350\u7684\u5c42\u547d\u540d\nNodeTopologyLayer       # \u8282\u70b9\u5c42\nAcceleratorLayer        # \u52a0\u901f\u5668\u4e92\u8fde\u5c42(\u4f8b\u5982 NVLink)\nBlockLayer              # Block \u4ea4\u6362\u673a\u5c42\nSpineLayer              # Spine \u4ea4\u6362\u673a\u5c42\nDatacenterLayer         # \u6570\u636e\u4e2d\u5fc3\u5c42\n")),(0,a.kt)("h3",{id:"\u62d3\u6251\u7b56\u7565\u9009\u62e9\u6307\u5357"},"\u62d3\u6251\u7b56\u7565\u9009\u62e9\u6307\u5357"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"\u7b56\u7565"),(0,a.kt)("th",{parentName:"tr",align:null},"\u7528\u4f8b"),(0,a.kt)("th",{parentName:"tr",align:null},"\u884c\u4e3a"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"PreferGather")),(0,a.kt)("td",{parentName:"tr",align:null},"\u62d3\u6251\u5c42\u9700\u8981\u826f\u597d\u7684\u7f51\u7edc\u6027\u80fd\u4f46\u53ef\u4ee5\u5bb9\u5fcd\u4e00\u4e9b\u5206\u6563"),(0,a.kt)("td",{parentName:"tr",align:null},"\u5c3d\u53ef\u80fd\u805a\u96c6,\u4f46\u5f53\u8d44\u6e90\u4e0d\u8db3\u65f6\u5141\u8bb8\u5206\u6563")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"MustGather")),(0,a.kt)("td",{parentName:"tr",align:null},"\u62d3\u6251\u5c42\u5177\u6709\u4e25\u683c\u7684\u7f51\u7edc\u5e26\u5bbd\u8981\u6c42"),(0,a.kt)("td",{parentName:"tr",align:null},"\u5fc5\u987b\u5728\u6307\u5b9a\u5c42\u4e2d\u805a\u96c6,\u5426\u5219\u8c03\u5ea6\u5931\u8d25")))),(0,a.kt)("h3",{id:"\u591a-podgroup-\u534f\u8c03\u8c03\u5ea6"},"\u591a PodGroup \u534f\u8c03\u8c03\u5ea6"),(0,a.kt)("p",null,"\u5bf9\u4e8e\u5305\u542b master \u548c worker \u7684\u590d\u6742\u8bad\u7ec3\u4f5c\u4e1a,\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"GangGroup")," \u8bed\u4e49:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: scheduling.sigs.k8s.io/v1alpha1\nkind: PodGroup\nmetadata:\n  annotations:\n    gang.scheduling.koordinator.sh/groups: |\n      ["default/llm-master", "default/llm-worker"]\n    gang.scheduling.koordinator.sh/network-topology-spec: |\n      {\n        "gatherStrategy": [\n          {\n            "layer": "SpineLayer",\n            "strategy": "MustGather"\n          }\n        ]\n      }\n')),(0,a.kt)("p",null,"\u786e\u4fdd\u6240\u6709\u76f8\u5173\u7684 PodGroup \u4f7f\u7528\u76f8\u540c\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"gang.scheduling.koordinator.sh/groups")," \u548c ",(0,a.kt)("inlineCode",{parentName:"p"},"gang.scheduling.koordinator.sh/network-topology-spec")," \u6ce8\u89e3\u3002"),(0,a.kt)("h2",{id:"\u6545\u969c\u6392\u67e5"},"\u6545\u969c\u6392\u67e5"),(0,a.kt)("h3",{id:"pod-\u5361\u5728-pending-\u72b6\u6001"},"Pod \u5361\u5728 Pending \u72b6\u6001"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u53ef\u80fd\u539f\u56e0"),": \u7f51\u7edc\u62d3\u6251\u7ea6\u675f\u8fc7\u4e8e\u4e25\u683c,\u6ca1\u6709\u8db3\u591f\u7684\u8282\u70b9\u6ee1\u8db3\u8981\u6c42"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u89e3\u51b3\u65b9\u6848"),": "),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u68c0\u67e5\u96c6\u7fa4\u62d3\u6251\u914d\u7f6e: ",(0,a.kt)("inlineCode",{parentName:"li"},"kubectl get clusternetworktopology default -o yaml")),(0,a.kt)("li",{parentName:"ul"},"\u653e\u5bbd\u62d3\u6251\u7b56\u7565,\u5c06 ",(0,a.kt)("inlineCode",{parentName:"li"},"MustGather")," \u66f4\u6539\u4e3a ",(0,a.kt)("inlineCode",{parentName:"li"},"PreferGather")),(0,a.kt)("li",{parentName:"ul"},"\u6dfb\u52a0\u96c6\u7fa4\u8282\u70b9\u6216\u8c03\u6574\u8282\u70b9\u62d3\u6251\u6807\u7b7e")),(0,a.kt)("h3",{id:"\u62d3\u6251\u611f\u77e5\u8c03\u5ea6\u672a\u751f\u6548"},"\u62d3\u6251\u611f\u77e5\u8c03\u5ea6\u672a\u751f\u6548"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u6545\u969c\u6392\u67e5\u6b65\u9aa4"),":"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u9a8c\u8bc1 Koord-Scheduler \u662f\u5426\u542f\u7528\u4e86\u7f51\u7edc\u62d3\u6251\u63d2\u4ef6:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl -n koordinator-system get cm koord-scheduler-config -o yaml\n")),(0,a.kt)("ol",{start:2},(0,a.kt)("li",{parentName:"ol"},"\u68c0\u67e5\u8282\u70b9\u662f\u5426\u5177\u6709\u6b63\u786e\u7684\u62d3\u6251\u6807\u7b7e:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get nodes --show-labels | grep network.topology\n")),(0,a.kt)("ol",{start:3},(0,a.kt)("li",{parentName:"ol"},"\u68c0\u67e5 ClusterNetworkTopology \u72b6\u6001:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get clusternetworktopology default -o yaml\n")),(0,a.kt)("h3",{id:"\u62a2\u5360\u672a\u6309\u9884\u671f\u53d1\u751f"},"\u62a2\u5360\u672a\u6309\u9884\u671f\u53d1\u751f"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u68c0\u67e5"),":"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u786e\u8ba4 PriorityClass \u914d\u7f6e\u6b63\u786e"),(0,a.kt)("li",{parentName:"ol"},"\u68c0\u67e5 Pod \u7684 ",(0,a.kt)("inlineCode",{parentName:"li"},"preemptionPolicy")," \u8bbe\u7f6e"),(0,a.kt)("li",{parentName:"ol"},"\u67e5\u770b\u8c03\u5ea6\u5668\u65e5\u5fd7:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl -n koordinator-system logs -l component=koord-scheduler --tail=100\n")),(0,a.kt)("h2",{id:"\u6700\u4f73\u5b9e\u8df5"},"\u6700\u4f73\u5b9e\u8df5"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"\u4ece ",(0,a.kt)("inlineCode",{parentName:"strong"},"PreferGather")," \u7b56\u7565\u5f00\u59cb"),": \u5bf9\u4e8e\u521d\u59cb\u90e8\u7f72,\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"PreferGather")," \u4e86\u89e3 Pod \u653e\u7f6e\u6a21\u5f0f,\u7136\u540e\u518d\u5e94\u7528\u4e25\u683c\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"MustGather")," \u7ea6\u675f")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"\u4e3a\u5206\u5e03\u5f0f\u8bad\u7ec3\u4f7f\u7528\u62d3\u6251\u7d22\u5f15"),": \u59cb\u7ec8\u5206\u914d ",(0,a.kt)("inlineCode",{parentName:"p"},"gang.scheduling.koordinator.sh/network-topology-index")," \u6ce8\u89e3,\u4ee5\u5728\u6570\u636e\u5e76\u884c\u4f5c\u4e1a\u4e2d\u5efa\u7acb\u6e05\u6670\u7684\u901a\u4fe1\u6a21\u5f0f")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"\u9009\u62e9\u9002\u5f53\u7684\u62d3\u6251\u5c42"),":"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u5bf9\u4e8e\u5ef6\u8fdf\u654f\u611f\u7684\u63a8\u7406\u670d\u52a1: ",(0,a.kt)("inlineCode",{parentName:"li"},"MustGather")," + ",(0,a.kt)("inlineCode",{parentName:"li"},"BlockLayer")),(0,a.kt)("li",{parentName:"ul"},"\u5bf9\u4e8e\u5927\u89c4\u6a21 LLM \u8bad\u7ec3: ",(0,a.kt)("inlineCode",{parentName:"li"},"MustGather")," + ",(0,a.kt)("inlineCode",{parentName:"li"},"SpineLayer")),(0,a.kt)("li",{parentName:"ul"},"\u5bf9\u4e8e\u4e00\u822c\u5206\u5e03\u5f0f\u8bad\u7ec3: \u8de8\u591a\u4e2a\u5c42\u7684 ",(0,a.kt)("inlineCode",{parentName:"li"},"PreferGather")," \u7ec4\u5408"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"\u4e3a\u5173\u952e\u5de5\u4f5c\u8d1f\u8f7d\u7ed3\u5408\u4f18\u5148\u7ea7"),": \u4e3a\u751f\u4ea7\u8bad\u7ec3\u4f5c\u4e1a\u8bbe\u7f6e\u9ad8\u4f18\u5148\u7ea7,\u4ee5\u786e\u4fdd\u5b83\u4eec\u53ef\u4ee5\u5728\u7ef4\u62a4\u62d3\u6251\u7ea6\u675f\u7684\u540c\u65f6\u62a2\u5360\u4f4e\u4f18\u5148\u7ea7\u4f5c\u4e1a")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"\u76d1\u63a7\u62d3\u6251\u5206\u5e03"),": \u5b9a\u671f\u68c0\u67e5 Pod \u653e\u7f6e\u6a21\u5f0f,\u5e76\u6839\u636e\u5b9e\u9645\u7f51\u7edc\u6027\u80fd\u6307\u6807\u8c03\u6574\u62d3\u6251\u7b56\u7565")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"\u89c4\u5212\u62a2\u5360\u573a\u666f"),": \u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"MustGather")," \u65f6,\u786e\u4fdd\u81f3\u5c11\u4e00\u4e2a\u62d3\u6251\u57df\u4e2d\u6709\u8db3\u591f\u7684\u5bb9\u91cf,\u4ee5\u907f\u514d\u8c03\u5ea6\u5931\u8d25"))),(0,a.kt)("h2",{id:"\u53c2\u8003\u8d44\u6599"},"\u53c2\u8003\u8d44\u6599"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"../architecture/job"},"Job \u67b6\u6784")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"../user-manuals/job-level-preemption"},"Job \u7ea7\u522b\u62a2\u5360")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"../user-manuals/gang-scheduling"},"Gang \u8c03\u5ea6")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/blob/main/docs/proposals/scheduling/20250611-networktopology-aware-scheduling.md"},"\u7f51\u7edc\u62d3\u6251\u63d0\u6848"))))}k.isMDXComponent=!0}}]);