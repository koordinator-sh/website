"use strict";(self.webpackChunkkoordinator_sh=self.webpackChunkkoordinator_sh||[]).push([[6894],{3905:(e,t,n)=>{n.d(t,{Zo:()=>m,kt:()=>k});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),c=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},m=function(e){var t=c(e.components);return r.createElement(s.Provider,{value:t},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),p=c(n),d=a,k=p["".concat(s,".").concat(d)]||p[d]||u[d]||i;return n?r.createElement(k,o(o({ref:t},m),{},{components:n})):r.createElement(k,o({ref:t},m))}));function k(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[p]="string"==typeof e?e:a,o[1]=l;for(var c=2;c<i;c++)o[c]=n[c];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},2782:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var r=n(7462),a=(n(7294),n(3905));const i={},o="Metrics Endpoints",l={unversionedId:"api-reference/metrics-endpoints",id:"api-reference/metrics-endpoints",title:"Metrics Endpoints",description:"Introduction",source:"@site/docs/api-reference/metrics-endpoints.md",sourceDirName:"api-reference",slug:"/api-reference/metrics-endpoints",permalink:"/docs/next/api-reference/metrics-endpoints",draft:!1,editUrl:"https://github.com/koordinator-sh/koordinator.sh/edit/main/docs/api-reference/metrics-endpoints.md",tags:[],version:"current",lastUpdatedBy:"\u4e54\u666e",lastUpdatedAt:1760692701,formattedLastUpdatedAt:"Oct 17, 2025",frontMatter:{},sidebar:"docs",previous:{title:"Client Libraries",permalink:"/docs/next/api-reference/client-libraries"},next:{title:"Webhook Endpoints",permalink:"/docs/next/api-reference/webhook-endpoints"}},s={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Component Metrics Endpoints",id:"component-metrics-endpoints",level:2},{value:"Koordlet Metrics",id:"koordlet-metrics",level:2},{value:"Resource Utilization Metrics",id:"resource-utilization-metrics",level:3},{value:"Performance and QoS Metrics",id:"performance-and-qos-metrics",level:3},{value:"Koord-scheduler Metrics",id:"koord-scheduler-metrics",level:2},{value:"Scheduling Performance Metrics",id:"scheduling-performance-metrics",level:3},{value:"Reservation and Quota Metrics",id:"reservation-and-quota-metrics",level:3},{value:"Koord-descheduler Metrics",id:"koord-descheduler-metrics",level:2},{value:"Pod Eviction Metrics",id:"pod-eviction-metrics",level:3},{value:"Koord-manager Metrics",id:"koord-manager-metrics",level:2},{value:"SLO Controller Metrics",id:"slo-controller-metrics",level:3},{value:"Metrics Collection and Configuration",id:"metrics-collection-and-configuration",level:2},{value:"Configuration Parameters",id:"configuration-parameters",level:3},{value:"Prometheus Queries and Alerting",id:"prometheus-queries-and-alerting",level:2},{value:"Key Prometheus Queries",id:"key-prometheus-queries",level:3},{value:"Alerting Rules",id:"alerting-rules",level:3},{value:"Metrics Stability and Versioning",id:"metrics-stability-and-versioning",level:2},{value:"Stability Levels",id:"stability-levels",level:3},{value:"Deprecation Policy",id:"deprecation-policy",level:3}],m={toc:c},p="wrapper";function u(e){let{components:t,...n}=e;return(0,a.kt)(p,(0,r.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"metrics-endpoints"},"Metrics Endpoints"),(0,a.kt)("h2",{id:"introduction"},"Introduction"),(0,a.kt)("p",null,"Koordinator exposes comprehensive Prometheus metrics through its various components to enable monitoring, observability, and performance analysis of the system. Each component (koord-manager, koord-scheduler, koordlet, and koord-descheduler) provides a /metrics HTTP endpoint that exports metrics in Prometheus format. These metrics cover various aspects of the system including scheduling performance, resource utilization, pod eviction statistics, and QoS enforcement. The metrics endpoints are secured and configured according to the component's deployment configuration, with specific port numbers and security requirements. This documentation provides a comprehensive overview of all exported metrics, their semantic meaning, and guidance on configuring and using these metrics for monitoring and alerting."),(0,a.kt)("h2",{id:"component-metrics-endpoints"},"Component Metrics Endpoints"),(0,a.kt)("p",null,"Each Koordinator component exposes metrics through a dedicated HTTP endpoint with specific port configurations and security settings. The metrics endpoints follow the standard Prometheus exposition format and are accessible via the /metrics path."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Component Metrics Endpoints:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"Koord-manager \u2192 /metrics (Port: 8080)\nKoord-scheduler \u2192 /metrics (Port: 10251)\nKoordlet \u2192 /metrics (Port: 9808)\nKoord-descheduler \u2192 /metrics (Port: 10260)\n  \u2193\nMetrics Collection\n  \u2193\nPrometheus Server\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Diagram sources")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/config/manager/manager.yaml"},"manager.yaml")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/config/manager/scheduler.yaml"},"scheduler.yaml")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/config/manager/descheduler.yaml"},"descheduler.yaml"))),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Section sources")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/config/manager/manager.yaml"},"manager.yaml")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/config/manager/scheduler.yaml"},"scheduler.yaml")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/config/manager/descheduler.yaml"},"descheduler.yaml"))),(0,a.kt)("h2",{id:"koordlet-metrics"},"Koordlet Metrics"),(0,a.kt)("p",null,"The koordlet component, running as a daemon on each node, exposes detailed metrics about node resource utilization, container performance, and system-level observations. These metrics are crucial for understanding the actual resource consumption and performance characteristics of workloads."),(0,a.kt)("h3",{id:"resource-utilization-metrics"},"Resource Utilization Metrics"),(0,a.kt)("p",null,"Koordlet collects and exposes various resource utilization metrics at both node and container levels, including CPU, memory, and specialized metrics like PSI (Pressure Stall Information)."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Node Resource Metrics Class Structure:")),(0,a.kt)("p",null,"Core metric classes and relationships:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"NodeResourceAllocatable")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Labels: ",(0,a.kt)("inlineCode",{parentName:"li"},"node"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"resource"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"unit")),(0,a.kt)("li",{parentName:"ul"},"Value: ",(0,a.kt)("inlineCode",{parentName:"li"},"float64")),(0,a.kt)("li",{parentName:"ul"},'Help: "the node allocatable of resources updated by koordinator"'))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"ContainerResourceRequests")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Labels: ",(0,a.kt)("inlineCode",{parentName:"li"},"node"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"resource"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"unit"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"pod_uid"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"pod_name"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"pod_namespace"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"container_id"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"container_name")),(0,a.kt)("li",{parentName:"ul"},"Value: ",(0,a.kt)("inlineCode",{parentName:"li"},"float64")),(0,a.kt)("li",{parentName:"ul"},'Help: "the container requests of resources updated by koordinator"'))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"NodePredictedResourceReclaimable")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Labels: ",(0,a.kt)("inlineCode",{parentName:"li"},"node"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"predictor"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"resource"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"unit")),(0,a.kt)("li",{parentName:"ul"},"Value: ",(0,a.kt)("inlineCode",{parentName:"li"},"float64")),(0,a.kt)("li",{parentName:"ul"},'Help: "the node reclaimable resources predicted by koordinator"')))),(0,a.kt)("p",null,"Relationships:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"NodeResourceAllocatable contains ContainerResourceRequests"),(0,a.kt)("li",{parentName:"ul"},"NodeResourceAllocatable relates to NodePredictedResourceReclaimable")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Diagram sources")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/pkg/koordlet/metrics/resource_summary.go"},"metrics.go")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/pkg/koordlet/metrics/prediction.go"},"metrics.go"))),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Section sources")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/pkg/koordlet/metrics/metrics.go"},"metrics.go"))),(0,a.kt)("h3",{id:"performance-and-qos-metrics"},"Performance and QoS Metrics"),(0,a.kt)("p",null,"Koordlet exposes specialized metrics for performance monitoring and QoS enforcement, including CPU burst, core scheduling, and PSI metrics that help identify resource contention and performance bottlenecks."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Performance and QoS Metrics Class Structure:")),(0,a.kt)("p",null,"Core metric classes and relationships:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"ContainerScaledCFSBurstUS")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Labels: ",(0,a.kt)("inlineCode",{parentName:"li"},"node"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"pod_namespace"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"pod_name"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"container_id"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"container_name")),(0,a.kt)("li",{parentName:"ul"},"Value: ",(0,a.kt)("inlineCode",{parentName:"li"},"float64")),(0,a.kt)("li",{parentName:"ul"},'Help: "The maximum accumulated run-time(in microseconds) in container-level set by koordlet"'))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"ContainerPSI")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Labels: ",(0,a.kt)("inlineCode",{parentName:"li"},"node"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"container_id"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"container_name"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"pod_uid"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"pod_name"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"pod_namespace"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"psi_resource_type"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"psi_precision"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"psi_degree"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"cpu_full_supported")),(0,a.kt)("li",{parentName:"ul"},"Value: ",(0,a.kt)("inlineCode",{parentName:"li"},"float64")),(0,a.kt)("li",{parentName:"ul"},'Help: "Container psi collected by koordlet"'))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"ContainerCoreSchedCookie")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Labels: ",(0,a.kt)("inlineCode",{parentName:"li"},"node"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"pod_name"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"pod_namespace"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"pod_uid"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"container_name"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"container_id"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"core_sched_group"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"core_sched_cookie")),(0,a.kt)("li",{parentName:"ul"},"Value: ",(0,a.kt)("inlineCode",{parentName:"li"},"float64")),(0,a.kt)("li",{parentName:"ul"},'Help: "the core scheduling cookie of the container"')))),(0,a.kt)("p",null,"Relationships:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"ContainerScaledCFSBurstUS correlates with ContainerPSI"),(0,a.kt)("li",{parentName:"ul"},"ContainerScaledCFSBurstUS influences ContainerCoreSchedCookie")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Diagram sources")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/pkg/koordlet/metrics/cpu_burst.go"},"metrics.go")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/pkg/koordlet/metrics/psi.go"},"metrics.go")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/pkg/koordlet/metrics/core_sched.go"},"metrics.go"))),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Section sources")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/pkg/koordlet/metrics/metrics.go"},"metrics.go"))),(0,a.kt)("h2",{id:"koord-scheduler-metrics"},"Koord-scheduler Metrics"),(0,a.kt)("p",null,"The koord-scheduler component extends the Kubernetes scheduler with additional scheduling capabilities and exposes metrics related to scheduling performance, reservation management, and plugin execution."),(0,a.kt)("h3",{id:"scheduling-performance-metrics"},"Scheduling Performance Metrics"),(0,a.kt)("p",null,"Koord-scheduler provides detailed metrics about the scheduling process, including latency, node evaluation statistics, and timeout information."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Scheduling Performance Metrics Class Structure:")),(0,a.kt)("p",null,"Core metric classes and relationships:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"PodSchedulingEvaluatedNodes")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Value: ",(0,a.kt)("inlineCode",{parentName:"li"},"float64")),(0,a.kt)("li",{parentName:"ul"},'Help: "The number of nodes the scheduler evaluated the pod against in the filtering phase and beyond when find the suggested node"'),(0,a.kt)("li",{parentName:"ul"},"Buckets: exponential(1,2,24)"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"PodSchedulingFeasibleNodes")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Value: ",(0,a.kt)("inlineCode",{parentName:"li"},"float64")),(0,a.kt)("li",{parentName:"ul"},'Help: "The number of of nodes out of the evaluated ones that fit the pod when find the suggested node"'),(0,a.kt)("li",{parentName:"ul"},"Buckets: exponential(1,2,24)"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"SchedulingTimeout")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Labels: ",(0,a.kt)("inlineCode",{parentName:"li"},"profile")),(0,a.kt)("li",{parentName:"ul"},"Value: ",(0,a.kt)("inlineCode",{parentName:"li"},"float64")),(0,a.kt)("li",{parentName:"ul"},'Help: "The currently scheduled Pod exceeds the maximum acceptable time interval"'))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"ElasticQuotaProcessLatency")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Labels: ",(0,a.kt)("inlineCode",{parentName:"li"},"operation")),(0,a.kt)("li",{parentName:"ul"},"Value: ",(0,a.kt)("inlineCode",{parentName:"li"},"float64")),(0,a.kt)("li",{parentName:"ul"},'Help: "elastic quota process latency in second"'),(0,a.kt)("li",{parentName:"ul"},"Buckets: exponential(0.00001,2,24)")))),(0,a.kt)("p",null,"Relationships:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"PodSchedulingEvaluatedNodes is a subset of PodSchedulingFeasibleNodes"),(0,a.kt)("li",{parentName:"ul"},"SchedulingTimeout is related to ElasticQuotaProcessLatency")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Diagram sources")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/pkg/scheduler/metrics/metrics.go"},"metrics.go"))),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Section sources")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/pkg/scheduler/metrics/metrics.go"},"metrics.go"))),(0,a.kt)("h3",{id:"reservation-and-quota-metrics"},"Reservation and Quota Metrics"),(0,a.kt)("p",null,"The scheduler exposes metrics related to resource reservations and elastic quotas, which are essential for understanding resource allocation and utilization patterns."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Reservation and Quota Metrics Class Structure:")),(0,a.kt)("p",null,"Core metric classes and relationships:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"ReservationStatusPhase")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Labels: ",(0,a.kt)("inlineCode",{parentName:"li"},"name"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"phase")),(0,a.kt)("li",{parentName:"ul"},"Value: ",(0,a.kt)("inlineCode",{parentName:"li"},"float64")),(0,a.kt)("li",{parentName:"ul"},'Help: "The current number of reservations in each status phase (e.g. Pending, Available, Succeeded, Failed)"'))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"ReservationResource")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Labels: ",(0,a.kt)("inlineCode",{parentName:"li"},"type"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"name"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"resource"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"unit")),(0,a.kt)("li",{parentName:"ul"},"Value: ",(0,a.kt)("inlineCode",{parentName:"li"},"float64")),(0,a.kt)("li",{parentName:"ul"},'Help: "Resource metrics for a reservation, including allocatable, allocated, and utilization with unit."'))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"WaitingGangGroupNumber")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Value: ",(0,a.kt)("inlineCode",{parentName:"li"},"float64")),(0,a.kt)("li",{parentName:"ul"},'Help: "The number of GangGroups in Waiting"')))),(0,a.kt)("p",null,"Relationships:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"ReservationStatusPhase contains ReservationResource"),(0,a.kt)("li",{parentName:"ul"},"ReservationStatusPhase affects WaitingGangGroupNumber")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Diagram sources")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/pkg/scheduler/metrics/metrics.go"},"metrics.go"))),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Section sources")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/pkg/scheduler/metrics/metrics.go"},"metrics.go"))),(0,a.kt)("h2",{id:"koord-descheduler-metrics"},"Koord-descheduler Metrics"),(0,a.kt)("p",null,"The koord-descheduler component is responsible for evicting pods to improve resource utilization and balance across the cluster. It exposes metrics about eviction activities and their outcomes."),(0,a.kt)("h3",{id:"pod-eviction-metrics"},"Pod Eviction Metrics"),(0,a.kt)("p",null,"The descheduler tracks all pod eviction activities, including successful evictions, failed attempts, and the strategies that triggered the evictions."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Pod Eviction Metrics Class Structure:")),(0,a.kt)("p",null,"Core metric classes and relationships:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"PodsEvicted")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Labels: ",(0,a.kt)("inlineCode",{parentName:"li"},"result"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"strategy"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"namespace"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"node")),(0,a.kt)("li",{parentName:"ul"},"Value: ",(0,a.kt)("inlineCode",{parentName:"li"},"float64")),(0,a.kt)("li",{parentName:"ul"},"Help: \"Number of evicted pods, by the result, by the strategy, by the namespace, by the node name. 'error' result means a pod could not be evicted\""))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"SecondaryDeviceNotWellPlannedNodes")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Labels: ",(0,a.kt)("inlineCode",{parentName:"li"},"node_name")),(0,a.kt)("li",{parentName:"ul"},"Value: ",(0,a.kt)("inlineCode",{parentName:"li"},"float64")),(0,a.kt)("li",{parentName:"ul"},'Help: "The number of secondary device not well planned"')))),(0,a.kt)("p",null,"Relationships:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"PodsEvicted correlates with SecondaryDeviceNotWellPlannedNodes")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Diagram sources")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/pkg/descheduler/metrics/metrics.go"},"metrics.go"))),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Section sources")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/pkg/descheduler/metrics/metrics.go"},"metrics.go"))),(0,a.kt)("h2",{id:"koord-manager-metrics"},"Koord-manager Metrics"),(0,a.kt)("p",null,"The koord-manager component serves as the control plane for Koordinator, managing various controllers and webhook configurations. It exposes metrics related to SLO (Service Level Objective) enforcement and controller operations."),(0,a.kt)("h3",{id:"slo-controller-metrics"},"SLO Controller Metrics"),(0,a.kt)("p",null,"The SLO controller within koord-manager tracks various reconciliation activities and resource management operations."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"SLO Controller Metrics Class Structure:")),(0,a.kt)("p",null,"Core metric classes and relationships:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"NodeMetricReconcileCount")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Labels: ",(0,a.kt)("inlineCode",{parentName:"li"},"node"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"status"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"reason")),(0,a.kt)("li",{parentName:"ul"},"Value: ",(0,a.kt)("inlineCode",{parentName:"li"},"float64")),(0,a.kt)("li",{parentName:"ul"},'Help: "The count of node metric reconciliations"'))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"NodeResourceReconcileCount")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Labels: ",(0,a.kt)("inlineCode",{parentName:"li"},"node"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"status"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"reason")),(0,a.kt)("li",{parentName:"ul"},"Value: ",(0,a.kt)("inlineCode",{parentName:"li"},"float64")),(0,a.kt)("li",{parentName:"ul"},'Help: "The count of node resource reconciliations"'))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"NodeSLOReconcileCount")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Labels: ",(0,a.kt)("inlineCode",{parentName:"li"},"node"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"status"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"reason")),(0,a.kt)("li",{parentName:"ul"},"Value: ",(0,a.kt)("inlineCode",{parentName:"li"},"float64")),(0,a.kt)("li",{parentName:"ul"},'Help: "The count of node SLO reconciliations"')))),(0,a.kt)("p",null,"Relationships:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"NodeMetricReconcileCount occurs with NodeResourceReconcileCount"),(0,a.kt)("li",{parentName:"ul"},"NodeResourceReconcileCount leads to NodeSLOReconcileCount")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Diagram sources")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/pkg/slo-controller/metrics/metrics.go"},"metrics.go"))),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Section sources")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/pkg/slo-controller/metrics/metrics.go"},"metrics.go"))),(0,a.kt)("h2",{id:"metrics-collection-and-configuration"},"Metrics Collection and Configuration"),(0,a.kt)("p",null,"Koordlet includes a built-in metric cache system that collects, stores, and exposes metrics with configurable retention and collection intervals. This system uses TSDB (Time Series Database) storage for efficient time-series data management."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Metrics Collection and Configuration Flow:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"Metric Collection\n  \u2193\nIn-Memory Buffer\n  \u2193\nTSDB Storage\n  \u251c\u2500\u2500 Data Persistence\n  \u2514\u2500\u2500 Prometheus Export\n\nConfiguration Parameters:\n  \u251c\u2500\u2500 MetricGCIntervalSeconds \u2192 TSDB Storage\n  \u251c\u2500\u2500 MetricExpireSeconds \u2192 TSDB Storage\n  \u2514\u2500\u2500 TSDBRetentionDuration \u2192 TSDB Storage\n\nPrometheus \u2192 Prometheus Export\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Diagram sources")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/pkg/koordlet/metriccache/config.go"},"config.go"))),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Section sources")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/pkg/koordlet/metriccache/config.go"},"config.go"))),(0,a.kt)("h3",{id:"configuration-parameters"},"Configuration Parameters"),(0,a.kt)("p",null,"The metric collection system can be configured with various parameters to control the behavior of metric collection, storage, and garbage collection."),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,a.kt)("th",{parentName:"tr",align:null},"Default Value"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"MetricGCIntervalSeconds"),(0,a.kt)("td",{parentName:"tr",align:null},"300"),(0,a.kt)("td",{parentName:"tr",align:null},"Interval in seconds for collecting expired metrics")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"MetricExpireSeconds"),(0,a.kt)("td",{parentName:"tr",align:null},"1800"),(0,a.kt)("td",{parentName:"tr",align:null},"Duration in seconds after which metrics expire")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"TSDBPath"),(0,a.kt)("td",{parentName:"tr",align:null},"/metric-data/"),(0,a.kt)("td",{parentName:"tr",align:null},"Base path for metric data storage")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"TSDBRetentionDuration"),(0,a.kt)("td",{parentName:"tr",align:null},"12h"),(0,a.kt)("td",{parentName:"tr",align:null},"Duration of persisted data to keep")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"TSDBEnablePromMetrics"),(0,a.kt)("td",{parentName:"tr",align:null},"true"),(0,a.kt)("td",{parentName:"tr",align:null},"Enable Prometheus metrics for TSDB")))),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Section sources")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/pkg/koordlet/metriccache/config.go"},"config.go"))),(0,a.kt)("h2",{id:"prometheus-queries-and-alerting"},"Prometheus Queries and Alerting"),(0,a.kt)("p",null,"Effective monitoring of Koordinator requires well-crafted Prometheus queries and alerting rules to detect and respond to potential issues in the system."),(0,a.kt)("h3",{id:"key-prometheus-queries"},"Key Prometheus Queries"),(0,a.kt)("p",null,"The following queries are essential for monitoring the health and performance of Koordinator components:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-promql"},'# Scheduling latency by percentile\nhistogram_quantile(0.95, sum(rate(koord_scheduler_pod_scheduling_evaluated_nodes_bucket[5m])) by (le))\n\n# Pod eviction rate by strategy\nsum by (strategy) (rate(koord_descheduler_pods_evicted_total[5m]))\n\n# Node resource utilization\nkoordlet_node_resource_allocatable{resource="cpu", unit="core"} - koordlet_node_resource_used{resource="cpu", unit="core"}\n\n# QoS violation rate\nsum(koordlet_container_psi{psi_degree="full", psi_precision="avg10"}) by (node) / count(koordlet_container_psi) by (node)\n')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Section sources")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/pkg/koordlet/metrics/metrics.go"},"metrics.go")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/pkg/scheduler/metrics/metrics.go"},"metrics.go")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/pkg/descheduler/metrics/metrics.go"},"metrics.go"))),(0,a.kt)("h3",{id:"alerting-rules"},"Alerting Rules"),(0,a.kt)("p",null,"The following alerting rules can be configured to proactively detect issues in the Koordinator system:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'# High scheduling latency\n- alert: HighSchedulingLatency\n  expr: histogram_quantile(0.95, sum(rate(koord_scheduler_pod_scheduling_evaluated_nodes_bucket[5m])) by (le)) > 10\n  for: 5m\n  labels:\n    severity: warning\n  annotations:\n    summary: "High scheduling latency detected"\n    description: "The 95th percentile scheduling latency is above 10 seconds"\n\n# High pod eviction rate\n- alert: HighPodEvictionRate\n  expr: sum(rate(koord_descheduler_pods_evicted_total[5m])) > 10\n  for: 10m\n  labels:\n    severity: warning\n  annotations:\n    summary: "High pod eviction rate detected"\n    description: "The pod eviction rate is above 10 evictions per minute"\n\n# Node resource exhaustion\n- alert: NodeResourceExhaustion\n  expr: (koordlet_node_resource_allocatable{resource="memory", unit="byte"} - koordlet_node_resource_used{resource="memory", unit="byte"}) / koordlet_node_resource_allocatable{resource="memory", unit="byte"} < 0.1\n  for: 15m\n  labels:\n    severity: critical\n  annotations:\n    summary: "Node memory exhaustion detected"\n    description: "Node memory usage is above 90% for more than 15 minutes"\n')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Section sources")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/pkg/koordlet/metrics/metrics.go"},"metrics.go")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/pkg/scheduler/metrics/metrics.go"},"metrics.go")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/pkg/descheduler/metrics/metrics.go"},"metrics.go"))),(0,a.kt)("h2",{id:"metrics-stability-and-versioning"},"Metrics Stability and Versioning"),(0,a.kt)("p",null,"Koordinator follows a structured approach to metrics stability and versioning to ensure backward compatibility and predictable behavior for monitoring systems."),(0,a.kt)("h3",{id:"stability-levels"},"Stability Levels"),(0,a.kt)("p",null,"Metrics are classified into different stability levels based on their maturity and expected stability:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"STABLE"),": Metrics that are considered stable and will not be changed in backward-incompatible ways"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"ALPHA"),": Experimental metrics that may change or be removed in future versions"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"BETA"),": Metrics that are feature-complete but may still undergo changes")),(0,a.kt)("p",null,"The stability level is indicated in the metric metadata and should be considered when building monitoring and alerting systems."),(0,a.kt)("h3",{id:"deprecation-policy"},"Deprecation Policy"),(0,a.kt)("p",null,"When metrics need to be changed or removed, Koordinator follows a deprecation policy:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Mark the metric as deprecated in the documentation"),(0,a.kt)("li",{parentName:"ol"},"Continue to expose the metric for at least two minor versions"),(0,a.kt)("li",{parentName:"ol"},"Add a warning in the logs when the deprecated metric is accessed"),(0,a.kt)("li",{parentName:"ol"},"Remove the metric in a subsequent major version")),(0,a.kt)("p",null,"This policy ensures that users have sufficient time to update their monitoring configurations before metrics are removed."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Section sources")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/pkg/koordlet/metrics/metrics.go"},"metrics.go")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/pkg/scheduler/metrics/metrics.go"},"metrics.go")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/pkg/descheduler/metrics/metrics.go"},"metrics.go")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/koordinator-sh/koordinator/tree/main/pkg/slo-controller/metrics/metrics.go"},"metrics.go"))))}u.isMDXComponent=!0}}]);