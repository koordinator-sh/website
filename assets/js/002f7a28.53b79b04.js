"use strict";(self.webpackChunkkoordinator_sh=self.webpackChunkkoordinator_sh||[]).push([[9110],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>k});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),c=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},u=function(e){var t=c(e.components);return n.createElement(s.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),p=c(a),m=r,k=p["".concat(s,".").concat(m)]||p[m]||d[m]||l;return a?n.createElement(k,o(o({ref:t},u),{},{components:a})):n.createElement(k,o({ref:t},u))}));function k(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=a.length,o=new Array(l);o[0]=m;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i[p]="string"==typeof e?e:r,o[1]=i;for(var c=2;c<l;c++)o[c]=a[c];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},12713:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>d,frontMatter:()=>l,metadata:()=>i,toc:()=>c});var n=a(87462),r=(a(67294),a(3905));const l={sidebar_position:7},o="Batch Workload Colocation Quick Start Guide",i={unversionedId:"best-practices/batch-colocation-quick-start",id:"best-practices/batch-colocation-quick-start",title:"Batch Workload Colocation Quick Start Guide",description:"This guide helps community newcomers quickly understand and deploy Koordinator for batch workload colocation. We'll cover core concepts, deployment process, and important considerations in an easy-to-understand way.",source:"@site/docs/best-practices/batch-colocation-quick-start.md",sourceDirName:"best-practices",slug:"/best-practices/batch-colocation-quick-start",permalink:"/docs/next/best-practices/batch-colocation-quick-start",draft:!1,editUrl:"https://github.com/koordinator-sh/koordinator.sh/edit/main/docs/best-practices/batch-colocation-quick-start.md",tags:[],version:"current",lastUpdatedBy:"saintube",lastUpdatedAt:1760579818,formattedLastUpdatedAt:"Oct 16, 2025",sidebarPosition:7,frontMatter:{sidebar_position:7},sidebar:"docs",previous:{title:"Enhanced NodeResourceFit Plugin",permalink:"/docs/next/designs/node-resource-fit-plus-scoring"},next:{title:"Colocation of Spark Jobs",permalink:"/docs/next/best-practices/colocation-of-spark-jobs"}},s={},c=[{value:"What is Batch Colocation?",id:"what-is-batch-colocation",level:2},{value:"Why Batch Colocation?",id:"why-batch-colocation",level:3},{value:"Core Concepts",id:"core-concepts",level:2},{value:"1. QoS Classes",id:"1-qos-classes",level:3},{value:"2. Priority Classes",id:"2-priority-classes",level:3},{value:"3. Resource Model",id:"3-resource-model",level:3},{value:"4. Resource Types",id:"4-resource-types",level:3},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Installation",id:"installation",level:2},{value:"Step 1: Install Koordinator",id:"step-1-install-koordinator",level:3},{value:"Step 2: Verify Priority Classes",id:"step-2-verify-priority-classes",level:3},{value:"Running Your First Batch Workload",id:"running-your-first-batch-workload",level:2},{value:"Method 1: Using ClusterColocationProfile (Recommended)",id:"method-1-using-clustercolocationprofile-recommended",level:3},{value:"Step 1: Create a Namespace",id:"step-1-create-a-namespace",level:4},{value:"Step 2: Create ClusterColocationProfile",id:"step-2-create-clustercolocationprofile",level:4},{value:"Step 3: Create a Batch Job",id:"step-3-create-a-batch-job",level:4},{value:"Step 4: Verify the Configuration",id:"step-4-verify-the-configuration",level:4},{value:"Method 2: Manual Configuration",id:"method-2-manual-configuration",level:3},{value:"Monitoring and Verification",id:"monitoring-and-verification",level:2},{value:"Check Node Resources",id:"check-node-resources",level:3},{value:"Monitor Resource Usage",id:"monitor-resource-usage",level:3},{value:"Check Node Metrics",id:"check-node-metrics",level:3},{value:"Important Considerations",id:"important-considerations",level:2},{value:"1. Resource Limits",id:"1-resource-limits",level:3},{value:"2. QoS Guarantees",id:"2-qos-guarantees",level:3},{value:"3. Workload Suitability",id:"3-workload-suitability",level:3},{value:"4. Failure Handling",id:"4-failure-handling",level:3},{value:"5. Scheduler Configuration",id:"5-scheduler-configuration",level:3},{value:"6. Namespace Isolation (Optional)",id:"6-namespace-isolation-optional",level:3},{value:"Common Patterns",id:"common-patterns",level:2},{value:"Pattern 1: Data Processing Pipeline",id:"pattern-1-data-processing-pipeline",level:3},{value:"Pattern 2: CronJob for Scheduled Batch",id:"pattern-2-cronjob-for-scheduled-batch",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Issue 1: Pod Stuck in Pending",id:"issue-1-pod-stuck-in-pending",level:3},{value:"Issue 2: Pod Evicted Frequently",id:"issue-2-pod-evicted-frequently",level:3},{value:"Issue 3: Batch Resources Not Available",id:"issue-3-batch-resources-not-available",level:3},{value:"Next Steps",id:"next-steps",level:2},{value:"Summary",id:"summary",level:2},{value:"References",id:"references",level:2}],u={toc:c},p="wrapper";function d(e){let{components:t,...l}=e;return(0,r.kt)(p,(0,n.Z)({},u,l,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"batch-workload-colocation-quick-start-guide"},"Batch Workload Colocation Quick Start Guide"),(0,r.kt)("p",null,"This guide helps community newcomers quickly understand and deploy Koordinator for batch workload colocation. We'll cover core concepts, deployment process, and important considerations in an easy-to-understand way."),(0,r.kt)("h2",{id:"what-is-batch-colocation"},"What is Batch Colocation?"),(0,r.kt)("p",null,"Batch colocation is a technique that allows running batch processing workloads (like data analysis, machine learning training, offline jobs) alongside latency-sensitive applications (like web services, microservices) on the same Kubernetes cluster. By utilizing idle resources from online services, you can significantly improve cluster resource utilization while maintaining service quality."),(0,r.kt)("h3",{id:"why-batch-colocation"},"Why Batch Colocation?"),(0,r.kt)("p",null,"In a typical Kubernetes cluster:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Online services")," request resources (CPU, memory) based on peak traffic, but actual usage is often much lower"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Idle resources")," are allocated but unused most of the time"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Cluster utilization")," is typically low (20-40%)")),(0,r.kt)("p",null,"Koordinator enables you to:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Reclaim")," idle resources from online services"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Run batch jobs")," using these reclaimed resources"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Improve utilization")," to 50-80% while maintaining service quality")),(0,r.kt)("h2",{id:"core-concepts"},"Core Concepts"),(0,r.kt)("h3",{id:"1-qos-classes"},"1. QoS Classes"),(0,r.kt)("p",null,"Koordinator defines five QoS (Quality of Service) classes for different workload types:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"QoS Class"),(0,r.kt)("th",{parentName:"tr",align:null},"Use Case"),(0,r.kt)("th",{parentName:"tr",align:null},"Resource Guarantee"),(0,r.kt)("th",{parentName:"tr",align:null},"Typical Workload"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"SYSTEM")),(0,r.kt)("td",{parentName:"tr",align:null},"System services"),(0,r.kt)("td",{parentName:"tr",align:null},"Limited but guaranteed"),(0,r.kt)("td",{parentName:"tr",align:null},"DaemonSets, system processes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"LSE")),(0,r.kt)("td",{parentName:"tr",align:null},"Exclusive latency-sensitive"),(0,r.kt)("td",{parentName:"tr",align:null},"Reserved, isolated"),(0,r.kt)("td",{parentName:"tr",align:null},"Middleware (rarely used)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"LSR")),(0,r.kt)("td",{parentName:"tr",align:null},"Reserved latency-sensitive"),(0,r.kt)("td",{parentName:"tr",align:null},"CPU cores reserved"),(0,r.kt)("td",{parentName:"tr",align:null},"Critical online services")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"LS")),(0,r.kt)("td",{parentName:"tr",align:null},"Shared latency-sensitive"),(0,r.kt)("td",{parentName:"tr",align:null},"Shared with burst capability"),(0,r.kt)("td",{parentName:"tr",align:null},"Typical microservices")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"BE")),(0,r.kt)("td",{parentName:"tr",align:null},"Best Effort"),(0,r.kt)("td",{parentName:"tr",align:null},"No guarantee, can be throttled/evicted"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Batch jobs")," \u2b50")))),(0,r.kt)("p",null,"For batch workloads, you'll primarily use ",(0,r.kt)("strong",{parentName:"p"},"BE (Best Effort)")," QoS class."),(0,r.kt)("h3",{id:"2-priority-classes"},"2. Priority Classes"),(0,r.kt)("p",null,"Koordinator extends Kubernetes PriorityClass with four levels:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"PriorityClass"),(0,r.kt)("th",{parentName:"tr",align:null},"Priority Range"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"),(0,r.kt)("th",{parentName:"tr",align:null},"Use for Batch?"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"koord-prod")),(0,r.kt)("td",{parentName:"tr",align:null},"[9000, 9999]"),(0,r.kt)("td",{parentName:"tr",align:null},"Production, guaranteed quota"),(0,r.kt)("td",{parentName:"tr",align:null},"\u274c No")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"koord-mid")),(0,r.kt)("td",{parentName:"tr",align:null},"[7000, 7999]"),(0,r.kt)("td",{parentName:"tr",align:null},"Medium priority, guaranteed quota"),(0,r.kt)("td",{parentName:"tr",align:null},"\u274c No")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"koord-batch")),(0,r.kt)("td",{parentName:"tr",align:null},"[5000, 5999]"),(0,r.kt)("td",{parentName:"tr",align:null},"Batch workloads, allows borrowing"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2705 ",(0,r.kt)("strong",{parentName:"td"},"Yes"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"koord-free")),(0,r.kt)("td",{parentName:"tr",align:null},"[3000, 3999]"),(0,r.kt)("td",{parentName:"tr",align:null},"Free resources, no guarantee"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2705 Optional")))),(0,r.kt)("p",null,"For most batch workloads, use ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"koord-batch"))," priority class."),(0,r.kt)("h3",{id:"3-resource-model"},"3. Resource Model"),(0,r.kt)("p",null,"Koordinator's colocation model works as follows:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Resource Model",src:a(8105).Z,width:"1058",height:"353"})),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Limit"),": Resources requested by high-priority pods (LS/LSR)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Usage"),": Actual resources used (varies over time)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Reclaimable"),": Resources between usage and limit - available for BE pods"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"BE Pods"),": Run using reclaimable resources")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Key Point"),": Batch jobs (BE) use idle resources that would otherwise be wasted, without affecting online service performance."),(0,r.kt)("h3",{id:"4-resource-types"},"4. Resource Types"),(0,r.kt)("p",null,"Koordinator introduces special resource types for batch workloads:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Resource Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"),(0,r.kt)("th",{parentName:"tr",align:null},"Use in Pod Spec"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"kubernetes.io/batch-cpu")),(0,r.kt)("td",{parentName:"tr",align:null},"CPU for batch workloads"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2705 Required")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"kubernetes.io/batch-memory")),(0,r.kt)("td",{parentName:"tr",align:null},"Memory for batch workloads"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2705 Required")))),(0,r.kt)("p",null,"These resources are allocated from the cluster's reclaimable pool."),(0,r.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("p",null,"Before getting started, ensure you have:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Kubernetes cluster")," (version >= 1.18)"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"kubectl")," configured to access your cluster"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Helm")," (version >= 3.5) - ",(0,r.kt)("a",{parentName:"li",href:"https://helm.sh/docs/intro/install/"},"Install Helm")),(0,r.kt)("li",{parentName:"ol"},"(Recommended) ",(0,r.kt)("strong",{parentName:"li"},"Linux kernel")," version >= 4.19 for best performance")),(0,r.kt)("h2",{id:"installation"},"Installation"),(0,r.kt)("h3",{id:"step-1-install-koordinator"},"Step 1: Install Koordinator"),(0,r.kt)("p",null,"Add the Koordinator Helm repository:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"helm repo add koordinator-sh https://koordinator-sh.github.io/charts/\nhelm repo update\n")),(0,r.kt)("p",null,"Install Koordinator (latest stable version):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"helm install koordinator koordinator-sh/koordinator --version 1.6.0\n")),(0,r.kt)("p",null,"Verify the installation:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get pod -n koordinator-system\n")),(0,r.kt)("p",null,"Expected output (all pods should be Running):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"NAME                                  READY   STATUS    RESTARTS   AGE\nkoord-descheduler-xxx                 1/1     Running   0          2m\nkoord-manager-xxx                     1/1     Running   0          2m\nkoord-manager-xxx                     1/1     Running   0          2m\nkoord-scheduler-xxx                   1/1     Running   0          2m\nkoord-scheduler-xxx                   1/1     Running   0          2m\nkoordlet-xxx                          1/1     Running   0          2m\nkoordlet-xxx                          1/1     Running   0          2m\n")),(0,r.kt)("h3",{id:"step-2-verify-priority-classes"},"Step 2: Verify Priority Classes"),(0,r.kt)("p",null,"Check that Koordinator PriorityClasses are created:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get priorityclass | grep koord\n")),(0,r.kt)("p",null,"Expected output:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"koord-batch         5000        false        10m\nkoord-free          3000        false        10m\nkoord-mid           7000        false        10m\nkoord-prod          9000        false        10m\n")),(0,r.kt)("h2",{id:"running-your-first-batch-workload"},"Running Your First Batch Workload"),(0,r.kt)("h3",{id:"method-1-using-clustercolocationprofile-recommended"},"Method 1: Using ClusterColocationProfile (Recommended)"),(0,r.kt)("p",null,"ClusterColocationProfile automatically injects colocation configurations into pods based on labels. This is the easiest way for batch workloads."),(0,r.kt)("h4",{id:"step-1-create-a-namespace"},"Step 1: Create a Namespace"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl create namespace batch-demo\nkubectl label namespace batch-demo koordinator.sh/enable-colocation=true\n")),(0,r.kt)("h4",{id:"step-2-create-clustercolocationprofile"},"Step 2: Create ClusterColocationProfile"),(0,r.kt)("p",null,"Create ",(0,r.kt)("inlineCode",{parentName:"p"},"batch-colocation-profile.yaml"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: config.koordinator.sh/v1alpha1\nkind: ClusterColocationProfile\nmetadata:\n  name: batch-workload-profile\nspec:\n  # Match namespace with label\n  namespaceSelector:\n    matchLabels:\n      koordinator.sh/enable-colocation: "true"\n  # Match pods with label\n  selector:\n    matchLabels:\n      app-type: batch\n  # Set QoS to BE for batch workloads\n  qosClass: BE\n  # Set priority class\n  priorityClassName: koord-batch\n  # Use Koordinator scheduler\n  schedulerName: koord-scheduler\n  # Add labels for tracking\n  labels:\n    koordinator.sh/mutated: "true"\n')),(0,r.kt)("p",null,"Apply the profile:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl apply -f batch-colocation-profile.yaml\n")),(0,r.kt)("h4",{id:"step-3-create-a-batch-job"},"Step 3: Create a Batch Job"),(0,r.kt)("p",null,"Create ",(0,r.kt)("inlineCode",{parentName:"p"},"batch-job.yaml"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: batch/v1\nkind: Job\nmetadata:\n  name: data-processing-job\n  namespace: batch-demo\nspec:\n  completions: 1\n  template:\n    metadata:\n      labels:\n        app-type: batch  # This label triggers the profile\n    spec:\n      containers:\n      - name: worker\n        image: python:3.9\n        command: \n          - python\n          - -c\n          - |\n            import time\n            import random\n            print("Starting data processing...")\n            for i in range(60):\n              # Simulate data processing\n              time.sleep(1)\n              print(f"Processing batch {i+1}/60...")\n            print("Job completed!")\n        resources:\n          requests:\n            cpu: "2"           # Will be converted to batch-cpu\n            memory: "4Gi"      # Will be converted to batch-memory\n          limits:\n            cpu: "2"\n            memory: "4Gi"\n      restartPolicy: Never\n')),(0,r.kt)("p",null,"Apply the job:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl apply -f batch-job.yaml\n")),(0,r.kt)("h4",{id:"step-4-verify-the-configuration"},"Step 4: Verify the Configuration"),(0,r.kt)("p",null,"Check that the pod has been configured correctly:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get pod -n batch-demo -l app-type=batch -o yaml\n")),(0,r.kt)("p",null,"You should see the colocation configurations automatically injected:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'metadata:\n  labels:\n    koordinator.sh/qosClass: BE         # \u2705 QoS injected\n    koordinator.sh/mutated: "true"      # \u2705 Profile applied\nspec:\n  priorityClassName: koord-batch        # \u2705 Priority set\n  schedulerName: koord-scheduler        # \u2705 Using Koordinator scheduler\n  containers:\n  - name: worker\n    resources:\n      limits:\n        kubernetes.io/batch-cpu: "2000"      # \u2705 Converted to batch resources\n        kubernetes.io/batch-memory: "4Gi"\n      requests:\n        kubernetes.io/batch-cpu: "2000"\n        kubernetes.io/batch-memory: "4Gi"\n')),(0,r.kt)("h3",{id:"method-2-manual-configuration"},"Method 2: Manual Configuration"),(0,r.kt)("p",null,"If you prefer explicit configuration without ClusterColocationProfile:"),(0,r.kt)("p",null,"Create ",(0,r.kt)("inlineCode",{parentName:"p"},"manual-batch-job.yaml"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: batch/v1\nkind: Job\nmetadata:\n  name: manual-batch-job\n  namespace: batch-demo\nspec:\n  completions: 1\n  template:\n    metadata:\n      labels:\n        koordinator.sh/qosClass: BE  # Explicitly set QoS\n    spec:\n      priorityClassName: koord-batch  # Explicitly set priority\n      schedulerName: koord-scheduler  # Use Koordinator scheduler\n      containers:\n      - name: worker\n        image: python:3.9\n        command: ["python", "-c", "print(\'Hello from batch job\'); import time; time.sleep(30)"]\n        resources:\n          requests:\n            kubernetes.io/batch-cpu: "1000"     # Use batch resources\n            kubernetes.io/batch-memory: "2Gi"\n          limits:\n            kubernetes.io/batch-cpu: "1000"\n            kubernetes.io/batch-memory: "2Gi"\n      restartPolicy: Never\n')),(0,r.kt)("p",null,"Apply the job:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl apply -f manual-batch-job.yaml\n")),(0,r.kt)("h2",{id:"monitoring-and-verification"},"Monitoring and Verification"),(0,r.kt)("h3",{id:"check-node-resources"},"Check Node Resources"),(0,r.kt)("p",null,"View node resource allocation:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'kubectl get node -o yaml | grep -A 10 "allocatable:"\n')),(0,r.kt)("p",null,"You should see batch resources available:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'allocatable:\n  cpu: "8"\n  memory: "16Gi"\n  kubernetes.io/batch-cpu: "15000"      # Batch CPU available\n  kubernetes.io/batch-memory: "20Gi"    # Batch memory available\n')),(0,r.kt)("h3",{id:"monitor-resource-usage"},"Monitor Resource Usage"),(0,r.kt)("p",null,"Check actual resource usage:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl top nodes\nkubectl top pods -n batch-demo\n")),(0,r.kt)("h3",{id:"check-node-metrics"},"Check Node Metrics"),(0,r.kt)("p",null,"Koordinator creates NodeMetric resources with detailed metrics:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get nodemetric -o yaml\n")),(0,r.kt)("p",null,"This shows real-time resource usage, helping Koordinator make scheduling decisions."),(0,r.kt)("h2",{id:"important-considerations"},"Important Considerations"),(0,r.kt)("h3",{id:"1-resource-limits"},"1. Resource Limits"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"DO:")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u2705 Always set both ",(0,r.kt)("inlineCode",{parentName:"li"},"requests")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"limits")," for batch workloads"),(0,r.kt)("li",{parentName:"ul"},"\u2705 Use realistic resource estimates"),(0,r.kt)("li",{parentName:"ul"},"\u2705 Set ",(0,r.kt)("inlineCode",{parentName:"li"},"requests == limits")," for predictable behavior")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"DON'T:")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u274c Don't over-request resources you don't need"),(0,r.kt)("li",{parentName:"ul"},"\u274c Don't omit resource specifications")),(0,r.kt)("h3",{id:"2-qos-guarantees"},"2. QoS Guarantees"),(0,r.kt)("p",null,"Understand the BE QoS behavior:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"CPU"),": BE pods get remaining CPU cycles; may be throttled when LS pods need resources"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Memory"),": BE pods can be evicted if memory pressure occurs"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Priority"),": BE pods are scheduled after higher-priority pods")),(0,r.kt)("h3",{id:"3-workload-suitability"},"3. Workload Suitability"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Good for Batch Colocation:")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u2705 Data processing jobs"),(0,r.kt)("li",{parentName:"ul"},"\u2705 Machine learning training"),(0,r.kt)("li",{parentName:"ul"},"\u2705 Batch analytics"),(0,r.kt)("li",{parentName:"ul"},"\u2705 Video transcoding"),(0,r.kt)("li",{parentName:"ul"},"\u2705 Log processing"),(0,r.kt)("li",{parentName:"ul"},"\u2705 ETL jobs")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Not Suitable:")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u274c Latency-sensitive services"),(0,r.kt)("li",{parentName:"ul"},"\u274c Real-time processing"),(0,r.kt)("li",{parentName:"ul"},"\u274c Jobs requiring guaranteed completion time"),(0,r.kt)("li",{parentName:"ul"},"\u274c Stateful services with strict SLA")),(0,r.kt)("h3",{id:"4-failure-handling"},"4. Failure Handling"),(0,r.kt)("p",null,"Batch jobs may be:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Throttled"),": When high-priority pods need CPU"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Evicted"),": During memory pressure")),(0,r.kt)("p",null,"Design your batch workloads to handle:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Checkpointing: Save progress periodically"),(0,r.kt)("li",{parentName:"ul"},"Retry logic: Use Job ",(0,r.kt)("inlineCode",{parentName:"li"},"backoffLimit")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"restartPolicy")),(0,r.kt)("li",{parentName:"ul"},"Idempotency: Ensure jobs can safely restart")),(0,r.kt)("p",null,"Example with retry:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: batch/v1\nkind: Job\nmetadata:\n  name: resilient-batch-job\n  namespace: batch-demo\nspec:\n  backoffLimit: 3          # Retry up to 3 times\n  completions: 1\n  template:\n    metadata:\n      labels:\n        app-type: batch\n    spec:\n      restartPolicy: OnFailure  # Retry on failure\n      containers:\n      - name: worker\n        image: your-batch-image\n        # ... rest of configuration\n")),(0,r.kt)("h3",{id:"5-scheduler-configuration"},"5. Scheduler Configuration"),(0,r.kt)("p",null,"For batch workloads, ensure you're using the Koordinator scheduler:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"spec:\n  schedulerName: koord-scheduler  # Required for batch resource scheduling\n")),(0,r.kt)("p",null,"Without this, the pod will use the default Kubernetes scheduler and won't benefit from colocation features."),(0,r.kt)("h3",{id:"6-namespace-isolation-optional"},"6. Namespace Isolation (Optional)"),(0,r.kt)("p",null,"For better organization, dedicate namespaces to batch workloads:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# Create batch namespace\nkubectl create namespace batch-workloads\n\n# Label for colocation\nkubectl label namespace batch-workloads koordinator.sh/enable-colocation=true\n\n# Create profile for this namespace\nkubectl apply -f batch-colocation-profile.yaml\n")),(0,r.kt)("h2",{id:"common-patterns"},"Common Patterns"),(0,r.kt)("h3",{id:"pattern-1-data-processing-pipeline"},"Pattern 1: Data Processing Pipeline"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: batch/v1\nkind: Job\nmetadata:\n  name: data-pipeline\n  namespace: batch-demo\nspec:\n  completions: 5          # Process 5 batches\n  parallelism: 2          # Run 2 at a time\n  template:\n    metadata:\n      labels:\n        app-type: batch\n    spec:\n      containers:\n      - name: processor\n        image: data-processor:latest\n        resources:\n          requests:\n            cpu: "4"\n            memory: "8Gi"\n          limits:\n            cpu: "4"\n            memory: "8Gi"\n      restartPolicy: OnFailure\n')),(0,r.kt)("h3",{id:"pattern-2-cronjob-for-scheduled-batch"},"Pattern 2: CronJob for Scheduled Batch"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: batch/v1\nkind: CronJob\nmetadata:\n  name: nightly-report\n  namespace: batch-demo\nspec:\n  schedule: "0 2 * * *"   # Run at 2 AM daily\n  jobTemplate:\n    spec:\n      template:\n        metadata:\n          labels:\n            app-type: batch\n        spec:\n          containers:\n          - name: report-generator\n            image: report-gen:latest\n            resources:\n              requests:\n                cpu: "2"\n                memory: "4Gi"\n              limits:\n                cpu: "2"\n                memory: "4Gi"\n          restartPolicy: OnFailure\n')),(0,r.kt)("h2",{id:"troubleshooting"},"Troubleshooting"),(0,r.kt)("h3",{id:"issue-1-pod-stuck-in-pending"},"Issue 1: Pod Stuck in Pending"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Symptom"),": Batch pod remains in Pending state"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Check"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl describe pod <pod-name> -n batch-demo\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Common causes"),":"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Insufficient batch resources available"),(0,r.kt)("li",{parentName:"ul"},"Node selector constraints"),(0,r.kt)("li",{parentName:"ul"},"Resource requests too high")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Solution"),": Check node allocatable resources and reduce requests if needed."),(0,r.kt)("h3",{id:"issue-2-pod-evicted-frequently"},"Issue 2: Pod Evicted Frequently"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Symptom"),": Batch pods are evicted often"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Check"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get events -n batch-demo --sort-by='.lastTimestamp'\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Common causes"),":"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Memory pressure on nodes"),(0,r.kt)("li",{parentName:"ul"},"High-priority pods need resources"),(0,r.kt)("li",{parentName:"ul"},"Resource overcommitment too aggressive")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Solution"),": "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Reduce memory requests"),(0,r.kt)("li",{parentName:"ul"},"Use checkpointing to handle evictions"),(0,r.kt)("li",{parentName:"ul"},"Tune Koordinator resource reservation settings (advanced)")),(0,r.kt)("h3",{id:"issue-3-batch-resources-not-available"},"Issue 3: Batch Resources Not Available"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Symptom"),": No ",(0,r.kt)("inlineCode",{parentName:"p"},"kubernetes.io/batch-cpu")," resources on nodes"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Check"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get nodemetric -o yaml\nkubectl get pod -n koordinator-system\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Solution"),":"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Ensure Koordlet is running on all nodes"),(0,r.kt)("li",{parentName:"ul"},"Check Koordlet logs: ",(0,r.kt)("inlineCode",{parentName:"li"},"kubectl logs -n koordinator-system koordlet-xxx")),(0,r.kt)("li",{parentName:"ul"},"Verify nodes have allocatable resources")),(0,r.kt)("h2",{id:"next-steps"},"Next Steps"),(0,r.kt)("p",null,"After successfully running batch workloads, you can explore:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Advanced Scheduling"),":"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"../user-manuals/load-aware-scheduling"},"Load-aware Scheduling")," - Schedule based on real-time load"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"../user-manuals/gang-scheduling"},"Gang Scheduling")," - All-or-nothing scheduling for distributed jobs"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Resource Management"),":"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"../user-manuals/cpu-qos"},"CPU QoS")," - Fine-tune CPU guarantees"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"../user-manuals/memory-qos"},"Memory QoS")," - Control memory behavior"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"../user-manuals/resource-reservation"},"Resource Reservation")," - Reserve resources for specific workloads"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Monitoring"),":"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"../user-manuals/slo-config"},"SLO Config")," - Configure SLO parameters"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"../user-manuals/performance-collector"},"Performance Collector")," - Collect performance metrics"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Other Batch Frameworks"),":"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"./colocation-of-spark-jobs"},"Colocation of Spark Jobs")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"./colocation-of-hadoop-yarn"},"Colocation of Hadoop YARN"))))),(0,r.kt)("h2",{id:"summary"},"Summary"),(0,r.kt)("p",null,"In this guide, you learned:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u2705 Core concepts: QoS classes, Priority, Resource Model"),(0,r.kt)("li",{parentName:"ul"},"\u2705 How to install Koordinator"),(0,r.kt)("li",{parentName:"ul"},"\u2705 Two methods to run batch workloads (ClusterColocationProfile and manual)"),(0,r.kt)("li",{parentName:"ul"},"\u2705 Important considerations for production use"),(0,r.kt)("li",{parentName:"ul"},"\u2705 Common patterns and troubleshooting")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Key Takeaways"),":"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Use ",(0,r.kt)("strong",{parentName:"li"},"BE QoS")," and ",(0,r.kt)("strong",{parentName:"li"},"koord-batch priority")," for batch workloads"),(0,r.kt)("li",{parentName:"ul"},"Leverage ",(0,r.kt)("strong",{parentName:"li"},"ClusterColocationProfile")," for easy configuration"),(0,r.kt)("li",{parentName:"ul"},"Design for ",(0,r.kt)("strong",{parentName:"li"},"eviction and throttling")," with retries and checkpointing"),(0,r.kt)("li",{parentName:"ul"},"Monitor resource usage and adjust as needed")),(0,r.kt)("p",null,"Start small with simple batch jobs and gradually increase complexity as you become familiar with Koordinator's behavior!"),(0,r.kt)("h2",{id:"references"},"References"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"../architecture/resource-model"},"Architecture: Resource Model")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"../architecture/qos"},"Architecture: QoS")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"../architecture/priority"},"Architecture: Priority")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"../user-manuals/colocation-profile"},"User Manual: Colocation Profile")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"../installation"},"Installation Guide"))))}d.isMDXComponent=!0},8105:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/resource-model-0f6ca53f0a140a2be9705e75758caf22.png"}}]);