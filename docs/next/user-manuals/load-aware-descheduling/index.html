<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.17">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Koordinator RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Koordinator Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Koordinator" href="/opensearch.xml"><title data-rh="true">Load Aware Descheduling | Koordinator</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://koordinator.sh/docs/next/user-manuals/load-aware-descheduling"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Load Aware Descheduling | Koordinator"><meta data-rh="true" name="description" content="The load-aware scheduling supported in the scheduler can select nodes with lower loads to run new Pods during scheduling, but as time, cluster environment changes, and changes in traffic/requests faced by workloads, the utilization of nodes will change dynamically Changes in the cluster will break the original load balance between nodes in the cluster, and even extreme load imbalance may occur, affecting the runtime quality of the workload."><meta data-rh="true" property="og:description" content="The load-aware scheduling supported in the scheduler can select nodes with lower loads to run new Pods during scheduling, but as time, cluster environment changes, and changes in traffic/requests faced by workloads, the utilization of nodes will change dynamically Changes in the cluster will break the original load balance between nodes in the cluster, and even extreme load imbalance may occur, affecting the runtime quality of the workload."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://koordinator.sh/docs/next/user-manuals/load-aware-descheduling"><link data-rh="true" rel="alternate" href="https://koordinator.sh/docs/next/user-manuals/load-aware-descheduling" hreflang="en"><link data-rh="true" rel="alternate" href="https://koordinator.sh/zh-Hans/docs/next/user-manuals/load-aware-descheduling" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://koordinator.sh/docs/next/user-manuals/load-aware-descheduling" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://FKASWWQYOP-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.48d3146e.css">
<link rel="preload" href="/assets/js/runtime~main.ea9c349b.js" as="script">
<link rel="preload" href="/assets/js/main.ee3946e7.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><div class="announcementBar_IbjG" role="banner"><div class="announcementBarPlaceholder_NC_W"></div><div class="announcementBarContent_KsVm">‚≠êÔ∏è If you like Koordinator, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/koordinator-sh/koordinator">GitHub</a>! ‚≠êÔ∏è</div><button type="button" class="clean-btn close announcementBarClose_FG1z" aria-label="Close"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Koordinator" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo.svg" alt="Koordinator" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Koordinator</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">Documentation</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link" href="/docs/next/">v1.4 üöß</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/next/user-manuals/load-aware-descheduling">v1.4 üöß</a></li><li><a class="dropdown__link" href="/docs/user-manuals/load-aware-descheduling">v1.3</a></li><li><a class="dropdown__link" href="/docs/v1.2/user-manuals/load-aware-descheduling">v1.2</a></li><li><a class="dropdown__link" href="/docs/v1.1/user-manuals/load-aware-descheduling">v1.1</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_dNtB"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/docs/next/user-manuals/load-aware-descheduling" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">English</a></li><li><a href="/zh-Hans/docs/next/user-manuals/load-aware-descheduling" target="_self" rel="noopener noreferrer" class="dropdown__link">ÁÆÄ‰Ωì‰∏≠Êñá</a></li></ul></div><a href="https://github.com/koordinator-sh/koordinator" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_S7eR toggle_TdHA toggleDisabled_f9M3"><div class="toggleButton_rCf9" role="button" tabindex="-1"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></div><input type="checkbox" class="toggleScreenReader_g2nN" aria-label="Switch between dark and light mode (currently light mode)"></div><div class="searchBox_qEbK"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO menuWithAnnouncementBar_x19h"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/next/">Getting Started</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/installation">Installation</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/next/architecture/overview">Architecture</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/architecture/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/architecture/resource-model">Resource Model</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/architecture/priority">Priority</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/architecture/qos">QoS</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/next/user-manuals/colocation-profile">User Manuals</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/user-manuals/colocation-profile">Colocation Profile</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/user-manuals/load-aware-scheduling">Load Aware Scheduling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/next/user-manuals/load-aware-descheduling">Load Aware Descheduling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/user-manuals/fine-grained-cpu-orchestration">Fine-grained CPU Orchestration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/user-manuals/resource-reservation">Resource Reservation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/user-manuals/pod-migration-job">PodMigrationJob</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/user-manuals/fine-grained-device-scheduling">Device Scheduling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/user-manuals/gang-scheduling">GangScheduling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/user-manuals/multi-hierarchy-elastic-quota-management">Multi Hierarchy Elastic Quota Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/user-manuals/slo-config">SLO Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/user-manuals/cpu-suppress">CPU Suppress</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/user-manuals/cpu-burst">CPU Burst</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/user-manuals/cpu-qos">CPU QoS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/user-manuals/cpu-evict">Eviction Strategy base on CPU Satisfaction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/user-manuals/memory-qos">Memory QoS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/user-manuals/memory-evict">Eviction Strategy base on Memory Usage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/user-manuals/performance-collector">Performance Collector</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/next/designs/koordlet-overview">Design Details</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/next/best-practices/colocation-of-spark-jobs">Best Practices</a></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <!-- -->Koordinator<!-- --> <b>v1.4 üöß</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/user-manuals/load-aware-descheduling">latest version</a></b> (<!-- -->v1.3<!-- -->).</div></div><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/">üè†</a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link breadcrumbsItemLink_e5ie">User Manuals</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/docs/next/user-manuals/load-aware-descheduling">Load Aware Descheduling</a></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: v1.4 üöß</span><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Load Aware Descheduling</h1><p>The load-aware scheduling supported in the scheduler can select nodes with lower loads to run new Pods during scheduling, but as time, cluster environment changes, and changes in traffic/requests faced by workloads, the utilization of nodes will change dynamically Changes in the cluster will break the original load balance between nodes in the cluster, and even extreme load imbalance may occur, affecting the runtime quality of the workload.</p><p>koord-descheduler perceives changes in the load of nodes in the cluster, automatically optimizes nodes that exceed the safety load to prevents extreme load imbalance.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="introduction">Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">‚Äã</a></h2><p>The LowNodeLoad plugin in the koord-descheduler is responsible for sensing the load of the node, and reducing the load hotspot by evict/migrate Pod. The <code>LowNodeLoad</code> plugin is different from the Kubernetes native descheduler plugin LowNodeUtilization in that <code>LowNodeLoad</code> decides to deschedule based on the actual utilization of nodes, while LowNodeUtilization decides to deschedule based on the resource allocation.</p><p>The <code>LowNodeLoad</code> plugin has two most important parameters:</p><ul><li><code>highThresholds</code> defines the target usage threshold of resources. The Pods on nodes exceeding this threshold will be evicted/migrated.</li><li><code>lowThresholds</code> defines the low usage threshold of resources. The Pods on nodes below this threshold will not be evicted/migrated.</li></ul><p>Take the following figure as an example, <code>lowThresholds</code> is 45%, <code>highThresholds</code> is 70%, we can classify nodes into three categories:</p><ol><li>Idle Node. Nodes with resource utilization below 45%;</li><li>Normal Node. For nodes whose resource utilization is higher than 45% but lower than 70%, this load water level range is a reasonable range we expect</li><li>Hotspot Node. If the node resource utilization rate is higher than 70%, the node will be judged as unsafe and belongs to the hotspot node, and some pods should be expelled to reduce the load level so that it does not exceed 70%.</li></ol><p><img loading="lazy" alt="image" src="/assets/images/low-node-load-3482df7bbffd96dc550f617ed99ff389.png" width="2828" height="926"></p><p>After identifying which nodes are hotspots, descheduler will perform a eviction/migration operation to evict some Pods from hotspot nodes to idle nodes.</p><p>If the total number of idle nodes in a cluster is not many, descheduling will be terminated. This can be helpful in large clusters where some nodes may be underutilized frequently or for short periods of time. By default, <code>numberOfNodes</code> is set to zero. This capability can be enabled by setting the parameter <code>numberOfNodes</code>.
Before migration, descheduler will calculate the actual free capacity to ensure that the sum of the actual utilization of the Pods to be migrated does not exceed the total free capacity in the cluster. These actual free capacities come from idle nodes, and the actual free capacity of an idle node = <code>(highThresholds - current load of the node) * total capacity of the node</code>. Suppose the load level of node A is 20%, the highThresholdss is 70%, and the total CPU of node A is 96C, then <code>(70%-20%) * 96 = 48C</code>, and this 48C is the free capacity that can be carried.</p><p>In addition, when migrating hotspot nodes, the Pods on the nodes will be filtered. Currently, descheduler supports multiple filtering parameters, which can avoid migration and expulsion of very important Pods:</p><ul><li>Filter by namespace. Can be configured to filter only certain namespaces or filter out certain namespaces</li><li>Filter by pod selector. Pods can be filtered out through the label selector, or Pods with certain Labels can be excluded</li><li>Configure <code>nodeFit</code> to check whether the scheduling rules have candidate nodes. When enabled, descheduler checks whether there is a matching Node in the cluster according to the Node Affinity/Node Selector/Toleration corresponding to the candidate Pod. If not, the Pod will not be evicted for migration. If you set <code>nodeFit</code> to false, the migration controller in the descheduler will complete the capacity reservation at this time, and start the migration after ensuring that there are resources.</li></ul><p>After the Pods are filtered out, these Pods are sorted from multiple dimensions such as QoSClass, Priority, actual usage, and creation time.</p><p>After pods have been filtered and sorted, the migration operation begins. Before migration, it will check whether the remaining free capacity is satisfied and whether the load the current node is higher than the target safety threshold. If one of these two conditions cannot be met, descheduling will stop. Every time a Pod is migrated, the remaining free capacity will be withheld, and the load of the current node will be adjusted at the same time until the remaining capacity is insufficient or the load reaches the safety threshold.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="setup">Setup<a class="hash-link" href="#setup" title="Direct link to heading">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="prerequisite">Prerequisite<a class="hash-link" href="#prerequisite" title="Direct link to heading">‚Äã</a></h3><ul><li>Kubernetes &gt;= 1.18</li><li>Koordinator &gt;= 1.1.1</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="installation">Installation<a class="hash-link" href="#installation" title="Direct link to heading">‚Äã</a></h3><p>Please make sure Koordinator components are correctly installed in your cluster. If not, please refer to <a href="/docs/installation">Installation</a>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="global-configuration-via-plugin-args">Global Configuration via plugin args<a class="hash-link" href="#global-configuration-via-plugin-args" title="Direct link to heading">‚Äã</a></h3><p>Load-aware descheduling is <em>Disabled</em> by default. You can modify the ConfigMap <code>koord-descheduler-config</code> to enable the plugin.</p><p>For users who need deep insight, please configure the rules of load-aware descheduling by modifying the ConfigMap
<code>koord-descheduler-config</code> in the helm chart. New configurations will take effect after the koord-descheduler restarts.</p><div class="codeBlockContainer_I0IT language-yaml theme-code-block"><div class="codeBlockContent_wNvx yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ConfigMap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> koord</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">descheduler</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">koord-descheduler-config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    apiVersion: descheduler/v1alpha2</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    kind: DeschedulerConfiguration</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    # Execute the LowNodeLoad plugin every 60s</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    deschedulingInterval: 60s  </span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    profiles:</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      - name: koord-descheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        plugins:</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          deschedule:</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            disabled:</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">              - name: &quot;*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          balance:</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            enabled:</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">              - name: LowNodeLoad  # Configure to enable the LowNodeLoad plugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          ....</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        pluginConfig:</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        - name: LowNodeLoad</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          args:</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            apiVersion: descheduler/v1alpha2</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            kind: LowNodeLoadArgs</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            evictableNamespaces:</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            # include and exclude are mutually exclusive, only one of them can be configured.</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            # include indicates that only the namespace configured below will be processed</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            # include:</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            #   - test-namespace</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">              # exclude means to only process namespaces other than those configured below</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">              exclude:</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                - &quot;kube-system&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                - &quot;koordinator-system&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            # lowThresholds defines the low usage threshold of resources</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            lowThresholds:</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">              cpu: 20</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">              memory: 30</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            # highThresholds defines the target usage threshold of resources</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            highThresholds:</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">              cpu: 50</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">              memory: 60</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        ....</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><table><thead><tr><th>Field</th><th>Description</th><th>Version</th></tr></thead><tbody><tr><td>paused</td><td>Paused indicates whether the LowNodeLoad should to work or not.</td><td>&gt;= v1.1.1</td></tr><tr><td>dryRun</td><td>DryRun means only execute the entire deschedule logic but don&#x27;t migrate Pod</td><td>&gt;= v1.1.1</td></tr><tr><td>numberOfNodes</td><td>NumberOfNodes can be configured to activate the strategy only when the number of under utilized nodes are above the configured value. This could be helpful in large clusters where a few nodes could go under utilized frequently or for a short period of time. By default, NumberOfNodes is set to zero.</td><td>&gt;= v1.1.1</td></tr><tr><td>evictableNamespaces</td><td>Naming this one differently since namespaces are still considered while considering resources used by pods but then filtered out before eviction.</td><td>&gt;= v1.1.1</td></tr><tr><td>nodeSelector</td><td>NodeSelector selects the nodes that matched labelSelector.</td><td>&gt;= v1.1.1</td></tr><tr><td>podSelectors</td><td>PodSelectors selects the pods that matched labelSelector.</td><td>&gt;= v1.1.1</td></tr><tr><td>nodeFit</td><td>NodeFit if enabled, it will check whether the candidate Pods have suitable nodes, including NodeAffinity, TaintTolerance, and whether resources are sufficient. By default, NodeFit is set to true.</td><td>&gt;= v1.1.1</td></tr><tr><td>useDeviationThresholds</td><td>If UseDeviationThresholds is set to <code>true</code>, the thresholds are considered as percentage deviations from mean resource usage. <code>lowThresholds</code> will be deducted from the mean among all nodes and <code>highThresholds</code> will be added to the mean. A resource consumption above (resp. below) this window is considered as overutilization (resp. underutilization).</td><td>&gt;= v1.1.1</td></tr><tr><td>highThresholds</td><td>HighThresholds defines the target usage threshold of resources</td><td>&gt;= v1.1.1</td></tr><tr><td>lowThresholds</td><td>LowThresholds defines the low usage threshold of resources</td><td>&gt;= v1.1.1</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_mojV" id="use-load-aware-descheduling">Use Load Aware Descheduling<a class="hash-link" href="#use-load-aware-descheduling" title="Direct link to heading">‚Äã</a></h2><p>The example cluster in this article has three 4-core 16GiB nodes.</p><ol><li>Deploy two <code>stress</code> pod with the YAML file below.</li></ol><div class="codeBlockContainer_I0IT language-yaml theme-code-block"><div class="codeBlockContent_wNvx yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> stress</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> stress</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> stress</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> stress</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> stress</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">args</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;--vm&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;2&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;--vm-bytes&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1600M&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;-c&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;2&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;--vm-hang&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;2&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> stress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> polinux/stress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">imagePullPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Always</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> stress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">limits</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;2&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 4Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;2&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 4Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">restartPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Always</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">schedulerName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> koord</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">scheduler </span><span class="token comment" style="color:#999988;font-style:italic"># use the koord-scheduler</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl create -f stress-demo.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.apps/stress-demo created</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ol start="2"><li>Watch the pod status util they become running.</li></ol><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get pod -o wide</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                           READY   STATUS    RESTARTS   AGE     IP          NODE                   NOMINATED NODE   READINESS GATES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stress-demo-7fdd89cc6b-lml7k   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          21m     </span><span class="token number" style="color:#36acaa">10.0</span><span class="token plain">.2.83   cn-beijing.10.0.2.54   </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">           </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stress-demo-7fdd89cc6b-xr5dl   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          4m40s   </span><span class="token number" style="color:#36acaa">10.0</span><span class="token plain">.2.77   cn-beijing.10.0.2.53   </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">           </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The stress pods are scheduled on <code>cn-beijing.10.0.2.53</code> and <code>cn-beijing.10.0.2.54</code>.</p><ol start="3"><li>Check the load of each node.</li></ol><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl </span><span class="token function" style="color:#d73a49">top</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">node</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                   CPU</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cores</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">   CPU%   MEMORY</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bytes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">   MEMORY%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cn-beijing.10.0.2.53   3825m        </span><span class="token number" style="color:#36acaa">98</span><span class="token plain">%    4051Mi          </span><span class="token number" style="color:#36acaa">31</span><span class="token plain">%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cn-beijing.10.0.2.54   2155m        </span><span class="token number" style="color:#36acaa">55</span><span class="token plain">%    4500Mi          </span><span class="token number" style="color:#36acaa">35</span><span class="token plain">%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cn-beijing.10.0.2.58   182m         </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">%     1367Mi          </span><span class="token number" style="color:#36acaa">10</span><span class="token plain">%</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In above order, <code>cn-beijing.10.0.2.53</code> and <code>cn-beijing.10.0.2.54</code> have the highest load, while <code>cn-beijing.10.0.2.58</code> has the lowest load.</p><ol start="4"><li><p>Update <code>koord-descheduler-config</code> to enable <code>LowNodeLoad</code> plugin.</p></li><li><p>Observe the Pod changes and wait for the koord-descheduler to execute the eviction/migration operation.</p></li></ol><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get pod -w</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                           READY   STATUS              RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stress-demo-7fdd89cc6b-lml7k   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running             </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          22m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stress-demo-7fdd89cc6b-xr5dl   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running             </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          5m45s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stress-demo-7fdd89cc6b-xr5dl   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Terminating         </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          5m59s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stress-demo-7fdd89cc6b-8k8wq   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     Pending             </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stress-demo-7fdd89cc6b-8k8wq   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     Pending             </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stress-demo-7fdd89cc6b-8k8wq   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     ContainerCreating   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stress-demo-7fdd89cc6b-8k8wq   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     ContainerCreating   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          1s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stress-demo-7fdd89cc6b-8k8wq   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running             </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          3s</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ol start="5"><li>Observe the Event, you can see the following migration records</li></ol><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get event </span><span class="token operator" style="color:#393A34">|</span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> stress-demo-7fdd89cc6b-xr5dl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">74s         Normal   Evicting             podmigrationjob/e54863dc-b651-47e3-9ffd-08b6b4ff64d5   Pod </span><span class="token string" style="color:#e3116c">&quot;default/stress-demo-7fdd89cc6b-xr5dl&quot;</span><span class="token plain"> evicted from </span><span class="token function" style="color:#d73a49">node</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;cn-beijing.10.0.2.53&quot;</span><span class="token plain"> by the reason </span><span class="token string" style="color:#e3116c">&quot;node is overutilized, cpu usage(56.13%)&gt;threshold(50.00%)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">41s         Normal   EvictComplete        podmigrationjob/e54863dc-b651-47e3-9ffd-08b6b4ff64d5   Pod </span><span class="token string" style="color:#e3116c">&quot;default/stress-demo-7fdd89cc6b-xr5dl&quot;</span><span class="token plain"> has been evicted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7m12s       Normal   Scheduled            pod/stress-demo-7fdd89cc6b-xr5dl                       Successfully assigned default/stress-demo-7fdd89cc6b-xr5dl to cn-beijing.10.0.2.53</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7m12s       Normal   AllocIPSucceed       pod/stress-demo-7fdd89cc6b-xr5dl                       Alloc IP </span><span class="token number" style="color:#36acaa">10.0</span><span class="token plain">.2.77/24</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7m12s       Normal   Pulling              pod/stress-demo-7fdd89cc6b-xr5dl                       Pulling image </span><span class="token string" style="color:#e3116c">&quot;polinux/stress&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6m59s       Normal   Pulled               pod/stress-demo-7fdd89cc6b-xr5dl                       Successfully pulled image </span><span class="token string" style="color:#e3116c">&quot;polinux/stress&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">12</span><span class="token plain">.685405843s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6m59s       Normal   Created              pod/stress-demo-7fdd89cc6b-xr5dl                       Created container stress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6m59s       Normal   Started              pod/stress-demo-7fdd89cc6b-xr5dl                       Started container stress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">74s         Normal   Descheduled          pod/stress-demo-7fdd89cc6b-xr5dl                       Pod evicted from </span><span class="token function" style="color:#d73a49">node</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;cn-beijing.10.0.2.53&quot;</span><span class="token plain"> by the reason </span><span class="token string" style="color:#e3116c">&quot;node is overutilized, cpu usage(56.13%)&gt;threshold(50.00%)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">73s         Normal   Killing              pod/stress-demo-7fdd89cc6b-xr5dl                       Stopping container stress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7m13s       Normal   SuccessfulCreate     replicaset/stress-demo-7fdd89cc6b                      Created pod: stress-demo-7fdd89cc6b-xr5dl</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/koordinator-sh/koordinator.sh/edit/main/docs/user-manuals/load-aware-descheduling.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-01-17T03:51:25.000Z">1/17/2023</time></b> by <b>Joseph</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/next/user-manuals/load-aware-scheduling"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Load Aware Scheduling</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/next/user-manuals/fine-grained-cpu-orchestration"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Fine-grained CPU Orchestration</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#setup" class="table-of-contents__link toc-highlight">Setup</a><ul><li><a href="#prerequisite" class="table-of-contents__link toc-highlight">Prerequisite</a></li><li><a href="#installation" class="table-of-contents__link toc-highlight">Installation</a></li><li><a href="#global-configuration-via-plugin-args" class="table-of-contents__link toc-highlight">Global Configuration via plugin args</a></li></ul></li><li><a href="#use-load-aware-descheduling" class="table-of-contents__link toc-highlight">Use Load Aware Descheduling</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/next/user-manuals/docs/installation">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/next/user-manuals/docs/user-manuals/colocation-profile">User Manuals</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/next/user-manuals/docs/architecture/overview">Architecture</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://join.slack.com/t/koordinator-sh/shared_invite/zt-1756qoub4-Cn4~esfdlfAPsD7cwO2NzA" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack ( #koordinator channel )<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/next/user-manuals/">DingTalk (GroupID: 33383887)</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/koordinator-sh/koordinator" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/next/user-manuals/blog">Blog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
        <br>
        <strong>Copyright ¬© 2023 The Koordinator Authors. All rights reserved.</strong></div></div></div></footer></div>
<script src="/assets/js/runtime~main.ea9c349b.js"></script>
<script src="/assets/js/main.ee3946e7.js"></script>
</body>
</html>