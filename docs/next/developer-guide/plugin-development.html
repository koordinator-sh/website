<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-developer-guide/plugin-development">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Developing Custom Scheduler Plugin | Koordinator</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://koordinator.sh/docs/next/developer-guide/plugin-development"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Developing Custom Scheduler Plugin | Koordinator"><meta data-rh="true" name="description" content="Introduction"><meta data-rh="true" property="og:description" content="Introduction"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://koordinator.sh/docs/next/developer-guide/plugin-development"><link data-rh="true" rel="alternate" href="https://koordinator.sh/docs/next/developer-guide/plugin-development" hreflang="en"><link data-rh="true" rel="alternate" href="https://koordinator.sh/zh-Hans/docs/next/developer-guide/plugin-development" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://koordinator.sh/docs/next/developer-guide/plugin-development" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://IRGGIU5RJ5-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Koordinator RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Koordinator Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Koordinator" href="/opensearch.xml">

<meta name="algolia-site-verification" content="94B07DDC59FCF9C7"><link rel="stylesheet" href="/assets/css/styles.d55f2266.css">
<link rel="preload" href="/assets/js/runtime~main.6d4c99ec.js" as="script">
<link rel="preload" href="/assets/js/main.9c7081d7.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">‚≠êÔ∏è If you like Koordinator, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/koordinator-sh/koordinator">GitHub</a>! ‚≠êÔ∏è</div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Koordinator" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="Koordinator" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Koordinator</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">Documentation</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/community/committee">Community</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/next">v1.8 üöß</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/next/developer-guide/plugin-development">v1.8 üöß</a></li><li><a class="dropdown__link" href="/docs/developer-guide/plugin-development">v1.7</a></li><li><a class="dropdown__link" href="/docs/v1.6">v1.6</a></li><li><a class="dropdown__link" href="/docs/v1.5">v1.5</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/docs/next/developer-guide/plugin-development" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/zh-Hans/docs/next/developer-guide/plugin-development" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-Hans">ÁÆÄ‰Ωì‰∏≠Êñá</a></li></ul></div><a href="https://github.com/koordinator-sh/koordinator" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/docs/next">Getting Started</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/installation">Installation</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/docs/next/architecture/overview">Architecture</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/architecture/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/architecture/resource-model">Resource Model</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/architecture/priority">Priority</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/architecture/qos">QoS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/architecture/job">Job</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/architecture/device">Device</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/next/user-manuals/gang-scheduling">User Manuals</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/next/designs/koordlet-overview">Design Details</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/next/best-practices/batch-colocation-quick-start">Best Practices</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/next/developer-guide/component-guide">Developer Guide</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/developer-guide/component-guide">Component Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/developer-guide/metrics-collection">Metrics Collection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/developer-guide/extensibility">Extensibility</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/next/developer-guide/plugin-development">Developing Custom Scheduler Plugin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/developer-guide/custom-scheduling-policies">Custom Scheduling Policies</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/developer-guide/webhook-extensions">Webhook Extensions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/developer-guide/develop-custom-deschedule-plugins">Developing Custom Descheduler Plugin</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/next/api-reference/custom-resource-definitions">API Reference</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <!-- -->Koordinator<!-- --> <b>v1.8 üöß</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/developer-guide/plugin-development">latest version</a></b> (<!-- -->v1.7<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Developer Guide</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Developing Custom Scheduler Plugin</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: v1.8 üöß</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Developing Custom Scheduler Plugin</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">‚Äã</a></h2><p>Koordinator provides a comprehensive plugin system for extending both scheduler and koordlet components. This document details the architecture, interface requirements, and development workflow for creating custom plugins. The plugin system enables developers to extend scheduling decisions and QoS policies through well-defined extension points.</p><p>The scheduler plugin architecture extends the Kubernetes Scheduling Framework via FrameworkExtender pattern. The QoS manager plugin system provides feature gate-based registration for implementing custom QoS policies at node level. Both systems follow consistent patterns for plugin registration, lifecycle management, and component integration.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="scheduler-plugin-architecture">Scheduler Plugin Architecture<a href="#scheduler-plugin-architecture" class="hash-link" aria-label="Direct link to Scheduler Plugin Architecture" title="Direct link to Scheduler Plugin Architecture">‚Äã</a></h2><p>Koordinator&#x27;s scheduler plugins extend Kubernetes Scheduling Framework through FrameworkExtender interface, enhancing the base framework with Koordinator capabilities. The extender pattern allows plugins to access Koordinator resources while participating in standard scheduling.</p><p>FrameworkExtender key capabilities:</p><ul><li>Access to Koordinator&#x27;s custom clientset for CRD interaction</li><li>Reservation nomination and restoration workflows</li><li>Custom error handling filters</li><li>Pod forget handlers for cleanup</li><li>Scheduling transformers to modify pod/node information</li></ul><p>Plugins register during initialization and are invoked at specific extension points. FrameworkExtender manages plugin lifecycle and coordinates execution across scheduling phases.</p><p><strong>Scheduler Plugin Architecture Class Structure:</strong></p><p>Core classes and relationships:</p><ul><li><p><strong>FrameworkExtender</strong> (Framework extender)</p><ul><li>Methods: <code>Scheduler()</code>, <code>KoordinatorClientSet()</code>, <code>GetReservationNominator()</code>, <code>RunReservationFilterPlugins()</code>, <code>RunReservationScorePlugins()</code>, <code>RunReservationRestoreReservation()</code></li></ul></li><li><p><strong>ExtendedHandle</strong> (Extended handle)</p><ul><li>Inherits: FrameworkExtender</li><li>Additional methods: <code>RegisterErrorHandlerFilters()</code>, <code>RegisterForgetPodHandler()</code></li></ul></li><li><p><strong>SchedulingTransformer</strong> (Scheduling transformer base interface)</p><ul><li>Methods: <code>Name() string</code></li></ul></li><li><p><strong>PreFilterTransformer</strong> (PreFilter transformer)</p><ul><li>Inherits: SchedulingTransformer</li><li>Methods: <code>BeforePreFilter()</code>, <code>AfterPreFilter()</code></li></ul></li><li><p><strong>FilterTransformer</strong> (Filter transformer)</p><ul><li>Inherits: SchedulingTransformer</li><li>Methods: <code>BeforeFilter()</code></li></ul></li><li><p><strong>ScoreTransformer</strong> (Score transformer)</p><ul><li>Inherits: SchedulingTransformer</li><li>Methods: <code>BeforeScore()</code></li></ul></li></ul><p>Relationships:</p><ul><li>ExtendedHandle contains and uses PreFilterTransformer, FilterTransformer, ScoreTransformer</li></ul><p><strong>Diagram sources</strong></p><ul><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/scheduler/frameworkext/interface.go#L37-L55" target="_blank" rel="noopener noreferrer">interface.go</a></li></ul><p><strong>Section sources</strong></p><ul><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/scheduler/frameworkext/interface.go#L37-L55" target="_blank" rel="noopener noreferrer">interface.go</a></li></ul><p>The FrameworkExtender interface provides several key capabilities:</p><ul><li>Access to Koordinator&#x27;s custom clientset for interacting with CRDs</li><li>Support for reservation nomination and restoration workflows</li><li>Custom error handling filters for intercepting scheduling errors</li><li>Pod forget handlers for cleanup operations</li><li>Scheduling transformers to modify pod and node information before processing</li></ul><p>Plugins register themselves with the framework during initialization and are invoked at specific extension points throughout the scheduling cycle. The FrameworkExtender implementation manages the lifecycle of these plugins and coordinates their execution across different scheduling phases.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="qos-manager-plugin-architecture">QoS Manager Plugin Architecture<a href="#qos-manager-plugin-architecture" class="hash-link" aria-label="Direct link to QoS Manager Plugin Architecture" title="Direct link to QoS Manager Plugin Architecture">‚Äã</a></h2><p>The QoS manager provides a plugin system for implementing custom QoS policies through feature gate-based registration, allowing dynamic plugin enablement/disablement.</p><p>Components:</p><ul><li><strong>ExtensionPlugin interface</strong>: Contract for QoS plugins (InitFlags, Setup, Run methods)</li><li><strong>RegisterQOSExtPlugin</strong>: Registers plugins with the system</li><li><strong>SetupPlugins</strong>: Initializes plugins with dependencies</li><li><strong>StartPlugins</strong>: Starts enabled plugins based on feature gates</li></ul><p>Plugins register using feature gates for dynamic control. The QoS manager orchestrates plugin lifecycle, ensuring proper initialization and startup.</p><p><strong>QoS Manager Plugin Architecture Class Diagram:</strong></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Core Classes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1. ExtensionPlugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Methods:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - InitFlags(fs *flag.FlagSet)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - Setup(client clientset.Interface, metricCache metriccache.MetricCache, statesInformer statesinformer.StatesInformer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - Run(stopCh &lt;-chan struct{})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Notes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - Interface for QOS extension plugins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - Each plugin must implement these methods</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. QOSExtensionConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Fields:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - FeatureGates: map[string]bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Methods:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - InitFlags(fs *flag.FlagSet)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Notes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - Configuration for QOS extension plugins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - Uses feature gates to enable/disable plugins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. QOSManager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Methods:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - Run(stopCh &lt;-chan struct{})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. CustomQOSPlugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - Inherits from ExtensionPlugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Relationships:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- CustomQOSPlugin inherits from ExtensionPlugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- QOSExtensionConfig ‚Üí ExtensionPlugin (configures)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- QOSManager ‚Üí ExtensionPlugin (manages)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- QOSManager ‚Üí QOSExtensionConfig (uses)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Diagram sources</strong></p><ul><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/koordlet/qosmanager/framework/extension.go" target="_blank" rel="noopener noreferrer">extension.go</a></li></ul><p><strong>Section sources</strong></p><ul><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/koordlet/qosmanager/framework/extension.go" target="_blank" rel="noopener noreferrer">extension.go</a></li></ul><p>The QoS manager plugin system operates through the following components:</p><ul><li><strong>ExtensionPlugin interface</strong>: Defines the contract for QoS extension plugins with InitFlags, Setup, and Run methods</li><li><strong>RegisterQOSExtPlugin function</strong>: Registers new QoS extension plugins with the system</li><li><strong>SetupPlugins function</strong>: Initializes all registered plugins with required dependencies</li><li><strong>StartPlugins function</strong>: Starts enabled plugins based on feature gate configuration</li></ul><p>Plugins are registered using feature gates, allowing for dynamic enablement and disablement. Each plugin must implement the ExtensionPlugin interface, which includes methods for flag initialization, setup with dependencies, and execution. The QoS manager orchestrates the lifecycle of these plugins, ensuring they are properly initialized and started.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="plugin-interface-requirements">Plugin Interface Requirements<a href="#plugin-interface-requirements" class="hash-link" aria-label="Direct link to Plugin Interface Requirements" title="Direct link to Plugin Interface Requirements">‚Äã</a></h2><p>Koordinator plugins must implement specific interfaces depending on their component and functionality. The interface requirements differ between scheduler plugins and QoS manager plugins, reflecting their distinct roles in the system.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="scheduler-plugin-interfaces">Scheduler Plugin Interfaces<a href="#scheduler-plugin-interfaces" class="hash-link" aria-label="Direct link to Scheduler Plugin Interfaces" title="Direct link to Scheduler Plugin Interfaces">‚Äã</a></h3><p>Scheduler plugins in Koordinator implement interfaces that extend the Kubernetes Scheduling Framework. These interfaces correspond to different phases of the scheduling cycle:</p><table><thead><tr><th>Extension Point</th><th>Interface</th><th>Purpose</th></tr></thead><tbody><tr><td><strong>PreEnqueue</strong></td><td>PreEnqueuePlugin</td><td>Early validation before scheduling begins</td></tr><tr><td><strong>PreFilter</strong></td><td>PreFilterPlugin</td><td>Pre-process pod and initialize cycle state</td></tr><tr><td><strong>Filter</strong></td><td>FilterPlugin</td><td>Evaluate if node meets pod requirements</td></tr><tr><td><strong>Score</strong></td><td>ScorePlugin</td><td>Rank nodes for pod placement</td></tr><tr><td><strong>Reserve</strong></td><td>ReservePlugin</td><td>Reserve resources for pod</td></tr><tr><td><strong>PreBind</strong></td><td>PreBindPlugin</td><td>Final checks before binding</td></tr><tr><td><strong>PostBind</strong></td><td>PostBindPlugin</td><td>Post-binding operations</td></tr></tbody></table><p>Additionally, Koordinator defines specialized interfaces for reservation handling:</p><ul><li><strong>ReservationFilterPlugin</strong>: Determines which reservations are available</li><li><strong>ReservationScorePlugin</strong>: Ranks reservations for pod placement</li><li><strong>ReservationRestorePlugin</strong>: Restores resources held by reservations</li><li><strong>ReservationNominator</strong>: Selects the most suitable reservation for a pod</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="qos-manager-plugin-interfaces">QoS Manager Plugin Interfaces<a href="#qos-manager-plugin-interfaces" class="hash-link" aria-label="Direct link to QoS Manager Plugin Interfaces" title="Direct link to QoS Manager Plugin Interfaces">‚Äã</a></h3><p>QoS manager plugins must implement the ExtensionPlugin interface, which defines the following methods:</p><ul><li><strong>InitFlags</strong>: Initializes command-line flags for the plugin</li><li><strong>Setup</strong>: Sets up the plugin with required dependencies (clientset, metric cache, states informer)</li><li><strong>Run</strong>: Starts the plugin&#x27;s main execution loop</li></ul><p>Plugins are registered through the RegisterQOSExtPlugin function and are managed by the QOSManager, which handles their lifecycle based on feature gate configuration.</p><p><strong>Section sources</strong></p><ul><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/koordlet/qosmanager/framework/extension.go" target="_blank" rel="noopener noreferrer">extension.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/koordlet/qosmanager/plugins/register.go" target="_blank" rel="noopener noreferrer">register.go</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="plugin-registration-mechanisms">Plugin Registration Mechanisms<a href="#plugin-registration-mechanisms" class="hash-link" aria-label="Direct link to Plugin Registration Mechanisms" title="Direct link to Plugin Registration Mechanisms">‚Äã</a></h2><p>Koordinator uses different registration mechanisms for scheduler plugins and QoS manager plugins, reflecting their distinct initialization processes and component architectures.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="scheduler-plugin-registration">Scheduler Plugin Registration<a href="#scheduler-plugin-registration" class="hash-link" aria-label="Direct link to Scheduler Plugin Registration" title="Direct link to Scheduler Plugin Registration">‚Äã</a></h3><p>Scheduler plugins are registered through the main.go file in the koord-scheduler component. The registration process involves:</p><ol><li>Defining a map of plugin names to factory functions</li><li>Flattening the plugin map into options for the scheduler command</li><li>Registering the plugins during scheduler initialization</li></ol><p><strong>Scheduler Plugin Registration Flow:</strong></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1. Plugin Registration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ‚Üì</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. Define Plugin Map</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ‚Üì</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. Flatten to Options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ‚Üì</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. Register with Scheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ‚Üì</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5. Initialize During Startup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ‚Üì</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6. Plugins Ready</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Diagram sources</strong></p><ul><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/cmd/koord-scheduler/main.go#L43-L79" target="_blank" rel="noopener noreferrer">main.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/cmd/koord-scheduler/app/server.go#L357-L391" target="_blank" rel="noopener noreferrer">server.go</a></li></ul><p>The registration process in code:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> koordinatorPlugins </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">map</span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">frameworkruntime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PluginFactory</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    loadaware</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">               loadaware</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">New</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nodenumaresource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">        nodenumaresource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">New</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reservation</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">             reservation</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">New</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    coscheduling</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">            coscheduling</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">New</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    deviceshare</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">             deviceshare</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">New</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    elasticquota</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">            elasticquota</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">New</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    defaultprebind</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">          defaultprebind</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">New</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    noderesourcesfitplus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">    noderesourcesfitplus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">New</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    scarceresourceavoidance</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> scarceresourceavoidance</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">New</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="qos-manager-plugin-registration">QoS Manager Plugin Registration<a href="#qos-manager-plugin-registration" class="hash-link" aria-label="Direct link to QoS Manager Plugin Registration" title="Direct link to QoS Manager Plugin Registration">‚Äã</a></h3><p>QoS manager plugins are registered through a feature gate-based system that allows for dynamic enablement and disablement. The registration process involves:</p><ol><li>Calling RegisterQOSExtPlugin with the plugin implementation</li><li>Configuring feature gates to enable/disable specific plugins</li><li>Initializing plugins during koordlet startup</li><li>Starting enabled plugins based on configuration</li></ol><p>The registration system uses a global registry to store plugin implementations and manages their lifecycle through the QOSManager component.</p><p><strong>Section sources</strong></p><ul><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/koordlet/qosmanager/plugins/register.go" target="_blank" rel="noopener noreferrer">register.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/koordlet/qosmanager/framework/extension.go" target="_blank" rel="noopener noreferrer">extension.go</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="scheduler-plugin-implementation-example">Scheduler Plugin Implementation Example<a href="#scheduler-plugin-implementation-example" class="hash-link" aria-label="Direct link to Scheduler Plugin Implementation Example" title="Direct link to Scheduler Plugin Implementation Example">‚Äã</a></h2><p>Creating a custom scheduler plugin in Koordinator follows a standardized pattern that ensures compatibility with the existing scheduling infrastructure. The implementation structure includes the plugin type, factory function, and scheduling cycle interface implementations.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="plugin-structure">Plugin Structure<a href="#plugin-structure" class="hash-link" aria-label="Direct link to Plugin Structure" title="Direct link to Plugin Structure">‚Äã</a></h3><p>A typical scheduler plugin in Koordinator follows this structure:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> Plugin </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    handle framework</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Handle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// plugin-specific fields</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">New</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">args runtime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Object</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> handle framework</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Handle</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">framework</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Plugin</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Initialize plugin with configuration and handle</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">p </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Plugin</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;PluginName&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Implement scheduling cycle interfaces</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">p </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Plugin</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">PreFilter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">p </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Plugin</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">p </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Plugin</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Score</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">p </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Plugin</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Reserve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Section sources</strong></p><ul><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/scheduler/plugins/loadaware/load_aware.go#L71-L79" target="_blank" rel="noopener noreferrer">load_aware.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/scheduler/plugins/elasticquota/plugin.go#L74-L93" target="_blank" rel="noopener noreferrer">elasticquota/plugin.go</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="plugin-initialization">Plugin Initialization<a href="#plugin-initialization" class="hash-link" aria-label="Direct link to Plugin Initialization" title="Direct link to Plugin Initialization">‚Äã</a></h3><p>The New function serves as the entry point for plugin creation and handles:</p><ul><li>Configuration parsing from the runtime.Object parameter</li><li>Validation of configuration parameters</li><li>Dependency injection through the framework handle</li><li>Event registration for cluster events the plugin needs to monitor</li></ul><p><strong>Plugin Initialization Flow:</strong></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1. Plugin Initialization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ‚Üì</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. Parse Configuration Object</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ‚Üì</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. Validate Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ‚Üì</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. Create Clientset (if needed)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ‚Üì</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5. Setup Shared Informers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ‚Üì</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6. Register Event Handlers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ‚Üì</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7. Register ForgetPodHandler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ‚Üì</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8. Return Plugin Instance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ‚Üì</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">9. Plugin Ready</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Diagram sources</strong></p><ul><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/scheduler/plugins/reservation/plugin.go#L93-L104" target="_blank" rel="noopener noreferrer">plugin.go</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="state-management">State Management<a href="#state-management" class="hash-link" aria-label="Direct link to State Management" title="Direct link to State Management">‚Äã</a></h3><p>Plugins use cycle state to maintain data across different scheduling phases. The cycle state is a thread-safe storage mechanism that allows plugins to share information:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getStateData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cycleState </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">framework</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CycleState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">stateData </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    v</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> cycleState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Read</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">stateKey</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">stateData</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    s</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ok </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">stateData</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain">ok </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> s </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">stateData</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Best practices for state management include using unique keys, implementing proper synchronization, cleaning up state in appropriate phases, and cloning state when necessary to prevent unintended modifications.</p><p><strong>Section sources</strong></p><ul><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/scheduler/plugins/reservation/reservation_state.go#L143-L162" target="_blank" rel="noopener noreferrer">reservation_state.go</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="qos-manager-plugin-implementation-example">QoS Manager Plugin Implementation Example<a href="#qos-manager-plugin-implementation-example" class="hash-link" aria-label="Direct link to QoS Manager Plugin Implementation Example" title="Direct link to QoS Manager Plugin Implementation Example">‚Äã</a></h2><p>Creating a custom QoS manager plugin involves implementing the ExtensionPlugin interface and registering the plugin with the QoS manager system. The implementation follows a consistent pattern across all QoS extension plugins.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="plugin-structure-1">Plugin Structure<a href="#plugin-structure-1" class="hash-link" aria-label="Direct link to Plugin Structure" title="Direct link to Plugin Structure">‚Äã</a></h3><p>A QoS manager plugin must implement the ExtensionPlugin interface with the following methods:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> ExtensionPlugin </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">InitFlags</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fs </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">flag</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FlagSet</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">Setup</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">client clientset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Interface</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> metricCache metriccache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">MetricCache</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> statesInformer statesinformer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">StatesInformer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">Run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">stopCh </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token keyword" style="color:#00009f">chan</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Each method serves a specific purpose in the plugin lifecycle:</p><ul><li><strong>InitFlags</strong>: Registers command-line flags specific to the plugin</li><li><strong>Setup</strong>: Initializes the plugin with dependencies from the koordlet</li><li><strong>Run</strong>: Executes the plugin&#x27;s main logic in a goroutine</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="plugin-registration">Plugin Registration<a href="#plugin-registration" class="hash-link" aria-label="Direct link to Plugin Registration" title="Direct link to Plugin Registration">‚Äã</a></h3><p>QoS manager plugins are registered through the RegisterQOSExtPlugin function, which adds the plugin to the global registry. The registration process ensures that each plugin has a unique name and is properly integrated into the QoS manager system.</p><p>Plugins are enabled or disabled through feature gates in the koordlet configuration, allowing for dynamic control over which QoS policies are active in the cluster.</p><p><strong>Section sources</strong></p><ul><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/koordlet/qosmanager/framework/extension.go" target="_blank" rel="noopener noreferrer">extension.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/koordlet/qosmanager/plugins/register.go" target="_blank" rel="noopener noreferrer">register.go</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="development-workflow">Development Workflow<a href="#development-workflow" class="hash-link" aria-label="Direct link to Development Workflow" title="Direct link to Development Workflow">‚Äã</a></h2><p>The complete development workflow for creating custom plugins in Koordinator involves several stages from creation to deployment. This workflow ensures that plugins are properly integrated, tested, and deployed in production environments.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="plugin-creation">Plugin Creation<a href="#plugin-creation" class="hash-link" aria-label="Direct link to Plugin Creation" title="Direct link to Plugin Creation">‚Äã</a></h3><ol><li><strong>Define the plugin structure</strong>: Create a struct that holds the plugin&#x27;s state and dependencies</li><li><strong>Implement the required interfaces</strong>: Implement the appropriate interfaces for the plugin type</li><li><strong>Create the factory function</strong>: Implement the New function that initializes the plugin</li><li><strong>Register the plugin</strong>: Add the plugin to the appropriate registration system</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="testing">Testing<a href="#testing" class="hash-link" aria-label="Direct link to Testing" title="Direct link to Testing">‚Äã</a></h3><p>Koordinator provides comprehensive testing utilities for both scheduler and QoS manager plugins:</p><ul><li>Unit tests for individual plugin methods</li><li>Integration tests with the full scheduling cycle</li><li>End-to-end tests for complete workflows</li><li>Benchmarking for performance evaluation</li></ul><p>Test utilities include mock informers for CRDs and Kubernetes resources, test fixtures for common scenarios, assertion helpers for validating decisions, and performance measurement tools.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="deployment">Deployment<a href="#deployment" class="hash-link" aria-label="Direct link to Deployment" title="Direct link to Deployment">‚Äã</a></h3><p>Plugins are deployed as part of the koord-scheduler or koordlet components:</p><ul><li>Scheduler plugins are included in the koord-scheduler binary</li><li>QoS manager plugins are included in the koordlet binary</li><li>Configuration is managed through component configuration files</li><li>Feature gates control plugin enablement</li></ul><p><strong>Section sources</strong></p><ul><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/cmd/koord-scheduler/main.go#L43-L79" target="_blank" rel="noopener noreferrer">main.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/cmd/koord-scheduler/app/server.go#L419-L489" target="_blank" rel="noopener noreferrer">server.go</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="lifecycle-methods-and-callback-mechanisms">Lifecycle Methods and Callback Mechanisms<a href="#lifecycle-methods-and-callback-mechanisms" class="hash-link" aria-label="Direct link to Lifecycle Methods and Callback Mechanisms" title="Direct link to Lifecycle Methods and Callback Mechanisms">‚Äã</a></h2><p>Koordinator plugins have well-defined lifecycle methods and callback mechanisms that enable them to participate in various stages of the system&#x27;s operation.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="scheduler-plugin-lifecycle">Scheduler Plugin Lifecycle<a href="#scheduler-plugin-lifecycle" class="hash-link" aria-label="Direct link to Scheduler Plugin Lifecycle" title="Direct link to Scheduler Plugin Lifecycle">‚Äã</a></h3><p>Scheduler plugins participate in the scheduling cycle through extension point callbacks:</p><ul><li><strong>PreEnqueue</strong>: Called early in the scheduling process for validation</li><li><strong>PreFilter</strong>: Called to pre-process pod information and initialize state</li><li><strong>Filter</strong>: Called to evaluate if nodes meet pod requirements</li><li><strong>Score</strong>: Called to rank suitable nodes for pod placement</li><li><strong>Reserve</strong>: Called to temporarily reserve resources on the selected node</li><li><strong>PreBind</strong>: Called for final validation before binding</li><li><strong>PostBind</strong>: Called for post-binding operations and cleanup</li></ul><p>Plugins can also implement specialized lifecycle methods for reservation handling:</p><ul><li><strong>PreRestoreReservation</strong>: Called before restoring resources held by reservations</li><li><strong>RestoreReservation</strong>: Called to restore fine-grained resources during scheduling</li><li><strong>FilterReservation</strong>: Called to determine which reservations are available</li><li><strong>ScoreReservation</strong>: Called to rank reservations for pod placement</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="qos-manager-plugin-lifecycle">QoS Manager Plugin Lifecycle<a href="#qos-manager-plugin-lifecycle" class="hash-link" aria-label="Direct link to QoS Manager Plugin Lifecycle" title="Direct link to QoS Manager Plugin Lifecycle">‚Äã</a></h3><p>QoS manager plugins follow a different lifecycle pattern:</p><ul><li><strong>InitFlags</strong>: Called during koordlet startup to register command-line flags</li><li><strong>Setup</strong>: Called to initialize the plugin with dependencies</li><li><strong>Run</strong>: Called to start the plugin&#x27;s main execution loop</li><li><strong>Stop</strong>: Called during shutdown to clean up resources</li></ul><p>The QoS manager uses callback mechanisms to notify plugins of state changes:</p><ul><li><strong>RegisterCallbacks</strong>: Registers update callbacks for specific object types</li><li><strong>SendCallback</strong>: Triggers callbacks when state changes occur</li><li><strong>UpdateCbFn</strong>: The callback function type that plugins implement</li></ul><p><strong>Section sources</strong></p><ul><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/scheduler/frameworkext/interface.go#L37-L55" target="_blank" rel="noopener noreferrer">interface.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/koordlet/qosmanager/framework/extension.go" target="_blank" rel="noopener noreferrer">extension.go</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="common-pitfalls-and-debugging-strategies">Common Pitfalls and Debugging Strategies<a href="#common-pitfalls-and-debugging-strategies" class="hash-link" aria-label="Direct link to Common Pitfalls and Debugging Strategies" title="Direct link to Common Pitfalls and Debugging Strategies">‚Äã</a></h2><p>Developing plugins for Koordinator requires attention to common pitfalls and effective debugging strategies to ensure reliable and performant operation.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="common-development-pitfalls">Common Development Pitfalls<a href="#common-development-pitfalls" class="hash-link" aria-label="Direct link to Common Development Pitfalls" title="Direct link to Common Development Pitfalls">‚Äã</a></h3><ol><li><strong>State Management Issues</strong>: Improper state management can lead to race conditions and memory leaks</li><li><strong>Error Handling</strong>: Inadequate error handling can cause silent failures in the scheduler</li><li><strong>Resource Leaks</strong>: Failure to clean up resources can lead to memory exhaustion</li><li><strong>Thread Safety</strong>: Concurrent access to shared data structures without proper synchronization</li><li><strong>Configuration Validation</strong>: Insufficient validation of plugin configuration parameters</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="debugging-strategies">Debugging Strategies<a href="#debugging-strategies" class="hash-link" aria-label="Direct link to Debugging Strategies" title="Direct link to Debugging Strategies">‚Äã</a></h3><ol><li><strong>Logging</strong>: Enable verbose logging for specific plugins during development</li><li><strong>Metrics</strong>: Monitor Prometheus metrics to identify performance bottlenecks</li><li><strong>Diagnosis Information</strong>: Analyze failure reasons in PostFilter to understand scheduling rejections</li><li><strong>Event Tracing</strong>: Use event tracing to understand the sequence of plugin execution</li><li><strong>Unit Testing</strong>: Write comprehensive unit tests for all plugin methods</li><li><strong>Integration Testing</strong>: Test plugins in integration environments that simulate production workloads</li></ol><p>Best practices for debugging include:</p><ul><li>Using the cycle state for debugging information storage</li><li>Implementing comprehensive logging at different verbosity levels</li><li>Monitoring plugin-specific metrics for performance analysis</li><li>Using the framework&#x27;s built-in debugging tools and utilities</li><li>Testing edge cases and failure scenarios thoroughly</li></ul><p><strong>Section sources</strong></p><ul><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/scheduler/plugins/reservation/plugin.go" target="_blank" rel="noopener noreferrer">plugin.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/scheduler/plugins/loadaware/load_aware.go" target="_blank" rel="noopener noreferrer">load_aware.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/scheduler/plugins/elasticquota/plugin.go" target="_blank" rel="noopener noreferrer">elasticquota/plugin.go</a></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/koordinator-sh/koordinator.sh/edit/main/docs/developer-guide/plugin-development.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-10-17T09:18:21.000Z">Oct 17, 2025</time></b> by <b>‰πîÊôÆ</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/next/developer-guide/extensibility"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Extensibility</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/next/developer-guide/custom-scheduling-policies"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Custom Scheduling Policies</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#scheduler-plugin-architecture" class="table-of-contents__link toc-highlight">Scheduler Plugin Architecture</a></li><li><a href="#qos-manager-plugin-architecture" class="table-of-contents__link toc-highlight">QoS Manager Plugin Architecture</a></li><li><a href="#plugin-interface-requirements" class="table-of-contents__link toc-highlight">Plugin Interface Requirements</a><ul><li><a href="#scheduler-plugin-interfaces" class="table-of-contents__link toc-highlight">Scheduler Plugin Interfaces</a></li><li><a href="#qos-manager-plugin-interfaces" class="table-of-contents__link toc-highlight">QoS Manager Plugin Interfaces</a></li></ul></li><li><a href="#plugin-registration-mechanisms" class="table-of-contents__link toc-highlight">Plugin Registration Mechanisms</a><ul><li><a href="#scheduler-plugin-registration" class="table-of-contents__link toc-highlight">Scheduler Plugin Registration</a></li><li><a href="#qos-manager-plugin-registration" class="table-of-contents__link toc-highlight">QoS Manager Plugin Registration</a></li></ul></li><li><a href="#scheduler-plugin-implementation-example" class="table-of-contents__link toc-highlight">Scheduler Plugin Implementation Example</a><ul><li><a href="#plugin-structure" class="table-of-contents__link toc-highlight">Plugin Structure</a></li><li><a href="#plugin-initialization" class="table-of-contents__link toc-highlight">Plugin Initialization</a></li><li><a href="#state-management" class="table-of-contents__link toc-highlight">State Management</a></li></ul></li><li><a href="#qos-manager-plugin-implementation-example" class="table-of-contents__link toc-highlight">QoS Manager Plugin Implementation Example</a><ul><li><a href="#plugin-structure-1" class="table-of-contents__link toc-highlight">Plugin Structure</a></li><li><a href="#plugin-registration" class="table-of-contents__link toc-highlight">Plugin Registration</a></li></ul></li><li><a href="#development-workflow" class="table-of-contents__link toc-highlight">Development Workflow</a><ul><li><a href="#plugin-creation" class="table-of-contents__link toc-highlight">Plugin Creation</a></li><li><a href="#testing" class="table-of-contents__link toc-highlight">Testing</a></li><li><a href="#deployment" class="table-of-contents__link toc-highlight">Deployment</a></li></ul></li><li><a href="#lifecycle-methods-and-callback-mechanisms" class="table-of-contents__link toc-highlight">Lifecycle Methods and Callback Mechanisms</a><ul><li><a href="#scheduler-plugin-lifecycle" class="table-of-contents__link toc-highlight">Scheduler Plugin Lifecycle</a></li><li><a href="#qos-manager-plugin-lifecycle" class="table-of-contents__link toc-highlight">QoS Manager Plugin Lifecycle</a></li></ul></li><li><a href="#common-pitfalls-and-debugging-strategies" class="table-of-contents__link toc-highlight">Common Pitfalls and Debugging Strategies</a><ul><li><a href="#common-development-pitfalls" class="table-of-contents__link toc-highlight">Common Development Pitfalls</a></li><li><a href="#debugging-strategies" class="table-of-contents__link toc-highlight">Debugging Strategies</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/next/developer-guide/docs/installation">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/next/developer-guide/docs/user-manuals/colocation-profile">User Manuals</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/next/developer-guide/docs/architecture/overview">Architecture</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://join.slack.com/t/koordinator-sh/shared_invite/zt-1756qoub4-Cn4~esfdlfAPsD7cwO2NzA" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack ( #koordinator channel )<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/next/developer-guide/">DingTalk (GroupID: 33383887)</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/koordinator-sh/koordinator" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/next/developer-guide/blog">Blog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
        <div style="font-size: 18px">
        <br>
        <strong>Koordinator is a <a href="https://www.cncf.io/">Cloud Native Computing Foundation</a> sandbox project</strong>
        <br>
        </div>
        <br>
        <img src="img/cncf-color.svg" alt="CNCF" width="auto" height="100px">
        <br>
        <div style="font-size: 14px">
        The Linux Foundation¬Æ (TLF) has registered trademarks and uses trademarks. For a list of TLF trademarks, see <a href="https://www.linuxfoundation.org/trademark-usage/">Trademark Usage</a>.
        <br>
        Copyright ¬© 2026 The Koordinator Authors. All rights reserved.
        </div>
        </div></div></div></footer></div>
<script src="/assets/js/runtime~main.6d4c99ec.js"></script>
<script src="/assets/js/main.9c7081d7.js"></script>
</body>
</html>