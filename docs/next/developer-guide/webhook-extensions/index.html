<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-developer-guide/webhook-extensions">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Webhook Extensions | Koordinator</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://koordinator.sh/docs/next/developer-guide/webhook-extensions"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Webhook Extensions | Koordinator"><meta data-rh="true" name="description" content="Introduction"><meta data-rh="true" property="og:description" content="Introduction"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://koordinator.sh/docs/next/developer-guide/webhook-extensions"><link data-rh="true" rel="alternate" href="https://koordinator.sh/docs/next/developer-guide/webhook-extensions" hreflang="en"><link data-rh="true" rel="alternate" href="https://koordinator.sh/zh-Hans/docs/next/developer-guide/webhook-extensions" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://koordinator.sh/docs/next/developer-guide/webhook-extensions" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://FKASWWQYOP-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Koordinator RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Koordinator Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Koordinator" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.d55f2266.css">
<link rel="preload" href="/assets/js/runtime~main.abdea256.js" as="script">
<link rel="preload" href="/assets/js/main.3b983ed9.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">⭐️ If you like Koordinator, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/koordinator-sh/koordinator">GitHub</a>! ⭐️</div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Koordinator" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="Koordinator" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Koordinator</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">Documentation</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/next/">v1.7 🚧</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/next/developer-guide/webhook-extensions">v1.7 🚧</a></li><li><a class="dropdown__link" href="/docs/">v1.6</a></li><li><a class="dropdown__link" href="/docs/v1.5/">v1.5</a></li><li><a class="dropdown__link" href="/docs/v1.4/">v1.4</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/docs/next/developer-guide/webhook-extensions" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/zh-Hans/docs/next/developer-guide/webhook-extensions" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-Hans">简体中文</a></li></ul></div><a href="https://github.com/koordinator-sh/koordinator" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/docs/next/">Getting Started</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/installation">Installation</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/docs/next/architecture/overview">Architecture</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/architecture/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/architecture/resource-model">Resource Model</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/architecture/priority">Priority</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/architecture/qos">QoS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/architecture/job">Job</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/architecture/device">Device</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/next/user-manuals/gang-scheduling">User Manuals</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/next/designs/koordlet-overview">Design Details</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/next/best-practices/batch-colocation-quick-start">Best Practices</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/next/developer-guide/component-guide">Developer Guide</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/developer-guide/component-guide">Component Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/developer-guide/metrics-collection">Metrics Collection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/developer-guide/extensibility">Extensibility</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/developer-guide/plugin-development">Developing Custom Scheduler Plugin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/developer-guide/custom-scheduling-policies">Custom Scheduling Policies</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/next/developer-guide/webhook-extensions">Webhook Extensions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/developer-guide/develop-custom-deschedule-plugins">Developing Custom Descheduler Plugin</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/next/api-reference/custom-resource-definitions">API Reference</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <!-- -->Koordinator<!-- --> <b>v1.7 🚧</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/">latest version</a></b> (<!-- -->v1.6<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Developer Guide</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Webhook Extensions</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: v1.7 🚧</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Webhook Extensions</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">​</a></h2><p>Koordinator provides an extensible webhook framework that enables custom admission control logic through mutating and validating webhooks. This document details the webhook mechanisms available for extending Koordinator&#x27;s functionality, focusing on pod, node, and quota admission controls. The framework in <code>pkg/webhook/util/framework</code> provides a structured approach for implementing custom webhook plugins with proper registration, certificate management, and service configuration.</p><p><strong>Section sources</strong></p><ul><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/server.go#L1-L162" target="_blank" rel="noopener noreferrer">server.go</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="webhook-framework-architecture">Webhook Framework Architecture<a href="#webhook-framework-architecture" class="hash-link" aria-label="Direct link to Webhook Framework Architecture" title="Direct link to Webhook Framework Architecture">​</a></h2><p><strong>Webhook Core Architecture:</strong></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Webhook Core Components</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── Webhook Server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── HandlerBuilder Interface</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── HandlerBuilderMap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Webhook Types</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── Mutating Webhooks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── Validating Webhooks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Resource-Specific Handlers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── Pod Webhooks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── Node Webhooks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── Quota Webhooks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── ConfigMap Webhooks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── Reservation Webhooks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Relationship Flow:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HandlerBuilder → HandlerBuilderMap → Webhook Server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Webhook Server → Mutating/Validating Webhooks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mutating/Validating Webhooks → Various Resource Handlers</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Diagram sources</strong></p><ul><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/server.go#L44" target="_blank" rel="noopener noreferrer">server.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/util/framework/builder.go#L1-L28" target="_blank" rel="noopener noreferrer">builder.go</a></li></ul><p><strong>Section sources</strong></p><ul><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/server.go#L1-L162" target="_blank" rel="noopener noreferrer">server.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/util/framework/builder.go#L1-L28" target="_blank" rel="noopener noreferrer">builder.go</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="mutating-and-validating-webhook-interfaces">Mutating and Validating Webhook Interfaces<a href="#mutating-and-validating-webhook-interfaces" class="hash-link" aria-label="Direct link to Mutating and Validating Webhook Interfaces" title="Direct link to Mutating and Validating Webhook Interfaces">​</a></h2><p>The webhook framework defines a standardized interface for both mutating and validating webhooks through the <code>HandlerBuilder</code> interface in <code>pkg/webhook/util/framework/builder.go</code>. This interface requires two methods: <code>WithControllerManager</code> to inject the controller manager dependency, and <code>Build</code> to construct the admission handler.</p><p>Mutating webhooks modify resources during creation or update operations, while validating webhooks reject requests that don&#x27;t meet specific criteria. Both types follow the same registration pattern but serve different purposes in the admission control process.</p><p><strong>Webhook Handler Class Structure:</strong></p><p>Core classes and relationships:</p><ul><li><p><strong>HandlerBuilder</strong> (Handler builder interface)</p><ul><li>Methods: <code>WithControllerManager(mgr ctrl.Manager) HandlerBuilder</code>, <code>Build() admission.Handler</code></li></ul></li><li><p><strong>PodMutatingHandler</strong> (Pod mutating handler)</p><ul><li>Fields: <code>Client client.Client</code>, <code>Decoder *admission.Decoder</code></li><li>Methods: <code>Handle(ctx, req)</code>, <code>InjectClient(c)</code>, <code>InjectDecoder(d)</code></li><li>Implements: HandlerBuilder</li></ul></li><li><p><strong>PodValidatingHandler</strong> (Pod validating handler)</p><ul><li>Fields: <code>Client client.Client</code>, <code>Decoder *admission.Decoder</code>, <code>QuotaEvaluator</code>, <code>PodEnhancedValidator</code></li><li>Methods: <code>Handle(ctx, req)</code>, <code>InjectClient(c)</code>, <code>InjectDecoder(d)</code></li><li>Implements: HandlerBuilder</li></ul></li><li><p><strong>NodeMutatingHandler</strong> (Node mutating handler)</p><ul><li>Fields: <code>Client client.Client</code>, <code>Decoder *admission.Decoder</code>, <code>ignoreFilter IgnoreFilter</code></li><li>Methods: <code>Handle(ctx, req)</code>, <code>InjectClient(c)</code>, <code>InjectDecoder(d)</code></li><li>Implements: HandlerBuilder</li></ul></li><li><p><strong>ElasticQuotaMutatingHandler</strong> (Elastic quota mutating handler)</p><ul><li>Fields: <code>Client client.Client</code>, <code>Decoder *admission.Decoder</code></li><li>Methods: <code>Handle(ctx, req)</code>, <code>InjectClient(c)</code>, <code>InjectDecoder(decoder)</code>, <code>InjectCache(cache)</code></li><li>Implements: HandlerBuilder</li></ul></li></ul><p><strong>Diagram sources</strong></p><ul><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/util/framework/builder.go#L1-L28" target="_blank" rel="noopener noreferrer">builder.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/pod/mutating/mutating_handler.go#L1-L177" target="_blank" rel="noopener noreferrer">mutating_handler.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/pod/validating/validating_handler.go#L1-L162" target="_blank" rel="noopener noreferrer">validating_handler.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/node/mutating/mutating_handler.go#L1-L164" target="_blank" rel="noopener noreferrer">mutating_handler.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/elasticquota/mutating/mutating_handler.go#L1-L121" target="_blank" rel="noopener noreferrer">mutating_handler.go</a></li></ul><p><strong>Section sources</strong></p><ul><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/util/framework/builder.go#L1-L28" target="_blank" rel="noopener noreferrer">builder.go</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="pod-webhook-implementation">Pod Webhook Implementation<a href="#pod-webhook-implementation" class="hash-link" aria-label="Direct link to Pod Webhook Implementation" title="Direct link to Pod Webhook Implementation">​</a></h2><p>Pod webhooks in Koordinator handle both mutating and validating operations for pod resources. The mutating webhook processes pod creation by applying various transformations, while the validating webhook ensures pods meet specific criteria before admission.</p><p>The pod mutating webhook implements multiple mutation functions that are executed sequentially during pod creation, including cluster colocation profile application, extended resource specification, multi-quota tree affinity, and device resource specification. Each mutation function is timed and metrics are recorded for performance monitoring.</p><p>The pod validating webhook performs comprehensive validation checks, including cluster reservation validation, cluster colocation profile validation, elastic quota validation, quota evaluation, device resource validation, and enhanced validation. These validations are executed in sequence, and any failure results in the rejection of the pod creation request.</p><p><strong>Pod Webhook Processing Flow:</strong></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Participants:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- APIserver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- PodMutatingWebhook (Pod mutating webhook)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- PodValidatingWebhook (Pod validating webhook)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Flow:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1. Client → APIserver: Create Pod Request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. APIserver → PodMutatingWebhook: Admission Review</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. PodMutatingWebhook internal processing:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - Apply ClusterColocationProfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - Apply ExtendedResourceSpec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - Add MultiQuotaTree Affinity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - Apply DeviceResourceSpec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. PodMutatingWebhook → APIserver: Return Mutated Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5. APIserver → PodValidatingWebhook: Admission Review</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6. PodValidatingWebhook internal validation:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - Validate ClusterReservation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - Validate ClusterColocationProfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - Validate ElasticQuota</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - Evaluate Quota</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - Validate DeviceResource</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - Enhanced Validation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7. PodValidatingWebhook → APIserver: Validation Response</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8. APIserver → Client: Pod Created or Rejected</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Diagram sources</strong></p><ul><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/add_pod.go#L1-L35" target="_blank" rel="noopener noreferrer">add_pod.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/pod/mutating/mutating_handler.go#L1-L177" target="_blank" rel="noopener noreferrer">mutating_handler.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/pod/validating/validating_handler.go#L1-L162" target="_blank" rel="noopener noreferrer">validating_handler.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/pod/mutating/webhooks.go#L31-L33" target="_blank" rel="noopener noreferrer">webhooks.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/pod/validating/webhooks.go#L31-L33" target="_blank" rel="noopener noreferrer">webhooks.go</a></li></ul><p><strong>Section sources</strong></p><ul><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/add_pod.go#L1-L35" target="_blank" rel="noopener noreferrer">add_pod.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/pod/mutating/mutating_handler.go#L1-L177" target="_blank" rel="noopener noreferrer">mutating_handler.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/pod/validating/validating_handler.go#L1-L162" target="_blank" rel="noopener noreferrer">validating_handler.go</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="node-webhook-implementation">Node Webhook Implementation<a href="#node-webhook-implementation" class="hash-link" aria-label="Direct link to Node Webhook Implementation" title="Direct link to Node Webhook Implementation">​</a></h2><p>Node webhooks in Koordinator focus on mutating node status resources rather than the node resources themselves. The implementation is designed to modify node status information during updates, enabling dynamic adjustment of node properties based on various plugins.</p><p>The node mutating webhook uses a plugin-based architecture where multiple plugins can be registered to handle different aspects of node mutation. Currently, the resource amplification plugin is implemented to adjust node resource reporting. The webhook specifically targets the node status sub-resource, ensuring that only status updates are processed.</p><p><strong>Node Webhook Processing Flow:</strong></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1. Node Status Update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ↓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. Check Resource Type (Resource = nodes?)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ├─ No → Allow Request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   └─ Yes → Continue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ↓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. Check SubResource (SubResource = status?)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ├─ No → Allow Request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   └─ Yes → Continue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ↓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. Decode Node Object</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ↓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5. Create Deep Copy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ↓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6. For Each Plugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ↓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7. Call plugin.Admit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ↓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8. Check Error?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ├─ Yes → Reject Request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   └─ No → Next Plugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ↓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">9. Last Plugin?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ├─ No → Return to Step 6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   └─ Yes → Continue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ↓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10. Modified?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├─ No → Allow Request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └─ Yes → Continue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ↓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">11. Generate JSON Patch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ↓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">12. Return Patch Response</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Diagram sources</strong></p><ul><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/add_node.go#L1-L36" target="_blank" rel="noopener noreferrer">add_node.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/node/mutating/mutating_handler.go#L1-L164" target="_blank" rel="noopener noreferrer">mutating_handler.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/node/mutating/webhooks.go#L30-L32" target="_blank" rel="noopener noreferrer">webhooks.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/node/validating/webhooks.go#L30-L32" target="_blank" rel="noopener noreferrer">webhooks.go</a></li></ul><p><strong>Section sources</strong></p><ul><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/add_node.go#L1-L36" target="_blank" rel="noopener noreferrer">add_node.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/node/mutating/mutating_handler.go#L1-L164" target="_blank" rel="noopener noreferrer">mutating_handler.go</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="quota-webhook-implementation">Quota Webhook Implementation<a href="#quota-webhook-implementation" class="hash-link" aria-label="Direct link to Quota Webhook Implementation" title="Direct link to Quota Webhook Implementation">​</a></h2><p>Quota webhooks in Koordinator handle the admission control for elastic quota resources. These webhooks ensure that quota specifications are valid and properly configured before they are applied to the cluster.</p><p>The elastic quota mutating webhook processes quota creation and updates by applying necessary mutations through the quota plugin system. The webhook specifically targets the elasticquotas resource and uses the quota topology plugin to perform the actual mutation logic. The implementation includes proper error handling and metrics collection for performance monitoring.</p><p><strong>Elastic Quota Webhook Processing Flow:</strong></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Participants:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- APIserver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- QuotaMutatingWebhook (Quota mutating webhook)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- QuotaPlugin (Quota plugin)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Flow:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1. Client → APIserver: Create/Update ElasticQuota</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. APIserver → QuotaMutatingWebhook: Admission Review</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. QuotaMutatingWebhook internal processing:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - Decode Quota Object</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - Create Copy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. QuotaMutatingWebhook → QuotaPlugin: NewPlugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5. QuotaMutatingWebhook → QuotaPlugin: AdmitQuota</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6. QuotaPlugin internal: Apply Quota Topology</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7. QuotaPlugin → QuotaMutatingWebhook: Mutation Result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8. QuotaMutatingWebhook internal:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - Compare Original vs Modified</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - Generate JSON Patch if Modified</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">9. QuotaMutatingWebhook → APIserver: Patch Response</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10. APIserver → Client: Quota Created/Updated or Rejected</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Diagram sources</strong></p><ul><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/add_quota.go#L1-L37" target="_blank" rel="noopener noreferrer">add_quota.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/elasticquota/mutating/mutating_handler.go#L1-L121" target="_blank" rel="noopener noreferrer">mutating_handler.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/elasticquota/mutating/webhooks.go#L31-L33" target="_blank" rel="noopener noreferrer">webhooks.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/elasticquota/validating/webhooks.go#L31-L33" target="_blank" rel="noopener noreferrer">webhooks.go</a></li></ul><p><strong>Section sources</strong></p><ul><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/add_quota.go#L1-L37" target="_blank" rel="noopener noreferrer">add_quota.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/elasticquota/mutating/mutating_handler.go#L1-L121" target="_blank" rel="noopener noreferrer">mutating_handler.go</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="custom-webhook-plugin-development">Custom Webhook Plugin Development<a href="#custom-webhook-plugin-development" class="hash-link" aria-label="Direct link to Custom Webhook Plugin Development" title="Direct link to Custom Webhook Plugin Development">​</a></h2><p>Developing custom webhook plugins in Koordinator follows a standardized pattern using the framework in <code>pkg/webhook/util/framework</code>. Developers can create new webhook plugins by implementing the <code>HandlerBuilder</code> interface and registering their handlers in the appropriate webhook package.</p><p>The process involves creating a new package under the webhook directory for the target resource, implementing the mutating or validating handler struct, and registering the handler builder in the package&#x27;s <code>webhooks.go</code> file. Feature gates control the enablement of webhook plugins, allowing for gradual rollout and testing.</p><p><strong>Custom Webhook Plugin Development Flow:</strong></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1. Create New Webhook Package</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ↓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. Implement Handler Struct</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ↓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. Fulfill HandlerBuilder Interface</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ↓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. Implement WithControllerManager Method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ↓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5. Implement Build Method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ↓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6. Create webhooks.go File</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ↓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7. Register Handler to HandlerBuilderMap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ↓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8. Add to init() in add_&lt;resource&gt;.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ↓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">9. Use Feature Gate for Enablement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ↓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10. Implement Unit Tests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ↓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">11. Integrate with Webhook Server</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Section sources</strong></p><ul><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/util/framework/builder.go#L1-L28" target="_blank" rel="noopener noreferrer">builder.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/add_pod.go#L1-L35" target="_blank" rel="noopener noreferrer">add_pod.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/add_node.go#L1-L36" target="_blank" rel="noopener noreferrer">add_node.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/add_quota.go#L1-L37" target="_blank" rel="noopener noreferrer">add_quota.go</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="webhook-registration-and-configuration">Webhook Registration and Configuration<a href="#webhook-registration-and-configuration" class="hash-link" aria-label="Direct link to Webhook Registration and Configuration" title="Direct link to Webhook Registration and Configuration">​</a></h2><p>Webhook registration in Koordinator follows a centralized pattern where individual webhook packages register their handlers through the <code>addHandlersWithGate</code> function in <code>pkg/webhook/server.go</code>. This function takes a map of handler builders and a gate function that determines whether the webhook should be enabled based on feature flags.</p><p>Each resource-specific webhook is registered in its corresponding <code>add_&lt;resource&gt;.go</code> file, which calls <code>addHandlersWithGate</code> with the appropriate handler builder map and feature gate check. This modular approach allows for independent development and testing of webhook functionality.</p><p>The registration process also includes setting up the webhook server with the appropriate host, port, and certificate directory, which are configured through the webhook utility package.</p><p><strong>Webhook Registration and Configuration Flow:</strong></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Participants:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Main (main program)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- WebhookServer (webhook server)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- HandlerRegistry (handler registry)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- HandlerBuilder (handler builder)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Flow:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1. Main → WebhookServer: SetupWithManager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. WebhookServer → HandlerRegistry: filterActiveHandlers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. HandlerRegistry internal processing:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - Check Feature Gates</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - Remove Disabled Handlers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. WebhookServer → HandlerRegistry: Iterate HandlerBuilderMap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5. For each HandlerBuilder:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - HandlerRegistry → HandlerBuilder: WithControllerManager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - HandlerBuilder internal: Build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - WebhookServer: Register Handler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6. WebhookServer internal:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - Register Conversion Handler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - Register Health Handler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7. WebhookServer → Main: Return Success</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Diagram sources</strong></p><ul><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/server.go#L1-L162" target="_blank" rel="noopener noreferrer">server.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/add_pod.go#L1-L35" target="_blank" rel="noopener noreferrer">add_pod.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/add_node.go#L1-L36" target="_blank" rel="noopener noreferrer">add_node.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/add_quota.go#L1-L37" target="_blank" rel="noopener noreferrer">add_quota.go</a></li></ul><p><strong>Section sources</strong></p><ul><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/server.go#L1-L162" target="_blank" rel="noopener noreferrer">server.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/add_pod.go#L1-L35" target="_blank" rel="noopener noreferrer">add_pod.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/add_node.go#L1-L36" target="_blank" rel="noopener noreferrer">add_node.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/add_quota.go#L1-L37" target="_blank" rel="noopener noreferrer">add_quota.go</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="certificate-management-and-service-configuration">Certificate Management and Service Configuration<a href="#certificate-management-and-service-configuration" class="hash-link" aria-label="Direct link to Certificate Management and Service Configuration" title="Direct link to Certificate Management and Service Configuration">​</a></h2><p>Certificate management for Koordinator webhooks is handled through the webhook utility package, which provides functions to retrieve the certificate directory and port configuration. The webhook server is configured to use TLS with certificates stored in the specified directory.</p><p>The service configuration is defined in the <code>config/webhook</code> directory, which contains the necessary manifests for deploying the webhook service, including the service definition, certificate manager configuration, and webhook manifests. The kustomization files in this directory orchestrate the deployment of the webhook components.</p><p>The certificate generation and management process is automated, with the webhook controller handling the lifecycle of webhook configurations and certificates. This ensures that the webhook server can securely communicate with the Kubernetes API server.</p><p><strong>Section sources</strong></p><ul><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/server.go#L1-L162" target="_blank" rel="noopener noreferrer">server.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/config/webhook" target="_blank" rel="noopener noreferrer">config/webhook</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="security-considerations">Security Considerations<a href="#security-considerations" class="hash-link" aria-label="Direct link to Security Considerations" title="Direct link to Security Considerations">​</a></h2><p>Security considerations for Koordinator webhooks include proper authentication and authorization through RBAC configuration, secure communication via TLS, and input validation to prevent malicious requests. The webhook server requires specific permissions to access secrets for certificate management and to update webhook configurations.</p><p>Feature gates provide an additional security layer by allowing administrators to enable or disable specific webhooks based on their security requirements. The modular design of the webhook system ensures that individual webhooks can be disabled without affecting the overall functionality of the system.</p><p>Input validation is critical in webhook handlers to prevent injection attacks and ensure data integrity. All webhook handlers should validate incoming requests and reject malformed or unauthorized requests with appropriate error messages.</p><p><strong>Section sources</strong></p><ul><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/server.go#L1-L162" target="_blank" rel="noopener noreferrer">server.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/add_pod.go#L1-L35" target="_blank" rel="noopener noreferrer">add_pod.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/add_node.go#L1-L36" target="_blank" rel="noopener noreferrer">add_node.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/add_quota.go#L1-L37" target="_blank" rel="noopener noreferrer">add_quota.go</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="performance-implications">Performance Implications<a href="#performance-implications" class="hash-link" aria-label="Direct link to Performance Implications" title="Direct link to Performance Implications">​</a></h2><p>Performance implications of custom webhook development in Koordinator include latency added to the admission control process, resource utilization of the webhook server, and potential bottlenecks during high-volume operations. Each webhook handler introduces additional processing time that can impact the overall cluster performance.</p><p>The framework includes built-in metrics collection to monitor webhook performance, with duration metrics recorded for each webhook operation. These metrics help identify performance bottlenecks and optimize webhook implementations.</p><p>To minimize performance impact, webhook handlers should be designed to be lightweight and efficient, avoiding expensive operations or external dependencies. Caching and batching can be used to reduce the overhead of repeated operations.</p><p><strong>Section sources</strong></p><ul><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/server.go#L1-L162" target="_blank" rel="noopener noreferrer">server.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/pod/mutating/mutating_handler.go#L1-L177" target="_blank" rel="noopener noreferrer">mutating_handler.go</a></li><li><a href="https://github.com/koordinator-sh/koordinator/tree/main/pkg/webhook/pod/validating/validating_handler.go#L1-L162" target="_blank" rel="noopener noreferrer">validating_handler.go</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2><p>Koordinator&#x27;s webhook framework provides a robust and extensible mechanism for implementing custom admission control logic. The system supports both mutating and validating webhooks for various resources including pods, nodes, and quotas, with a standardized interface for plugin development.</p><p>The architecture emphasizes modularity, security, and performance, with feature gates enabling controlled rollout of new webhook functionality. The framework in <code>pkg/webhook/util/framework</code> provides the necessary abstractions for building custom webhook plugins, while the registration system ensures proper integration with the webhook server.</p><p>When developing custom webhook plugins, developers should follow the established patterns, implement proper error handling, and consider the performance implications of their code. The comprehensive metrics collection system enables monitoring and optimization of webhook performance in production environments.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/koordinator-sh/koordinator.sh/edit/main/docs/developer-guide/webhook-extensions.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-10-17T09:18:21.000Z">Oct 17, 2025</time></b> by <b>乔普</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/next/developer-guide/custom-scheduling-policies"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Custom Scheduling Policies</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/next/developer-guide/develop-custom-deschedule-plugins"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Developing Custom Descheduler Plugin</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#webhook-framework-architecture" class="table-of-contents__link toc-highlight">Webhook Framework Architecture</a></li><li><a href="#mutating-and-validating-webhook-interfaces" class="table-of-contents__link toc-highlight">Mutating and Validating Webhook Interfaces</a></li><li><a href="#pod-webhook-implementation" class="table-of-contents__link toc-highlight">Pod Webhook Implementation</a></li><li><a href="#node-webhook-implementation" class="table-of-contents__link toc-highlight">Node Webhook Implementation</a></li><li><a href="#quota-webhook-implementation" class="table-of-contents__link toc-highlight">Quota Webhook Implementation</a></li><li><a href="#custom-webhook-plugin-development" class="table-of-contents__link toc-highlight">Custom Webhook Plugin Development</a></li><li><a href="#webhook-registration-and-configuration" class="table-of-contents__link toc-highlight">Webhook Registration and Configuration</a></li><li><a href="#certificate-management-and-service-configuration" class="table-of-contents__link toc-highlight">Certificate Management and Service Configuration</a></li><li><a href="#security-considerations" class="table-of-contents__link toc-highlight">Security Considerations</a></li><li><a href="#performance-implications" class="table-of-contents__link toc-highlight">Performance Implications</a></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/next/developer-guide/docs/installation">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/next/developer-guide/docs/user-manuals/colocation-profile">User Manuals</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/next/developer-guide/docs/architecture/overview">Architecture</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://join.slack.com/t/koordinator-sh/shared_invite/zt-1756qoub4-Cn4~esfdlfAPsD7cwO2NzA" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack ( #koordinator channel )<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/next/developer-guide/">DingTalk (GroupID: 33383887)</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/koordinator-sh/koordinator" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/next/developer-guide/blog">Blog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
        <div style="font-size: 18px">
        <br>
        <strong>Koordinator is a <a href="https://www.cncf.io/">Cloud Native Computing Foundation</a> sandbox project</strong>
        <br>
        </div>
        <br>
        <img src="img/cncf-color.svg" alt="CNCF" width="auto" height="100px">
        <br>
        <div style="font-size: 14px">
        The Linux Foundation® (TLF) has registered trademarks and uses trademarks. For a list of TLF trademarks, see <a href="https://www.linuxfoundation.org/trademark-usage/">Trademark Usage</a>.
        <br>
        Copyright © 2025 The Koordinator Authors. All rights reserved.
        </div>
        </div></div></div></footer></div>
<script src="/assets/js/runtime~main.abdea256.js"></script>
<script src="/assets/js/main.3b983ed9.js"></script>
</body>
</html>